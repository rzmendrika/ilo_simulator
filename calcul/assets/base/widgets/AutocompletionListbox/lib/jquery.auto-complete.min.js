(function(n){n.fn.autoComplete=function(t){var i=n.extend({},n.fn.autoComplete.defaults,t);return typeof t=="string"?(this.each(function(){var i=n(this);t=="destroy"?(n(window).off("resize.autocomplete",i.updateSC),i.off("blur.autocomplete focus.autocomplete keydown.autocomplete keyup.autocomplete"),i.data("autocomplete")?i.attr("autocomplete",i.data("autocomplete")):i.removeAttr("autocomplete"),n(i.data("sc")).remove(),i.removeData("sc").removeData("autocomplete")):t=="clearSuggestions"&&(i.val(""),i.last_val="\n")}),this):this.each(function(){function o(r){var o=t.val(),e,f,s;if(t.userInput=t.val(),t.cache[o]=r,t.data("suggestions",r.length),e=i.announce(r.length),r.length&&o.length>=i.minChars){for(t.sc.empty(),f=0;f<r.length;f++)s=n(i.renderItem(r[f],o)),s.attr({id:t.sc.attr("id")+"-suggestion-"+(f+1),role:"option",tabindex:"-1"}),t.sc.append(s);t.updateSC(0);u(e)}else u(e),r.length==0?(t.sc.html(e),t.updateSC(0)):(t.sc.attr("aria-hidden",!0),t.sc.hide())}function s(){return t.sc.html()&&t.sc.is(":visible")&&t.data("suggestions")>0}function u(t){var r=n("#"+i.menuId+"-announce").find("p").text();r!=t&&setTimeout(function(){n("#"+i.menuId+"-announce").html("<p>"+t+"<\/p>")},20)}function r(n){n.length&&(n.addClass("selected"),t.val(n.data("val")),t.attr("aria-activedescendant",n.attr("id")),t.updateSC(0,n))}function l(n,r){if(r.length&&t.sc.is(":visible")){n.preventDefault();n.stopPropagation();i.onSelect(n,r.data("val"),r);setTimeout(function(){t.removeAttr("aria-activedescendant");t.sc.empty();t.sc.hide();u("")},20)}}function c(n){n.preventDefault();n.stopPropagation();t.val(t.userInput);t.last_val=t.val();t.removeAttr("aria-activedescendant");setTimeout(function(){t.sc.empty();t.focus()},300)}var t=n(this),h,f,e;if(t.sc=n("<div>",{id:i.menuId,role:"listbox","class":"autocomplete-suggestions"}),t.attr({role:"combobox","aria-owns":i.menuId,"aria-autocomplete":"both",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}),i.menuClass&&t.sc.addClass(i.menuClass),t.data("sc",t.sc).data("autocomplete",t.attr("autocomplete")).data("suggestions",0),t.attr("autocomplete","off"),t.cache={},t.last_val="",t.userInput=t.val(),h=n("<div>",{id:i.menuId+"-announce","class":"sr-only","aria-live":"polite"}),t.before(h),i.clearButton){f=n("<button>",{id:i.menuId+"-clear","class":"autocomplete-input-clear-button",role:"button","aria-label":i.clearButton,title:i.clearButton});f.append('<span class="glyphicon glyphicon-remove"><\/span><\/a>');f.on("click",function(n){return n.preventDefault(),i.onClear(),t.autoComplete("clearSuggestions"),!1});t.after(f)}t.updateSC=function(r,u){var e=i.alignOnParent?t.parent():t,o,f;t.sc.css({top:e.offset().top+e.outerHeight(),left:e.offset().left,width:e.outerWidth()});r||(t.sc.show(),t.sc.removeAttr("aria-hidden"),t.sc.maxHeight||(t.sc.maxHeight=parseInt(t.sc.css("max-height"))),t.sc.suggestionHeight||(t.sc.suggestionHeight=n(".autocomplete-suggestion",t.sc).first().outerHeight()),t.sc.suggestionHeight&&(u?(o=t.sc.scrollTop(),f=u.offset().top-t.sc.offset().top,f+t.sc.suggestionHeight-t.sc.maxHeight>0?t.sc.scrollTop(f+t.sc.suggestionHeight+o-t.sc.maxHeight):f<0&&t.sc.scrollTop(f+o)):t.sc.scrollTop(0)))};n(window).on("resize.autocomplete",t.updateSC);t.sc.appendTo("body");i.helpText&&(e=n("<p>",{id:t.sc.attr("id")+"-help","class":"sr-only",text:i.helpText}),t.before(e),t.attr("aria-describedby",t.sc.attr("id")+"-help"),e.hide());t.sc.on("mouseleave",".autocomplete-suggestion",function(){n(".autocomplete-suggestion.selected").removeClass("selected");t.removeAttr("aria-activedescendant")});t.sc.on("mouseenter",".autocomplete-suggestion",function(){n(".autocomplete-suggestion.selected").removeClass("selected");n(this).addClass("selected");t.attr("aria-activedescendant",n(this).attr("id"))});t.sc.on("mousedown click",".autocomplete-suggestion",function(r){var f=n(this),e=f.data("val");if(e||f.hasClass("autocomplete-suggestion")){t.val(e);i.onSelect(r,e,f);u("");setTimeout(function(){t.sc.hide()},20);t.focus()}return!1});t.on("blur.autocomplete",function(){try{over_sb=n(".autocomplete-suggestions:hover").length}catch(i){over_sb=0}over_sb?t.is(":focus")||setTimeout(function(){t.focus()},20):(t.last_val=t.val(),t.sc.hide(),u(""),setTimeout(function(){t.sc.hide()},350))});if(!i.minChars)t.on("focus.autocomplete",function(){t.last_val="\n";t.trigger("keyup.autocomplete")});t.on("keydown.autocomplete",function(f){var e,o;if(f.which==40&&s())return o=n(".autocomplete-suggestion.selected",t.sc),o.length?(e=o.next(".autocomplete-suggestion"),o.removeClass("selected"),e.length?r(e):(e=n(".autocomplete-suggestion",t.sc).first(),r(e))):(e=n(".autocomplete-suggestion",t.sc).first(),r(e)),!1;if(f.which==38&&s())return o=n(".autocomplete-suggestion.selected",t.sc),o.length?(e=o.prev(".autocomplete-suggestion"),o.removeClass("selected"),e.length?r(e):(e=n(".autocomplete-suggestion",t.sc).last(),r(e))):(e=n(".autocomplete-suggestion",t.sc).last(),r(e)),!1;if(f.which==27)t.val(t.last_val).sc.hide(),u(""),t.focus();else if(f.which==13||f.which==32)o=n(".autocomplete-suggestion.selected",t.sc),l(f,o);else if(f.which==9)if(s())if(f.shiftKey)if(o=n(".autocomplete-suggestion.selected",t.sc),o.length){if(e=o.prev(".autocomplete-suggestion"),o.removeClass("selected"),e.length)return r(e),!1;c(f)}else return e=n(".autocomplete-suggestion",t.sc).last(),r(e),!1;else if(o=n(".autocomplete-suggestion.selected",t.sc),o.length){if(e=o.next(".autocomplete-suggestion"),o.removeClass("selected"),e.length)return r(e),!1;c(f)}else return e=n(".autocomplete-suggestion",t.sc).first(),r(e),!1;else f.shiftKey||i.clearButton||setTimeout(function(){t.sc.empty();i.onTab()},300);else f.which==8||f.which==46?(t.sc.empty(),u(""),setTimeout(function(){if(t.val()=="")i.onClear();else i.onInput(t.val())},20)):setTimeout(function(){i.onInput(t.val())},20)});t.on("keyup.autocomplete",function(r){var u,f,e;if(!~n.inArray(r.which,[9,13,16,27,32,35,36,37,38,39,40]))if(u=t.val(),u.length>=i.minChars){if(u!=t.last_val){if(t.last_val=u,clearTimeout(t.timer),i.cache){if(u in t.cache){o(t.cache[u]);return}for(f=1;f<u.length-i.minChars;f++)if(e=u.slice(0,u.length-f),e in t.cache&&!t.cache[e].length){o([]);return}}t.timer=setTimeout(function(){i.source(u,o)},i.delay)}}else t.last_val=u,t.sc.hide()})})};n.fn.autoComplete.defaults={source:0,minChars:3,delay:150,cache:1,alignOnParent:!1,menuId:"autocomplete-suggestions",menuClass:"",helpText:"",clearButton:"",renderItem:function(n,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var i=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+n+'">'+n.replace(i,"<b>$1<\/b>")+"<\/div>"},announce:function(n){switch(n){case 0:return"There is no suggestion";case 1:return"There is one suggestion";default:return"There are "+n+" suggestions, use up and down arrows to review."}},onSelect:function(){},onClear:function(){},onInput:function(){},onTab:function(){}}})(jQuery)