(function(c){var f=c.dom;c.toolbar.Dialog=c.lang.Dispatcher.extend({constructor:function(a,d){this.link=a;this.container=d},_observe:function(){if(!this._observed){var a=this,d=function(d){var c=a._serialize();a.fire("save",c);a.hide();d.preventDefault();d.stopPropagation()};f.observe(a.link,"click",function(){f.hasClass(a.link,"wysihtml-command-dialog-opened")&&setTimeout(function(){a.hide()},0)});f.observe(this.container,"keydown",function(g){var f=g.keyCode;f===c.ENTER_KEY&&d(g);f===c.ESCAPE_KEY&&
a.cancel()});f.delegate(this.container,"[data-wysihtml-dialog-action=save]","click",d);f.delegate(this.container,"[data-wysihtml-dialog-action=cancel]","click",function(d){a.cancel();d.preventDefault();d.stopPropagation()});this._observed=!0}},_serialize:function(){for(var a={},d=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),c=d.length,f=0;f<c;f++)a[d[f].getAttribute("data-wysihtml-dialog-field")]=d[f].value;return a},_interpolate:function(a){for(var d,c,f=document.querySelector(":focus"),
k=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),b=k.length,h=0;h<b;h++)d=k[h],d===f||a&&"hidden"===d.type||(c=d.getAttribute("data-wysihtml-dialog-field"),c=this.elementToChange&&"boolean"!==typeof this.elementToChange?this.elementToChange.getAttribute(c)||"":d.defaultValue,d.value=c)},update:function(a){this.elementToChange=a?a:this.elementToChange;this._interpolate();this.fire("change")},show:function(a){var c=this.container.querySelector("input, select, textarea");this._observe();
this.update(a);f.addClass(this.link,"wysihtml-command-dialog-opened");this.container.style.display="";this.isOpen=!0;this.fire("show");if(c&&!a)try{c.focus()}catch(g){}},_hide:function(a){this.elementToChange=null;f.removeClass(this.link,"wysihtml-command-dialog-opened");this.container.style.display="none";this.isOpen=!1},hide:function(){this._hide();this.fire("hide")},cancel:function(){this._hide();this.fire("cancel")}})})(wysihtml);
(function(c){c.toolbar.Dialog_bgColorStyle=c.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var c={},a=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),d=a.length,g=0;g<d;g++)c[a[g].getAttribute("data-wysihtml-dialog-field")]=a[g].value;return c},_interpolate:function(f){for(var a,d=document.querySelector(":focus"),g=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),m=g.length,k=0,b=(a=(a=this.elementToChange?c.lang.object(this.elementToChange).isArray()?
this.elementToChange[0]:this.elementToChange:null)?a.getAttribute("style"):null)?c.quirks.styleParser.parseColor(a,"background-color"):null;k<m;k++)a=g[k],a===d||f&&"hidden"===a.type||"color"!==a.getAttribute("data-wysihtml-dialog-field")||(a.value=b?b[3]&&1!=b[3]?"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+");":"rgb("+b[0]+","+b[1]+","+b[2]+");":"rgb(0,0,0);")}})})(wysihtml);(function(c){c.toolbar.Dialog_createTable=c.toolbar.Dialog.extend({show:function(c){this.base(c)}})})(wysihtml);
(function(c){c.toolbar.Dialog_fontSizeStyle=c.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml-dialog-field="size"]').value}},_interpolate:function(f){f=document.querySelector(":focus");var a=this.container.querySelector("[data-wysihtml-dialog-field='size']"),d=this.elementToChange?c.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null;d=(d=d?d.getAttribute("style"):null)?c.quirks.styleParser.parseFontSize(d):
null;a&&a!==f&&d&&!/^\s*$/.test(d)&&(a.value=d)}})})(wysihtml);
(function(c){c.toolbar.Dialog_foreColorStyle=c.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var c={},a=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),d=a.length,g=0;g<d;g++)c[a[g].getAttribute("data-wysihtml-dialog-field")]=a[g].value;return c},_interpolate:function(f){for(var a,d,g=c.quirks.styleParser,m=document.querySelector(":focus"),k=this.container.querySelectorAll("[data-wysihtml-dialog-field]"),b=k.length,h=0,n=(a=(a=this.elementToChange?c.lang.object(this.elementToChange).isArray()?
this.elementToChange[0]:this.elementToChange:null)?a.getAttribute("style"):null)?g.parseColor(a,"color"):null;h<b;h++)a=k[h],a===m||f&&"hidden"===a.type||"color"!==a.getAttribute("data-wysihtml-dialog-field")||(d=(a.dataset.colormode||"rgb").toLowerCase(),d="hex"===d?"hash":d,a.value=n?g.unparseColor(n,d):g.unparseColor([0,0,0],d))}})})(wysihtml);
(function(c){var f=c.dom,a={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},g={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},m={"x-webkit-speech":"",speech:""};c.toolbar.Speech=function(k,b){var h=document.createElement("input");if(c.browser.supportsSpeechApiOn(h)){var n=k.editor.textarea.element.getAttribute("lang");n&&(m.lang=n);n=document.createElement("div");
c.lang.object(d).merge({width:b.offsetWidth+"px",height:b.offsetHeight+"px"});f.insert(h).into(n);f.insert(n).into(b);f.setStyles(g).on(h);f.setAttributes(m).on(h);f.setStyles(d).on(n);f.setStyles(a).on(b);f.observe(h,"onwebkitspeechchange"in h?"webkitspeechchange":"speechchange",function(){k.execCommand("insertText",h.value);h.value=""});f.observe(h,"click",function(c){f.hasClass(b,"wysihtml-command-disabled")&&c.preventDefault();c.stopPropagation()})}else b.style.display="none"}})(wysihtml);
(function(c){function f(b,h){b=b.commands.state(h.name,h.value);!h.dialog.multiselect&&c.lang.object(b).isArray()&&(b=1===b.length?b[0]:!0);return b}var a="wysihtml-command-disabled",d="wysihtml-commands-disabled",g="wysihtml-command-active",m="wysihtml-action-active",k=c.dom;c.toolbar.Toolbar=Base.extend({constructor:function(b,h,n){this.editor=b;this.container="string"===typeof h?document.getElementById(h):h;this.composer=b.composer;this._getLinks("command");this._getLinks("action");this._observe();
n&&this.show();null!=b.config.classNameCommandDisabled&&(a=b.config.classNameCommandDisabled);null!=b.config.classNameCommandsDisabled&&(d=b.config.classNameCommandsDisabled);null!=b.config.classNameCommandActive&&(g=b.config.classNameCommandActive);null!=b.config.classNameActionActive&&(m=b.config.classNameActionActive);b=this.container.querySelectorAll("[data-wysihtml-command=insertSpeech]");h=b.length;for(n=0;n<h;n++)new c.toolbar.Speech(this,b[n])},_getLinks:function(b){for(var h=this[b+"Links"]=
c.lang.array(this.container.querySelectorAll("[data-wysihtml-"+b+"]")).get(),a=h.length,d=0,e=this[b+"Mapping"]={},f,g,k,m,q,r;d<a;d++)f=h[d],k=f.getAttribute("data-wysihtml-"+b),m=f.getAttribute("data-wysihtml-"+b+"-value"),r=f.getAttribute("data-wysihtml-"+b+"-blank-value"),g=this.container.querySelector("[data-wysihtml-"+b+"-group='"+k+"']"),q=this._getDialog(f,k),e[k+":"+m]={link:f,group:g,name:k,value:m,tracksBlankValue:r,dialog:q,state:!1}},_getDialog:function(b,a){var d=this,h=this.container.querySelector("[data-wysihtml-dialog='"+
a+"']"),e;if(h){var f=c.toolbar["Dialog_"+a]?new c.toolbar["Dialog_"+a](b,h):new c.toolbar.Dialog(b,h);f.on("show",function(){e=d.composer.selection.getBookmark();d.editor.fire("show:dialog",{command:a,dialogContainer:h,commandLink:b})});f.on("change",function(){e=d.composer.selection.getBookmark();d.editor.fire("change:dialog",{command:a,dialogContainer:h,commandLink:b})});f.on("save",function(c){e&&d.composer.selection.setBookmark(e);d._execCommand(a,c);d.editor.fire("save:dialog",{command:a,dialogContainer:h,
commandLink:b});d._hideAllDialogs();d._preventInstantFocus();e=void 0});f.on("cancel",function(){e&&d.composer.selection.setBookmark(e);d.editor.fire("cancel:dialog",{command:a,dialogContainer:h,commandLink:b});e=void 0;d._preventInstantFocus()});f.on("hide",function(){d.editor.fire("hide:dialog",{command:a,dialogContainer:h,commandLink:b});e=void 0})}return f},execCommand:function(b,a){this.commandsDisabled||this._execCommand(b,a)},_execCommand:function(b,a){this.editor.focus(!1);this.composer.commands.exec(b,
a);this._updateLinkStates()},execAction:function(b){var a=this.editor;"change_view"===b&&(a.currentView===a.textarea||"source"===a.currentView?a.fire("change_view","composer"):a.fire("change_view","textarea"));"showSource"==b&&a.fire("showSource")},_observe:function(){for(var b=this,a=this.editor,g=this.container,m=this.commandLinks.concat(this.actionLinks),e=m.length,l=0;l<e;l++)if("A"===m[l].nodeName)k.setAttributes({href:"javascript:;",unselectable:"on"}).on(m[l]);else k.setAttributes({unselectable:"on"}).on(m[l]);
k.delegate(g,"[data-wysihtml-command], [data-wysihtml-action]","mousedown",function(b){b.preventDefault()});k.delegate(g,"[data-wysihtml-command]","click",function(a){var c=this.getAttribute("data-wysihtml-command");var d=this.getAttribute("data-wysihtml-command-value"),e=b.commandMapping[c+":"+d];d||!e.dialog?b.execCommand(c,d):(c=f(b.composer,e),e.dialog.show(c));a.preventDefault()});k.delegate(g,"[data-wysihtml-action]","click",function(a){var c=this.getAttribute("data-wysihtml-action");b.execAction(c);
a.preventDefault()});a.on("interaction:composer",function(a){b.preventFocus||b._updateLinkStates()});this._ownerDocumentClick=function(a){c.dom.contains(b.container,a.target)||c.dom.contains(b.composer.element,a.target)||(b._updateLinkStates(),b._preventInstantFocus())};this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1);this.editor.on("destroy:composer",this.destroy.bind(this));this.editor.config.handleTables&&(a.on("tableselect:composer",function(){b.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display=
""}),a.on("tableunselect:composer",function(){b.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display="none"}));a.on("change_view",function(a){setTimeout(function(){b.commandsDisabled="composer"!==a;b._updateLinkStates();b.commandsDisabled?k.addClass(g,d):k.removeClass(g,d)},0)})},destroy:function(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function(){var b=this.commandMapping,a;for(a in b)b[a].dialog&&b[a].dialog.hide()},
_preventInstantFocus:function(){this.preventFocus=!0;setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var b,c=this.commandMapping,d=this.composer,p=this.actionMapping;for(b in c){var e=c[b];if(this.commandsDisabled){var l=!1;k.removeClass(e.link,g);e.group&&k.removeClass(e.group,g);e.dialog&&e.dialog.hide()}else l=this.composer.commands.state(e.name,e.value),k.removeClass(e.link,a),e.group&&k.removeClass(e.group,a);if(e.state!==l||e.tracksBlankValue)if(e.state=
l)if(e.tracksBlankValue)k.removeClass(e.link,g);else{if(k.addClass(e.link,g),e.group&&k.addClass(e.group,g),e.dialog&&("undefined"===typeof e.value||null===e.value))if(l&&"object"===typeof l){l=f(d,e);e.state=l;var t=e.dialog.container.dataset?e.dialog.container.dataset.showdialogonselection:!1;d.config.showToolbarDialogsOnSelection||t?e.dialog.show(l):e.dialog.update(l)}else e.dialog.hide()}else e.tracksBlankValue?k.addClass(e.link,g):(k.removeClass(e.link,g),e.group&&k.removeClass(e.group,g),e.dialog&&
!e.value&&e.dialog.hide())}for(b in p)l=p[b],"change_view"===l.name&&(l.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,l.state?k.addClass(l.link,m):k.removeClass(l.link,m))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}});c.Editor.prototype.defaults.toolbar=void 0;c.Editor.prototype.defaults.showToolbarAfterInit=!0;c.Editor.prototype.defaults.showToolbarDialogsOnSelection=!0;c.extendEditor(function(a){a.config.toolbar&&
(a.toolbar=new c.toolbar.Toolbar(a,a.config.toolbar,a.config.showToolbarAfterInit),a.on("destroy:composer",function(){a&&a.toolbar&&a.toolbar.destroy()}))})})(wysihtml);
