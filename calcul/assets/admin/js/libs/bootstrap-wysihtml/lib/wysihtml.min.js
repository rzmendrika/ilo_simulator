/*
 wysihtml v0.6.0-beta1
 https://github.com/Voog/wysihtml

 Author: Christopher Blum (https://github.com/tiff)
 Secondary author of extended features: Oliver Pulges (https://github.com/pulges)

 Copyright (C) 2012 XING AG
 Licensed under the MIT license (MIT)

*/
var wysihtml={version:"0.6.0-beta1",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},editorExtenders:[],extendEditor:function(a){this.editorExtenders.push(a)},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,VOID_ELEMENTS:"area, base, br, col, embed, hr, img, input, keygen, link, meta, param, source, track, wbr",PERMITTED_PHRASING_CONTENT_ONLY:"h1, h2, h3, h4, h5, h6, p, pre",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,
SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46,polyfills:function(a,e){var d={normalizeHasCaretError:function(){if("createRange"in e&&"getSelection"in a){var d=window.pageYOffset,f=window.pageXOffset,b=e.createElement("div"),c=e.createTextNode("a"),h=e.createTextNode("a"),l=e.createTextNode("a"),k=e.createRange(),q;if(document.activeElement)if(1===document.activeElement.nodeType&&-1<["INPUT","TEXTAREA","SELECT","BUTTON"].indexOf(document.activeElement.nodeName))var n={type:"form",node:document.activeElement,
start:document.activeElement.selectionStart,end:document.activeElement.selectionEnd};else(q=a.getSelection())&&q.anchorNode&&(n={type:"range",anchorNode:q.anchorNode,anchorOffset:q.anchorOffset,focusNode:q.focusNode,focusOffset:q.focusOffset});b.setAttribute("contenteditable","true");b.appendChild(c);b.appendChild(h);b.appendChild(l);e.body.appendChild(b);k.setStart(h,1);k.setEnd(h,1);q=a.getSelection();q.removeAllRanges();q.addRange(k);b.normalize();q=a.getSelection();c=1!==b.childNodes.length||
q.anchorNode!==b.firstChild||2!==q.anchorOffset;b.parentNode.removeChild(b);q.removeAllRanges();n&&("form"===n.type?("undefined"!==typeof n.start&&"undefined"!==typeof n.end&&n.node.setSelectionRange(n.start,n.end),n.node.focus()):"range"===n.type&&(k=e.createRange(),k.setStart(n.anchorNode,n.anchorOffset),k.setEnd(n.focusNode,n.focusOffset),q.addRange(k)));d===window.pageYOffset&&f===window.pageXOffset||a.scrollTo(f,d);return c}},apply:function(){function g(){try{var b=new a.CustomEvent("cat",{detail:{foo:"bar"}});
return"cat"===b.type&&"bar"===b.detail.foo}catch(l){}return!1}(function(a){a.matches=a.matches||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){a=(this.document||this.ownerDocument).querySelectorAll(a);for(var b=0;a[b]&&a[b]!==this;)++b;return a[b]?!0:!1};a.closest=a.closest||function(a){for(var b=this;b&&!b.matches(a);)b=b.parentElement;return b};a.remove=a.remove||function(){this.parentNode&&this.parentNode.removeChild(this)}})(a.Element.prototype);
"classList"in e.documentElement||!a.Object.defineProperty||"undefined"===typeof a.HTMLElement||a.Object.defineProperty(a.HTMLElement.prototype,"classList",{get:function(){function b(a){return function(b){var d=c.className.split(/\s+/),e=d.indexOf(b);a(d,e,b);c.className=d.join(" ")}}var c=this,d={add:b(function(a,b,c){~b||a.push(c)}),remove:b(function(a,b){~b&&a.splice(b,1)}),toggle:b(function(a,b,c){~b?a.splice(b,1):a.push(c)}),contains:function(a){return!!~c.className.split(/\s+/).indexOf(a)},item:function(a){return c.className.split(/\s+/)[a]||
null}};a.Object.defineProperty(d,"length",{get:function(){return c.className.split(/\s+/).length}});return d}});var f=function(a){var b=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b.push(a):b=b.concat(f(a));return b},b=function(){a.Node.prototype.normalize=function(){var b=f(this),c=this.ownerDocument.defaultView.getSelection(),d=c.anchorNode,e=c.anchorOffset,g=d&&1===d.nodeType&&0<d.childNodes.length?d.childNodes[e]:void 0,r=c.focusNode,w=c.focusOffset,C=r&&1===r.nodeType&&0<w?r.childNodes[w-
1]:void 0,y=this.ownerDocument.createRange(),z=b.shift(),D=z?b.shift():null;C&&3===C.nodeType&&(r=C,w=C.nodeValue.length,C=void 0);g&&3===g.nodeType&&(d=g,e=0,g=void 0);if(d===r&&w<e||d!==r&&d.compareDocumentPosition(r)&a.Node.DOCUMENT_POSITION_PRECEDING&&!(d.compareDocumentPosition(r)&a.Node.DOCUMENT_POSITION_CONTAINS))r=[d,d=r][0],w=[e,e=w][0];for(;z&&D;)D.previousSibling&&D.previousSibling===z?(d===D&&(d=z,e=z.nodeValue.length+e),r===D&&(r=z,w=z.nodeValue.length+w),z.nodeValue+=D.nodeValue,D.parentNode.removeChild(D)):
z=D,D=b.shift();C&&(w=Array.prototype.indexOf.call(C.parentNode.childNodes,C)+1);g&&(e=Array.prototype.indexOf.call(g.parentNode.childNodes,g));a:{b=this.ownerDocument;g=this;do{if(g===b){b=!0;break a}g=g.parentNode}while(g);b=!1}b&&d&&d.parentNode&&r&&r.parentNode&&(y.setStart(d,e),y.setEnd(r,w),c.removeAllRanges(),c.addRange(y))}},c=function(){a.removeEventListener("load",c);"Node"in a&&"normalize"in a.Node.prototype&&d.normalizeHasCaretError()&&b()};"complete"!==e.readyState?a.addEventListener("load",
c):c();(function(){if(!g()&&"CustomEvent"in a){var b=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=e.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c};b.prototype=a.Event.prototype;a.CustomEvent=b}})()}};return d}};wysihtml.polyfills(window,document).apply();var Base=function(){};
Base.extend=function(a,e){var d=Base.prototype.extend;Base._prototyping=!0;var g=new this;d.call(g,a);g.base=function(){};delete Base._prototyping;var f=g.constructor,b=g.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==b)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||d).call(arguments[0],g)};b.ancestor=this;b.extend=this.extend;b.forEach=this.forEach;b.implement=this.implement;b.prototype=
g;b.toString=this.toString;b.valueOf=function(a){return"object"==a?b:f.valueOf()};d.call(b,e);"function"==typeof b.init&&b.init();return b};
Base.prototype={extend:function(a,e){if(1<arguments.length){var d=this[a];if(d&&"function"==typeof e&&(!d.valueOf||d.valueOf()!=e.valueOf())&&/\bbase\b/.test(e)){var g=e.valueOf();e=function(){var a=this.base||Base.prototype.base;this.base=d;var b=g.apply(this,arguments);this.base=a;return b};e.valueOf=function(a){return"object"==a?e:g};e.toString=Base.toString}this[a]=e}else if(a){var f=Base.prototype.extend;Base._prototyping||"function"==typeof this||(f=this.extend||f);for(var b={toSource:null},
c=["constructor","toString","valueOf"],h=Base._prototyping?0:1;l=c[h++];)a[l]!=b[l]&&f.call(this,l,a[l]);for(var l in a)b[l]||f.call(this,l,a[l])}return this}};
Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,e,d){for(var g in a)void 0===this.prototype[g]&&e.call(d,a[g],g,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});var rangy;
(function(){function a(a,b){var c=typeof a[b];return"function"==c||!("object"!=c||!a[b])||"unknown"==c}function e(a,b){return!("object"!=typeof a[b]||!a[b])}function d(a,b){return"undefined"!=typeof a[b]}function g(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function f(a){return a&&A(a,H)&&t(a,D)}function b(a){return e(a,"body")?a.body:a.getElementsByTagName("body")[0]}function c(b){"undefined"!=typeof console&&a(console,"log")&&console.log(b)}function h(a){v.initialized=
!0;v.supported=!1;a="Rangy is not supported in this environment. Reason: "+a;B&&v.config.alertOnFail?alert(a):c(a)}function l(){if(B&&!v.initialized){var d=!1,e=!1;if(a(document,"createRange")){var g=document.createRange();A(g,z)&&t(g,y)&&(d=!0)}if((g=b(document))&&"body"==g.nodeName.toLowerCase())if(g&&a(g,"createTextRange")&&(g=g.createTextRange(),f(g)&&(e=!0)),d||e){v.initialized=!0;v.features={implementsDomRange:d,implementsTextRange:e};var p,l;for(l in m)(p=m[l])instanceof r&&p.init(p,v);e=0;
for(p=u.length;e<p;++e)try{u[e](v)}catch(ea){d="Rangy init listener threw an exception. Continuing. Detail: "+(ea.message||ea.description||String(ea)),c(d)}}else h("Neither Range nor TextRange are available");else h("No body element found")}}function k(a,b,c){c&&(a+=" in module "+c.name);v.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}function q(a,b,c,d){a[b]=function(){k(b,c,d);return a[c].apply(a,x.toArray(arguments))}}function n(a){a=a||window;l();for(var b=0,c=G.length;b<
c;++b)G[b](a)}function r(a,b,c){this.name=a;this.dependencies=b;this.supported=this.initialized=!1;this.initializer=c}function w(a,b,d){b=new r(a,b,function(b){if(!b.initialized){b.initialized=!0;try{d(v,b),b.supported=!0}catch(U){c("Module '"+a+"' failed to load: "+(U.message||U.description||String(U))),U.stack&&c(U.stack)}}});return m[a]=b}function C(){}var y="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),z="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
D="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),H="collapse compareEndPoints duplicate moveToElementText parentElement select setEndPoint getBoundingClientRect".split(" "),A=g(a),p=g(e),t=g(d),m={},B="undefined"!=typeof window&&"undefined"!=typeof document,x={isHostMethod:a,isHostObject:e,isHostProperty:d,areHostMethods:A,areHostObjects:p,areHostProperties:t,isTextRange:f,getBody:b,forEach:[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;c<
d;++c)b(a[c],c)}},v={version:"1.3.1-dev",initialized:!1,isBrowser:B,supported:!0,util:x,features:{},modules:m,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:"undefined"==typeof rangyAutoInitialize?!0:rangyAutoInitialize}};v.fail=h;v.warn=function(a){a="Rangy warning: "+a;B&&v.config.alertOnWarn?alert(a):c(a)};var J;({}).hasOwnProperty?(x.extend=J=function(a,b,c){var d;for(d in b)if(b.hasOwnProperty(d)){var e=a[d];var h=b[d];c&&null!==e&&"object"==typeof e&&null!==h&&"object"==
typeof h&&J(e,h,!0);a[d]=h}b.hasOwnProperty("toString")&&(a.toString=b.toString);return a},x.createOptions=function(a,b){var c={};J(c,b);a&&J(c,a);return c}):h("hasOwnProperty not supported");B||h("Rangy can only run in a browser");(function(){var a;if(B){var b=document.createElement("div");b.appendChild(document.createElement("span"));var c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(ma){}}a||(a=function(a){for(var b=[],c=0,d=a.length;c<d;++c)b[c]=
a[c];return b});x.toArray=a})();var L;B&&(a(document,"addEventListener")?L=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?L=function(a,b,c){a.attachEvent("on"+b,c)}:h("Document does not have required addEventListener or attachEvent method"),x.addListener=L);var u=[];x.deprecationNotice=k;x.createAliasForDeprecatedMethod=q;v.init=l;v.addInitListener=function(a){v.initialized?a(v):u.push(a)};var G=[];v.addShimListener=function(a){G.push(a)};B&&(v.shim=v.createMissingNativeApi=
n,q(v,"createMissingNativeApi","shim"));r.prototype={init:function(){for(var a=this.dependencies||[],b=0,c=a.length,d,e;b<c;++b){e=a[b];d=m[e];if(!(d&&d instanceof r))throw Error("required module '"+e+"' not found");d.init();if(!d.supported)throw Error("required module '"+e+"' not supported");}this.initializer(this)},fail:function(a){this.initialized=!0;this.supported=!1;throw Error(a);},warn:function(a){v.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){v.warn("DEPRECATED: "+a+" in module "+
this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return Error("Error in Rangy "+this.name+" module: "+a)}};v.createModule=function(a){if(2==arguments.length){var b=arguments[1];var c=[]}else b=arguments[2],c=arguments[1];b=w(a,c,b);v.initialized&&v.supported&&b.init()};v.createCoreModule=function(a,b,c){w(a,b,c)};v.RangePrototype=C;v.rangePrototype=new C;v.selectionPrototype=new function(){};v.createCoreModule("DomUtil",[],function(a,b){function c(a){for(var b=0;a=a.previousSibling;)++b;
return b}function d(a,b){for(var c=[];a;a=a.parentNode)c.push(a);for(a=b;a;a=a.parentNode)if(D(c,a))return a;return null}function e(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1}function h(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function f(a){a=a.nodeType;return 3==a||4==a||8==a}function g(a,b){var c=b.nextSibling;b=b.parentNode;c?b.insertBefore(a,c):b.appendChild(a);return a}function m(a){if(9==a.nodeType)return a;if("undefined"!=
typeof a.ownerDocument)return a.ownerDocument;if("undefined"!=typeof a.document)return a.document;if(a.parentNode)return m(a.parentNode);throw b.createError("getDocument: no document found for node");}function p(a){a=m(a);if("undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw b.createError("Cannot get a window object for node");}function t(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;
throw b.createError("getIframeDocument: No Document object found for iframe element");}function l(a){return a&&q.isHostMethod(a,"setTimeout")&&q.isHostObject(a,"document")}function k(a){return a?f(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">[index:"+c(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]":a.nodeName:"[No node]"}function B(a){this._next=this.root=a}function A(a,b){this.node=a;this.offset=b}function x(a){this.code=
this[a];this.codeName=a;this.message="DOMException: "+this.codeName}var q=a.util,v=q.getBody;q.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method");q.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var n=document.createElement("div");q.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation");q.isHostProperty(n,"innerHTML")||
b.fail("Element is missing innerHTML property");n=document.createTextNode("test");q.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var D=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},J=!1;(function(){var b=document.createElement("b");b.innerHTML="1";b.innerHTML="<br />";J=!1;a.features.crashyTextNodes=J})();var w;"undefined"!=typeof window.getComputedStyle?w=function(a,b){return p(a).getComputedStyle(a,
null)[b]}:"undefined"!=typeof document.documentElement.currentStyle?w=function(a,b){return a.currentStyle?a.currentStyle[b]:""}:b.fail("No means of obtaining computed style properties found");B.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current)if(b=a.firstChild)this._next=b;else{for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};A.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+k(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};x.prototype.toString=function(){return this.message};a.dom={arrayContains:D,isHtmlNamespace:function(a){var b;
return"undefined"==typeof a.namespaceURI||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:c,getNodeLength:function(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}},getCommonAncestor:d,isAncestorOf:e,isOrIsAncestorOf:function(a,b){return e(a,b,!0)},getClosestAncestorIn:h,isCharacterDataNode:f,isTextOrCommentNode:function(a){if(!a)return!1;
a=a.nodeType;return 3==a||8==a},insertAfter:g,splitDataNode:function(a,b,d){var e=a.cloneNode(!1);e.deleteData(0,b);a.deleteData(b,a.length-b);g(e,a);if(d)for(var h=0,f;f=d[h++];)f.node==a&&f.offset>b?(f.node=e,f.offset-=b):f.node==a.parentNode&&f.offset>c(a)&&++f.offset;return e},getDocument:m,getWindow:p,getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element");
},getIframeDocument:t,getBody:v,isWindow:l,getContentDocument:function(a,b,c){if(a)q.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?t(a):m(a):l(a)&&(d=a.document);else var d=document;if(!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,e,f,g){var m;if(a==f)return e===g?0:e<g?-1:1;if(m=h(f,a,!0))return e<=c(m)?-1:1;if(m=h(a,f,!0))return c(m)<
g?-1:1;e=d(a,f);if(!e)throw Error("comparePoints error: nodes have no common ancestor");a=a===e?e:h(a,e,!0);f=f===e?e:h(f,e,!0);if(a===f)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(e=e.firstChild;e;){if(e===a)return-1;if(e===f)return 1;e=e.nextSibling}},isBrokenNode:function(a){return!1},inspectNode:k,getComputedStyleProperty:w,createTestElement:function(a,b,c){var d=v(a);a=a.createElement("div");a.contentEditable=""+!!c;b&&(a.innerHTML=b);(b=d.firstChild)?
d.insertBefore(a,b):d.appendChild(a);return a},removeNode:function(a){return a.parentNode.removeChild(a)},fragmentFromNodeChildren:function(a){for(var b=m(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new B(a)},DomPosition:A};a.DOMException=x});v.createCoreModule("DomRange",["DomUtil"],function(a,b){function c(a,b){return 3!=a.nodeType&&(P(a,b.startContainer)||P(a,b.endContainer))}function d(a){return a.document||K(a.startContainer)}function e(a){return new N(a.parentNode,
E(a))}function h(a){return new N(a.parentNode,E(a)+1)}function f(a,b,c){var d=11==a.nodeType?a.firstChild:a;I(b)?c==b.length?F.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:Y(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return d}function g(a,b,c){r(a);r(b);if(d(b)!=d(a))throw new z("WRONG_DOCUMENT_ERR");var e=G(a.startContainer,a.startOffset,b.endContainer,b.endOffset);a=G(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?0>=e&&0<=a:0>e&&
0<a}function m(a){for(var b,c,e=d(a.range).createDocumentFragment();c=a.next();){b=a.isPartiallySelectedSubtree();c=c.cloneNode(!b);b&&(b=a.getSubtreeIterator(),c.appendChild(m(b)),b.detach());if(10==c.nodeType)throw new z("HIERARCHY_REQUEST_ERR");e.appendChild(c)}return e}function p(a,b,c){var d,e;for(c=c||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree())if(!1===b(d)){c.stop=!0;break}else{if(d=a.getSubtreeIterator(),p(d,b,c),d.detach(),c.stop)break}else for(d=F.createIterator(d);e=d.next();)if(!1===
b(e)){c.stop=!0;return}}function t(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),t(b),b.detach()):a.remove()}function l(a){for(var b,c=d(a.range).createDocumentFragment(),e;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),e=a.getSubtreeIterator(),b.appendChild(l(e)),e.detach()):a.remove();if(10==b.nodeType)throw new z("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function k(a,b,c){var d=!(!b||!b.length),e,h=!!c;d&&(e=new RegExp("^("+b.join("|")+
")$"));var f=[];p(new A(a,!1),function(b){if(!d||e.test(b.nodeType))if(!h||c(b)){var g=a.startContainer;b==g&&I(g)&&a.startOffset==g.length||(g=a.endContainer,b==g&&I(g)&&0==a.endOffset||f.push(b))}});return f}function B(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+F.inspectNode(a.startContainer)+":"+a.startOffset+", "+F.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function A(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;a.collapsed||(this.sc=a.startContainer,
this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset,a=a.commonAncestorContainer,this.sc===this.ec&&I(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==a||I(this.sc)?aa(this.sc,a,!0):this.sc.childNodes[this.so],this._last=this.ec!==a||I(this.ec)?aa(this.ec,a,!0):this.ec.childNodes[this.eo-1]))}function x(a){return function(b,c){for(c=c?b:b.parentNode;c;){b=c.nodeType;if(S(a,b))return c;c=c.parentNode}return null}}function q(a,
b){if(qa(a,b))throw new z("INVALID_NODE_TYPE_ERR");}function v(a,b){if(!S(b,a.nodeType))throw new z("INVALID_NODE_TYPE_ERR");}function n(a,b){if(0>b||b>(I(a)?a.length:a.childNodes.length))throw new z("INDEX_SIZE_ERR");}function D(a,b){if(za(a,!0)!==za(b,!0))throw new z("WRONG_DOCUMENT_ERR");}function J(a){if(Ja(a,!0))throw new z("NO_MODIFICATION_ALLOWED_ERR");}function w(a,b){return b<=(I(a)?a.length:a.childNodes.length)}function H(a){return!!a.startContainer&&!!a.endContainer&&!(ba&&(F.isBrokenNode(a.startContainer)||
F.isBrokenNode(a.endContainer)))&&R(a.startContainer)==R(a.endContainer)&&w(a.startContainer,a.startOffset)&&w(a.endContainer,a.endOffset)}function r(a){if(!H(a))throw Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a.inspect()+")");}function C(a,b){r(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,h=a.endOffset,f=c===e;I(e)&&0<h&&h<e.length&&Y(e,h,b);I(c)&&0<d&&d<c.length&&(c=Y(c,d,b),f?(h-=d,e=c):e==c.parentNode&&h>=E(c)&&h++,d=0);a.setStartAndEnd(c,
d,e,h)}function O(a){r(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);b.appendChild(a.cloneContents());return b.innerHTML}function W(a){a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.NODE_BEFORE=0;a.NODE_AFTER=1;a.NODE_BEFORE_AND_AFTER=2;a.NODE_INSIDE=3}function X(a){W(a);W(a.prototype)}function ia(a,b){return function(){r(this);var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,f=new A(this,!0);c!==e&&(c=aa(c,e,!0),d=h(c),c=d.node,d=d.offset);
p(f,J);f.reset();e=a(f);f.detach();b(this,c,d,c,d);return e}}function M(b,d){function f(a,b){return function(c){v(c,ca);v(R(c),ja);c=(a?e:h)(c);(b?g:m)(this,c.node,c.offset)}}function g(a,b,c){var e=a.endContainer,f=a.endOffset;if(b!==a.startContainer||c!==a.startOffset){if(R(b)!=R(e)||1==G(b,c,e,f))e=b,f=c;d(a,b,c,e,f)}}function m(a,b,c){var e=a.startContainer,f=a.startOffset;if(b!==a.endContainer||c!==a.endOffset){if(R(b)!=R(e)||-1==G(b,c,e,f))e=b,f=c;d(a,e,f,b,c)}}var p=function(){};p.prototype=
a.rangePrototype;b.prototype=new p;y.extend(b.prototype,{setStart:function(a,b){q(a,!0);n(a,b);g(this,a,b)},setEnd:function(a,b){q(a,!0);n(a,b);m(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],e=b,f=c;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}d(this,b,c,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:f(!0,!0),setStartAfter:f(!1,!0),setEndBefore:f(!0,!1),setEndAfter:f(!1,!1),collapse:function(a){r(this);a?d(this,this.startContainer,
this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){q(a,!0);d(this,a,0,a,Z(a))},selectNode:function(a){q(a,!1);v(a,ca);var b=e(a);a=h(a);d(this,b.node,b.offset,a.node,a.offset)},extractContents:ia(l,d),deleteContents:ia(t,d),canSurroundContents:function(){r(this);J(this.startContainer);J(this.endContainer);var a=new A(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();
return!b},splitBoundaries:function(){C(this)},splitBoundariesPreservingPositions:function(a){C(this,a)},normalizeBoundaries:function(){r(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),T(b))},h=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var h=d.length;b=f.length;d.insertData(0,f.data);T(f);a==c?(e+=b,c=a):c==d.parentNode&&(f=E(d),e==f?
(c=d,e=h):e>f&&e--)}},g=!0;I(c)?e==c.length?f(c):0==e&&(f=c.previousSibling)&&f.nodeType==c.nodeType&&(e=f.length,a==c&&(g=!1),f.appendData(c.data),T(c),c=f):(0<e&&(g=c.childNodes[e-1])&&I(g)&&f(g),g=!this.collapsed);g?I(a)?0==b?h(a):b==a.length&&(f=a.nextSibling)&&f.nodeType==a.nodeType&&(c==f&&(c=a,e+=a.length),a.appendData(f.data),T(f)):b<a.childNodes.length&&(f=a.childNodes[b])&&I(f)&&h(f):(a=c,b=e);d(this,a,b,c,e)},collapseToPoint:function(a,b){q(a,!0);n(a,b);this.setStartAndEnd(a,b)}});X(b)}
function Aa(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:F.getCommonAncestor(a.startContainer,a.endContainer)}function L(a,b,c,d,e){a.startContainer=b;a.startOffset=c;a.endContainer=d;a.endOffset=e;a.document=F.getDocument(b);Aa(a)}function u(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this.document=a;Aa(this)}var F=a.dom,y=a.util,N=F.DomPosition,z=a.DOMException,I=F.isCharacterDataNode,
E=F.getNodeIndex,P=F.isOrIsAncestorOf,K=F.getDocument,G=F.comparePoints,Y=F.splitDataNode,aa=F.getClosestAncestorIn,Z=F.getNodeLength,S=F.arrayContains,R=F.getRootContainer,ba=a.features.crashyTextNodes,T=F.removeNode;A.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,
I(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current;if(!I(a)||a!==this.sc&&a!==this.ec)a.parentNode&&T(a);else{var b=a===this.sc?this.so:0;var c=a===this.ec?this.eo:a.length;b!=c&&a.deleteData(b,c-b)}},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){if(this.isSingleCharacterDataNode){var a=
this.range.cloneRange();a.collapse(!1)}else{a=new u(d(this.range));var b=this._current,c=b,e=0,f=b,h=Z(b);P(b,this.sc)&&(c=this.sc,e=this.so);P(b,this.ec)&&(f=this.ec,h=this.eo);L(a,c,e,f,h)}return new A(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var ca=[1,3,4,5,7,8,10],ja=[2,9,11],ka=[1,3,4,5,7,8,10,11],da=[1,3,4,5,7,8],za=x([9,11]),Ja=x([5,6,10,12]),qa=x([6,10,12]);b=document.createElement("style");
var la=!1;try{b.innerHTML="<b>x</b>",la=3==b.firstChild.nodeType}catch(Ka){}a.features.htmlParsingConforms=la;var ra="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" ");y.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){r(this);D(this.startContainer,b.startContainer);var c=3==a||0==a?"start":"end";a=1==a||0==a?"start":"end";return G(this[c+"Container"],this[c+"Offset"],b[a+"Container"],b[a+"Offset"])},insertNode:function(a){r(this);v(a,ka);
J(this.startContainer);if(P(a,this.startContainer))throw new z("HIERARCHY_REQUEST_ERR");a=f(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){r(this);if(this.collapsed)return d(this).createDocumentFragment();if(this.startContainer===this.endContainer&&I(this.startContainer)){var a=this.startContainer.cloneNode(!0);a.data=a.data.slice(this.startOffset,this.endOffset);var b=d(this).createDocumentFragment();b.appendChild(a);return b}b=new A(this,!0);a=m(b);b.detach();
return a},canSurroundContents:function(){r(this);J(this.startContainer);J(this.endContainer);var a=new A(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!b},surroundContents:function(a){v(a,da);if(!this.canSurroundContents())throw new z("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);f(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){r(this);for(var a=
new u(d(this)),b=ra.length,c;b--;)c=ra[b],a[c]=this[c];return a},toString:function(){r(this);var a=this.startContainer;if(a===this.endContainer&&I(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[];a=new A(this,!0);p(a,function(a){3!=a.nodeType&&4!=a.nodeType||b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){r(this);var b=a.parentNode,c=E(a);if(!b)throw new z("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return 0>
a?0<b?2:0:0<b?1:3},comparePoint:function(a,b){r(this);if(!a)throw new z("HIERARCHY_REQUEST_ERR");D(a,this.startContainer);return 0>G(a,b,this.startContainer,this.startOffset)?-1:0<G(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:la?function(a){var b=this.startContainer,c=K(b);if(!b)throw new z("INVALID_STATE_ERR");var d=null;1==b.nodeType?d=b:I(b)&&(d=F.parentElement(b));d=null===d||"HTML"==d.nodeName&&F.isHtmlNamespace(K(d).documentElement)&&F.isHtmlNamespace(d)?c.createElement("body"):
d.cloneNode(!1);d.innerHTML=a;return F.fragmentFromNodeChildren(d)}:function(a){var b=d(this).createElement("body");b.innerHTML=a;return F.fragmentFromNodeChildren(b)},toHtml:function(){return O(this)},intersectsNode:function(a,b){r(this);if(R(a)!=R(this.startContainer))return!1;var c=a.parentNode,d=E(a);if(!c)return!0;a=G(c,d,this.endContainer,this.endOffset);c=G(c,d+1,this.startContainer,this.startOffset);return b?0>=a&&0<=c:0>a&&0<c},isPointInRange:function(a,b){r(this);if(!a)throw new z("HIERARCHY_REQUEST_ERR");
D(a,this.startContainer);return 0<=G(a,b,this.startContainer,this.startOffset)&&0>=G(a,b,this.endContainer,this.endOffset)},intersectsRange:function(a){return g(this,a,!1)},intersectsOrTouchesRange:function(a){return g(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=G(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=G(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();-1==b&&d.setStart(a.startContainer,a.startOffset);1==c&&
d.setEnd(a.endContainer,a.endOffset);return d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();-1==G(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==G(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new z("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):3==this.compareNode(a)},containsNodeContents:function(a){return 0<=
this.comparePoint(a,0)&&0>=this.comparePoint(a,Z(a))},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return 0<c.length?(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),this.containsRange(b)):this.containsNodeContents(a)},getNodes:function(a,b){r(this);return k(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){this.setEndBefore(a);this.collapse(!1)},
collapseAfter:function(a){this.setStartAfter(a);this.collapse(!0)},getBookmark:function(b){var c=d(this),e=a.createRange(c);b=b||F.getBody(c);e.selectNodeContents(b);c=this.intersection(e);var f=0,h=0;c&&(e.setEnd(c.startContainer,c.startOffset),f=e.toString().length,h=f+c.toString().length);return{start:f,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0);this.collapse(!0);b=[b];for(var d,e=!1,f=!1,h,g;!f&&(d=b.pop());)if(3==d.nodeType)h=c+d.length,!e&&
a.start>=c&&a.start<=h&&(this.setStart(d,a.start-c),e=!0),e&&a.end>=c&&a.end<=h&&(this.setEnd(d,a.end-c),f=!0),c=h;else for(g=d.childNodes,h=g.length;h--;)b.push(g[h])},getName:function(){return"DomRange"},equals:function(a){return u.rangesEqual(this,a)},isValid:function(){return H(this)},inspect:function(){return B(this)},detach:function(){}});M(u,L);y.extend(u,{rangeProperties:ra,RangeIterator:A,copyComparisonConstants:X,createPrototypeRange:M,inspect:B,toHtml:O,getRangeDocument:d,rangesEqual:function(a,
b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}});a.DomRange=u});v.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d=a.dom,e=a.util,f=d.DomPosition,h=a.DomRange,g=d.getBody,m=d.getContentDocument,p=d.isCharacterDataNode;a.features.implementsDomRange&&function(){function f(a){for(var b=p.length,c;b--;)c=p[b],a[c]=a.nativeRange[c];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===
a.endOffset}var p=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a;f(this)};h.createPrototypeRange(c,function(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,h=a.endContainer!==d||a.endOffset!=e,g=!a.equals(a.nativeRange);if(f||h||g)a.setEnd(d,e),a.setStart(b,c)});var t=c.prototype;t.selectNode=function(a){this.nativeRange.selectNode(a);f(this)};t.cloneContents=function(){return this.nativeRange.cloneContents()};t.surroundContents=
function(a){this.nativeRange.surroundContents(a);f(this)};t.collapse=function(a){this.nativeRange.collapse(a);f(this)};t.cloneRange=function(){return new c(this.nativeRange.cloneRange())};t.refresh=function(){f(this)};t.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");g(document).appendChild(l);var k=document.createRange();k.setStart(l,0);k.setEnd(l,0);try{k.setStart(l,1);t.setStart=function(a,b){this.nativeRange.setStart(a,b);f(this)};t.setEnd=function(a,
b){this.nativeRange.setEnd(a,b);f(this)};var B=function(a){return function(b){this.nativeRange[a](b);f(this)}}}catch(sa){t.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(W){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}f(this)},t.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(W){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}f(this)},B=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(X){this.nativeRange[b](c),this.nativeRange[a](c)}f(this)}}}t.setStartBefore=
B("setStartBefore","setEndBefore");t.setStartAfter=B("setStartAfter","setEndAfter");t.setEndBefore=B("setEndBefore","setStartBefore");t.setEndAfter=B("setEndAfter","setStartAfter");t.selectNodeContents=function(a){this.setStartAndEnd(a,0,d.getNodeLength(a))};k.selectNodeContents(l);k.setEnd(l,3);B=document.createRange();B.selectNodeContents(l);B.setEnd(l,4);B.setStart(l,2);-1==k.compareBoundaryPoints(k.START_TO_END,B)&&1==k.compareBoundaryPoints(k.END_TO_START,B)?t.compareBoundaryPoints=function(a,
b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:t.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};B=document.createElement("div");B.innerHTML="123";var A=B.firstChild,x=g(document);x.appendChild(B);k.setStart(A,1);k.setEnd(A,2);k.deleteContents();"13"==A.data&&(t.deleteContents=function(){this.nativeRange.deleteContents();f(this)},t.extractContents=
function(){var a=this.nativeRange.extractContents();f(this);return a});x.removeChild(B);x=null;e.isHostMethod(k,"createContextualFragment")&&(t.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});g(document).removeChild(l);t.getName=function(){return"WrappedRange"};a.WrappedRange=c;a.createNativeRange=function(a){a=m(a,b,"createNativeRange");return a.createRange()}}();if(a.features.implementsTextRange){var t=function(a,b,c,e,h){var g=a.duplicate();g.collapse(c);
var m=g.parentElement();d.isOrIsAncestorOf(b,m)||(m=b);if(!m.canHaveHTML)return m=new f(m.parentNode,d.getNodeIndex(m)),{boundaryPosition:m,nodeInfo:{nodeIndex:m.offset,containerElement:m.node}};b=d.getDocument(m).createElement("span");b.parentNode&&d.removeNode(b);var t=c?"StartToStart":"StartToEnd",l=h&&h.containerElement==m?h.nodeIndex:0,k=m.childNodes.length,O=k;for(h=O;;){h==k?m.appendChild(b):m.insertBefore(b,m.childNodes[h]);g.moveToElementText(b);var B=g.compareEndPoints(t,a);if(0==B||l==
O)break;else if(-1==B)if(O==l+1)break;else l=h;else O=O==l+1?l:h;h=Math.floor((l+O)/2);m.removeChild(b)}t=b.nextSibling;if(-1==B&&t&&p(t)){g.setEndPoint(c?"EndToStart":"EndToEnd",a);if(/[\r\n]/.test(t.data))for(c=g.duplicate(),e=c.text.replace(/\r\n/g,"\r").length,e=c.moveStart("character",e);-1==c.compareEndPoints("StartToEnd",c);)e++,c.moveStart("character",1);else e=g.text.length;c=new f(t,e)}else a=(e||!c)&&b.previousSibling,c=(c=(e||c)&&b.nextSibling)&&p(c)?new f(c,0):a&&p(a)?new f(a,a.data.length):
new f(m,d.getNodeIndex(b));d.removeNode(b);return{boundaryPosition:c,nodeInfo:{nodeIndex:h,containerElement:m}}},l=function(a,b){var c=a.offset,e=d.getDocument(a.node),f=g(e).createTextRange(),h=p(a.node);if(h){var m=a.node;a=m.parentNode}else m=a.node.childNodes,m=c<m.length?m[c]:null,a=a.node;e=e.createElement("span");e.innerHTML="&#feff;";m?a.insertBefore(e,m):a.appendChild(e);f.moveToElementText(e);f.collapse(!b);a.removeChild(e);if(h)f[b?"moveStart":"moveEnd"]("character",c);return f};var k=
function(a){this.textRange=a;this.refresh()};k.prototype=new h(document);k.prototype.refresh=function(){var a=this.textRange;var b=a.parentElement();var c=a.duplicate();c.collapse(!0);var e=c.parentElement();c=a.duplicate();c.collapse(!1);a=c.parentElement();e=e==a?e:d.getCommonAncestor(e,a);e=e==b?e:d.getCommonAncestor(b,e);b=this.textRange;0==b.compareEndPoints("StartToEnd",b)?e=b=t(this.textRange,e,!0,!0).boundaryPosition:(a=t(this.textRange,e,!0,!1),b=a.boundaryPosition,e=t(this.textRange,e,!1,
!1,a.nodeInfo).boundaryPosition);this.setStart(b.node,b.offset);this.setEnd(e.node,e.offset)};k.prototype.getName=function(){return"WrappedTextRange"};h.copyComparisonConstants(k);var B=function(a){if(a.collapsed)return l(new f(a.startContainer,a.startOffset),!0);var b=l(new f(a.startContainer,a.startOffset),!0),c=l(new f(a.endContainer,a.endOffset),!1);a=g(h.getRangeDocument(a)).createTextRange();a.setEndPoint("StartToStart",b);a.setEndPoint("EndToEnd",c);return a};k.rangeToTextRange=B;k.prototype.toTextRange=
function(){return B(this)};a.WrappedTextRange=k;if(!a.features.implementsDomRange||a.config.preferTextRange){var A=Function("return this;")();"undefined"==typeof A.Range&&(A.Range=k);a.createNativeRange=function(a){a=m(a,b,"createNativeRange");return g(a).createTextRange()};a.WrappedRange=k}}a.createRange=function(c){c=m(c,b,"createRange");return new a.WrappedRange(a.createNativeRange(c))};a.createRangyRange=function(a){a=m(a,b,"createRangyRange");return new h(a)};e.createAliasForDeprecatedMethod(a,
"createIframeRange","createRange");e.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange");a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)});c=b=null})});v.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(w.isWindow(a))return a;if(a instanceof x)return a.win;a=w.getContentDocument(a,
b,c);return w.getWindow(a)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function h(a){var b=!1;a.anchorNode&&(b=1==w.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return b}function g(a,b,c){var d=c?"end":"start";c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function m(a){a.anchorNode=a.focusNode=null;
a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function p(b){if(b instanceof O){var c=a.createNativeRange(b.getDocument());c.setEnd(b.endContainer,b.endOffset);c.setStart(b.startContainer,b.startOffset)}else b instanceof W?c=b.nativeRange:M.implementsDomRange&&b instanceof w.getWindow(b.startContainer).Range&&(c=b);return c}function t(a){var c=a.getNodes();a:if(c.length&&1==c[0].nodeType){var d=1;for(var e=c.length;d<e;++d)if(!w.isAncestorOf(c[0],c[d])){d=!1;break a}d=
!0}else d=!1;if(!d)throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function l(a){return!!a&&"undefined"!=typeof a.text}function k(a,b){b=new W(b);a._ranges=[b];g(a,b,!1);a.rangeCount=1;a.isCollapsed=b.collapsed}function B(b){b._ranges.length=0;if("None"==b.docSelection.type)m(b);else{var c=b.docSelection.createRange();if(l(c))k(b,c);else{b.rangeCount=c.length;for(var d,e=C(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),
d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;g(b,b._ranges[b.rangeCount-1],!1)}}}function A(a,c){var d=a.docSelection.createRange();c=t(c);var e=C(d.item(0));e=L(e).createControlRange();for(var f=0,h=d.length;f<h;++f)e.add(d.item(f));try{e.add(c)}catch(Ia){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}e.select();B(a)}function x(a,b,c){this.nativeSelection=a;this.docSelection=
b;this._ranges=[];this.win=c;this.refresh()}function q(a){a.win=a.anchorNode=a.focusNode=a._ranges=null;a.rangeCount=a.anchorOffset=a.focusOffset=0;a.detached=!0}function v(a,b){for(var c=T.length,d,e;c--;)if(d=T[c],e=d.selection,"deleteAll"==b)q(e);else if(d.win==a)return"delete"==b?(T.splice(c,1),!0):e;"deleteAll"==b&&(T.length=0);return null}function n(a,c){var d=C(c[0].startContainer);d=L(d).createControlRange();for(var e=0,f,h=c.length;e<h;++e){f=t(c[e]);try{d.add(f)}catch(Ia){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");
}}d.select();B(a)}function D(a,b){if(a.win.document!=C(b))throw new X("WRONG_DOCUMENT_ERR");}function J(b){return function(c,d){if(this.rangeCount){var e=this.getRangeAt(0);e["set"+(b?"Start":"End")](c,d)}else e=a.createRange(this.win.document),e.setStartAndEnd(c,d);this.setSingleRange(e,this.isBackward())}}function r(a){var b=[],c=new ia(a.anchorNode,a.anchorOffset),d=new ia(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=
0,h=a.rangeCount;f<h;++f)b[f]=O.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var w=a.dom,H=a.util,u=H.isHostMethod,O=a.DomRange,W=a.WrappedRange,X=a.DOMException,ia=w.DomPosition,M=a.features,C=w.getDocument,L=w.getBody,y=O.rangesEqual,F=u(window,"getSelection"),z=H.isHostObject(document,"selection");M.implementsWinGetSelection=F;var G=(M.implementsDocSelection=z)&&(!F||a.config.preferTextRange);
if(G){var K=f;a.isSelectionValid=function(a){a=d(a,"isSelectionValid").document;var b=a.selection;return"None"!=b.type||C(b.createRange().parentElement())==a}}else if(F)K=e,a.isSelectionValid=function(){return!0};else return b.fail("Neither document.selection or window.getSelection() detected."),!1;a.getNativeSelection=K;F=K();if(!F)return b.fail("Native selection was null (possibly issue 138?)"),!1;var I=a.createNativeRange(document),E=L(document),N=H.areHostProperties(F,["anchorNode","focusNode",
"anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=N;var P=u(F,"extend");M.selectionHasExtend=P;var ya="number"==typeof F.rangeCount;M.selectionHasRangeCount=ya;var Y=!1,aa=!0,Z=P?function(b,c){var d=O.getRangeDocument(c);d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.addRange(p(d));b.extend(c.startContainer,c.startOffset)}:null;H.areHostMethods(F,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof F.rangeCount&&M.implementsDomRange&&function(){var b=window.getSelection();
if(b){for(var c=b.rangeCount,d=1<c,e=[],f=h(b),g=0;g<c;++g)e[g]=b.getRangeAt(g);g=w.createTestElement(document,"",!1);var m=g.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),p=document.createRange();p.setStart(m,1);p.collapse(!0);b.removeAllRanges();b.addRange(p);aa=1==b.rangeCount;b.removeAllRanges();d||((d=window.navigator.appVersion.match(/Chrome\/(.*?) /))&&36<=parseInt(d[1])?Y=!1:(d=p.cloneRange(),p.setStart(m,0),d.setEnd(m,3),d.setStart(m,2),b.addRange(p),b.addRange(d),Y=2==b.rangeCount));
w.removeNode(g);b.removeAllRanges();for(g=0;g<c;++g)0==g&&f?Z?Z(b,e[g]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(e[g])):b.addRange(e[g])}}();M.selectionSupportsMultipleRanges=Y;M.collapsedNonEditableSelectionsSupported=aa;var S=!1;E&&u(E,"createControlRange")&&(E=E.createControlRange(),H.areHostProperties(E,["item","add"])&&(S=!0));M.implementsControlRange=S;var R=N?function(a){return a.anchorNode===
a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var ba;u(F,"getRangeAt")?ba=function(a,b){try{return a.getRangeAt(b)}catch(qa){return null}}:N&&(ba=function(b){var c=C(b.anchorNode);c=a.createRange(c);c.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset);c.collapsed!==this.isCollapsed&&c.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset);return c});x.prototype=a.selectionPrototype;var T=[],
ca=function(a){if(a&&a instanceof x)return a.refresh(),a;a=d(a,"getNativeSelection");var b=v(a),c=K(a),e=z?f(a):null;b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new x(c,e,a),T.push({win:a,selection:b}));return b};a.getSelection=ca;H.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");E=x.prototype;if(!G&&N&&H.areHostMethods(F,["removeAllRanges","addRange"]))E.removeAllRanges=function(){this.nativeSelection.removeAllRanges();m(this)},E.addRange=ya?function(b,d){if(S&&
z&&"Control"==this.docSelection.type)A(this,b);else if(c(d)&&P)Z(this.nativeSelection,b),this.refresh();else{Y?d=this.rangeCount:(this.removeAllRanges(),d=0);var e=p(b).cloneRange();try{this.nativeSelection.addRange(e)}catch(la){}this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=ba(this.nativeSelection,this.rangeCount-1))&&!y(d,b)&&(b=new W(d)),this._ranges[this.rangeCount-1]=b,g(this,b,da(this.nativeSelection)),this.isCollapsed=R(this)):this.refresh()}}:
function(a,b){c(b)&&P?Z(this.nativeSelection,a):this.nativeSelection.addRange(p(a));this.refresh()},E.setRanges=function(a){if(S&&z&&1<a.length)n(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}};else if(u(F,"empty")&&u(I,"select")&&S&&G)E.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){if(this.anchorNode)var a=C(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&
(a=C(b.item(0)))}a&&(L(a).createTextRange().select(),this.docSelection.empty())}}catch(qa){}m(this)},E.addRange=function(b){"Control"==this.docSelection.type?A(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,g(this,b,!1))},E.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?n(this,a):b&&this.addRange(a[0])};else return b.fail("No means of selecting a Range or TextRange was found"),!1;E.getRangeAt=
function(a){if(0>a||a>=this.rangeCount)throw new X("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};if(G)var ja=function(b){if(a.isSelectionValid(b.win))var c=b.docSelection.createRange();else c=L(b.win.document).createTextRange(),c.collapse(!0);"Control"==b.docSelection.type?B(b):l(c)?k(b,c):m(b)};else if(u(F,"getRangeAt")&&"number"==typeof F.rangeCount)ja=function(b){if(S&&z&&"Control"==b.docSelection.type)B(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection?b.nativeSelection.rangeCount:
0,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));g(b,b._ranges[b.rangeCount-1],da(b.nativeSelection));b.isCollapsed=R(b)}else m(b)};else if(N&&"boolean"==typeof F.isCollapsed&&"boolean"==typeof I.collapsed&&M.implementsDomRange)ja=function(a){var b=a.nativeSelection;b.anchorNode?(b=ba(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=
b.focusOffset,a.isCollapsed=R(a)):m(a)};else return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;E.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;ja(this);if(a){a=b.length;if(a!=this._ranges.length||this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;a--;)if(!y(b[a],this._ranges[a]))return!0;return!1}};var ka=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;d<e;++d)y(b,c[d])||
a.addRange(c[d]);a.rangeCount||m(a)};E.removeRange=S&&z?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=t(a);var c=C(b.item(0));c=L(c).createControlRange();for(var d,e=!1,f=0,h=b.length;f<h;++f)d=b.item(f),d!==a||e?c.add(b.item(f)):e=!0;c.select();B(this)}else ka(this,a)}:function(a){ka(this,a)};if(!G&&N&&M.implementsDomRange){var da=h;E.isBackward=function(){return da(this)}}else da=E.isBackward=function(){return!1};E.isBackwards=E.isBackward;E.toString=
function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};E.collapse=function(b,c){D(this,b);var d=a.createRange(b);d.collapseToPoint(b,c);this.setSingleRange(d);this.isCollapsed=!0};E.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new X("INVALID_STATE_ERR");};E.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new X("INVALID_STATE_ERR");
};E.selectAllChildren=function(b){D(this,b);var c=a.createRange(b);c.selectNodeContents(b);this.setSingleRange(c)};E.deleteFromDocument=function(){if(S&&z&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),b;a.length;)b=a.item(0),a.remove(b),w.removeNode(b);this.refresh()}else if(this.rangeCount&&(a=this.getAllRanges(),a.length)){this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};E.eachRange=function(a,b){for(var c=0,d=this._ranges.length;c<
d;++c)if(a(this.getRangeAt(c)))return b};E.getAllRanges=function(){var a=[];this.eachRange(function(b){a.push(b)});return a};E.setSingleRange=function(a,b){this.removeAllRanges();this.addRange(a,b)};E.callMethodOnEachRange=function(a,b){var c=[];this.eachRange(function(d){c.push(d[a].apply(d,b||[]))});return c};E.setStart=J(!0);E.setEnd=J(!1);a.rangePrototype.select=function(a){ca(this.getDocument()).setSingleRange(this,a)};E.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c);
b.push(c)});this.removeAllRanges();c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)};E.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1};E.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}};E.moveToBookmark=function(b){for(var c=[],d=0,e,f;e=b.rangeBookmarks[d++];)f=a.createRange(this.win),f.moveToBookmark(e),c.push(f);b.backward?this.setSingleRange(c[0],"backward"):
this.setRanges(c)};E.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};E.restoreRanges=function(a){this.removeAllRanges();for(var b=0,c;c=a.ranges[b];++b)this.addRange(c,a.backward&&0==b)};E.toHtml=function(){var a=[];this.eachRange(function(b){a.push(O.toHtml(b))});return a.join("")};M.implementsTextRange&&(E.getNativeTextRange=function(){var c;if(c=this.docSelection){c=c.createRange();if(l(c))return c;throw b.createError("getNativeTextRange: selection is a control selection");
}if(0<this.rangeCount)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range");});E.getName=function(){return"WrappedSelection"};E.inspect=function(){return r(this)};E.detach=function(){v(this.win,"delete");q(this)};x.detachAll=function(){v(null,"deleteAll")};x.inspect=r;x.isDirectionBackward=c;a.Selection=x;a.selectionPrototype=E;a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ca(a)});
a=null})});var K=!1;p=function(a){K||(K=!0,!v.initialized&&v.config.autoInitialize&&l())};B&&("complete"==document.readyState?p():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",p,!1),L(window,"load",p)));rangy=v})();
rangy.createModule("SaveRestore",["WrappedRange"],function(a,e){function d(a,b){var c="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),d=q.getDocument(a.startContainer);a=a.cloneRange();a.collapse(b);b=d.createElement("span");b.id=c;b.style.lineHeight="0";b.style.display="none";b.className="rangySelectionBoundary";b.appendChild(d.createTextNode("\ufeff"));a.insertNode(b);return b}function g(a,b,c,d){(a=(a||document).getElementById(c))?(b[d?"setStartBefore":"setEndBefore"](a),n(a)):
e.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function b(b,c){var e=a.DomRange.getRangeDocument(b),f=b.toString(),h=r(c);if(b.collapsed){var g=d(b,!1);return{document:e,markerId:g.id,collapsed:!0}}g=d(b,!1);c=d(b,!0);return{document:e,startMarkerId:c.id,endMarkerId:g.id,collapsed:!1,backward:h,toString:function(){return"original text: '"+f+"', new text: '"+b.toString()+"'"}}}function c(b,c){var d=b.document;
"undefined"==typeof c&&(c=!0);var f=a.createRange(d);b.collapsed?(b=(d||document).getElementById(b.markerId))?(b.style.display="inline",(d=b.previousSibling)&&3==d.nodeType?(n(b),f.collapseToPoint(d,d.length)):(f.collapseBefore(b),n(b))):e.warn("Marker element has been removed. Cannot restore selection."):(g(d,f,b.startMarkerId,!0),g(d,f,b.endMarkerId,!1));c&&f.normalizeBoundaries();return f}function h(c,d){var e=[],h;var g=r(d);c=c.slice(0);c.sort(f);d=0;for(h=c.length;d<h;++d)e[d]=b(c[d],g);for(d=
h-1;0<=d;--d)g=c[d],h=a.DomRange.getRangeDocument(g),g.collapsed?g.collapseAfter((h||document).getElementById(e[d].markerId)):(g.setEndBefore((h||document).getElementById(e[d].endMarkerId)),g.setStartAfter((h||document).getElementById(e[d].startMarkerId)));return e}function l(a){for(var b=[],d=a.length-1;0<=d;d--)b[d]=c(a[d],!0);return b}function k(a,b){(a=(a||document).getElementById(b))&&n(a)}var q=a.dom,n=q.removeNode,r=a.Selection.isDirectionBackward;a.util.extend(a,{saveRange:b,restoreRange:c,
saveRanges:h,restoreRanges:l,saveSelection:function(b){if(!a.isSelectionValid(b))return e.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var c=a.getSelection(b),d=c.getAllRanges(),f=1==d.length&&c.isBackward(),g=h(d,f);f?c.setSingleRange(d[0],f):c.setRanges(d);return{win:b,rangeInfos:g,restored:!1}},restoreSelection:function(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=l(d);1==d.length&&c&&a.features.selectionHasExtend&&
d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f);b.restored=!0}},removeMarkerElement:k,removeMarkers:function(a){for(var b=a.rangeInfos,c=0,d=b.length,e;c<d;++c)e=b[c],e.collapsed?k(a.doc,e.markerId):(k(a.doc,e.startMarkerId),k(a.doc,e.endMarkerId))}})});
rangy.createModule("TextRange",["WrappedSelection"],function(a,e){function d(a,b){var c=a.slice(b.start,b.end);a={isWord:b.isWord,chars:c,toString:function(){return c.join("")}};b=0;for(var d=c.length;b<d;++b)c[b].token=a;return a}function g(a,b,c){b=c(a,b);c=[];for(var e=0,f;f=b[e++];)c.push(d(a,f));return c}function f(a){a=a||"";a="string"==typeof a?a.split(""):a;a.sort(function(a,b){return a.charCodeAt(0)-b.charCodeAt(0)});return a.join("").replace(/(.)\1+/g,"$1")}function b(a,b){a=N(a,b);if(b.hasOwnProperty("wordOptions")){var c=
a.wordOptions;if(c){var d=c.language||"en";var e={};K(e,pa[d]||pa.en);K(e,c);c=e}else c=pa.en;a.wordOptions=c}b.hasOwnProperty("characterOptions")&&(a.characterOptions=N(a.characterOptions,oa));return a}function c(a,b){b=fa(a,"display",b);a=a.tagName.toLowerCase();return"block"==b&&wa&&xa.hasOwnProperty(a)?xa[a]:b}function h(a){for(var b=a,d=[];b.parentNode;)d.unshift(b.parentNode),b=b.parentNode;a=d.concat([a]);b=0;for(d=a.length;b<d;++b)if(1==a[b].nodeType&&"none"==c(a[b]))return!0;return!1}function l(a,
b){if(!b&&a.hasChildNodes())return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;a=a?a.nextSibling:null;return a}function k(a){var b=a.previousSibling;if(b){for(a=b;a.hasChildNodes();)a=a.lastChild;return a}return(a=a.parentNode)&&1==a.nodeType?a:null}function q(a){if(!a||3!=a.nodeType)return!1;var b=a.data;if(""===b)return!0;var c=a.parentNode;if(!c||1!=c.nodeType)return!1;a=fa(a.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(a)||/^[\t\r ]+$/.test(b)&&"pre-line"==
a}function n(a){return""===a.data?!0:q(a)?!a.parentNode||h(a)?!0:!1:!1}function r(a){var b=a.nodeType;if(!(b=7==b||8==b||h(a)||/^(script|style)$/i.test(a.nodeName))){var c;b=3==a.nodeType&&(c=a.parentNode)&&"hidden"==fa(c,"visibility")}return b||n(a)}function w(a,b){var d=a.nodeType;return 7==d||8==d||1==d&&"none"==c(a,b)}function C(){this.store={}}function y(a,b,c){return function(d){var e=this.cache;if(e.hasOwnProperty(a))return Ba++,e[a];Ha++;d=b.call(this,c?this[c]:this,d);return e[a]=d}}function z(a,
b){this.node=a;this.session=b;this.cache=new C;this.positions=new C}function D(a,b){this.offset=b;this.nodeWrapper=a;this.node=a.node;this.session=a.session;this.cache=new C}function H(){A();return V=new sa}function A(){V&&V.detach();V=null}function p(a,b,c,d){function f(){var a=null;b?(a=h,g||(h=h.previousVisible(),g=!h||c&&h.equals(c))):g||(a=h=h.nextVisible(),g=!h||c&&h.equals(c));g&&(h=null);return a}c&&(b?r(c.node)&&(c=a.previousVisible()):r(c.node)&&(c=c.nextVisible()));var h=a,g=!1,m,p=!1;
return{next:function(){if(p)return p=!1,m;for(var a,b;a=f();)if(b=a.getCharacter(d))return m=a;return null},rewind:function(){if(m)p=!0;else throw e.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");},dispose:function(){a=c=null}}}function t(a,b,c){function d(a){for(var b,c=[],d=a?e:f,h=!1,g=!1;a=d.next();){b=a.character;if(U.test(b))g&&(g=!1,h=!0);else if(h){d.rewind();break}else g=!0;c.push(a)}return c}var e=p(a,!1,null,b),f=p(a,!0,null,b),h=c.tokenizer;a=
d(!0);b=d(!1).reverse();var m=g(b.concat(a),c,h),t=a.length?m.slice(ta(m,a[0].token)):[],l=b.length?m.slice(0,ta(m,b.pop().token)+1):[];return{nextEndToken:function(){for(var a,b;1==t.length&&!(a=t[0]).isWord&&0<(b=d(!0)).length;)t=g(a.chars.concat(b),c,h);return t.shift()},previousStartToken:function(){for(var a,b;1==l.length&&!(a=l[0]).isWord&&0<(b=d(!1)).length;)l=g(b.reverse().concat(a.chars),c,h);return l.pop()},dispose:function(){e.dispose();f.dispose();t=l=null}}}function m(a,b,c,d){var e=
a.getRangeBoundaryPosition(b,!0);a=a.getRangeBoundaryPosition(b,!1);return p(d?a:e,!!d,d?e:a,c)}function B(b,c,d,e,f){function h(b,c){b=m[b].previousVisible();c=m[c-1];var d;if(!(d=!f.wholeWordsOnly)){d=f.wordOptions;var e=a.createRange(b.node);e.setStartAndEnd(b.node,b.offset,c.node,c.offset);d=!e.expand("word",{wordOptions:d})}return{startPos:b,endPos:c,valid:d}}var g=na(f.direction);b=p(b,g,b.session.getRangeBoundaryPosition(e,g),f.characterOptions);e="";for(var m=[],t,l,k,B,A,x=null;t=b.next();)if(l=
t.character,d||f.caseSensitive||(l=l.toLowerCase()),g?(m.unshift(t),e=l+e):(m.push(t),e+=l),d){if(t=c.exec(e))if(k=t.index,B=k+t[0].length,A){if(!g&&B<e.length||g&&0<k){x=h(k,B);break}}else A=!0}else if(-1!=(k=e.indexOf(c))){x=h(k,k+c.length);break}A&&(x=h(k,B));b.dispose();return x}function x(a){return function(){var b=!!V,c=[V||H()].concat(G.toArray(arguments));c=a.apply(this,c);b||A();return c}}function v(a,c){return x(function(d,e,f,h){var g;"undefined"==typeof f&&(f=e,e="character");h=b(h,Ea);
var m=a;c&&(m=0<=f,this.collapse(!m));d=d.getRangeBoundaryPosition(this,m);var l=h.characterOptions,k=h.wordOptions;h=0;var B=d,A=Math.abs(f);if(0!==f){f=0>f;switch(e){case "character":for(k=p(d,f,null,l);(g=k.next())&&h<A;)++h,B=g;k.dispose();break;case "word":k=t(d,l,k);for(var x=f?k.previousStartToken:k.nextEndToken;(k=x())&&h<A;)k.isWord&&(++h,B=f?k.chars[0]:k.chars[k.chars.length-1]);break;default:throw Error("movePositionBy: unit '"+e+"' not implemented");}f?(B=B.previousVisible(),h=-h):B&&
B.isLeadingSpace&&!B.isTrailingSpace&&("word"==e&&(k=p(d,!1,null,l),g=k.next(),k.dispose()),g&&(B=g.previousVisible()))}d=B;g=h;this[m?"setStart":"setEnd"](d.node,d.offset);return g})}function J(a){return x(function(b,c){c=N(c,oa);var d,e=m(b,this,c,!a);for(b=0;(d=e.next())&&U.test(d.character);)++b;e.dispose();if(d=0<b)this[a?"moveStart":"moveEnd"]("character",a?b:-b,{characterOptions:c});return d})}function L(a){return x(function(b,c){var d=!1;this.changeEachRange(function(b){d=b[a](c)||d});return d})}
var u=a.dom,G=a.util,K=G.extend,N=G.createOptions,P=u.getBody,Q=/^[ \t\f\r\n]+$/,ma=/^[ \t\f\r]+$/,U=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,ea=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,na=a.Selection.isDirectionBackward,ua=!1,va=!1;(function(){var b=u.createTestElement(document,"<p>1 </p><p></p>",!0),c=b.firstChild,d=a.getSelection();d.collapse(c.lastChild,2);d.setStart(c.firstChild,0);b.innerHTML="1 <br />";d.collapse(b,2);d.setStart(b.firstChild,
0);ua=1==(""+d).length;b.innerHTML="1 <p>1</p>";d.collapse(b,2);d.setStart(b.firstChild,0);va=1==(""+d).length;u.removeNode(b);d.removeAllRanges()})();var oa={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},Ca={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!ua,includeSpaceBeforeBlock:!va,includePreLineTrailingSpace:!0},pa={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:function(a,
b){function c(a,b,c){f.push({start:a,end:b,isWord:c})}for(var d=a.join(""),e,f=[],h=0,g;e=b.wordRegex.exec(d);){g=e.index;e=g+e[0].length;g>h&&c(h,g,!1);if(b.includeTrailingSpace)for(;ea.test(a[e]);)++e;c(g,e,!0);h=e}h<a.length&&c(h,a.length,!1);return f}}},Da={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},Ea={wordOptions:null,characterOptions:null},Fa={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},
Ga={wordOptions:null,characterOptions:null,direction:"forward"},fa=u.getComputedStyleProperty,wa;(function(){var a=document.createElement("table"),b=P(document);b.appendChild(a);wa="block"==fa(a,"display");b.removeChild(a)})();var xa={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};C.prototype={get:function(a){return this.store.hasOwnProperty(a)?
this.store[a]:null},set:function(a,b){return this.store[a]=b}};var Ba=0,Ha=0,ha={getPosition:function(a){var b=this.positions;return b.get(a)||b.set(a,new D(this,a))},toString:function(){return"[NodeWrapper("+u.inspectNode(this.node)+")]"}};z.prototype=ha;K(ha,{isCharacterDataNode:y("isCharacterDataNode",u.isCharacterDataNode,"node"),getNodeIndex:y("nodeIndex",u.getNodeIndex,"node"),getLength:y("nodeLength",u.getNodeLength,"node"),containsPositions:y("containsPositions",function(a){return u.isCharacterDataNode(a)||
!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(a.nodeName)},"node"),isWhitespace:y("isWhitespace",q,"node"),isCollapsedWhitespace:y("isCollapsedWhitespace",n,"node"),getComputedDisplay:y("computedDisplay",c,"node"),isCollapsed:y("collapsed",r,"node"),isIgnored:y("ignored",w,"node"),next:y("nextPos",l,"node"),previous:y("previous",k,"node"),getTextNodeInfo:y("textNodeInfo",function(a){var b=null,c=!1,d=fa(a.parentNode,"whiteSpace"),e="pre-line"==d;if(e)b=ma,c=!0;
else if("normal"==d||"nowrap"==d)b=Q,c=!0;return{node:a,text:a.data,spaceRegex:b,collapseSpaces:c,preLine:e}},"node"),hasInnerText:y("hasInnerText",function(a,b){var c=this.session,d=c.getPosition(a.parentNode,this.getNodeIndex()+1);c=c.getPosition(a,0);a=b?d:c;for(d=b?c:d;a!==d;){a.prepopulateChar();if(a.isDefinitelyNonEmpty())return!0;a=b?a.previousVisible():a.nextVisible()}return!1},"node"),isRenderedBlock:y("isRenderedBlock",function(a){a=a.getElementsByTagName("br");for(var b=0,c=a.length;b<
c;++b)if(!r(a[b]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:y("trailingSpace",function(a){if("br"!=a.tagName.toLowerCase())switch(this.getComputedDisplay()){case "inline":for(a=a.lastChild;a;){if(!w(a))return 1==a.nodeType?this.session.getNodeWrapper(a).getTrailingSpace():"";a=a.previousSibling}break;case "inline-block":case "inline-table":case "none":case "table-column":case "table-column-group":break;case "table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},
"node"),getLeadingSpace:y("leadingSpace",function(a){switch(this.getComputedDisplay()){case "inline":case "inline-block":case "inline-table":case "none":case "table-column":case "table-column-group":case "table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});ha={character:"",characterType:"EMPTY",isBr:!1,prepopulateChar:function(){if(!this.prepopulatedChar){var a=this.node,b=this.offset,c="",d="EMPTY",e=!1;if(0<b)if(3==a.nodeType){a=a.data;var f=a.charAt(b-1),h=this.nodeWrapper.getTextNodeInfo(),
g=h.spaceRegex;h.collapseSpaces?g.test(f)?1<b&&g.test(a.charAt(b-2))||(h.preLine&&"\n"===a.charAt(b)?(c=" ",d="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK"):(c=" ",d="COLLAPSIBLE_SPACE")):(c=f,d="NON_SPACE",e=!0):(c=f,d="UNCOLLAPSIBLE_SPACE",e=!0)}else(f=a.childNodes[b-1])&&1==f.nodeType&&!r(f)&&("br"==f.tagName.toLowerCase()?(c="\n",this.isBr=!0,d="COLLAPSIBLE_SPACE",e=!1):this.checkForTrailingSpace=!0),c||(b=a.childNodes[b])&&1==b.nodeType&&!r(b)&&(this.checkForLeadingSpace=!0);this.prepopulatedChar=
!0;this.character=c;this.characterType=d;this.isCharInvariant=e}},isDefinitelyNonEmpty:function(){var a=this.characterType;return"NON_SPACE"==a||"UNCOLLAPSIBLE_SPACE"==a},resolveLeadingAndTrailingSpaces:function(){this.prepopulatedChar||this.prepopulateChar();if(this.checkForTrailingSpace){var a=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();a&&(this.isTrailingSpace=!0,this.character=a,this.characterType="COLLAPSIBLE_SPACE");this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){if(a=
this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace())this.isLeadingSpace=!0,this.character=a,this.characterType="COLLAPSIBLE_SPACE";this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(a){for(var b=this,c;b=b.previousVisible();)if(c=b.getCharacter(a),""!==c)return b;return null},getCharacter:function(a){function b(){t||(m=p.getPrecedingUncollapsedPosition(a),t=!0);return m}this.resolveLeadingAndTrailingSpaces();var c=this.character,d=f(a.ignoreCharacters),
e=""!==c&&-1<d.indexOf(c);if(this.isCharInvariant)return e?"":c;e=["character",a.includeSpaceBeforeBr,a.includeBlockContentTrailingSpace,a.includePreLineTrailingSpace,d].join("_");var h=this.cache.get(e);if(null!==h)return h;h="";var g,m,t=!1,p=this;if("COLLAPSIBLE_SPACE"==this.characterType)if("INCLUDED_TRAILING_LINE_BREAK_AFTER_BR"==this.type)h="\n";else if(" "!=c||b()&&!m.isTrailingSpace&&"\n"!=m.character&&(" "!=m.character||"COLLAPSIBLE_SPACE"!=m.characterType))if("\n"==c&&this.isLeadingSpace)b()&&
"\n"!=m.character&&(h="\n");else if(g=this.nextUncollapsed())if(g.isBr?this.type="TRAILING_SPACE_BEFORE_BR":g.isTrailingSpace&&"\n"==g.character?this.type="TRAILING_SPACE_IN_BLOCK":g.isLeadingSpace&&"\n"==g.character&&(this.type="TRAILING_SPACE_BEFORE_BLOCK"),"\n"==g.character){if("TRAILING_SPACE_BEFORE_BR"!=this.type||a.includeSpaceBeforeBr)if("TRAILING_SPACE_BEFORE_BLOCK"!=this.type||a.includeSpaceBeforeBlock)if("TRAILING_SPACE_IN_BLOCK"!=this.type||!g.isTrailingSpace||a.includeBlockContentTrailingSpace)if("PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK"!=
this.type||"NON_SPACE"!=g.type||a.includePreLineTrailingSpace)"\n"==c?g.isTrailingSpace?!this.isTrailingSpace&&this.isBr&&(g.type="TRAILING_LINE_BREAK_AFTER_BR",b()&&m.isLeadingSpace&&!m.isTrailingSpace&&"\n"==m.character?g.character="":g.type="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR"):h="\n":" "==c&&(h=" ")}else h=c;-1<d.indexOf(h)&&(h="");this.cache.set(e,h);return h},equals:function(a){return!!a&&this.node===a.node&&this.offset===a.offset},inspect:function(){return"[Position("+u.inspectNode(this.node)+
":"+this.offset+")]"},toString:function(){return this.character}};D.prototype=ha;K(ha,{next:y("nextPos",function(a){var b=a.nodeWrapper,c=a.node,d=a.offset;a=b.session;if(!c)return null;d==b.getLength()?b=(c=c.parentNode)?b.getNodeIndex()+1:0:b.isCharacterDataNode()?b=d+1:(b=c.childNodes[d],a.getNodeWrapper(b).containsPositions()?(c=b,b=0):b=d+1);return c?a.getPosition(c,b):null}),previous:y("previous",function(a){var b=a.nodeWrapper,c=a.node,d=a.offset;a=b.session;0==d?b=(c=c.parentNode)?b.getNodeIndex():
0:b.isCharacterDataNode()?b=d-1:(b=c.childNodes[d-1],a.getNodeWrapper(b).containsPositions()?(c=b,b=u.getNodeLength(b)):b=d-1);return c?a.getPosition(c,b):null}),nextVisible:y("nextVisible",function(a){var b=a.next();if(!b)return null;a=b.nodeWrapper;var c=b.node;a.isCollapsed()&&(b=a.session.getPosition(c.parentNode,a.getNodeIndex()+1));return b}),nextUncollapsed:y("nextUncollapsed",function(a){for(;a=a.nextVisible();)if(a.resolveLeadingAndTrailingSpaces(),""!==a.character)return a;return null}),
previousVisible:y("previousVisible",function(a){var b=a.previous();if(!b)return null;a=b.nodeWrapper;var c=b.node;a.isCollapsed()&&(b=a.session.getPosition(c.parentNode,a.getNodeIndex()));return b})});var V=null,sa=function(){function a(a){var b=new C;return{get:function(c){var d=b.get(c[a]);if(d)for(var e=0,f;f=d[e++];)if(f.node===c)return f;return null},set:function(c){var d=c.node[a];(b.get(d)||b.set(d,[])).push(c)}}}function b(){this.initCaches()}var c=G.isHostProperty(document.documentElement,
"uniqueID");b.prototype={initCaches:function(){this.elementCache=c?function(){var a=new C;return{get:function(b){return a.get(b.uniqueID)},set:function(b){a.set(b.node.uniqueID,b)}}}():a("tagName");this.textNodeCache=a("data");this.otherNodeCache=a("nodeName")},getNodeWrapper:function(a){switch(a.nodeType){case 1:var b=this.elementCache;break;case 3:b=this.textNodeCache;break;default:b=this.otherNodeCache}var c=b.get(a);c||(c=new z(a,this),b.set(c));return c},getPosition:function(a,b){return this.getNodeWrapper(a).getPosition(b)},
getRangeBoundaryPosition:function(a,b){b=b?"start":"end";return this.getPosition(a[b+"Container"],a[b+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}};return b}();K(u,{nextNode:l,previousNode:k});var ta=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c]===b)return c;return-1};K(a.rangePrototype,{moveStart:v(!0,!1),moveEnd:v(!1,!1),move:v(!0,!0),trimStart:J(!0),trimEnd:J(!1),trim:x(function(a,
b){a=this.trimStart(b);b=this.trimEnd(b);return a||b}),expand:x(function(a,c,d){var e=!1;d=b(d,Fa);var f=d.characterOptions;c||(c="character");if("word"==c){var h=d.wordOptions;c=a.getRangeBoundaryPosition(this,!0);a=a.getRangeBoundaryPosition(this,!1);var g=t(c,f,h).nextEndToken(),m=g.chars[0].previousVisible();h=this.collapsed?g:t(a,f,h).previousStartToken();h=h.chars[h.chars.length-1];m.equals(c)||(this.setStart(m.node,m.offset),e=!0);h&&!h.equals(a)&&(this.setEnd(h.node,h.offset),e=!0);d.trim&&
(d.trimStart&&(e=this.trimStart(f)||e),d.trimEnd&&(e=this.trimEnd(f)||e));return e}return this.moveEnd("character",1,d)}),text:x(function(a,b){if(this.collapsed)b="";else{var c=N(b,oa);b=[];for(a=m(a,this,c);c=a.next();)b.push(c);a.dispose();b=b.join("")}return b}),selectCharacters:x(function(a,b,c,d,e){a={characterOptions:e};b||(b=P(this.getDocument()));this.selectNodeContents(b);this.collapse(!0);this.moveStart("character",c,a);this.collapse(!0);this.moveEnd("character",d-c,a)}),toCharacterRange:x(function(a,
b,c){b||(b=P(this.getDocument()));a=b.parentNode;b=u.getNodeIndex(b);var d=-1==u.comparePoints(this.startContainer,this.endContainer,a,b),e=this.cloneRange();d?(e.setStartAndEnd(this.startContainer,this.startOffset,a,b),a=-e.text(c).length):(e.setStartAndEnd(a,b,this.startContainer,this.startOffset),a=e.text(c).length);c=a+this.text(c).length;return{start:a,end:c}}),findText:x(function(c,d,e){e=b(e,Da);e.wholeWordsOnly&&(e.wordOptions.includeTrailingSpace=!1);var f=na(e.direction),h=e.withinRange;
h||(h=a.createRange(),h.selectNodeContents(this.getDocument()));var g=!1;"string"==typeof d?e.caseSensitive||(d=d.toLowerCase()):g=!0;var m=c.getRangeBoundaryPosition(this,!f),t=h.comparePoint(m.node,m.offset);-1===t?m=c.getRangeBoundaryPosition(h,!0):1===t&&(m=c.getRangeBoundaryPosition(h,!1));var p=m;for(t=!1;;)if(p=B(p,d,g,h,e)){if(p.valid)return this.setStartAndEnd(p.startPos.node,p.startPos.offset,p.endPos.node,p.endPos.offset),!0;p=f?p.startPos:p.endPos}else if(e.wrap&&!t)h=h.cloneRange(),p=
c.getRangeBoundaryPosition(h,!f),h.setBoundary(m.node,m.offset,f),t=!0;else return!1}),pasteHtml:function(a){this.deleteContents();if(a){a=this.createContextualFragment(a);var b=a.lastChild;this.insertNode(a);this.collapseAfter(b)}}});K(a.selectionPrototype,{expand:x(function(a,b,c){this.changeEachRange(function(a){a.expand(b,c)})}),move:x(function(a,b,c,d){a=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var e=this.getRangeAt(0);d||(d={});d.characterOptions=N(d.characterOptions,
Ca);a=e.move(b,c,d);this.setSingleRange(e)}return a}),trimStart:L("trimStart"),trimEnd:L("trimEnd"),trim:L("trim"),selectCharacters:x(function(b,c,d,e,f,h){b=a.createRange(c);b.selectCharacters(c,d,e,h);this.setSingleRange(b,f)}),saveCharacterRanges:x(function(a,b,c){a=this.getAllRanges();for(var d=[],e=1==a.length&&this.isBackward(),f=0,h=a.length;f<h;++f)d[f]={characterRange:a[f].toCharacterRange(b,c),backward:e,characterOptions:c};return d}),restoreCharacterRanges:x(function(b,c,d){this.removeAllRanges();
b=0;for(var e=d.length,f,h,g;b<e;++b)h=d[b],g=h.characterRange,f=a.createRange(c),f.selectCharacters(c,g.start,g.end,h.characterOptions),this.addRange(f,h.backward)}),text:x(function(a,b){a=[];for(var c=0,d=this.rangeCount;c<d;++c)a[c]=this.getRangeAt(c).text(b);return a.join("")})});a.innerText=function(b,c){var d=a.createRange(b);d.selectNodeContents(b);return d.text(c)};a.createWordIterator=function(a,c,d){var e=V||H();d=b(d,Ga);a=e.getPosition(a,c);var f=t(a,d.characterOptions,d.wordOptions),
h=na(d.direction);return{next:function(){return h?f.previousStartToken():f.nextEndToken()},dispose:function(){f.dispose();this.next=function(){}}}};a.noMutation=function(a){var b=V||H();a(b);A()};a.noMutation.createEntryPointFunction=x;a.textRange={isBlockNode:function(a){return a&&(1==a.nodeType&&!/^(inline(-block|-table)?|none)$/.test(c(a))||9==a.nodeType||11==a.nodeType)},isCollapsedWhitespaceNode:n,createPosition:x(function(a,b,c){return a.getPosition(b,c)})}});
wysihtml.browser=function(){function a(a,b){var c=-1,d;"Microsoft Internet Explorer"==navigator.appName?d=/MSIE ([0-9]{1,}[.0-9]{0,})/:"Netscape"==navigator.appName&&(-1<navigator.userAgent.indexOf("Trident")?d=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/:/Edge\/(\d+)./i.test(navigator.userAgent)&&(d=/Edge\/(\d+)./i));d&&null!=d.exec(navigator.userAgent)&&(c=parseFloat(RegExp.$1));if(-1===c)return!1;if(!a)return!0;if(!b)return a===c;if("<"===b)return a<c;if(">"===b)return a>c;if("<="===b)return a<=c;if(">="===
b)return a>=c}var e=navigator.userAgent,d=document.createElement("div"),g=-1!==e.indexOf("Gecko")&&-1===e.indexOf("KHTML")&&!a(),f=-1!==e.indexOf("AppleWebKit/")&&!a(),b=-1!==e.indexOf("Chrome/")&&!a(),c=-1!==e.indexOf("Opera/")&&!a();return{USER_AGENT:e,supported:function(){var a=this.USER_AGENT.toLowerCase(),b="contentEditable"in d,c=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,e=document.querySelector&&document.querySelectorAll,f;if(f=this.isIos())f=5>+(/ipad|iphone|ipod/.test(a)&&
a.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1];a=f||this.isAndroid()&&4>+(a.match(/android (\d+)/)||[void 0,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return b&&c&&e&&!a},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return a()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in
document)},displaysCaretInEmptyContentEditableCorrectly:function(){return a(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in d},insertsLineBreaksOnReturn:function(){return g},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){var b;(b="on"+a in d)||(d.setAttribute("on"+a,"return;"),b="function"===typeof d["on"+a]);return b},supportsEventsInIframeCorrectly:function(){return!c},supportsHTML5Tags:function(a){a=a.createElement("div");a.innerHTML=
"<article>foo</article>";return"<article>foo</article>"===a.innerHTML.toLowerCase()},supportsCommand:function(){var b={formatBlock:a(10,"<="),insertUnorderedList:a(),insertOrderedList:a()},c={insertHTML:g};return function(a,d){if(!b[d]){try{return a.queryCommandSupported(d)}catch(n){}try{return a.queryCommandEnabled(d)}catch(n){return!!c[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return a()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},
clearsContentEditableCorrectly:function(){return g||c||f},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return g||a()||c},autoScrollsToCaret:function(){return!f},autoClosesUnclosedTags:function(){var a=d.cloneNode(!1);a.innerHTML="<p><div></div>";a=a.innerHTML.toLowerCase();var b="<p></p><div></div>"===a||"<p><div></div></p>"===a;this.autoClosesUnclosedTags=function(){return b};return b},supportsNativeGetElementsByClassName:function(){return-1!==
String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return c},supportsSpeechApiOn:function(a){return 11<=(e.match(/Chrome\/(\d+)/)||[void 0,0])[1]&&("onwebkitspeechchange"in a||"speech"in a)},crashesWhenDefineProperty:function(b){return a(9)&&("XMLHttpRequest"===b||"XDomainRequest"===b)},doesAsyncFocus:function(){return a(12,">")},hasProblemsSettingCaretAfterImg:function(){return a()},
hasLiDeletingProblem:function(){return a()},hasUndoInContextMenu:function(){return g||b||c},hasInsertNodeIssue:function(){return c},hasIframeFocusIssue:function(){return a()},createsNestedInvalidMarkupAfterPaste:function(){return f},hasCaretBlockElementIssue:function(){return f},supportsMutationEvents:function(){return"MutationEvent"in window},supportsMutationObserver:function(){return"MutationObserver"in window},supportsModernPaste:function(){return!a()},fixStyleKey:function(a){return"cssFloat"===
a?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":a},usesControlRanges:function(){return document.body&&"createControlRange"in document.body},hasCaretAtLinkEndInsertionProblems:function(){return f}}}();
wysihtml.lang.array=function(a){return{contains:function(e){if(Array.isArray(e)){for(var d=e.length;d--;)if(-1!==wysihtml.lang.array(a).indexOf(e[d]))return!0;return!1}return-1!==wysihtml.lang.array(a).indexOf(e)},indexOf:function(e){if(a.indexOf)return a.indexOf(e);for(var d=0,g=a.length;d<g;d++)if(a[d]===e)return d;return-1},without:function(e){e=wysihtml.lang.array(e);for(var d=[],g=0,f=a.length;g<f;g++)e.contains(a[g])||d.push(a[g]);return d},get:function(){for(var e=0,d=a.length,g=[];e<d;e++)g.push(a[e]);
return g},map:function(e,d){if(Array.prototype.map)return a.map(e,d);for(var g=a.length>>>0,f=Array(g),b=0;b<g;b++)f[b]=e.call(d,a[b],b,a);return f},unique:function(){for(var e=[],d=a.length,g=0;g<d;)wysihtml.lang.array(e).contains(a[g])||e.push(a[g]),g++;return e}}};
wysihtml.lang.Dispatcher=Base.extend({on:function(a,e){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(e);return this},off:function(a,e){this.events=this.events||{};var d=0,g;if(a){var f=this.events[a]||[];for(g=[];d<f.length;d++)f[d]!==e&&e&&g.push(f[d]);this.events[a]=g}else this.events={};return this},fire:function(a,e){this.events=this.events||{};a=this.events[a]||[];for(var d=0;d<a.length;d++)a[d].call(this,e);return this},observe:function(){return this.on.apply(this,
arguments)},stopObserving:function(){return this.off.apply(this,arguments)}});
wysihtml.lang.object=function(a){return{merge:function(e,d){for(var g in e)d&&wysihtml.lang.object(e[g]).isPlainObject()&&("undefined"===typeof a[g]||wysihtml.lang.object(a[g]).isPlainObject())?"undefined"===typeof a[g]?a[g]=wysihtml.lang.object(e[g]).clone(!0):wysihtml.lang.object(a[g]).merge(wysihtml.lang.object(e[g]).clone(!0)):a[g]=wysihtml.lang.object(e[g]).isPlainObject()?wysihtml.lang.object(e[g]).clone(!0):e[g];return this},difference:function(e){var d={},g;for(g in a)a.hasOwnProperty(g)&&
(e.hasOwnProperty(g)||(d[g]=a[g]));for(var f in e)e.hasOwnProperty(f)&&(a.hasOwnProperty(f)&&a[f]===e[f]||(d[0]=a[0]));return d},get:function(){return a},clone:function(e){var d={},g;if(null===a||!wysihtml.lang.object(a).isPlainObject())return a;for(g in a)a.hasOwnProperty(g)&&(d[g]=e?wysihtml.lang.object(a[g]).clone(e):a[g]);return d},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},
isPlainObject:function(){return a&&"[object Object]"===Object.prototype.toString.call(a)&&!("Node"in window?a instanceof Node:a instanceof Element||a instanceof Text)},isEmpty:function(){for(var e in a)if(a.hasOwnProperty(e))return!1;return!0}}};
(function(){var a=/^\s+/,e=/\s+$/,d=/[&<>\t"]/g,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml.lang.string=function(f){f=String(f);return{trim:function(){return f.replace(a,"").replace(e,"")},interpolate:function(a){for(var b in a)f=this.replace("#{"+b+"}").by(a[b]);return f},replace:function(a){return{by:function(b){return f.split(a).join(b)}}},escapeHTML:function(a,c){var b=f.replace(d,function(a){return g[a]});a&&(b=b.replace(/(?:\r\n|\r|\n)/g,"<br />"));c&&(b=b.replace(/  /gi,
"&nbsp; "));return b}}}})();
(function(a){function e(a){return a.replace(f,function(a,d){a=(d.match(b)||[])[1]||"";var e=c[a];d=d.replace(b,"");d.split(e).length>d.split(a).length&&(d+=a,a="");var f=e=d;100<d.length&&(f=f.substr(0,100)+"...");"www."===e.substr(0,4)&&(e="http://"+e);return'<a href="'+e+'">'+f+"</a>"+a})}function d(b,c){if(!(g.contains(b.nodeName)||b.className&&a.lang.array(b.className.split(" ")).contains(c)))if(b.nodeType===a.TEXT_NODE&&b.data.match(f)){c=b.parentNode;var h=a.lang.string(b.data).escapeHTML();var l=
c.ownerDocument;var n=l._wysihtml_tempElement;n||(n=l._wysihtml_tempElement=l.createElement("div"));l=n;l.innerHTML="<span></span>"+e(h);for(l.removeChild(l.firstChild);l.firstChild;)c.insertBefore(l.firstChild,b);c.removeChild(b)}else{h=a.lang.array(b.childNodes).get();l=h.length;for(n=0;n<l;n++)d(h[n],c);return b}}var g=a.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),f=/((https?:\/\/|www\.)[^\s<]{3,})/gi,b=/([^\w\/\-](,?))$/i,c={")":"(","]":"[","}":"{"};a.dom.autoLink=function(b,c){a:{var e=
b;for(var f;e.parentNode;){e=e.parentNode;f=e.nodeName;if(e.className&&a.lang.array(e.className.split(" ")).contains(c)||g.contains(f)){e=!0;break a}if("body"===f)break}e=!1}if(e)return b;b===b.ownerDocument.documentElement&&(b=b.ownerDocument.body);return d(b,c)};a.dom.autoLink.URL_REG_EXP=f})(wysihtml);
(function(a){var e=a.dom;e.addClass=function(a,g){var d=a.classList;if(d)return d.add(g);e.hasClass(a,g)||(a.className+=" "+g)};e.removeClass=function(a,e){var d=a.classList;if(d)return d.remove(e);a.className=a.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ")};e.hasClass=function(a,e){var d=a.classList;if(d)return d.contains(e);a=a.className;return 0<a.length&&(a==e||(new RegExp("(^|\\s)"+e+"(\\s|$)")).test(a))}})(wysihtml);
wysihtml.dom.compareDocumentPosition=function(){return document.documentElement.compareDocumentPosition?function(a,e){return a.compareDocumentPosition(e)}:function(a,e){if(a===e)return 0;if(a===e.ownerDocument)return 20;if(a.ownerDocument===e)return 10;if((9===a.nodeType?a:a.ownerDocument)!==(9===e.nodeType?e:e.ownerDocument))return 1;if(2===a.nodeType&&a.childNodes&&-1!==wysihtml.lang.array(a.childNodes).indexOf(e))return 20;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml.lang.array(e.childNodes).indexOf(a))return 10;
for(var d=a,g=[];d;){if(d==e)return 10;g.push(d);d=d.parentNode}d=e;for(e=null;d;){if(d==a)return 20;var f=wysihtml.lang.array(g).indexOf(d);if(-1!==f)return a=g[f],g=wysihtml.lang.array(a.childNodes).indexOf(g[f-1]),e=wysihtml.lang.array(a.childNodes).indexOf(e),g>e?2:4;e=d;d=d.parentNode}return 1}}();
wysihtml.dom.contains=function(){var a=document.documentElement;if(a.contains)return function(a,d){if(d.nodeType!==wysihtml.ELEMENT_NODE){if(d.parentNode===a)return!0;d=d.parentNode}return a!==d&&a.contains(d)};if(a.compareDocumentPosition)return function(a,d){return!!(a.compareDocumentPosition(d)&16)}}();
(function(a){var e=document;a.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(d,e,f){this.callback=d||a.EMPTY_FUNCTION;this.config=a.lang.object({}).merge(e).get();this.config.className||(this.config.className="wysihtml-sandbox");this.element=f?this._bindElement(f):this._createElement()},
destroy:function(){},_createElement:function(){var a=e.createElement("div");a.className=this.config.className;this._loadElement(a);return a},_bindElement:function(a){a.className=a.className?a.className+" wysihtml-sandbox":"wysihtml-sandbox";this._loadElement(a,!0);return a},_loadElement:function(a,e){var d=this;e||(e=this._getHtml(),a.innerHTML=e);this.loaded=!0;setTimeout(function(){d.callback(d)},0)},_getHtml:function(a){return""}})})(wysihtml);
wysihtml.dom.convertToList=function(){function a(a,d){a=a.createElement("li");d.appendChild(a);return a}return function(e,d,g){if("UL"===e.nodeName||"OL"===e.nodeName||"MENU"===e.nodeName)return e;var f=e.ownerDocument;d=f.createElement(d);var b=e.querySelectorAll("br"),c=b.length,h,l,k;for(k=0;k<c;k++)for(l=b[k];(h=l.parentNode)&&h!==e&&h.lastChild===l;){if("block"===wysihtml.dom.getStyle("display").from(h)){h.removeChild(l);break}wysihtml.dom.insert(l).after(l.parentNode)}h=wysihtml.lang.array(e.childNodes).get();
b=h.length;for(k=0;k<b;k++){var q=q||a(f,d);c=h[k];l="block"===wysihtml.dom.getStyle("display").from(c);var n="BR"===c.nodeName;!l||g&&wysihtml.dom.hasClass(c,g)?n?q=q.firstChild?null:q:q.appendChild(c):(q=q.firstChild?a(f,d):q,q.appendChild(c),q=null)}0===h.length&&a(f,d);e.parentNode.replaceChild(d,e);return d}}();wysihtml.dom.copyAttributes=function(a){return{from:function(e){return{to:function f(g){for(var b,c=0,h=a.length;c<h;c++)b=a[c],"undefined"!==typeof e[b]&&""!==e[b]&&(g[b]=e[b]);return{andTo:f}}}}}};
(function(a){var e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],d=function(d){a:{var f=0;for(var b=e.length;f<b;f++)if("border-box"===a.getStyle(e[f]).from(d)){f=e[f];break a}f=void 0}return f?parseInt(a.getStyle("width").from(d),10)<d.offsetWidth:!1};a.copyStyles=function(g){return{from:function(f){d(f)&&(g=wysihtml.lang.array(g).without(e));for(var b="",c=g.length,h=0,l;h<c;h++)l=g[h],b+=l+":"+a.getStyle(l).from(f)+";";return{to:function n(c){a.setStyles(b).on(c);return{andTo:n}}}}}}})(wysihtml.dom);
(function(a){a.dom.delegate=function(a,d,g,f){var b=function(b){var c=b.target;c=3===c.nodeType?c.parentNode:c;for(var e=a.querySelectorAll(d),g=0,q=e.length;g<q;g++)e[g].contains(c)&&f.call(e[g],b)};a.addEventListener(g,b,!1);return{stop:function(){a.removeEventListener(g,b,!1)}}}})(wysihtml);
(function(a){function e(a,e){for(var d=[a];e&&a&&a!==e||!e&&a;)d.unshift(a),a=a.parentNode;return d}a.dom.domNode=function(d){var g=[a.ELEMENT_NODE,a.TEXT_NODE];return{is:{emptyTextNode:function(e){e=e?/^\s*$/g:/^[\r\n]*$/g;return d&&d.nodeType===a.TEXT_NODE&&e.test(d.data)},rangyBookmark:function(){return d&&1===d.nodeType&&d.classList.contains("rangySelectionBoundary")},visible:function(){var e=!/^\s*$/g.test(a.dom.getTextContent(d));e||1===d.nodeType&&d.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&
(e=!0);return e},lineBreak:function(){return d&&1===d.nodeType&&"BR"===d.nodeName},block:function(){return d&&1===d.nodeType&&"block"===d.ownerDocument.defaultView.getComputedStyle(d).display},voidElement:function(){return a.dom.domNode(d).test({query:a.VOID_ELEMENTS})}},prev:function(e){var b=d.previousSibling,c=e&&e.nodeTypes?e.nodeTypes:g;return b?a.dom.domNode(b).is.rangyBookmark()||!a.lang.array(c).contains(b.nodeType)||e&&e.ignoreBlankTexts&&a.dom.domNode(b).is.emptyTextNode(!0)?a.dom.domNode(b).prev(e):
b:null},next:function(e){var b=d.nextSibling,c=e&&e.nodeTypes?e.nodeTypes:g;return b?a.dom.domNode(b).is.rangyBookmark()||!a.lang.array(c).contains(b.nodeType)||e&&e.ignoreBlankTexts&&a.dom.domNode(b).is.emptyTextNode(!0)?a.dom.domNode(b).next(e):b:null},commonAncestor:function(a,b){var c=e(d,b);a=e(a,b);if(c[0]!=a[0])return null;for(b=0;b<c.length;b++)if(c[b]!=a[b])return c[b-1];return null},lastLeafNode:function(e){if(1!==d.nodeType)return d;var b=d.lastChild;if(!b)return d;if(e&&e.leafClasses)for(var c=
e.leafClasses.length;c--;)if(a.dom.hasClass(d,e.leafClasses[c]))return d;return a.dom.domNode(b).lastLeafNode(e)},escapeParent:function(e,b){var c,f=d;if(!a.dom.contains(e,d))throw Error("Child is not a descendant of node.");do{var g=f.parentNode;for(c=g.cloneNode(!1);g.lastChild&&g.lastChild!==f;)c.insertBefore(g.lastChild,c.firstChild);if(g!==e){var k=g.cloneNode(!1);k.appendChild(f);f=k}g.parentNode.insertBefore(f,g.nextSibling);if(""!==c.innerHTML)if(/^\s+$/.test(c.innerHTML))for(;c.lastChild;)g.parentNode.insertBefore(c.lastChild,
f.nextSibling);else g.parentNode.insertBefore(c,f.nextSibling);if(""===g.innerHTML)g.parentNode.removeChild(g);else if(/^\s+$/.test(g.innerHTML)){for(;g.firstChild;)g.parentNode.insertBefore(g.firstChild,g);g.parentNode.removeChild(g)}}while(g&&g!==e);b&&f&&(f.parentNode.insertBefore(b,f),b.appendChild(f))},transferContentTo:function(e,b){if(1===d.nodeType){if(a.dom.domNode(e).is.voidElement()||3===e.nodeType)for(;d.lastChild;)e.parentNode.insertBefore(d.lastChild,e.nextSibling);else for(;d.firstChild;)e.appendChild(d.firstChild);
b&&d.parentNode.removeChild(d)}else if(3===d.nodeType||8===d.nodeType)a.dom.domNode(e).is.voidElement()?e.parentNode.insertBefore(d,e.nextSibling):e.appendChild(d)},test:function(e){if(!e||1!==d.nodeType||e.query&&!d.matches(e.query)||e.nodeName&&d.nodeName.toLowerCase()!==e.nodeName.toLowerCase()||e.className&&!d.classList.contains(e.className)||e.classRegExp&&0===((d.className||"").match(e.classRegExp)||[]).length)return!1;if(e.styleProperty&&0<e.styleProperty.length){var b=Array.isArray(e.styleProperty)?
e.styleProperty:[e.styleProperty];for(var c=b.length;0<c;){b=a.browser.fixStyleKey(b[0]);if(d.style[b])if(e.styleValue)if(e.styleValue instanceof RegExp){if(0<d.style[b].trim().match(e.styleValue).length)break}else if(Array.isArray(e.styleValue)){if(e.styleValue.indexOf(d.style[b].trim()))break}else{if(e.styleValue===d.style[b].trim().replace(/, /g,","))break}else break;return!1}}if(e.attribute){b=a.dom.getAttributes(d);c=[];var f=!1;Array.isArray(e.attribute)?c=e.attribute:c[e.attribute]=e.attributeValue;
for(var g in c)if(c.hasOwnProperty(g))if("undefined"===typeof c[g]){if("undefined"!==typeof b[g]){f=!0;break}}else if(b[g]===c[g]){f=!0;break}if(!f)return!1}return!0}}}})(wysihtml);
wysihtml.dom.getAsDom=function(){var a="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(e,d){d=d||document;if("object"===typeof e&&e.nodeType)d=d.createElement("div"),d.appendChild(e);else if(wysihtml.browser.supportsHTML5Tags(d))d=d.createElement("div"),d.innerHTML=e;else{var g=d;if(!g._wysihtml_supportsHTML5Tags){for(var f=
0,b=a.length;f<b;f++)g.createElement(a[f]);g._wysihtml_supportsHTML5Tags=!0}g=d.createElement("div");g.style.display="none";d.body.appendChild(g);try{g.innerHTML=e}catch(c){}d.body.removeChild(g);d=g}return d}}();wysihtml.dom.getAttribute=function(a,e){var d=!wysihtml.browser.supportsGetAttributeCorrectly();e=e.toLowerCase();return"IMG"==a.nodeName&&"src"==e&&!0===wysihtml.dom.isLoadedImage(a)?a.src:d&&"outerHTML"in a?-1!=a.outerHTML.toLowerCase().indexOf(" "+e+"=")?a.getAttribute(e):null:a.getAttribute(e)};
wysihtml.dom.getAttributes=function(a){var e=!wysihtml.browser.supportsGetAttributeCorrectly(),d=a.nodeName,g=[],f;for(f in a.attributes)(a.attributes.hasOwnProperty&&a.attributes.hasOwnProperty(f)||!a.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(a.attributes,f))&&a.attributes[f].specified&&("IMG"==d&&"src"==a.attributes[f].name.toLowerCase()&&!0===wysihtml.dom.isLoadedImage(a)?g.src=a.src:wysihtml.lang.array(["rowspan","colspan"]).contains(a.attributes[f].name.toLowerCase())&&
e?1!==a.attributes[f].value&&(g[a.attributes[f].name]=a.attributes[f].value):g[a.attributes[f].name]=a.attributes[f].value);return g};wysihtml.dom.getParentElement=function(){return function(a,e,d,g){for(d=d||50;d--&&a&&"BODY"!==a.nodeName&&(!g||a!==g);){if(wysihtml.dom.domNode(a).test(e))return a;a=a.parentNode}return null}}();
wysihtml.dom.getPastedHtml=function(a){var e;wysihtml.browser.supportsModernPaste()&&a.clipboardData&&(wysihtml.lang.array(a.clipboardData.types).contains("text/html")?e=a.clipboardData.getData("text/html"):wysihtml.lang.array(a.clipboardData.types).contains("text/plain")&&(e=wysihtml.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0)));return e};
wysihtml.dom.getPastedHtmlWithDiv=function(a,e){var d=a.selection.getBookmark(),g=a.element.ownerDocument,f=g.createElement("DIV"),b=a.getScrollPos();g.body.appendChild(f);f.style.width="1px";f.style.height="1px";f.style.overflow="hidden";f.style.position="absolute";f.style.top=b.y+"px";f.style.left=b.x+"px";f.setAttribute("contenteditable","true");f.focus();setTimeout(function(){var b;a.selection.setBookmark(d);(b=f.innerHTML)&&/^<br\/?>$/i.test(b.trim())&&(b=!1);e(b);f.parentNode.removeChild(f)},
0)};
wysihtml.dom.getStyle=function(){function a(a){return a.replace(d,function(a){return a.charAt(1).toUpperCase()})}var e={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},d=/\-[a-z]/g;return function(d){return{from:function(f){if(f.nodeType===wysihtml.ELEMENT_NODE){var b=f.ownerDocument,c=e[d]||a(d),g=f.style,l=f.currentStyle,k=g[c];if(k)return k;if(l)try{return l[c]}catch(n){}c=b.defaultView||b.parentWindow;b=("height"===d||"width"===d)&&"TEXTAREA"===f.nodeName;if(c.getComputedStyle){if(b){var q=
g.overflow;g.overflow="hidden"}f=c.getComputedStyle(f,null).getPropertyValue(d);b&&(g.overflow=q||"");return f}}}}}}();wysihtml.dom.getTextNodes=function(a,e){var d=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?e&&/^\s*$/.test(a.innerText||a.textContent)||d.push(a):d=d.concat(wysihtml.dom.getTextNodes(a,e));return d};
(function(a){var e={},d=1;a.dom.hasElementWithClassName=function(g,f){if(!a.browser.supportsNativeGetElementsByClassName())return!!g.querySelector("."+f);var b=(g._wysihtml_identifier||(g._wysihtml_identifier=d++))+":"+f,c=e[b];c||(c=e[b]=g.getElementsByClassName(f));return 0<c.length}})(wysihtml);wysihtml.dom.hasElementWithTagName=function(){var a={},e=1;return function(d,g){var f=(d._wysihtml_identifier||(d._wysihtml_identifier=e++))+":"+g,b=a[f];b||(b=a[f]=d.getElementsByTagName(g));return 0<b.length}}();
wysihtml.dom.insert=function(a){return{after:function(e){e.parentNode.insertBefore(a,e.nextSibling)},before:function(e){e.parentNode.insertBefore(a,e)},into:function(e){e.appendChild(a)}}};wysihtml.dom.insertCSS=function(a){a=a.join("\n");return{into:function(e){var d=e.createElement("style");d.type="text/css";d.styleSheet?d.styleSheet.cssText=a:d.appendChild(e.createTextNode(a));var g=e.querySelector("head link");g?g.parentNode.insertBefore(d,g):(e=e.querySelector("head"))&&e.appendChild(d)}}};
wysihtml.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(e){if(a.complete&&"complete"===a.readyState)return!0}};
(function(a){a.dom.lineBreaks=function(e){function d(d){return"BR"===d.nodeName||"block"===a.dom.getStyle("display").from(d)?!0:!1}return{add:function(g){g=e.ownerDocument;var f=a.dom.domNode(e).next({ignoreBlankTexts:!0}),b=a.dom.domNode(e).prev({ignoreBlankTexts:!0});f&&!d(f)&&a.dom.insert(g.createElement("br")).after(e);b&&!d(b)&&a.dom.insert(g.createElement("br")).before(e)},remove:function(d){d=a.dom.domNode(e).next({ignoreBlankTexts:!0});var f=a.dom.domNode(e).prev({ignoreBlankTexts:!0});d&&
"BR"===d.nodeName&&d.parentNode.removeChild(d);f&&"BR"===f.nodeName&&f.parentNode.removeChild(f)}}}})(wysihtml);
wysihtml.dom.observe=function(a,e,d){e="string"===typeof e?[e]:e;for(var g,f,b=0,c=e.length;b<c;b++)f=e[b],a.addEventListener?a.addEventListener(f,d,!1):(g=function(b){"target"in b||(b.target=b.srcElement);b.preventDefault=b.preventDefault||function(){this.returnValue=!1};b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0};d.call(a,b)},a.attachEvent("on"+f,g));return{stop:function(){for(var b,c=0,f=e.length;c<f;c++)b=e[c],a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent("on"+
b,g)}}};
wysihtml.dom.parse=function(a,e){function d(a,b,e,f){var g=a.nodeType,m=a.childNodes,p=m.length,l=c[g],k;if(f&&1===g&&wysihtml.dom.hasClass(a,f))return a;var A=l&&l(a,e);if(!A){if(!1===A){g=a.ownerDocument.createDocumentFragment();for(l=p;l--;)m[l]&&(k=d(m[l],b,e,f))&&(m[l]===k&&l--,g.insertBefore(k,g.firstChild));b=wysihtml.dom.getStyle("display").from(a);""===b&&(b=wysihtml.lang.array(n).contains(a.tagName)?"block":"");wysihtml.lang.array(["block","flex","table"]).contains(b)&&g.appendChild(a.ownerDocument.createElement("br"));wysihtml.lang.array("div pre p table td th ul ol li dd dl footer header section h1 h2 h3 h4 h5 h6".split(" ")).contains(a.nodeName.toLowerCase())&&
a.parentNode.lastChild!==a&&(a.nextSibling&&3===a.nextSibling.nodeType&&/^\s/.test(a.nextSibling.nodeValue)||g.appendChild(a.ownerDocument.createTextNode(" ")));g.normalize&&g.normalize();return g}return null}for(l=0;l<p;l++)m[l]&&(k=d(m[l],b,e,f))&&(m[l]===k&&l--,A.appendChild(k));if(b&&A.nodeName.toLowerCase()===h&&(!A.childNodes.length||/^\s*$/gi.test(A.innerHTML)&&(e||"_wysihtml-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className)||!A.attributes.length)){for(g=A.ownerDocument.createDocumentFragment();A.firstChild;)g.appendChild(A.firstChild);
g.normalize&&g.normalize();return g}A.normalize&&A.normalize();return A}function g(a,b){var c=a.getAttribute("class"),d=a.getAttribute("style"),e,f;if(b.methods)for(g in b.methods)if(b.methods.hasOwnProperty(g)&&y[g]&&y[g](a))return!0;if(c&&b.classes){c=c.replace(/^\s+/g,"").replace(/\s+$/g,"").split(l);var g=c.length;for(var h=0;h<g;h++)if(b.classes[c[h]])return!0}if(d&&b.styles)for(e in d=d.split(";"),b.styles)if(b.styles.hasOwnProperty(e))for(g=d.length;g--;)if(c=d[g].split(":"),c[0].replace(/\s/g,
"").toLowerCase()===e&&(!0===b.styles[e]||1===b.styles[e]||wysihtml.lang.array(b.styles[e]).contains(c[1].replace(/\s/g,"").toLowerCase())))return!0;if(b.attrs)for(f in b.attrs)if(b.attrs.hasOwnProperty(f)&&(d=wysihtml.dom.getAttribute(a,f),"string"===typeof d&&-1<d.search(b.attrs[f])))return!0;return!1}function f(a,b,c,d){if(a=wysihtml.lang.object(c).isFunction()?c:r[c])if(b=a(b,d),"string"===typeof b)return b;return!1}function b(a,b){var c=wysihtml.lang.object(q.attributes||{}).clone();b=wysihtml.lang.object(c).merge(wysihtml.lang.object(b||
{}).clone()).get();c={};var d=wysihtml.dom.getAttributes(a),e;for(e in b)if(/\*$/.test(e)){var g=void 0;var h=e.slice(0,-1);var l=d,k=[];for(g in l)l.hasOwnProperty(g)&&0===g.indexOf(h)&&k.push(g);h=k;l=0;for(k=h.length;l<k;l++)g=f(h[l],d[h[l]],b[e],a.nodeName),!1!==g&&(c[h[l]]=g)}else g=f(e,d[e],b[e],a.nodeName),!1!==g&&(c[e]=g);return c}var c={1:function(a,c){var d=q.tags;var e=a.nodeName.toLowerCase();var f=a.scopeName;if(a._wysihtml)return null;a._wysihtml=1;if("wysihtml-temp"===a.className)return null;
f&&"HTML"!=f&&(e=f+":"+e);"outerHTML"in a&&(wysihtml.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(e="div"));if(e in d){d=d[e];if(!d||d.remove)return null;if(d.unwrap)return!1;d="string"===typeof d?{rename_tag:d}:d}else if(a.firstChild)d={rename_tag:h};else return null;if(f=d.one_of_type){a:{f=q;var m=d.one_of_type;if("SPAN"!==a.nodeName||c||"_wysihtml-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className){for(x in m)if(m.hasOwnProperty(x)&&
f.type_definitions&&f.type_definitions[x]){var k=f.type_definitions[x];if(g(a,k)){var x=!0;break a}}x=!1}else x=!0}f=!x}if(f)if(d.remove_action){if("unwrap"===d.remove_action)return!1;if("rename"===d.remove_action)var v=d.remove_action_rename_to||h;else return null}else return null;e=a.ownerDocument.createElement(v||d.rename_tag||e);var n=d;v={};var r=n.set_class,u=n.add_class,D=n.add_style,H=n.set_attributes;x=q.classes;f=0;m=[];k=[];var z=[];H&&(v=wysihtml.lang.object(H).clone());v=wysihtml.lang.object(v).merge(b(a,
n.check_attributes)).get();r&&m.push(r);if(u)for(Q in u)if(n=C[u[Q]])n=n(wysihtml.dom.getAttribute(a,Q)),"string"===typeof n&&m.push(n);if(D)for(Q in D)if(n=w[D[Q]])newStyle=n(wysihtml.dom.getAttribute(a,Q)),"string"===typeof newStyle&&k.push(newStyle);if("string"===typeof x&&"any"===x)if(a.getAttribute("class"))if(q.classes_blacklist){(u=a.getAttribute("class"))&&(m=m.concat(u.split(l)));for(u=m.length;f<u;f++)D=m[f],q.classes_blacklist[D]||z.push(D);z.length&&(v["class"]=wysihtml.lang.array(z).unique().join(" "))}else v["class"]=
a.getAttribute("class");else m&&0<m.length&&(v["class"]=wysihtml.lang.array(m).unique().join(" "));else{c||(x["_wysihtml-temp-placeholder"]=1,x._rangySelectionBoundary=1,x["wysiwyg-tmp-selected-cell"]=1);(u=a.getAttribute("class"))&&(m=m.concat(u.split(l)));for(u=m.length;f<u;f++)D=m[f],x[D]&&z.push(D);z.length&&(v["class"]=wysihtml.lang.array(z).unique().join(" "))}v["class"]&&c&&(v["class"]=v["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(v["class"])&&delete v["class"]);k.length&&
(v.style=wysihtml.lang.array(k).unique().join(" "));for(Q in v)try{e.setAttribute(Q,v[Q])}catch(ma){}v.src&&("undefined"!==typeof v.width&&e.setAttribute("width",v.width),"undefined"!==typeof v.height&&e.setAttribute("height",v.height));c=d;var y;if(c&&c.keep_styles)for(y in c.keep_styles)if(c.keep_styles.hasOwnProperty(y)){var Q="float"===y?a.style.styleFloat||a.style.cssFloat:a.style[y];c.keep_styles[y]instanceof RegExp&&!c.keep_styles[y].test(Q)||("float"===y?e.style[a.style.styleFloat?"styleFloat":
"cssFloat"]=Q:a.style[y]&&(e.style[y]=Q))}e.normalize&&e.normalize();return e},3:function(a){var b=a.nextSibling;if(b&&b.nodeType===wysihtml.TEXT_NODE)b.data=a.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")+b.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"");else return b=a.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,""),a.ownerDocument.createTextNode(b)},8:function(a){if(q.comments)return a.ownerDocument.createComment(a.nodeValue)}},h="span",l=/\s+/,k={tags:{},classes:{}},q={},n="ADDRESS BLOCKQUOTE CENTER DIR DIV DL FIELDSET FORM H1 H2 H3 H4 H5 H6 ISINDEX MENU NOFRAMES NOSCRIPT OL P PRE TABLE UL".split(" "),
r={url:function(){var a=/^https?:\/\//i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b,c){return b?
b.replace(a,""):"IMG"===c?"":null}}(),numbers:function(){var a=/\D/g;return function(b){return(b=(b||"").replace(a,""))||null}}(),dimension:function(){var a=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(b){return(b=(b||"").replace(a,"$1$2$3"))||null}}(),any:function(){return function(a){return a?a:null}}()},w={align_text:function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(b){return a[String(b).toLowerCase()]}}()},C={align_img:function(){var a=
{left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[String(b).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[String(b).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[String(b).toLowerCase()]}}(),
size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[String(b).charAt(0)]}}()},y={has_visible_contet:function(){var a,b="img video picture br script noscript style table iframe object embed audio svg input button select textarea canvas".split(" ");
return function(c){if((a=(c.innerText||c.textContent).replace(/\s/g,""))&&0<a.length)return!0;for(var d=b.length;d--;)if(c.querySelector(b[d]))return!0;return c.offsetWidth&&0<c.offsetWidth&&c.offsetHeight&&0<c.offsetHeight?!0:!1}}()},z={unwrap:function(a){wysihtml.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return function(a,b){wysihtml.lang.object(q).merge(k).merge(b.rules).get();var c=b.context||a.ownerDocument||document,e=c.createDocumentFragment(),f="string"===typeof a,g=
!1,h,l;!0===b.clearInternals&&(g=!0);a=f?wysihtml.dom.getAsDom(a,c):a;if(q.selectors)for(h in c=q.selectors,c)if(c.hasOwnProperty(h)){wysihtml.lang.object(c[h]).isFunction()?l=c[h]:"string"===typeof c[h]&&z[c[h]]&&(l=z[c[h]]);var v=a.querySelectorAll(h);for(var n=v.length;n--;)l(v[n])}for(;a.firstChild;)l=a.firstChild,(h=d(l,b.cleanUp,g,b.uneditableClass))&&e.appendChild(h),l!==h&&a.removeChild(l);if(b.unjoinNbsps)for(b=wysihtml.dom.getTextNodes(e),g=b.length;g--;)b[g].nodeValue=b[g].nodeValue.replace(/([\S\u00A0])\u00A0/gi,
"$1 ");a.innerHTML="";a.appendChild(e);return f?wysihtml.quirks.getCorrectInnerHTML(a):a}(a,e)};wysihtml.dom.query=function(a,e){var d=[],g;a.nodeType&&(a=[a]);for(var f=0,b=a.length;f<b;f++)if(g=a[f].querySelectorAll(e))for(var c=g.length;c--;d.unshift(g[c]));return d};wysihtml.dom.removeEmptyTextNodes=function(a){for(var e=wysihtml.lang.array(a.childNodes).get(),d=e.length,g=0;g<d;g++)a=e[g],a.nodeType===wysihtml.TEXT_NODE&&/^[\n\r]*$/.test(a.data)&&a.parentNode.removeChild(a)};
wysihtml.dom.removeInvisibleSpaces=function(a){a=wysihtml.dom.getTextNodes(a);for(var e=a.length;e--;)a[e].nodeValue=a[e].nodeValue.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")};wysihtml.dom.renameElement=function(a,e){e=a.ownerDocument.createElement(e);for(var d;d=a.firstChild;)e.appendChild(d);wysihtml.dom.copyAttributes(["align","className"]).from(a).to(e);a.parentNode&&a.parentNode.replaceChild(e,a);return e};
wysihtml.dom.replaceWithChildNodes=function(a){if(a.parentNode){for(;a.firstChild;)a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}};
(function(a){function e(d){return"block"===a.getStyle("display").from(d)}function d(a){var d=a.ownerDocument.createElement("br");a.appendChild(d)}a.resolveList=function(a,f){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var b=a.ownerDocument,c=b.createDocumentFragment(),g=wysihtml.dom.domNode(a).prev({ignoreBlankTexts:!0}),l=wysihtml.dom.domNode(a).next({ignoreBlankTexts:!0}),k=a.lastElementChild||a.lastChild,q;if(f)for(g&&!e(g)&&"BR"!==g.nodeName&&d(c);g=a.firstElementChild||a.firstChild;){b=g.lastChild;
for(q=g===k;f=g.firstChild;){var n=f===b;n=(!q||l&&!e(l))&&n&&!e(f)&&"BR"!==f.nodeName;c.appendChild(f);n&&d(c)}g.parentNode.removeChild(g)}else for(;g=a.firstElementChild||a.firstChild;){if(g.querySelector&&g.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;f=g.firstChild;)c.appendChild(f);else{for(l=b.createElement("p");f=g.firstChild;)l.appendChild(f);c.appendChild(l)}g.parentNode.removeChild(g)}a.parentNode.replaceChild(c,a)}}})(wysihtml.dom);
(function(a){var e=document,d="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),g="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),f=["referrer","write","open","close"];a.dom.Sandbox=Base.extend({constructor:function(b,c){this.callback=b||a.EMPTY_FUNCTION;this.config=a.lang.object({}).merge(c).get();this.config.className||(this.config.className="wysihtml-sandbox");this.editableArea=
this._createIframe()},insertInto:function(a){"string"===typeof a&&(a=e.getElementById(a));a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw Error("wysihtml.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var b=this,c=e.createElement("iframe");c.className=this.config.className;
a.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(c);a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(c.src="javascript:'<html></html>'");c.onload=function(){c.onreadystatechange=c.onload=null;b._onLoadIframe(c)};c.onreadystatechange=function(){/loaded|complete/.test(c.readyState)&&(c.onreadystatechange=c.onload=null,b._onLoadIframe(c))};return c},_onLoadIframe:function(b){if(a.dom.contains(e.documentElement,
b)){var c=this,h=b.contentWindow,l=b.contentWindow.document,k=this._getHtml({charset:e.characterSet||e.charset||"utf-8",stylesheets:this.config.stylesheets});l.open("text/html","replace");l.write(k);l.close();this.getWindow=function(){return b.contentWindow};this.getDocument=function(){return b.contentWindow?b.contentWindow.document:null};h.onerror=function(a,b,c){throw Error("wysihtml.Sandbox: "+a,b,c);};if(!a.browser.supportsSandboxedIframes()){var q;k=0;for(q=d.length;k<q;k++)this._unset(h,d[k]);
k=0;for(q=g.length;k<q;k++)this._unset(h,g[k],a.EMPTY_FUNCTION);k=0;for(q=f.length;k<q;k++)this._unset(l,f[k]);this._unset(l,"cookie","",!0)}a.polyfills&&a.polyfills(h,l).apply();this.loaded=!0;setTimeout(function(){c.callback(c)},0)}},_getHtml:function(b){var c=b.stylesheets,d="",e=0,f;if(c="string"===typeof c?[c]:c)for(f=c.length;e<f;e++)d+='<link rel="stylesheet" href="'+c[e]+'">';b.stylesheets=d;return a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},
_unset:function(b,c,d,e){try{b[c]=d}catch(q){}try{b.__defineGetter__(c,function(){return d})}catch(q){}if(e)try{b.__defineSetter__(c,function(){})}catch(q){}if(!a.browser.crashesWhenDefineProperty(c))try{var f={get:function(){return d}};e&&(f.set=function(){});Object.defineProperty(b,c,f)}catch(q){}}})})(wysihtml);(function(){var a={className:"class"};wysihtml.dom.setAttributes=function(e){return{on:function(d){for(var g in e)d.setAttribute(a[g]||g,e[g])}}}})();
wysihtml.dom.setStyles=function(a){return{on:function(e){e=e.style;if("string"===typeof a)e.cssText+=";"+a;else for(var d in a)"float"===d?(e.cssFloat=a[d],e.styleFloat=a[d]):e[d]=a[d]}}};
(function(a){a.simulatePlaceholder=function(e,d,g,f){var b=f||"wysihtml-placeholder";f=function(){var c=0<d.element.offsetWidth&&0<d.element.offsetHeight;d.hasPlaceholderSet()&&(d.clear(),d.element.focus(),c&&setTimeout(function(){var a=d.selection.getSelection();a.focusNode&&a.anchorNode||d.selection.selectNode(d.element.firstChild||d.element)},0));d.placeholderSet=!1;a.removeClass(d.element,b)};var c=function(){d.isEmpty()&&!d.placeholderSet&&(d.placeholderSet=!0,d.setValue(g,!1),a.addClass(d.element,
b))};e.on("set_placeholder",c).on("unset_placeholder",f).on("focus:composer",f).on("paste:composer",f).on("blur:composer",c);c()}})(wysihtml.dom);(function(a){var e=document.documentElement;"textContent"in e?(a.setTextContent=function(a,e){a.textContent=e},a.getTextContent=function(a){return a.textContent}):"innerText"in e?(a.setTextContent=function(a,e){a.innerText=e},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,e){a.nodeValue=e},a.getTextContent=function(a){return a.nodeValue})})(wysihtml.dom);
wysihtml.dom.unwrap=function(a){var e=[];if(a.parentNode){for(;a.lastChild;)e.unshift(a.lastChild),wysihtml.dom.insert(a.lastChild).after(a);a.parentNode.removeChild(a)}return e};
wysihtml.quirks.cleanPastedHTML=function(){return function(a,e){var d={color:wysihtml.dom.getStyle("color").from(e.referenceNode),fontSize:wysihtml.dom.getStyle("font-size").from(e.referenceNode)};a:{var g=e.rules;if(g){for(var f=0,b=g.length;f<b;f++){if(!g[f].condition)var c=g[f].set;if(g[f].condition&&g[f].condition.test(a)){g=g[f].set;break a}}g=c}else g=null}g=wysihtml.lang.object(g||{}).clone(!0);var h,l;for(h in g.tags)if(g.tags.hasOwnProperty(h)&&g.tags[h].keep_styles)for(l in g.tags[h].keep_styles)g.tags[h].keep_styles.hasOwnProperty(l)&&
d[l]&&(c=g.tags[h].keep_styles,f=l,b=wysihtml.lang.string(d[l]).trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),c[f]=new RegExp("^((?!^"+b+"$).)*$","i"));return wysihtml.dom.parse(a,{rules:g,cleanUp:!0,context:e.referenceNode.ownerDocument,uneditableClass:e.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}();
wysihtml.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var d=a.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==d||"<p>&nbsp;</p><p>&nbsp;</p>"==d)a.innerHTML=""},0)};return function(e){wysihtml.dom.observe(e.element,["cut","keydown"],a)}}();
(function(a){a.quirks.getCorrectInnerHTML=function(e){var d=e.innerHTML;if(-1===d.indexOf("%7E"))return d;e=e.querySelectorAll("[href*='~'], [src*='~']");var g;var f=0;for(g=e.length;f<g;f++){var b=e[f].href||e[f].src;var c=a.lang.string(b).replace("~").by("%7E");d=a.lang.string(d).replace(c).by(b)}return d}})(wysihtml);
(function(a){a.quirks.redraw=function(e){a.dom.addClass(e,"wysihtml-quirks-redraw");a.dom.removeClass(e,"wysihtml-quirks-redraw");try{var d=e.ownerDocument;d.execCommand("italic",!1,null);d.execCommand("italic",!1,null)}catch(g){}}})(wysihtml);
(function(a){function e(a){var b;for(b in d)if(d.hasOwnProperty(b)){var c=d[b];if(c.regex.test(a))return c}}var d={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},g=function(a){return new RegExp("(^|\\s|;)"+
a+"\\s*:\\s*[^;$]+","gi")};a.quirks.styleParser={getColorParseMethod:e,getColorFormat:function(a){return(a=e(a))?a.name:void 0},parseColor:function(f,b){var c,h,l=f;if(b){b=g(b);if(!(f=f.match(b)))return!1;f=f.pop().split(":")[1];l=a.lang.string(f).trim()}if(!(c=e(l))||!(h=l.match(c.regex)))return!1;var k=c.radix||10;if(c===d.hex3)return h.shift(),h.push(1),a.lang.array(h).map(function(a,b){return 3>b?parseInt(a,k)*k+parseInt(a,k):parseFloat(a)});h.shift();h[3]||h.push(1);return a.lang.array(h).map(function(a,
b){return 3>b?parseInt(a,k):parseFloat(a)})},unparseColor:function(a,b){return"hex"===b?(a[0].toString(16)+a[1].toString(16)+a[2].toString(16)).toUpperCase():"hash"===b?"#"+(a[0].toString(16)+a[1].toString(16)+a[2].toString(16)).toUpperCase():"rgb"===b?"rgb("+a[0]+","+a[1]+","+a[2]+")":"rgba"===b?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"csv"===b?a[0]+","+a[1]+","+a[2]+","+a[3]:a[3]&&1!==a[3]?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"rgb("+a[0]+","+a[1]+","+a[2]+")"},parseFontSize:function(d){return(d=
d.match(g("font-size")))?a.lang.string(d[d.length-1].split(":")[1]).trim():!1}}})(wysihtml);
(function(a){function e(a,c){for(var b=0;c!==a;)if(b++,c=c.parentNode,!c)throw Error("not a descendant of ancestor!");return b}function d(a,c){return 3===a.nodeType?a:a.childNodes[c]||a}function g(b){var c=document.createElement("span"),d=function(a){b.removeEventListener("mouseup",d);b.removeEventListener("keydown",d);b.removeEventListener("touchstart",d);b.removeEventListener("focus",d);b.removeEventListener("blur",d);b.removeEventListener("paste",e);b.removeEventListener("drop",e);b.removeEventListener("beforepaste",
e);c&&c.parentNode&&c.parentNode.removeChild(c)},e=function(a){c&&c.parentNode&&setTimeout(d,0)};c.appendChild(b.ownerDocument.createTextNode(a.INVISIBLE_SPACE));c.className="_wysihtml-temp-caret-fix";c.style.display="block";c.style.minWidth="1px";c.style.height="0px";b.addEventListener("mouseup",d);b.addEventListener("keydown",d);b.addEventListener("touchstart",d);b.addEventListener("focus",d);b.addEventListener("blur",d);b.addEventListener("paste",e);b.addEventListener("drop",e);b.addEventListener("beforepaste",
e);return c}var f=a.dom;a.Selection=Base.extend({constructor:function(a,c,d){rangy.init();this.editor=a;this.composer=a.composer;this.doc=this.composer.doc;this.win=this.composer.win;this.contain=c;this.unselectableClass=d||!1},getBookmark:function(){var a=this.getRange();return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);b.setStartBefore(a);b.setEndBefore(a);return this.setSelection(b)},createTemporaryCaretSpaceAfter:function(b){var c=
this.doc.createElement("span"),d=this.doc.createTextNode(a.INVISIBLE_SPACE),e=function(b){this.contain.removeEventListener("mouseup",e);this.contain.removeEventListener("keydown",g);this.contain.removeEventListener("touchstart",e);this.contain.removeEventListener("focus",e);this.contain.removeEventListener("blur",e);this.contain.removeEventListener("paste",f);this.contain.removeEventListener("drop",f);this.contain.removeEventListener("beforepaste",f);c&&c.parentNode&&(c.innerHTML=c.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,
""),/[^\s]+/.test(c.innerHTML)?(b=c.lastChild,a.dom.unwrap(c),this.setAfter(b)):c.parentNode.removeChild(c))}.bind(this),f=function(a){c&&c.parentNode&&setTimeout(e,0)},g=function(a){8===a.which||91===a.which||17===a.which||86===a.which&&(a.ctrlKey||a.metaKey)||e()};c.className="_wysihtml-temp-caret-fix";c.style.position="absolute";c.style.display="block";c.style.minWidth="1px";c.style.zIndex="99999";c.appendChild(d);b.parentNode.insertBefore(c,b.nextSibling);this.setBefore(d);this.contain.addEventListener("mouseup",
e);this.contain.addEventListener("keydown",g);this.contain.addEventListener("touchstart",e);this.contain.addEventListener("focus",e);this.contain.addEventListener("blur",e);this.contain.addEventListener("paste",f);this.contain.addEventListener("drop",f);this.contain.addEventListener("beforepaste",f);return c},setAfter:function(b,c,d){var e=this.win,f=rangy.createRange(this.doc),g=function(){var d=b.parentNode;d=d?d.childNodes[d.childNodes.length-1]:null;if(!h||d===b&&1===b.nodeType&&"block"===e.getComputedStyle(b).display)if(c){var f=
this.doc.createTextNode(a.INVISIBLE_SPACE);b.parentNode.insertBefore(f,b.nextSibling);this.selectNode(f);setTimeout(function(){f&&f.parentNode&&f.parentNode.removeChild(f)},0)}else this.createTemporaryCaretSpaceAfter(b)}.bind(this);f.setStartAfter(b);f.setEndAfter(b);if(document.activeElement&&document.activeElement===this.composer.element){var h=this.setSelection(f);g();d&&d(h)}else{var r=this.composer.getScrollPos();this.composer.element.focus();this.composer.setScrollPos(r);setTimeout(function(){h=
this.setSelection(f);g();d&&d(h)}.bind(this),0)}},selectNode:function(b,c){var d=rangy.createRange(this.doc),e=b.nodeType===a.ELEMENT_NODE,g="canHaveHTML"in b?b.canHaveHTML:"IMG"!==b.nodeName,q=e?b.innerHTML:b.data;q=""===q||q===a.INVISIBLE_SPACE;var n=f.getStyle("display").from(b);n="block"===n||"list-item"===n;if(q&&e&&g&&!c)try{b.innerHTML=a.INVISIBLE_SPACE}catch(r){}g?d.selectNodeContents(b):d.selectNode(b);g&&q&&e?d.collapse(n):g&&q&&(d.setStartAfter(b),d.setEndAfter(b));this.setSelection(d)},
getSelectedNode:function(a){if(a&&this.doc.selection&&"Control"===this.doc.selection.type&&(a=this.doc.selection.createRange())&&a.length)return a.item(0);a=this.getSelection(this.doc);return a.focusNode===a.anchorNode?a.focusNode:(a=this.getRange(this.doc))?a.commonAncestorContainer:this.doc.body},fixSelBorders:function(){var a=this.getRange();if(!a.canSurroundContents())for(var c=a.commonAncestorContainer,d=e(c,a.startContainer),f=e(c,a.endContainer);!a.canSurroundContents();)d>f?(a.setStartBefore(a.startContainer),
d=e(c,a.startContainer)):(a.setEndAfter(a.endContainer),f=e(c,a.endContainer));this.setSelection(a)},getSelectedOwnNodes:function(a){a=this.getOwnRanges();for(var b=[],d=0,e=a.length;d<e;d++)b.push(a[d].commonAncestorContainer||this.doc.body);return b},findNodesInSelection:function(b){for(var c=this.getOwnRanges(),d=[],e,f=0,g=c.length;f<g;f++)e=c[f].getNodes([1],function(c){return a.lang.array(b).contains(c.nodeName)}),d=d.concat(e);return d},filterElements:function(a){for(var b=this.getOwnRanges(),
d=[],e,f=0,g=b.length;f<g;f++)e=b[f].getNodes([1],function(c){return a(c,b[f])}),d=d.concat(e);return d},containsUneditable:function(){for(var a=this.getOwnUneditables(),c=this.getSelection(),d=0,e=a.length;d<e;d++)if(c.containsNode(a[d]))return!0;return!1},deleteContents:function(){var a=this.getRange();this.deleteRangeContents(a);this.setSelection(a)},deleteRangeContents:function(b){var c,d;if(this.unselectableClass)for((c=a.dom.getParentElement(b.startContainer,{query:"."+this.unselectableClass},
!1,this.contain))&&b.setStartBefore(c),(d=a.dom.getParentElement(b.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&b.setEndAfter(d),c=b.getNodes([1],function(b){return a.dom.hasClass(b,this.unselectableClass)}.bind(this)),d=c.length;d--;)try{var e=new CustomEvent("wysihtml:uneditable:delete");c[d].dispatchEvent(e)}catch(k){}b.deleteContents()},getCaretNode:function(){var a=this.getSelection();return a&&a.anchorNode?d(a.anchorNode,a.anchorOffset):null},getPreviousNode:function(b,
c){if(!b){var e=this.getSelection();b=e&&e.anchorNode?d(e.anchorNode,e.anchorOffset):null}if(b===this.contain)return!1;e=b.previousSibling;if(e===this.contain)return!1;e&&3!==e.nodeType&&1!==e.nodeType?e=this.getPreviousNode(e,c):e&&3===e.nodeType&&/^\s*$/.test(e.textContent)?e=this.getPreviousNode(e,c):c&&e&&1===e.nodeType?(b=a.dom.getStyle("display").from(e),a.lang.array(["BR","HR","IMG"]).contains(e.nodeName)||a.lang.array(["block","inline-block","flex","list-item","table"]).contains(b)||!/^[\s]*$/.test(e.innerHTML)||
(e=this.getPreviousNode(e,c))):e||b===this.contain||(b=b.parentNode,b!==this.contain&&(e=this.getPreviousNode(b,c)));return e!==this.contain?e:!1},getNodesNearCaret:function(){if(!this.isCollapsed())throw"Selection must be caret when using selection.getNodesNearCaret()";var a=this.getOwnRanges();if(a&&0<a.length){if(1===a[0].startContainer.nodeType){var c=a[0].startContainer.childNodes[a[0].startOffset-1];if(!c&&0===a[0].startOffset)var d=a[0].startContainer.childNodes[0];else if(c){var e=c.previousSibling;
d=c.nextSibling}}else{if(0===a[0].startOffset&&a[0].startContainer.previousSibling){if(c=a[0].startContainer.previousSibling,3===c.nodeType)var f=c.data.length}else c=a[0].startContainer,f=a[0].startOffset;e=c.previousSibling;d=c.nextSibling}return{caretNode:c,prevNode:e,nextNode:d,textOffset:f}}return null},getSelectionParentsByTag:function(b){b=this.getSelectedOwnNodes();for(var c,d=[],e=0,f=b.length;e<f;e++)(c=b[e].nodeName&&"LI"===b[e].nodeName?b[e]:a.dom.getParentElement(b[e],{query:"li"},!1,
this.contain))&&d.push(c);return d.length?d:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var a=this.getRange();if(a){var c=a.startContainer;a=a.startOffset;var d=rangy.createRange(this.doc);d.selectNodeContents(c);d.setStart(c,a);return d}}},getRangeToNodeBeginning:function(){if(this.isCollapsed()){var a=this.getRange(),c=a.startContainer;a=a.startOffset;var d=rangy.createRange(this.doc);d.selectNodeContents(c);d.setEnd(c,a);return d}},caretIsInTheEndOfNode:function(a){rangy.createRange(this.doc);
this.getSelection();var b=this.getRangeToNodeEnd();return b&&(b=b.cloneContents(),b=b.textContent,/^\s*$/.test(b))?a?(a=this.getRangeToNodeBeginning().cloneContents(),a=a.textContent,!/[\u00A0 ][\s\uFEFF]*$/.test(a)):!0:!1},caretIsFirstInSelection:function(b){var c=rangy.createRange(this.doc),e=this.getSelection(),f=this.getRange(),g=d(f.startContainer,f.startOffset);if(g){if(g.nodeType===a.TEXT_NODE){if(!g.parentNode||!this.isCollapsed()||g.parentNode.firstChild!==g&&!a.dom.domNode(g.previousSibling).is.block())return!1;
b=this.win.getComputedStyle(g.parentNode).whiteSpace;return"pre"===b||"pre-wrap"===b?0===f.startOffset:/^\s*$/.test(g.data.substr(0,f.startOffset))}if(b&&a.dom.domNode(g).is.lineBreak())return!0;c.selectNodeContents(this.getRange().commonAncestorContainer);c.collapse(!0);return this.isCollapsed()&&(c.startContainer===e.anchorNode||c.endContainer===e.anchorNode)&&c.startOffset===e.anchorOffset}},caretIsInTheBeginnig:function(b){var c=this.getSelection(),d=c.anchorNode;c=c.anchorOffset;if(b&&d)return 0===
c&&(d.nodeName&&d.nodeName===b.toUpperCase()||a.dom.getParentElement(d.parentNode,{query:b},1));if(d)return 0===c&&!this.getPreviousNode(d,!0)},getBeforeSelection:function(b){var c=this.getSelection(),d=c.isBackwards()?c.focusNode:c.anchorNode;c=c.isBackwards()?c.focusOffset:c.anchorOffset;var e=this.createRange(),f;d&&3===d.nodeType&&/^\s*$/.test(d.data.slice(0,c))&&(c=0);if(f=a.dom.getParentElement(d,{query:"._wysihtml-temp-caret-fix"},1))d=f.parentNode,c=Array.prototype.indexOf.call(d.childNodes,
f);if(d){if(0<c){if(3===d.nodeType)return e.setStart(d,0),e.setEnd(d,c),{type:"text",range:e,offset:c,node:d};e.setStartBefore(d.childNodes[0]);d=d.childNodes[c-1];e.setEndAfter(d);return{type:"element",range:e,offset:c,node:d}}e.setStartAndEnd(d,0);return b&&(b=this.getPreviousNode(d,!0),f=null,b&&(f=1===b.nodeType&&a.dom.hasClass(b,this.unselectableClass)?b:a.dom.domNode(b).lastLeafNode()),f)?{type:"leafnode",range:e,offset:c,node:f}:{type:"none",range:e,offset:c,node:d}}return null},executeAndRestoreRangy:function(a,
c){if(c=rangy.saveSelection(this.win))try{a()}catch(h){setTimeout(function(){throw h;},0)}else a();rangy.restoreSelection(c)},executeAndRestore:function(b,c){var d=this.doc.body,e=c&&d.scrollTop,g=c&&d.scrollLeft,q='<span class="_wysihtml-temp-placeholder">'+a.INVISIBLE_SPACE+"</span>",n=this.getRange(!0);if(n){if(!n.collapsed){var r=n.cloneRange();var w=r.createContextualFragment(q);r.collapse(!1);r.insertNode(w);r.detach()}q=n.createContextualFragment(q);n.insertNode(q);w&&(w=this.contain.querySelectorAll("._wysihtml-temp-placeholder"),
n.setStartBefore(w[0]),n.setEndAfter(w[w.length-1]));this.setSelection(n);try{b(n.startContainer,n.endContainer)}catch(y){setTimeout(function(){throw y;},0)}if((w=this.contain.querySelectorAll("._wysihtml-temp-placeholder"))&&w.length){b=rangy.createRange(this.doc);n=w[0].nextSibling;if(1<w.length)var C=w[w.length-1].previousSibling;C&&n?(b.setStartBefore(n),b.setEndAfter(C)):(C=this.doc.createTextNode(a.INVISIBLE_SPACE),f.insert(C).after(w[0]),b.setStartBefore(C),b.setEndAfter(C));this.setSelection(b);
for(C=w.length;C--;)w[C].parentNode.removeChild(w[C])}else this.contain.focus();c&&(d.scrollTop=e,d.scrollLeft=g);try{w.parentNode.removeChild(w)}catch(y){}}else b(d,d)},set:function(a,c){var b=rangy.createRange(this.doc);b.setStart(a,c||0);this.setSelection(b)},insertHTML:function(a){var b=this.getRange(),d=this.doc.createElement("DIV"),e=this.doc.createDocumentFragment();if(b){b.deleteContents();d.innerHTML=a;for(a=d.lastChild;d.firstChild;)e.appendChild(d.firstChild);b.insertNode(e);for(b=this.contain.lastChild;b&&
3===b.nodeType&&b.previousSibling&&/^\s*$/.test(b.data);)b=b.previousSibling;a&&(b&&a===b&&1===a.nodeType&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(a))}},insertNode:function(a){var b=this.getRange();b&&(b.deleteContents(),b.insertNode(a))},canAppendChild:function(a){var b,d=this.getRange();(a=a||d.startContainer)&&(b=(a.tagName||a.nodeName).toLowerCase());return-1==="area base br col command embed hr img input keygen link meta param source track wbr".split(" ").indexOf(b)},
splitElementAtCaret:function(b,c){var d=this.getSelection();if(0<d.rangeCount){d=d.getRangeAt(0).cloneRange();d.setEndAfter(b);var e=d.extractContents();var f=e.childNodes;for(var g=f.length;g--;)a.dom.domNode(f[g]).is.visible()||e.removeChild(f[g]);b.parentNode.insertBefore(e,b.nextSibling);c?(e=c.firstChild||c,f=c.lastChild||c,b.parentNode.insertBefore(c,b.nextSibling),e&&f&&(d.setStartBefore(e),d.setEndAfter(f),this.setSelection(d))):(d.setStartAfter(b),d.setEndAfter(b));a.dom.domNode(b).is.visible()||
(""===a.dom.getTextContent(b)?b.parentNode.removeChild(b):b.parentNode.replaceChild(this.doc.createTextNode(" "),b))}},surround:function(a){var b=this.getOwnRanges(),d=[];if(0==b.length)return d;for(var e=b.length;e--;){var f=this.doc.createElement(a.nodeName);d.push(f);a.className&&(f.className=a.className);a.cssStyle&&f.setAttribute("style",a.cssStyle);try{b[e].surroundContents(f),this.selectNode(f)}catch(q){f.appendChild(b[e].extractContents()),b[e].insertNode(f)}}return d},scrollIntoView:function(){var b=
this.doc,c=b.documentElement.scrollHeight>b.documentElement.offsetHeight,d;(d=b._wysihtmlScrollIntoViewElement)||(d=b.createElement("span"),d.innerHTML=a.INVISIBLE_SPACE);d=b._wysihtmlScrollIntoViewElement=d;if(c){this.insertNode(d);c=d;var e=0;if(c.parentNode){do e+=c.offsetTop||0,c=c.offsetParent;while(c)}c=e;d.parentNode.removeChild(d);c>=b.body.scrollTop+b.documentElement.offsetHeight-5&&(b.body.scrollTop=c)}},selectLine:function(){var b=rangy.createRange();a.browser.supportsSelectionModify()?
this._selectLine_W3C():b.nativeRange&&b.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var a=this.getSelection(),c=a.getRangeAt(0),d=function(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")},e=1===a.anchorNode.nodeType?a.anchorNode.childNodes[a.anchorOffset]:a.anchorNode,f=1===a.focusNode.nodeType?a.focusNode.childNodes[a.focusOffset]:a.focusNode,g;if(g=f){g=a.focusOffset;var n=1===f.nodeType?f.childNodes&&f.childNodes.length||
0:f.data&&f.data.length||0;g=g===n}g&&f.nextSibling&&d(f.nextSibling)&&c.setEndAfter(f.nextSibling);e&&0===a.anchorOffset&&e.previousSibling&&d(e.previousSibling)&&c.setStartBefore(e.previousSibling);c.select()},_selectLine_W3C:function(){var a=this.win.getSelection(),c=[a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset];a.modify("move","left","lineboundary");a.modify("extend","right","lineboundary");a.anchorNode===c[0]&&a.anchorOffset===c[1]&&a.focusNode===c[2]&&a.focusOffset===c[3]?this._selectLineUniversal():
this.includeRangyRangeHelpers()},toLineBoundary:function(b,c){c="undefined"===typeof c?!1:c;if(a.browser.supportsSelectionModify()){var d=this.win.getSelection();d.modify("extend",b,"lineboundary");c&&("left"===b?d.collapseToStart():"right"===b&&d.collapseToEnd())}},getRangeRect:function(a){this.doc.createTextNode("i");var b=this.doc.createTextNode("i");a.collapsed?(a.insertNode(b),a.selectNode(b),b=a.nativeRange.getBoundingClientRect(),a.deleteContents()):b=a.nativeRange.getBoundingClientRect();
return b},_selectLineUniversal:function(){var b=this.getSelection().getRangeAt(0),c=0,d=this;var e=function(b){return b&&1===b.nodeType&&("block"===d.win.getComputedStyle(b).display||a.lang.array(["BR","HR"]).contains(b.nodeName))};var f=function(a){if(a)for(;a&&(1===a.nodeType&&a.classList.contains("rangySelectionBoundary")||3===a.nodeType&&/^\s*$/.test(a.data));)a=a.previousSibling;return a};b.cloneRange();b.cloneRange();b.collapsed&&(3===b.startContainer.nodeType&&b.startOffset<b.startContainer.data.length?
b.moveEnd("character",1):1===b.startContainer.nodeType&&b.startContainer.childNodes[b.startOffset]&&3===b.startContainer.childNodes[b.startOffset].nodeType&&0<b.startContainer.childNodes[b.startOffset].data.length?b.moveEnd("character",1):0<b.startOffset&&(3===b.startContainer.nodeType||1===b.startContainer.nodeType&&!e(f(b.startContainer.childNodes[b.startOffset-1])))&&b.moveStart("character",-1));b.collapsed||b.insertNode(this.doc.createTextNode(a.INVISIBLE_SPACE));e=b.nativeRange.getBoundingClientRect();
do{f=b.moveStart("character",-1);var g=b.nativeRange.getBoundingClientRect();if(!g||Math.floor(g.top)!==Math.floor(e.top)){b.moveStart("character",1);var n=!0}c++}while(0!==f&&!n&&2E3>c);c=0;n=!1;e=b.nativeRange.getBoundingClientRect();if(b.endContainer!==this.contain||this.contain.lastChild&&this.contain.childNodes[b.endOffset]!==this.contain.lastChild){do f=b.moveEnd("character",1),g=b.nativeRange.getBoundingClientRect(),g&&Math.floor(g.bottom)===Math.floor(e.bottom)||(b.moveEnd("character",-1),
b.endContainer&&1===b.endContainer.nodeType&&b.endContainer.childNodes[b.endOffset]&&1===b.endContainer.childNodes[b.endOffset].nodeType&&"BR"===b.endContainer.childNodes[b.endOffset].nodeName&&b.endContainer.childNodes[b.endOffset].previousSibling&&(1===b.endContainer.childNodes[b.endOffset].previousSibling.nodeType?b.setEnd(b.endContainer.childNodes[b.endOffset].previousSibling,b.endContainer.childNodes[b.endOffset].previousSibling.childNodes.length):3===b.endContainer.childNodes[b.endOffset].previousSibling.nodeType&&
b.setEnd(b.endContainer.childNodes[b.endOffset].previousSibling,b.endContainer.childNodes[b.endOffset].previousSibling.data.length)),n=!0),c++;while(0!==f&&!n&&2E3>c)}b.select();this.includeRangyRangeHelpers()},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(a,c){var b=this.getRange();return b?b.getNodes(Array.isArray(a)?a:[a],c):[]},getOwnNodes:function(a,c,d){for(var b=this.getOwnRanges(),e=[],f=0,g=b.length;f<g;f++)b[f]&&(d&&b[f].splitBoundaries(),e=e.concat(b[f].getNodes(Array.isArray(a)?
a:[a],c)));return e},fixRangeOverflow:function(a){if(this.contain&&this.contain.firstChild&&a){var b=a.compareNode(this.contain);2!==b?(1===b&&a.setStartBefore(this.contain.firstChild),0===b&&a.setEndAfter(this.contain.lastChild),3===b&&(a.setStartBefore(this.contain.firstChild),a.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(a)&&(b=a.endContainer.previousElementSibling)&&a.setEnd(b,this._endOffsetForNode(b))}},_endOffsetForNode:function(a){var b=document.createRange();b.selectNodeContents(a);
return b.endOffset},_detectInlineRangeProblems:function(a){var b=f.compareDocumentPosition(a.startContainer,a.endContainer);return 0==a.endOffset&&b&4},getRange:function(a){var b=this.getSelection();b=b&&b.rangeCount&&b.getRangeAt(0);!0!==a&&this.fixRangeOverflow(b);return b},getOwnUneditables:function(){var b=f.query(this.contain,"."+this.unselectableClass),c=f.query(b,"."+this.unselectableClass);return a.lang.array(b).without(c)},getOwnRanges:function(){var a=[],c=this.getRange();c&&a.push(c);if(this.unselectableClass&&
this.contain&&c){var d=this.getOwnUneditables();if(0<d.length)for(var e=0,f=d.length;e<f;e++){c=[];for(var g=0,n=a.length;g<n;g++){if(a[g])switch(a[g].compareNode(d[e])){case 2:break;case 3:var r=a[g].cloneRange();r.setEndBefore(d[e]);c.push(r);r=a[g].cloneRange();r.setStartAfter(d[e]);c.push(r);break;default:c.push(a[g])}a=c}}}return a},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(a){var b=rangy.getSelection(this.win);b.setSingleRange(a);return b&&b.anchorNode&&
b.focusNode?b:null},selectAll:function(){var b=this.createRange(),c=this.composer,d=this,e=g(this.composer.element),f=g(this.composer.element),q,n=function(){b.setStart(c.element,0);b.setEnd(c.element,c.element.childNodes.length);q=d.setSelection(b)},r=function(){return!q||q.nativeSelection&&q.nativeSelection.type&&("Caret"===q.nativeSelection.type||"None"===q.nativeSelection.type)};a.dom.removeInvisibleSpaces(this.composer.element);n();this.composer.element.firstChild&&r()&&(this.composer.element.appendChild(e),
n(),r()&&(e.parentNode.removeChild(e),this.composer.element.insertBefore(f,this.composer.element.firstChild),n(),r()&&(this.composer.element.appendChild(e),n())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(b){var c=this.getRange(),d=c.commonAncestorContainer,e=c.startContainer,
f=c.endContainer;d.nodeType===a.TEXT_NODE&&(d=d.parentNode);if(e.nodeType===a.TEXT_NODE&&!/^\s*$/.test(e.data.substr(c.startOffset))||f.nodeType===a.TEXT_NODE&&!/^\s*$/.test(f.data.substr(c.endOffset)))return!1;for(;e&&e!==d;){if(e.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,e)||a.dom.domNode(e).prev({ignoreBlankTexts:!0}))return!1;e=e.parentNode}for(;f&&f!==d;){if(f.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,f)||a.dom.domNode(f).next({ignoreBlankTexts:!0}))return!1;f=f.parentNode}return a.lang.array(b).contains(d.nodeName)?
d:!1},isInThisEditable:function(){var b=this.getSelection(),c=b.focusNode;b=b.anchorNode;c&&1!==c.nodeType&&(c=c.parentNode);b&&1!==b.nodeType&&(b=b.parentNode);return b&&c&&(a.dom.contains(this.composer.element,c)||this.composer.element===c)&&(a.dom.contains(this.composer.element,b)||this.composer.element===b)},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})})(wysihtml);
wysihtml.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return wysihtml.browser.supportsCommand(this.doc,a)},exec:function(a,e){var d=wysihtml.commands[a],g=wysihtml.lang.array(arguments).get(),f=d&&d.exec,b=null;this.composer.hasPlaceholderSet()&&!wysihtml.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(a)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element));
this.editor.fire("beforecommand:composer",{command:a,value:e});if(f)g.unshift(this.composer),b=f.apply(d,g);else try{b=this.doc.execCommand(a,!1,e)}catch(c){}this.editor.fire("aftercommand:composer",{command:a,value:e});return b},remove:function(a,e){var d=wysihtml.commands[a],g=wysihtml.lang.array(arguments).get(),f=d&&d.remove;if(f)return g.unshift(this.composer),f.apply(d,g)},state:function(a,e){var d=wysihtml.commands[a],g=wysihtml.lang.array(arguments).get(),f=d&&d.state;if(f)return g.unshift(this.composer),
f.apply(d,g);try{return this.doc.queryCommandState(a)}catch(b){return!1}},stateValue:function(a){var e=wysihtml.commands[a],d=wysihtml.lang.array(arguments).get(),g=e&&e.stateValue;return g?(d.unshift(this.composer),g.apply(e,d)):!1}});
(function(a){var e={nodeName:"A",toggle:!1};a.commands.createLink={exec:function(d,g,f){f=a.lang.object({}).merge(e).merge({attribute:f}).get();if(d.selection.isCollapsed()&&!this.state(d,g)){var b=d.doc.createTextNode(f.attribute.href);d.selection.insertNode(b);d.selection.selectNode(b)}a.commands.formatInline.exec(d,g,f)},state:function(d,g){return a.commands.formatInline.state(d,g,e)}}})(wysihtml);
(function(a){function e(a,b){return 3===a.nodeType?a:a.childNodes[b]||a}function d(a){return a&&1===a.nodeType&&"BR"===a.nodeName}function g(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")}function f(a,b){return d(a)||a&&1===a.nodeType&&"block"===b.win.getComputedStyle(a).display}function b(b,c){a.dom.removeInvisibleSpaces(b.element);var d=b.element,e=d.querySelectorAll("h1, h2, h3, h4, h5, h6, p, pre, div, blockquote");b=b.config.classNames.uneditableContainer+[""].concat("h1; h2; h3; h4; h5; h6; p; pre; div; blockquote".split(";")).join(", "+
b.config.classNames.uneditableContainer+" ");d=d.querySelectorAll(b);e=a.lang.array(e).without(d);for(b=e.length;b--;)""!==e[b].innerHTML.replace(/[\uFEFF]/g,"")||0!==c.length&&e[b]===c[c.length-1]||(d=a.lang.array(c).indexOf(e[b]),-1<d&&c.splice(d,1),e[b].parentNode.removeChild(e[b]));return c}function c(a,b,c){for(var d=null;a&&b&&a!==b;)1===a.nodeType&&a.matches(c?"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote":"h1, h2, h3, h4, h5, h6, p, pre")&&(d=a),a=a.parentNode;return d}function h(b,c,d){b||
(b=d.doc.createElement(c.nodeName||(d.config.useLineBreaks?"DIV":"P")),b.appendChild(d.doc.createTextNode(a.INVISIBLE_SPACE)));c.nodeName&&b.nodeName!==c.nodeName&&(b=D.renameElement(b,c.nodeName));c.classRegExp&&(b.className=b.className.replace(c.classRegExp,""));c.className&&b.classList.add(c.className);c.styleProperty&&"undefined"!==typeof c.styleValue&&(b.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue);return b}function l(b){b=b.querySelectorAll("h1, h2, h3, h4, h5, h6, p, pre, div, blockquote")||
[];for(var c,d=b.length;d--;)c=a.dom.domNode(b[d]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),a.dom.domNode(b[d]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(b[d].innerHTML||b[d].nodeValue||"").trim()&&b[d].parentNode.insertBefore(b[d].ownerDocument.createElement("BR"),c),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(b[d].innerHTML||b[d].nodeValue||"").trim()&&b[d].parentNode.insertBefore(b[d].ownerDocument.createElement("BR"),c),a.dom.unwrap(b[d])}function k(b){for(var c=
[],d,e,f,g,h,l,k=0,q=b.length;k<q;k++){1===b[k].startContainer.nodeType&&b[k].startContainer.matches("ul, ol")&&b[k].setStart(b[k].startContainer.childNodes[b[k].startOffset],0);1===b[k].endContainer.nodeType&&b[k].endContainer.matches("ul, ol")&&(l=b[k].endContainer.childNodes[Math.max(b[k].endOffset-1,0)],l.childNodes&&b[k].setEnd(l,l.childNodes.length));d=b[k].getNodes([1],function(a){return"LI"===a.nodeName});if(0<d.length)for(e=0,f=d.length;e<f;e++){h=b[k].compareNode(d[e]);if(h===b[k].NODE_AFTER||
h===b[k].NODE_INSIDE)g=b[k].cloneRange(),(l=a.dom.domNode(d[e]).prev({nodeTypes:[1]}))?g.setEnd(l,l.childNodes.length):d[e].closest("ul, ol")?g.setEndBefore(d[e].closest("ul, ol")):g.setEndBefore(d[e]),c.push(g),b[k].setStart(d[e],0);if(h===b[k].NODE_BEFORE||h===b[k].NODE_INSIDE)g=b[k].cloneRange(),g.setEnd(d[e],d[e].childNodes.length),c.push(g),(l=a.dom.domNode(d[e]).next({nodeTypes:[1]}))?b[k].setStart(l,0):d[e].closest("ul, ol")?b[k].setStartAfter(d[e].closest("ul, ol")):b[k].setStartAfter(d[e])}c.push(b[k])}return c}
function q(b,d,e,g){var m=d.startContainer;if(g=g||c(m,e.element,!0)){d=b.firstChild;var h=b.lastChild;e.selection.splitElementAtCaret(g,b);var p=a.dom.domNode(h).next({nodeTypes:[1,3],ignoreBlankTexts:!0});b=a.dom.domNode(d).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});d&&!f(d,e)&&b&&!f(b,e)&&d.parentNode.insertBefore(e.doc.createElement("br"),d);h&&!f(h,e)&&p&&!f(p,e)&&p.parentNode.insertBefore(e.doc.createElement("br"),p)}else{g=e.element;var t=m;m=null;for(var k;t&&g&&t!==g;)1===t.nodeType&&t.matches("b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u")&&
(p=t,null===m?h=m=t.cloneNode(!1):(k=t.cloneNode(!1),k.appendChild(m),m=k)),t=t.parentNode;if((g=m)&&h&&p){if(1===b.childNodes.length){for(;b.firstChild.firstChild;)h.appendChild(b.firstChild.firstChild);b.firstChild.appendChild(g)}e.selection.splitElementAtCaret(p,b)}else e=b.firstChild,h=b.lastChild,d.insertNode(b),d.setStartBefore(e),d.setEndAfter(h)}}function n(b,c,d){b=b.cloneRange();var g=e(b.startContainer,b.startOffset).previousSibling,h=e(b.endContainer,b.endOffset).nextSibling,p=b.extractContents();
c=d.doc.createDocumentFragment();for(var t;p.firstChild;)if(1===p.firstChild.nodeType&&p.firstChild.matches("h1, h2, h3, h4, h5, h6, p, pre, div, blockquote")){l(p.firstChild);t=a.dom.unwrap(p.firstChild);0<t.length&&(c.lastChild&&(1!==c.lastChild.nodeType||!f(c.lastChild,d))||!c.lastChild&&g&&(1!==g.nodeType||f(g,d)))&&c.appendChild(d.doc.createElement("BR"));for(var k=0,n=t.length;k<n;k++)c.appendChild(t[k]);0<t.length&&(1===c.lastChild.nodeType&&f(c.lastChild,d)||(h||c.lastChild!==p.lastChild)&&
c.appendChild(d.doc.createElement("BR")))}else c.appendChild(p.firstChild);g=a.lang.array(c.childNodes).get();q(c,b,d);return g}function r(b,f,g,m){var t=f?{nodeName:f.nodeName||null,className:f.classRegExp?null:f.className||null,classRegExp:f.classRegExp||null,styleProperty:f.styleProperty||null}:null;b=b.cloneRange();var p=b.startContainer,k=e(b.startContainer,b.startOffset),n=e(b.endContainer,b.endOffset),r;if(r=b.startContainer===k&&3===k.nodeType)r=k.data?k.data.slice(0,b.startOffset):"",r=!/^\s*$/.test(r);
k=r?k:a.dom.domNode(k).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});n=1===b.endContainer.nodeType&&b.endContainer.childNodes[b.endOffset]===n&&(1===n.nodeType||!H(n,b.endOffset)&&!a.dom.domNode(n).is.rangyBookmark())||b.endContainer===n&&3===n.nodeType&&!H(n,b.endOffset)?n:a.dom.domNode(n).next({nodeTypes:[1,3],ignoreBlankTexts:!0});var u=b.extractContents();r=m.doc.createDocumentFragment();t=t?a.dom.getParentElement(p,t,null,m.element):null;var A=!g||!f||"BLOCKQUOTE"===f.nodeName&&"BLOCKQUOTE"===
g;p=t||c(p,m.element,A);a.dom.domNode(n).is.rangyBookmark()&&(n=n.nextSibling);if(u){for(;u.firstChild&&3===u.firstChild.nodeType&&/^\s*$/.test(u.firstChild.data)&&u.lastChild!==u.firstChild;)u.removeChild(u.firstChild);for(;u.lastChild&&3===u.lastChild.nodeType&&/^\s*$/.test(u.lastChild.data)&&u.lastChild!==u.firstChild;)u.removeChild(u.lastChild);u.firstChild&&1===u.firstChild.nodeType&&"BR"===u.firstChild.nodeName&&u.lastChild!==u.firstChild&&u.removeChild(u.firstChild);u.lastChild&&1===u.lastChild.nodeType&&
"BR"===u.lastChild.nodeName&&u.lastChild!==u.firstChild&&u.removeChild(u.lastChild)}if(f&&"BLOCKQUOTE"===f.nodeName)f=h(null,f,m),f.appendChild(u),r.appendChild(f),f=[f];else{if(u.firstChild)for(;u.firstChild;)if(1==u.firstChild.nodeType&&u.firstChild.matches("h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"))h(u.firstChild,f,m),u.firstChild.matches("h1, h2, h3, h4, h5, h6, p, pre")&&l(u.firstChild),r.appendChild(u.firstChild);else{t=g;A=m;var w=f?a.lang.object(f).clone(!0):null;w&&(w.nodeName=w.nodeName||
t||(A.config.useLineBreaks?"DIV":"P"));for(t=h(null,w,m);u.firstChild&&(1!==u.firstChild.nodeType||!u.firstChild.matches("h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"));)1==u.firstChild.nodeType&&t.matches("h1, h2, h3, h4, h5, h6, p, pre")&&l(u.firstChild),t.appendChild(u.firstChild);r.appendChild(t)}else r.appendChild(h(null,f,m));f=a.lang.array(r.childNodes).get()}q(r,b,m,p);b=n;g=k&&a.dom.domNode(k).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});d(b)&&b.parentNode.removeChild(b);!d(k)||g&&1===
g.nodeType&&"block"===m.win.getComputedStyle(g).display||k.parentNode.removeChild(k);0<f.length&&("undefined"===typeof f[f.length-1].lastChild||a.dom.domNode(f[f.length-1].lastChild).is.rangyBookmark())&&f[f.length-1].appendChild(m.doc.createElement("br"));return f}function w(b,c){c=a.dom.getParentElement(b.selection.getOwnRanges()[0].startContainer,{query:"h1, h2, h3, h4, h5, h6, p, pre, "+(c?c.toLowerCase():"div")},null,b.element);if(c){var d=b.selection.createRange();d.selectNode(c);b.selection.setSelection(d)}else b.isEmpty()||
b.selection.selectLine()}function C(a,b){b=b.selection.createRange();var c=a[a.length-1],d=1===c.nodeType&&c.childNodes?c.childNodes.length|0:c.length||0;b.setStart(a[0],0);b.setEnd(c,d);b.select()}function y(b,c,d){var e=c.selection.getOwnRanges(),f=[];e=k(e);for(var g=e.length;g--;){var h=e[g];var t=c;var p=h.startContainer;var l=h.endContainer;p&&1===p.nodeType&&p===l?p.firstChild===p.lastChild&&1===h.endOffset&&p!==t.element&&"LI"!==p.nodeName&&"TD"!==p.nodeName&&(h.setStartBefore(p),h.setEndAfter(l)):
p&&1===p.nodeType&&3===l.nodeType?p.firstChild===l&&h.endOffset===l.data.length&&p!==t.element&&"LI"!==p.nodeName&&"TD"!==p.nodeName&&h.setEndAfter(p):l&&1===l.nodeType&&3===p.nodeType?l.firstChild===p&&0===h.startOffset&&l!==t.element&&"LI"!==l.nodeName&&"TD"!==l.nodeName&&h.setStartBefore(l):p&&3===p.nodeType&&p===l&&1===p.parentNode.childNodes.length&&h.endOffset==l.data.length&&0===h.startOffset&&(p=p.parentNode,p!==t.element&&"LI"!==p.nodeName&&"TD"!==p.nodeName&&(h.setStartBefore(p),h.setEndAfter(p)));
h=(h=a.dom.getParentElement(e[g].startContainer,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},null,c.element))?h.nodeName:null;f="remove"===b?f.concat(n(e[g],h,c)):f.concat(r(e[g],d,h,c))}return f}function z(a){"string"===typeof a&&(a={nodeName:a.toUpperCase()});return a}var D=a.dom,H=function(a,b){a=a.data?a.data.slice(b):"";return/^\s*$/.test(a)};a.commands.formatBlock={exec:function(c,e,f){f=z(f);var m=[],h;f&&f.toggle&&(h=this.state(c,e,f));if(h){var p=rangy.saveSelection(c.win);e=
0;for(var t=h.length;e<t;e++){var k=h[e];var l=f;var n=c,q=k.previousSibling,r=k.nextSibling,A=!1;l.styleProperty&&(k.style[a.browser.fixStyleKey(l.styleProperty)]="");l.className&&k.classList.remove(l.className);l.classRegExp&&(k.className=k.className.replace(l.classRegExp,""));null!==k.getAttribute("class")&&""===k.getAttribute("class").trim()&&k.removeAttribute("class");l.nodeName&&k.nodeName.toLowerCase()===l.nodeName.toLowerCase()&&((l=k.getAttribute("style"))&&""!==l.trim()?k=D.renameElement(k,
n.config.useLineBreaks?"DIV":"P"):(D.unwrap(k),A=!0));null!==k.getAttribute("style")&&""===k.getAttribute("style").trim()&&k.removeAttribute("style");A&&((k=q)&&g(k)&&(k=k.previousSibling),r&&g(r)&&(r=r.nextSibling),k&&(1!==k.nodeType||"block"!==n.win.getComputedStyle(k).display&&!d(k))&&k.parentNode&&k.parentNode.insertBefore(n.doc.createElement("br"),k.nextSibling),r&&(1!==r.nodeType||"block"!==n.win.getComputedStyle(r).display)&&r.parentNode&&r.parentNode.insertBefore(n.doc.createElement("br"),
r))}}else{if(c.selection.isCollapsed()){p=rangy.saveSelection(c.win);a:{if(c.selection.isCollapsed()&&(m=c.selection.getNodesNearCaret())&&m.caretNode&&(a.dom.domNode(m.caretNode).is.lineBreak()||3===m.caretNode.nodeType&&0===m.textOffset&&(!m.prevNode||a.dom.domNode(m.prevNode).is.lineBreak())||1===m.caretNode.nodeType&&m.caretNode.classList.contains("rangySelectionBoundary")&&(!m.prevNode||a.dom.domNode(m.prevNode).is.lineBreak()||a.dom.domNode(m.prevNode).is.block())&&(!m.nextNode||a.dom.domNode(m.nextNode).is.lineBreak()||
a.dom.domNode(m.nextNode).is.block()))){m=!0;break a}m=!1}m?c.selection.selectLine():w(c,f&&f.nodeName?f.nodeName.toUpperCase():void 0)}m=f?y("apply",c,f):y("remove",c)}m=b(c,m);p?rangy.restoreSelection(p):C(m,c)},remove:function(a,c,d){d=z(d);if(a.selection.isCollapsed()){var e=rangy.saveSelection(a.win);w(a,d&&d.nodeName?d.nodeName.toUpperCase():void 0)}c=y("remove",a);c=b(a,c);e?rangy.restoreSelection(e):C(c,a)},state:function(b,c,d){d=z(d);c=b.selection.filterElements(function(b){return a.dom.domNode(b).test(d||
{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"})}.bind(this));for(var e=b.selection.getSelectedOwnNodes(),f,g=0,h=e.length;g<h;g++)(f=D.getParentElement(e[g],d||{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},null,b.element))&&-1===c.indexOf(f)&&c.push(f);return 0===c.length?!1:c}}})(wysihtml);
(function(a){function e(a){return!a.getAttribute("style")||/^\s*$/.test(a.getAttribute("style"))}function d(b,c){if(1!==b.nodeType||1!==c.nodeType||b.nodeName!==c.nodeName)return!1;var d=b.className.trim().replace(/\s+/g," ").split(" ");var e=c.className.trim().replace(/\s+/g," ").split(" ");if(0<a.lang.array(d).without(e).length)return!1;b=a.dom.getAttributes(b);c=a.dom.getAttributes(c);return b.length===c.length&&a.lang.object(a.lang.object(b).difference(c)).isEmpty()?!0:!1}function g(b,c){b=b.ownerDocument.createElement(c&&
c.nodeName||"SPAN");c.classRegExp&&(b.className=b.className.replace(c.classRegExp,""));c.className&&b.classList.add(c.className);c.styleProperty&&"undefined"!==typeof c.styleValue&&(b.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue);if(c.attribute)if("object"===typeof c.attribute)for(var d in c.attribute)c.attribute.hasOwnProperty(d)&&b.setAttribute(d,c.attribute[d]);else"undefined"!==typeof c.attributeValue&&b.setAttribute(c.attribute,c.attributeValue);return b}function f(b,c){c.className&&
(!1!==c.toggle&&b.classList.contains(c.className)?b.classList.remove(c.className):(c.classRegExp&&(b.className=b.className.replace(c.classRegExp,"")),b.classList.add(c.className)),/^\s*$/.test(b.className)&&b.removeAttribute("class"));c.styleProperty&&(!1!==c.toggle&&b.style[a.browser.fixStyleKey(c.styleProperty)].trim().replace(/, /g,",")===c.styleValue?b.style[a.browser.fixStyleKey(c.styleProperty)]="":b.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue);e(b)&&b.removeAttribute("style");
if(c.attribute){if("object"===typeof c.attribute)var d=c.attribute;else d={},d[c.attribute]=c.attributeValue||"";var f=c.toggle,g=a.dom.getAttributes(b);a:{for(h in d)if(d.hasOwnProperty(h)&&g[h]!==d[h]){var h=!1;break a}h=!0}a.lang.object(g).difference(d);if(h&&!1!==f)for(k in d)d.hasOwnProperty(k)&&b.removeAttribute(k);else for(k in d)d.hasOwnProperty(k)&&b.setAttribute(k,d[k])}var k=(k=c.nodeName?A[c.nodeName.toLowerCase()]||c.nodeName.toLowerCase():null)?a.dom.domNode(b).test({query:k}):!1;if(!c.nodeName||
"SPAN"===c.nodeName||k){if(c=(!1!==c.toggle&&k||!c.nodeName&&"SPAN"===b.nodeName)&&/^\s*$/.test(b.className)&&e(b))c=a.dom.getAttributes(b),c=a.lang.object(c).isEmpty();c&&a.dom.unwrap(b)}}function b(b,c){var d=[];b.isCollapsed()||(d=d.concat(b.getOwnNodes([3],function(b){return!a.dom.domNode(b).is.emptyTextNode()},c)));return d}function c(b,c,d,e){c=e?c:{nodeName:c.nodeName||null,className:c.classRegExp?null:c.className||null,classRegExp:c.classRegExp||null,styleProperty:c.styleProperty||null};do{if(e=
1===b.nodeType){e=b;var f=c;f.nodeName?(f=A[f.nodeName.toLowerCase()]||f.nodeName.toLowerCase(),e=a.dom.domNode(e).test({query:f})):(f=a.lang.object(f).clone(),f.query="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",e=a.dom.domNode(e).test(f))}if(e)return b;b=b.parentNode}while(b&&b!==d);return null}function h(b,c){var d=document.documentElement||document.body,e=d.scrollTop,f=d.scrollLeft;
rangy.getSelection(b.win);rangy.getSelection(b.win).removeAllRanges();try{rangy.getSelection(b.win).addRange(c)}catch(v){}b.doc.activeElement&&a.dom.contains(b.element,b.doc.activeElement)||(b.element.focus(),d.scrollTop=e,d.scrollLeft=f,rangy.getSelection(b.win).addRange(c))}function l(a,b){var c=rangy.createRange(b.doc),d=a[a.length-1];a[0]&&d&&(c.setStart(a[0],0),c.setEnd(d,d.length),h(b,c))}function k(a,b,c,d){var e=rangy.createRange(a.doc);b&&(e.setStart(b,c),e.setEnd(b,"undefined"!==typeof d?
d:c),h(a,e))}function q(a,d,e){var f=b(a.selection),g=[],h=!1;if(a.selection.isInThisEditable()){if(0===f.length&&a.selection.isCollapsed()){var m=a.selection.getSelection().anchorNode;if(!m)return{nodes:[],partial:!1};3===m.nodeType&&(f=[m])}f.length||(m=a.selection.getOwnRanges()[0])&&(f=[m.endContainer]);for(var k=0,l=f.length;k<l;k++)(m=c(f[k],d,a.element,e))?g.push(m):h=!0}return{nodes:g,partial:h}}function n(a){if(a){var b=a.anchorNode;var c=a.anchorOffset;if(b&&3===b.nodeType&&0<c&&c<b.data.length)return a=
b.data[c-1],b=b.data[c],/\w/.test(a)&&/\w/.test(b)}return!1}function r(b){var c,d;var e=[];if(b){e=b.anchorNode;b=c=d=b.anchorOffset;var f=e.ownerDocument;f=rangy.createRange(f);if(e&&3===e.nodeType){for(;0<c&&/\w/.test(e.data[c-1]);)c--;for(;d<e.data.length&&/\w/.test(e.data[d]);)d++;f.setStartAndEnd(e,c,d);f.splitBoundaries();e=f.getNodes([3],function(b){return!a.dom.domNode(b).is.emptyTextNode()});return{wordOffset:b-c,range:f,textNode:e[0]}}}return!1}function w(a){for(var b=a.length;b--;)if(a[b]&&
a[b].parentNode){if(a[b].nextSibling&&d(a[b],a[b].nextSibling)){for(var c=a[b],e=a[b].nextSibling;e.firstChild;)c.appendChild(e.firstChild);e.parentNode.removeChild(e)}if(a[b].previousSibling&&d(a[b],a[b].previousSibling)){c=a[b].previousSibling;for(e=a[b];e.firstChild;)c.appendChild(e.firstChild);e.parentNode.removeChild(e)}}}function C(a,b,c){0<b.length&&l(b,a);w(q(a,c).nodes);0<b.length&&l(b,a)}function y(a,b,c,d){k(a,b,c);w(q(a,d).nodes);k(a,b,c)}function z(a,b){b=g(a,b);a.parentNode.insertBefore(b,
a);b.appendChild(a)}function D(b,d,e){d=c(b,e,d.element);if(d){var g=d.cloneNode(!1);a.dom.domNode(b).escapeParent(d,g);f(g,e)}}function H(a){a="string"===typeof a?{nodeName:a}:a;a.nodeName&&(a.nodeName=a.nodeName.toUpperCase());return a}var A={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};a.commands.formatInline={exec:function(d,e,h){h=H(h);d.element.normalize();e=b(d.selection,!0);var m=q(d,h);if(0<m.nodes.length){var k=q(d,h,!0),l=d.selection.getSelection();if(e.length){if(k.partial||
!1===h.toggle)for(k=e.length;k--;)c(e[k],h,d.element)&&D(e[k],d,h),c(e[k],h,d.element)||z(e[k],h);else for(k=e.length;k--;)D(e[k],d,h);C(d,e,h)}else if(!1!==h.toggle)if(n(l))e=r(l),D(e.textNode,d,h),y(d,e.textNode,e.wordOffset,h);else{if(e=d.doc.createTextNode(a.INVISIBLE_SPACE),k=m.nodes[0].cloneNode(!1),k.appendChild(e),d.selection.splitElementAtCaret(m.nodes[0],k),f(k,h),C(d,[e],h),e=d.selection.getSelection(),e.anchorNode&&e.focusNode)try{e.collapseToEnd()}catch(J){}}else for(k=m.nodes.length;k--;)f(m.nodes[k],
h)}else if(m=h,h=d.selection.getSelection(),e.length){for(h=e.length;h--;)z(e[h],m);C(d,e,m)}else if(n(h))e=r(h),z(e.textNode,m),y(d,e.textNode,e.wordOffset,m);else if(e=d.selection.getOwnRanges()[0])m=g(e.endContainer,m),e.surroundContents(m),d.selection.selectNode(m);d.element.normalize()},remove:function(d,e,f){f=H(f);d.element.normalize();e=b(d.selection,!0);var g=q(d,f);if(0<g.nodes.length){var h;var m=d.selection.getSelection();if(e.length){for(m=e.length;m--;)g=e[m],(h=c(g,f,d.element))&&a.dom.domNode(g).escapeParent(h);
C(d,e,f)}else{e=m.anchorNode;h=m.anchorOffset;for(m=g.nodes.length;m--;)a.dom.unwrap(g.nodes[m]);y(d,e,h,f)}}d.element.normalize()},state:function(a,b,c){c=H(c);a=q(a,c,!0).nodes;return 0===a.length?!1:a}}})(wysihtml);
(function(a){a.commands.indentList={exec:function(a,d,g){return(d=a.selection.getSelectionParentsByTag("LI"))?this.tryToPushLiLevel(d,a.selection):!1},state:function(a,d){return!1},tryToPushLiLevel:function(e,d){var g,f,b,c,h,l=!1;d.executeAndRestoreRangy(function(){for(var d=e.length;d--;)c=e[d],g="OL"===c.parentNode.nodeName?"OL":"UL",f=c.ownerDocument.createElement(g),h=(b=a.dom.domNode(c).prev({nodeTypes:[a.ELEMENT_NODE]}))?b.querySelector("ul, ol"):null,b&&(h?h.appendChild(c):(f.appendChild(c),
b.appendChild(f)),l=!0)});return l}}})(wysihtml);(function(a){a.commands.insertHTML={exec:function(a,d,g){a.selection.insertHTML(g)},state:function(){return!1}}})(wysihtml);(function(a){var e="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(a,g){a.selection.insertHTML(e)},state:function(){return!1}}})(wysihtml);
wysihtml.commands.insertList=function(a){var e=function(a,b){if(a&&a.nodeName){"string"===typeof b&&(b=[b]);for(var c=b.length;c--;)if(a.nodeName===b[c])return!0}return!1},d=function(b,d,f){var c={el:null,other:!1};if(b){var g=a.dom.getParentElement(b,{query:"li"},!1,f.element),h="UL"===d?"OL":"UL";e(b,d)?c.el=b:e(b,h)?c={el:b,other:!0}:g&&(e(g.parentNode,d)?c.el=g.parentNode:e(g.parentNode,h)&&(c={el:g.parentNode,other:!0}))}c.el&&!f.element.contains(c.el)&&(c.el=null);return c},g=function(c,d,e){var f=
"UL"===d?"OL":"UL",g,h;e.selection.executeAndRestoreRangy(function(){g=b(f,e);if(g.length)for(var k=g.length;k--;)a.dom.renameElement(g[k],d.toLowerCase());else{h=b(["OL","UL"],e);for(k=h.length;k--;)a.dom.resolveList(h[k],e.config.useLineBreaks);0===h.length&&a.dom.resolveList(c,e.config.useLineBreaks)}})},f=function(c,d,e){var f="UL"===d?"OL":"UL";e.selection.executeAndRestoreRangy(function(){for(var g=[c].concat(b(f,e)),h=g.length;h--;)a.dom.renameElement(g[h],d.toLowerCase())})},b=function(a,
b){b=b.selection.getOwnRanges();for(var c=[],d=b.length;d--;)c=c.concat(b[d].getNodes([1],function(b){return e(b,a)}));return c};return{exec:function(b,e,l){e=b.doc;var c="OL"===l?"insertOrderedList":"insertUnorderedList",h=b.selection.getSelection(),n=1===h.anchorNode.nodeType&&h.anchorNode.firstChild?h.anchorNode.childNodes[h.anchorOffset]:h.anchorNode,r=1===h.focusNode.nodeType&&h.focusNode.firstChild?h.focusNode.childNodes[h.focusOffset]||h.focusNode.lastChild:h.focusNode;h.isBackwards()&&(n=
[r,r=n][0]);a.dom.domNode(r).is.emptyTextNode(!0)&&r&&(r=a.dom.domNode(r).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}));a.dom.domNode(n).is.emptyTextNode(!0)&&n&&(n=a.dom.domNode(n).next({nodeTypes:[1,3],ignoreBlankTexts:!0}));h=n&&r?n===r?n:a.dom.domNode(n).commonAncestor(r,b.element):b.selection.getSelectedNode();h=d(h,l,b);h.el?h.other?f(h.el,l,b):g(h.el,l,b):b.commands.support(c)?e.execCommand(c,!1,null):(e=rangy.saveSelection(b.win),c="_wysihtml-temp-"+(new Date).getTime(),b.commands.exec("formatBlock",
{nodeName:"div",className:c}),h=b.element.querySelector("."+c),h.innerHTML=h.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,""),h&&(c=/^(\s|(<br>))+$/i.test(h.innerHTML),l=a.dom.convertToList(h,l.toLowerCase(),b.parent.config.classNames.uneditableContainer),e&&rangy.restoreSelection(e),c&&b.selection.selectNode(l.querySelector("li"),!0)))},state:function(a,b,e){b=a.selection.getSelectedNode();a=d(b,e,a);return a.el&&!a.other?a.el:!1}}}(wysihtml);
(function(a){a.commands.outdentList={exec:function(a,d,g){return(d=a.selection.getSelectionParentsByTag("LI"))?this.tryToPullLiLevel(d,a):!1},state:function(a,d){return!1},tryToPullLiLevel:function(e,d){var g,f,b,c,h,l=!1,k=this;d.selection.executeAndRestoreRangy(function(){for(var q=e.length;q--;)if(c=e[q],c.parentNode&&(g=c.parentNode,"OL"===g.tagName||"UL"===g.tagName)){l=!0;f=a.dom.getParentElement(g.parentNode,{query:"ol, ul"},!1,d.element);b=a.dom.getParentElement(g.parentNode,{query:"li"},
!1,d.element);if(f&&b)c.nextSibling&&(h=k.getAfterList(g,c),c.appendChild(h)),f.insertBefore(c,b.nextSibling);else{c.nextSibling&&(h=k.getAfterList(g,c),c.appendChild(h));for(var n=c.childNodes.length;n--;)g.parentNode.insertBefore(c.childNodes[n],g.nextSibling);g.parentNode.insertBefore(document.createElement("br"),g.nextSibling);c.parentNode.removeChild(c)}0===g.childNodes.length&&g.parentNode.removeChild(g)}});return l},getAfterList:function(a,d){for(a=document.createElement(a.nodeName);d.nextSibling;)a.appendChild(d.nextSibling);
return a}}})(wysihtml);(function(a){a.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}}})(wysihtml);(function(a){var e={nodeName:"A"};a.commands.removeLink={exec:function(d,g){a.commands.formatInline.remove(d,g,e)},state:function(d,g){return a.commands.formatInline.state(d,g,e)}}})(wysihtml);(function(a){a.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}}})(wysihtml);
(function(a){var e=a.dom;a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.element=this.composer.element;this.position=0;this.historyStr=[];this.historyDom=[];this.transact();this._observe()},_observe:function(){var a=this;this.composer.sandbox.getDocument();var g;e.observe(this.element,"keydown",function(d){if(!d.altKey&&(d.ctrlKey||d.metaKey)){var b=d.keyCode,c=90===b&&d.shiftKey||89===b;90!==b||d.shiftKey?c&&(a.redo(),d.preventDefault()):
(a.undo(),d.preventDefault())}});e.observe(this.element,"keydown",function(d){d=d.keyCode;d!==g&&(g=d,8!==d&&46!==d||a.transact())});this.editor.on("newword:composer",function(){a.transact()}).on("beforecommand:composer",function(){a.transact()})},transact:function(){var d=this.historyStr[this.position-1],e=this.composer.getValue(!1,!1),f=0<this.element.offsetWidth&&0<this.element.offsetHeight,b;if(e!==d){25<(this.historyStr.length=this.historyDom.length=this.position)&&(this.historyStr.shift(),this.historyDom.shift(),
this.position--);this.position++;if(f){d=(b=this.composer.selection.getRange())&&b.startContainer?b.startContainer:this.element;f=b&&b.startOffset?b.startOffset:0;if(d.nodeType===a.ELEMENT_NODE)b=d;else{b=d.parentNode;var c=this.getChildNodeIndex(b,d)}b.setAttribute("data-wysihtml-selection-offset",f);"undefined"!==typeof c&&b.setAttribute("data-wysihtml-selection-node",c)}c=this.element.cloneNode(!!e);this.historyDom.push(c);this.historyStr.push(e);b&&(b.removeAttribute("data-wysihtml-selection-offset"),
b.removeAttribute("data-wysihtml-selection-node"))}},undo:function(){this.transact();this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return 1<this.position},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";for(var d=0,e=a.childNodes,b=a.childNodes.length;d<
b;d++)this.element.appendChild(e[d].cloneNode(!0));a.hasAttribute("data-wysihtml-selection-offset")?(d=a.getAttribute("data-wysihtml-selection-offset"),e=a.getAttribute("data-wysihtml-selection-node"),a=this.element):(a=this.element.querySelector("[data-wysihtml-selection-offset]")||this.element,d=a.getAttribute("data-wysihtml-selection-offset"),e=a.getAttribute("data-wysihtml-selection-node"),a.removeAttribute("data-wysihtml-selection-offset"),a.removeAttribute("data-wysihtml-selection-node"));null!==
e&&(a=this.getChildNodeByIndex(a,+e));this.composer.selection.set(a,d)},getChildNodeIndex:function(a,e){var d=0;a=a.childNodes;for(var b=a.length;d<b;d++)if(a[d]===e)return d},getChildNodeByIndex:function(a,e){return a.childNodes[e]}})})(wysihtml);
wysihtml.views.View=Base.extend({constructor:function(a,e,d){this.parent=a;this.element=e;this.config=d;this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(e){e===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&
this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(a){var e=a.dom,d=a.browser;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,d,b){this.base(a,d,b);this.config.noTextarea?this.editableArea=d:this.textarea=this.parent.textarea;this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=d.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(d,e){var b=this.isEmpty()?"":a.quirks.getCorrectInnerHTML(this.element);!1!==d&&(b=this.parent.parse(b,
!1===e?!1:!0));return b},setValue:function(a,d){!1!==d&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(b){this.element.innerText=a}},cleanUp:function(a){var d;this.selection&&this.selection.isInThisEditable()&&(d=rangy.saveSelection(this.win));this.parent.parse(this.element,void 0,a);d&&rangy.restoreSelection(d)},show:function(){this.editableArea.style.display=this._displayStyle||"";this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=
e.getStyle("display").from(this.editableArea);"none"===this._displayStyle&&(this._displayStyle=null);this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer");this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer");this.element.setAttribute("contentEditable","true")},focus:function(d){a.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var e=this.element.lastChild;d&&e&&this.selection&&
("BR"===e.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var a={};a.y="undefined"!==typeof this.win.pageYOffset?this.win.pageYOffset:(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop;a.x="undefined"!==typeof this.win.pageXOffset?this.win.pageXOffset:(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft;return a}},setScrollPos:function(a){a&&
"undefined"!==typeof a.x&&"undefined"!==typeof a.y&&this.win.scrollTo(a.x,a.y)},getTextContent:function(){return e.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(a)||""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===
a||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;this.config.noTextarea?this.sandbox=new e.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new e.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),e.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var a=
this;this.sandbox=new e.Sandbox(function(){a._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox});this.editableArea=this.sandbox.getIframe();var d=this.textarea.element;e.insert(this.editableArea).after(d);this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden";a.name="_wysihtml_mode";a.value=1;e.insert(a).after(this.textarea.element)}},_create:function(){var g=this;
this.doc=this.sandbox.getDocument();this.win=this.sandbox.getWindow();this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body;this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1));this.selection=new a.Selection(this.parent,this.element,this.config.classNames.uneditableContainer);this.commands=new a.Commands(this.parent);this.config.noTextarea||e.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element);
this._initAutoLinking();e.addClass(this.element,this.config.classNames.composer);this.config.style&&!this.config.contentEditableMode&&this.style();this.observe();var f=this.config.name;f&&(e.addClass(this.element,f),this.config.contentEditableMode||e.addClass(this.editableArea,f));this.enable();!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();(f="string"===typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):
this.textarea.element.getAttribute("placeholder"))&&e.simulatePlaceholder(this.parent,this,f,this.config.classNames.placeholder);this.commands.exec("styleWithCSS",!1);this._initObjectResizing();this._initUndoManager();this._initLineBreaking();this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||d.isIos()||setTimeout(function(){g.focus(!0)},100);d.clearsContentEditableCorrectly()||a.quirks.ensureProperClearing(this);this.initSync&&
this.config.sync&&this.initSync();this.config.noTextarea||this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var g=this,f=d.canDisableAutoLinking(),b=d.doesAutoLinkingInContentEditable();f&&this.commands.exec("AutoUrlDetect",!1,!1);if(this.config.autoLink){if(!b||b&&f)this.parent.on("newword:composer",function(){if(e.getTextContent(g.element).match(e.autoLink.URL_REG_EXP)){for(var b=g.selection.getSelectedNode(),c=g.element.querySelectorAll("."+g.config.classNames.uneditableContainer),
d=!1,f=c.length;f--;)a.dom.contains(c[f],b)&&(d=!0);d||e.autoLink(b,[g.config.classNames.uneditableContainer])}}),e.observe(this.element,"blur",function(){e.autoLink(g.element,[g.config.classNames.uneditableContainer])});var c=this.sandbox.getDocument().getElementsByTagName("a"),h=e.autoLink.URL_REG_EXP,l=function(b){b=a.lang.string(e.getTextContent(b)).trim();"www."===b.substr(0,4)&&(b="http://"+b);return b};e.observe(this.element,"keydown",function(a){if(c.length){a=g.selection.getSelectedNode(a.target.ownerDocument);
var b=e.getParentElement(a,{query:"a"},4);if(b){var d=l(b);setTimeout(function(){var a=l(b);a!==d&&a.match(h)&&b.setAttribute("href",a)},0)}}})}},_initObjectResizing:function(){this.commands.exec("enableObjectResizing",!0);if(d.supportsEvent("resizeend")){var g=["width","height"],f=g.length,b=this.element;e.observe(b,"resizeend",function(c){c=c.target||c.srcElement;var d=c.style,e=0;if("IMG"===c.nodeName){for(;e<f;e++){var k=g[e];d[k]&&(c.setAttribute(k,parseInt(d[k],10)),d[k]="")}a.quirks.redraw(b)}})}},
_initUndoManager:function(){this.undoManager=new a.UndoManager(this.parent)},_initLineBreaking:function(){function g(a){var b=e.getParentElement(a,{query:"p, div"},2);b&&e.contains(f.element,b)&&f.selection.executeAndRestoreRangy(function(){f.config.useLineBreaks?((!b.firstChild||b.firstChild===b.lastChild&&1===b.firstChild.nodeType&&b.firstChild.classList.contains("rangySelectionBoundary"))&&b.appendChild(f.doc.createElement("br")),e.replaceWithChildNodes(b)):"P"!==b.nodeName&&e.renameElement(b,
"p")})}var f=this;this.config.useLineBreaks||e.observe(this.element,["focus"],function(){f.isEmpty()&&setTimeout(function(){var a=f.doc.createElement("P");f.element.innerHTML="";f.element.appendChild(a);d.displaysCaretInEmptyContentEditableCorrectly()?f.selection.selectNode(a,!0):(a.innerHTML="<br>",f.selection.setBefore(a.firstChild))},0)});e.observe(this.element,"keydown",function(b){var c=b.keyCode;if(!(b.shiftKey||b.ctrlKey||b.defaultPrevented||c!==a.ENTER_KEY&&c!==a.BACKSPACE_KEY)){var d=e.getParentElement(f.selection.getSelectedNode(),
{query:"li, p, h1, h2, h3, h4, h5, h6"},4);d?setTimeout(function(){var b=f.selection.getSelectedNode(),h;if("LI"===d.nodeName){if(!b)return;(h=e.getParentElement(b,{query:"ul, ol, menu"},2))||g(b)}c===a.ENTER_KEY&&d.nodeName.match(/^H[1-6]$/)&&g(b)},0):f.config.useLineBreaks&&c===a.ENTER_KEY&&!a.browser.insertsLineBreaksOnReturn()&&(b.preventDefault(),f.commands.exec("insertLineBreak"))}})}})})(wysihtml);
(function(a){var e=a.dom,d=document,g=window,f=d.createElement("div"),b="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),c="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),
h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],l=function(a){if(a.setActive)try{a.setActive()}catch(w){}else{var b=a.style,c=d.documentElement.scrollTop||
d.body.scrollTop,f=d.documentElement.scrollLeft||d.body.scrollLeft;b={position:b.position,top:b.top,left:b.left,WebkitUserSelect:b.WebkitUserSelect};e.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a);a.focus();e.setStyles(b).on(a);g.scrollTo&&g.scrollTo(f,c)}};a.views.Composer.prototype.style=function(){var g=this,q=d.querySelector(":focus"),n=this.textarea.element,r=n.hasAttribute("placeholder"),w=r&&n.getAttribute("placeholder"),C=n.style.display,y=n.disabled,
z;this.focusStylesHost=f.cloneNode(!1);this.blurStylesHost=f.cloneNode(!1);this.disabledStylesHost=f.cloneNode(!1);r&&n.removeAttribute("placeholder");n===q&&n.blur();n.disabled=!1;n.style.display=z="none";if(n.getAttribute("rows")&&"auto"===e.getStyle("height").from(n)||n.getAttribute("cols")&&"auto"===e.getStyle("width").from(n))n.style.display=z=C;e.copyStyles(c).from(n).to(this.editableArea).andTo(this.blurStylesHost);e.copyStyles(b).from(n).to(this.element).andTo(this.blurStylesHost);e.insertCSS(h).into(this.element.ownerDocument);
n.disabled=!0;e.copyStyles(c).from(n).to(this.disabledStylesHost);e.copyStyles(b).from(n).to(this.disabledStylesHost);n.disabled=y;n.style.display=C;l(n);n.style.display=z;e.copyStyles(c).from(n).to(this.focusStylesHost);e.copyStyles(b).from(n).to(this.focusStylesHost);n.style.display=C;e.copyStyles(["display"]).from(n).to(this.editableArea);var D=a.lang.array(c).without(["display"]);q?l(q):n.blur();r&&n.setAttribute("placeholder",w);this.parent.on("focus:composer",function(){e.copyStyles(D).from(g.focusStylesHost).to(g.editableArea);
e.copyStyles(b).from(g.focusStylesHost).to(g.element)});this.parent.on("blur:composer",function(){e.copyStyles(D).from(g.blurStylesHost).to(g.editableArea);e.copyStyles(b).from(g.blurStylesHost).to(g.element)});this.parent.observe("disable:composer",function(){e.copyStyles(D).from(g.disabledStylesHost).to(g.editableArea);e.copyStyles(b).from(g.disabledStylesHost).to(g.element)});this.parent.observe("enable:composer",function(){e.copyStyles(D).from(g.blurStylesHost).to(g.editableArea);e.copyStyles(b).from(g.blurStylesHost).to(g.element)});
return this}})(wysihtml);
(function(a){var e=a.dom,d=e.domNode,g=a.browser,f={66:"bold",73:"italic",85:"underline"},b={addListeners:function(a,b,c){for(var d=0,e=b.length;d<e;d++)a.addEventListener(b[d],c,!1)},removeListeners:function(a,b,c){for(var d=0,e=b.length;d<e;d++)a.removeEventListener(b[d],c,!1)},fixLastBrDeletionInTable:function(b,c){if(b.selection.caretIsInTheEndOfNode()){var d=b.selection.getSelection(),e=d.anchorNode;if(e&&1===e.nodeType&&(a.dom.getParentElement(e,{query:"td, th"},!1,b.element)||c)&&(b=e.childNodes[d.anchorOffset])&&
1===b.nodeType&"BR"===b.nodeName)return b.parentNode.removeChild(b),!0}return!1},handleUneditableDeletion:function(a){var c=a.selection.getBeforeSelection(!0);if(c&&("element"===c.type||"leafnode"===c.type)&&1===c.node.nodeType&&c.node.classList.contains(a.config.classNames.uneditableContainer)){if(b.fixLastBrDeletionInTable(a,!0))return!0;try{var d=new CustomEvent("wysihtml:uneditable:delete",{bubbles:!0,cancelable:!1});c.node.dispatchEvent(d)}catch(v){}c.node.parentNode.removeChild(c.node);return!0}return!1},
fixDeleteInTheBeginningOfBlock:function(b){var c=b.selection,e=c.getPreviousNode();if(c.caretIsFirstInSelection(a.browser.usesControlRanges())&&e&&1===e.nodeType&&a.dom.domNode(e).is.block()&&!d(e).test({query:"ol, ul, table, tr, dl"})){if(/^\s*$/.test(e.textContent||e.innerText))return e.parentNode.removeChild(e),!0;if(e.lastChild){var f=e.lastChild,g=c.getSelectedNode(),h=d(e).commonAncestor(g,b.element);if(b=a.dom.getParentElement(g,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,
h||b.element))return d(b).transferContentTo(e,!0),c.setAfter(f),!0;if(a.browser.usesControlRanges())return g=c.getCaretNode(),d(g).transferContentTo(e,!0),c.setAfter(f),!0}}return!1},fixDeleteInTheBeginningOfLi:function(b){if(a.browser.hasLiDeletingProblem()){var c=b.selection.getSelection(),e=c.anchorNode;var f=b.selection.caretIsFirstInSelection();3===e.nodeType&&0===c.anchorOffset&&e===e.parentNode.firstChild&&(e=e.parentNode,f=!0);if(f&&e&&1===e.nodeType&&"LI"===e.nodeName){c=d(e).prev({nodeTypes:[1,
3],ignoreBlankTexts:!0});if(!c&&e.parentNode&&("UL"===e.parentNode.nodeName||"OL"===e.parentNode.nodeName)){c=d(e.parentNode).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});var g=e.parentNode}if(c)return f=e.firstChild,d(e).transferContentTo(c,!0),g&&0===g.children.length&&g.remove(),f?b.selection.setBefore(f):c&&(1===c.nodeType?c.lastChild?b.selection.setAfter(c.lastChild):b.selection.selectNode(c):b.selection.setAfter(c)),!0}}return!1},fixDeleteInTheBeginningOfControlSelection:function(a){var b=a.selection,
c=b.getPreviousNode(),e=b.getSelectedNode();return b.caretIsFirstInSelection()?(3===e.nodeType&&(e=e.parentNode),b=e.firstChild,d(e).transferContentTo(c,!0),b&&a.selection.setBefore(b),!0):!1},doLineBreaksModeEnterWithCaret:function(b){var c,f=!1;if(c=b.selection.getNodesNearCaret()){if(c.caretNode||c.nextNode){var g=e.getParentElement(c.caretNode||c.nextNode,{query:"p, pre, div, blockquote"},2);g===b.element&&(g=void 0)}if(g&&c.caretNode)if(d(c.caretNode).is.lineBreak()){if(b.config.doubleLineBreakEscapesBlock){f=
!0;c.caretNode.parentNode.removeChild(c.caretNode);d(c.nextNode).is.lineBreak()&&c.nextNode.parentNode.removeChild(c.nextNode);var h=b.doc.createElement("br");d(c.nextNode).is.lineBreak()&&c.nextNode===g.lastChild?g.parentNode.insertBefore(h,g.nextSibling):b.selection.splitElementAtCaret(g,h);c.nextNode&&3===c.nextNode.nodeType&&(c.nextNode.data=c.nextNode.data.replace(/^ *[\r\n]+/,""));b.selection.setBefore(h)}}else 3===c.caretNode.nodeType&&a.browser.hasCaretBlockElementIssue()&&c.textOffset===
c.caretNode.data.length&&!c.nextNode&&(f=!0,c=b.doc.createElement("br"),g=b.doc.createElement("br"),h=b.doc.createDocumentFragment(),h.appendChild(c),h.appendChild(g),b.selection.insertNode(h),b.selection.setBefore(g))}return f}},c=function(c,d){var e=d.selection;e.isCollapsed()?d.isEmpty()&&!d.config.useLineBreaks?c.preventDefault():b.handleUneditableDeletion(d)?c.preventDefault():b.fixDeleteInTheBeginningOfLi(d)?c.preventDefault():b.fixDeleteInTheBeginningOfBlock(d)?c.preventDefault():b.fixLastBrDeletionInTable(d)?
c.preventDefault():a.browser.usesControlRanges()&&b.fixDeleteInTheBeginningOfControlSelection(d)&&c.preventDefault():e.containsUneditable()&&(c.preventDefault(),e.deleteContents())},h=function(a,c){!c.config.useLineBreaks||a.shiftKey||a.ctrlKey||c.selection.isCollapsed()&&b.doLineBreaksModeEnterWithCaret(c)&&a.preventDefault();if(g.hasCaretAtLinkEndInsertionProblems()&&c.selection.caretIsInTheEndOfNode()){var d=(a=c.selection.getSelectedNode(!0))&&3===a.nodeType?a.parentNode:a;d&&d.closest("a")&&
3===a.nodeType&&a===d.lastChild&&c.selection.setAfter(d)}},l=function(a,b,c){if(!a.selection.isCollapsed())a.selection.deleteContents();else if(a.selection.caretIsInTheBeginnig("li"))if(c){if(a.commands.exec("outdentList"))return}else if(a.commands.exec("indentList"))return;a.commands.exec("insertHTML","&emsp;")},k=function(a){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval);this.parent.fire("destroy:composer")},q=function(a){this.parent.fire("beforeinteraction",a).fire("beforeinteraction:composer",
a);setTimeout(function(){this.parent.fire("interaction",a).fire("interaction:composer",a)}.bind(this),0)},n=function(a){this.parent.fire("focus",a).fire("focus:composer",a);setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},r=function(a){if(this.focusState!==this.getValue(!1,!1)){var b=a;"function"==typeof Object.create&&(b=Object.create(a,{type:{value:"change"}}));this.parent.fire("change",b).fire("change:composer",b)}this.parent.fire("blur",a).fire("blur:composer",a)},w=
function(a){this.parent.fire(a.type,a).fire(a.type+":composer",a);"paste"===a.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},C=function(b){this.config.copyedFromMarking&&(a.browser.supportsModernPaste()&&(b.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),b.clipboardData.setData("text/plain",this.selection.getPlainText()),b.preventDefault()),this.parent.fire(b.type,b).fire(b.type+":composer",b))},y=function(b){b=b.keyCode;
b!==a.SPACE_KEY&&b!==a.ENTER_KEY||this.parent.fire("newword:composer")},z=function(b){if(!g.canSelectImagesInContentEditable()){var c=b.target,d=this.element.querySelectorAll("img"),e=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img");d=a.lang.array(d).without(e);"IMG"===c.nodeName&&a.lang.array(d).contains(c)&&this.selection.selectNode(c)}a.browser.usesControlRanges()&&(this.selection.lastMouseDownPos={x:b.clientX,y:b.clientY},setTimeout(function(){delete this.selection.lastMouseDownPos}.bind(this),
0))},D=function(a){var b=this.selection.lastMouseDownPos;if(b){var c=document.body.createTextRange();setTimeout(function(){try{c.moveToPoint(b.x,b.y),c.select()}catch(v){}}.bind(this),0)}},H=function(b){this.config.classNames.uneditableContainer&&(b=a.dom.getParentElement(b.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element))&&this.selection.setAfter(b)},A=function(a){g.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),
0)},p=function(b){var d=b.keyCode,e=f[d],g=this.selection.getSelectedNode(!0);!b.ctrlKey&&!b.metaKey||b.altKey||65!==d?((b.ctrlKey||b.metaKey)&&!b.altKey&&e&&(this.commands.exec(e),b.preventDefault()),d===a.BACKSPACE_KEY&&c(b,this),d!==a.BACKSPACE_KEY&&d!==a.DELETE_KEY||!g||"IMG"!==g.nodeName||(b.preventDefault(),e=g.parentNode,e.removeChild(g),"A"!==e.nodeName||e.firstChild||e.parentNode.removeChild(e),setTimeout(function(){a.quirks.redraw(this.element)}.bind(this),0)),this.config.handleTabKey&&
d===a.TAB_KEY&&(b.preventDefault(),l(this,this.element,b.shiftKey)),d===a.ENTER_KEY&&h(b,this)):(this.selection.selectAll(),b.preventDefault())},t=function(b){if(0!==b.which&&this.selection.caretIsInTheEndOfNode()){var c=this.selection.getSelectedNode(!0),d=c&&3===c.nodeType?c.parentNode:c;if(d&&d.closest("a")&&c===d.lastChild)if(32!==b.which||this.selection.caretIsInTheEndOfNode(!0)&&g.hasCaretAtLinkEndInsertionProblems()){var e=this.doc.createTextNode(a.INVISIBLE_SPACE);this.selection.insertNode(e);
this.selection.setBefore(e);setTimeout(function(){1<e.textContent.length?(e.textContent=e.textContent.replace(a.INVISIBLE_SPACE_REG_EXP,""),this.selection.setAfter(e)):e.remove()}.bind(this),0)}else 32===b.which&&3===c.nodeType&&/[\u00A0 ]$/.test(c.textContent)&&(c.textContent=c.textContent.replace(/[\u00A0 ]$/,""),c=this.doc.createTextNode(" "),d.parentNode.insertBefore(c,d.nextSibling),this.selection.setAfter(c,!1),b.preventDefault())}};a.views.Composer.prototype.observeActions=b;a.views.Composer.prototype.observe=
function(){var c=this,d=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),f=g.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow();this.focusState=this.getValue(!1,!1);this.actions=b;g.supportsMutationObserver()?(new MutationObserver(function(a){a.forEach(function(a){0<a.removedNodes.length&&!e.contains(document.documentElement,d)&&k.call(c)})})).observe(d.parentNode,{childList:!0}):g.supportsMutationEvents()?d.addEventListener(["DOMNodeRemoved"],
k.bind(this),!1):this.domNodeRemovedInterval=setInterval(function(){e.contains(document.documentElement,d)||k.call(this)},250);b.addListeners(f,["drop","paste","mouseup","focus","keyup"],q.bind(this));f.addEventListener("focus",n.bind(this),!1);f.addEventListener("blur",r.bind(this),!1);b.addListeners(this.element,["drop","paste","beforepaste"],w.bind(this),!1);this.element.addEventListener("copy",C.bind(this),!1);this.element.addEventListener("mousedown",z.bind(this),!1);this.element.addEventListener("click",
H.bind(this),!1);this.element.addEventListener("drop",A.bind(this),!1);this.element.addEventListener("keyup",y.bind(this),!1);this.element.addEventListener("keydown",p.bind(this),!1);this.element.addEventListener("keypress",t.bind(this),!1);a.browser.usesControlRanges()&&this.element.addEventListener("mscontrolselect",D.bind(this),!1);this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}})(wysihtml);
(function(a){a.views.Synchronizer=Base.extend({constructor:function(a,d,g){this.editor=a;this.textarea=d;this.composer=g;this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),e)},fromTextareaToComposer:function(a){var d=this.textarea.getValue(!1,!1);d?this.composer.setValue(d,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a):
this.fromComposerToTextarea(a)},_observe:function(){var e,d=this,g=this.textarea.element.form,f=function(){e=setInterval(function(){d.fromComposerToTextarea()},400)},b=function(){clearInterval(e);e=null};f();g&&(a.dom.observe(g,"submit",function(){d.sync(!0)}),a.dom.observe(g,"reset",function(){setTimeout(function(){d.fromTextareaToComposer()},0)}));this.editor.on("change_view",function(a){"composer"!==a||e?"textarea"===a&&(d.fromComposerToTextarea(!0),b()):(d.fromTextareaToComposer(!0),f())});this.editor.on("destroy:composer",
b)}})})(wysihtml);
(function(a){a.views.SourceView=Base.extend({constructor:function(a,d){this.editor=a;this.composer=d;this._observe()},switchToTextarea:function(a){var d=this.composer.win.getComputedStyle(this.composer.element),e=parseFloat(d.width);d=Math.max(parseFloat(d.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml-source-view");this.textarea.style.width=e+"px";this.textarea.style.height=d+"px";this.textarea.value=this.editor.getValue(a,!0);
this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element);this.editor.currentView="source";this.composer.element.style.display="none"},switchToComposer:function(a){var d=this.textarea.value;d?this.composer.setValue(d,a):(this.composer.clear(),this.editor.fire("set_placeholder"));this.textarea.parentNode.removeChild(this.textarea);this.editor.currentView=this.composer;this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(a){"composer"===
a?this.switchToComposer(!0):"textarea"===a&&this.switchToTextarea(!0)}.bind(this))}})})(wysihtml);
wysihtml.views.Textarea=wysihtml.views.View.extend({name:"textarea",constructor:function(a,e,d){this.base(a,e,d);this._observe()},clear:function(){this.element.value=""},getValue:function(a){var e=this.isEmpty()?"":this.element.value;!1!==a&&(e=this.parent.parse(e));return e},setValue:function(a,e){!1!==e&&(a=this.parent.parse(a));this.element.value=a},cleanUp:function(a){a=this.parent.parse(this.element.value,void 0,a);this.element.value=a},hasPlaceholderSet:function(){var a=wysihtml.browser.supportsPlaceholderAttributeOn(this.element),
e=this.element.getAttribute("placeholder")||null,d=this.element.value;return a&&!d||d===e},isEmpty:function(){return!wysihtml.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,e=this.parent,d={focusin:"focus",focusout:"blur"},g=wysihtml.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];e.on("beforeload",function(){wysihtml.dom.observe(a,g,function(a){a=d[a.type]||a.type;e.fire(a).fire(a+":textarea")});
wysihtml.dom.observe(a,["paste","drop"],function(){setTimeout(function(){e.fire("paste").fire("paste:textarea")},0)})})}});
(function(a){a.Editor=a.lang.Dispatcher.extend({defaults:{name:void 0,style:!0,autoLink:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:a.dom.parse,useLineBreaks:!0,doubleLineBreakEscapesBlock:!0,stylesheets:[],placeholderText:void 0,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml-editor",body:"wysihtml-supported",sandbox:"wysihtml-sandbox",placeholder:"wysihtml-placeholder",uneditableContainer:"wysihtml-uneditable-container"},
copyedFromMarking:'<meta name="copied-from" content="wysihtml">'},constructor:function(e,d){this.editableElement="string"===typeof e?document.getElementById(e):e;this.config=a.lang.object({}).merge(this.defaults).merge(d).get();this._isCompatible=a.browser.supported();d&&d.classNames&&a.lang.object(this.config.classNames).merge(d.classNames);"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0);this.config.noTextarea||(this.currentView=
this.textarea=new a.views.Textarea(this,this.editableElement,this.config));if(!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var g=this;setTimeout(function(){g.fire("beforeload").fire("load")},0)}else a.dom.addClass(document.body,this.config.classNames.body),this.currentView=this.composer=new a.views.Composer(this,this.editableElement,this.config),"function"===typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?
this.sourceView=new a.views.SourceView(this,this.composer):this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer);this.runEditorExtenders()},runEditorExtenders:function(){a.editorExtenders.forEach(function(a){a(this)}.bind(this))},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(a,d){return this.currentView.getValue(a,d)},setValue:function(a,d){this.fire("unset_placeholder");if(!a)return this.clear();
this.currentView.setValue(a,d);return this},cleanUp:function(a){this.currentView.cleanUp(a)},focus:function(a){this.currentView.focus(a);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy();this.fire("destroy:composer");
this.off()},parse:function(e,d,g){var f=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null;d=this.config.parser(e,{rules:g||this.config.parserRules,cleanUp:this.config.cleanUp,context:f,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:d});"object"===typeof e&&a.quirks.redraw(e);return d},_initParser:function(){var e;if(a.browser.supportsModernPaste())this.on("paste:composer",function(d){d.preventDefault();(e=a.dom.getPastedHtml(d))&&
this._cleanAndPaste(e)}.bind(this));else this.on("beforepaste:composer",function(d){d.preventDefault();var e=this.composer.getScrollPos();a.dom.getPastedHtmlWithDiv(this.composer,function(a){a&&this._cleanAndPaste(a);this.composer.setScrollPos(e)}.bind(this))}.bind(this))},_cleanAndPaste:function(e){e=a.quirks.cleanPastedHTML(e,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents();
this.composer.selection.insertHTML(e)}})})(wysihtml);
