(function(n){"use strict";function t(){}t.dataTypes=["date","boolean","number","integer","text","textarea","money","choice","multichoice","percent","table","department","region","country","year","month","day"];t.functions={abs:{arity:1,args:["number"],type:"number",label:Translator.trans("abs")},acos:{arity:1,args:["number"],type:"number",label:Translator.trans("acos")},acosh:{arity:1,args:["number"],type:"number",label:Translator.trans("acosh")},addMonths:{arity:2,args:["number","date"],type:"date",label:Translator.trans("addMonths")},asin:{arity:1,args:["number"],type:"number",label:Translator.trans("asin")},asinh:{arity:1,args:["number"],type:"number",label:Translator.trans("asinh")},atan:{arity:1,args:["number"],type:"number",label:Translator.trans("atan")},atan2:{arity:2,args:["number","number"],type:"number",label:Translator.trans("atan2")},atanh:{arity:1,args:["number"],type:"number",label:Translator.trans("atanh")},ceil:{arity:1,args:["number"],type:"number",label:Translator.trans("ceil")},concat:{arity:-1,args:["text"],type:"text",label:Translator.trans("concat")},cos:{arity:1,args:["number"],type:"number",label:Translator.trans("cos")},cosh:{arity:1,args:["number"],type:"number",label:Translator.trans("cosh")},count:{arity:-1,args:["number"],type:"number",label:Translator.trans("count")},day:{arity:1,args:["date"],type:"number",label:Translator.trans("day")},exp:{arity:1,args:["number"],type:"number",label:Translator.trans("exp")},firstDayOfMonth:{arity:1,args:["date"],type:"date",label:Translator.trans("firstDayOfMonth")},floor:{arity:1,args:["number"],type:"number",label:Translator.trans("floor")},fullmonth:{arity:1,args:["date"],type:"text",label:Translator.trans("fullmonth")},get:{arity:2,args:["array","number"],type:"text",label:Translator.trans("get")},lastday:{arity:2,args:["number","number"],type:"number",label:Translator.trans("lastDay")},lastDayOfMonth:{arity:1,args:["date"],type:"date",label:Translator.trans("lastDayOfMonth")},lcfirst:{arity:1,args:["text"],type:"text",label:Translator.trans("lcfirst")},length:{arity:1,args:["text"],type:"number",label:Translator.trans("length")},log:{arity:1,args:["number"],type:"number",label:Translator.trans("log")},log10:{arity:1,args:["number"],type:"number",label:Translator.trans("log10")},lower:{arity:1,args:["text"],type:"text",label:Translator.trans("lower")},match:{arity:2,args:["text","text"],type:"boolean",label:Translator.trans("match")},max:{arity:2,args:["number","number"],type:"number",label:Translator.trans("max")},min:{arity:2,args:["number","number"],type:"number",label:Translator.trans("min")},money:{arity:1,args:["number"],type:"text",label:Translator.trans("money")},month:{arity:1,args:["date"],type:"number",label:Translator.trans("month")},nextWorkDay:{arity:1,args:["date"],type:"date",label:Translator.trans("nextWorkDay")},pow:{arity:2,args:["number","number"],type:"number",label:Translator.trans("pow")},rand:{arity:0,args:[],type:"number",label:Translator.trans("rand")},replace:{arity:3,args:["text","text","text"],type:"text",label:Translator.trans("replace")},round:{arity:1,args:["number"],type:"number",label:Translator.trans("round")},sin:{arity:1,args:["number"],type:"number",label:Translator.trans("sin")},sinh:{arity:1,args:["number"],type:"number",label:Translator.trans("sinh")},size:{arity:1,args:["array"],type:"number",label:Translator.trans("size")},split:{arity:2,args:["text","text"],type:"array",label:Translator.trans("split")},sqrt:{arity:1,args:["number"],type:"number",label:Translator.trans("sqrt")},substr:{arity:3,args:["text","number","number"],type:"text",label:Translator.trans("substr")},sum:{arity:-1,args:["number"],type:"number",label:Translator.trans("sum")},tan:{arity:1,args:["number"],type:"number",label:Translator.trans("tan")},tanh:{arity:1,args:["number"],type:"number",label:Translator.trans("tanh")},titlecase:{arity:1,args:["text"],type:"text",label:Translator.trans("ucwords")},trim:{arity:1,args:["text"],type:"text",label:Translator.trans("trim")},ucfirst:{arity:1,args:["text"],type:"text",label:Translator.trans("ucfirst")},upper:{arity:1,args:["text"],type:"text",label:Translator.trans("upper")},workdays:{arity:2,args:["date","date"],type:"number",label:Translator.trans("workdays")},workdaysofmonth:{arity:2,args:["number","number"],type:"number",label:Translator.trans("workdaysofmonth")},year:{arity:1,args:["date"],type:"number",label:Translator.trans("year")}};t.constants={pi:{type:"number",label:Translator.trans("pi")},now:{type:"date",label:Translator.trans("now")},today:{type:"date",label:Translator.trans("today")},"true":{type:"boolean",label:Translator.trans("true")},"false":{type:"boolean",label:Translator.trans("false")}};t.dateFormats={"d/m/Y":Translator.trans("d/m/Y")+" ("+(new Date).format("d/m/Y")+")","m/d/Y":Translator.trans("m/d/Y")+" ("+(new Date).format("m/d/Y")+")","d-m-Y":Translator.trans("d-m-Y")+" ("+(new Date).format("d-m-Y")+")","m-d-Y":Translator.trans("m-d-Y")+" ("+(new Date).format("m-d-Y")+")","d.m.Y":Translator.trans("d.m.Y")+" ("+(new Date).format("d.m.Y")+")","d.m.Y.":Translator.trans("d.m.Y.")+" ("+(new Date).format("d.m.Y.")+")","d/m Y":Translator.trans("d/m Y")+" ("+(new Date).format("d/m Y")+")","d. m. Y":Translator.trans("d. m. Y")+" ("+(new Date).format("d. m. Y")+")","Y-m-d":Translator.trans("Y-m-d")+" ("+(new Date).format("Y-m-d")+")","Y/m/d":Translator.trans("Y/m/d")+" ("+(new Date).format("Y/m/d")+")","Y. m. d.":Translator.trans("Y. m. d.")+" ("+(new Date).format("Y. m. d.")+")"};t.parameterDateFormats={"Y-m-d":Translator.trans("Y-m-d")+" ("+(new Date).format("Y-m-d")+")","Y-m":Translator.trans("Y-m")+" ("+(new Date).format("Y-m")+")","m-d":Translator.trans("m-d")+" ("+(new Date).format("m-d")+")","d/m/Y":Translator.trans("d/m/Y")+" ("+(new Date).format("d/m/Y")+")","m/Y":Translator.trans("m/Y")+" ("+(new Date).format("m/Y")+")","m/d":Translator.trans("m/d")+" ("+(new Date).format("m/d")+")",Y:Translator.trans("Y")+" ("+(new Date).format("Y")+")","y-m-d":Translator.trans("y-m-d")+" ("+(new Date).format("y-m-d")+")","y-m":Translator.trans("y-m")+" ("+(new Date).format("y-m")+")","d/m/y":Translator.trans("d/m/Y")+" ("+(new Date).format("d/m/y")+")","m/y":Translator.trans("m/y")+" ("+(new Date).format("m/y")+")",y:Translator.trans("y")+" ("+(new Date).format("y")+")",m:Translator.trans("m")+" ("+(new Date).format("m")+")",d:Translator.trans("d")+" ("+(new Date).format("d")+")"};t.moneySymbols={"฿":"฿","B/.":"B/.","₵":"₵","¢":"¢","₡":"₡","Kč":"Kč",$:"$","₫":"₫","€":"€","ƒ":"ƒ",Ft:"Ft","₲":"₲","₴":"₴","₭":"₭",L:"L","£ / ₤":"£ / ₤","₺":"₺","₥":"₥","₦":"₦","S/.":"S/.","₱":"₱",P:"P",R:"R",RM:"RM","₹ / ₨":"₹ / ₨","৲":"৲","৳":"৳",R$:"R$","₪":"₪","₮":"₮","₩":"₩","¥":"¥","Ұ":"Ұ","zł":"zł"};t.decimalPoints={",":Translator.trans("Comma"),".":Translator.trans("Dot"),"٫":Translator.trans("Arabic decimal point")};t.groupingSeparators={"":Translator.trans("None")," ":Translator.trans("Space"),",":Translator.trans("Comma"),"٬":Translator.trans("Arabic thousands separator"),".":Translator.trans("Dot"),"'":Translator.trans("Apostrophe"),"’":Translator.trans("Private use 2")};t.optionalAttributes={"default":{type:"expression",label:Translator.trans("default"),placeholder:Translator.trans("default value")},min:{type:"expression",label:Translator.trans("min"),placeholder:Translator.trans("min value")},max:{type:"expression",label:Translator.trans("max"),placeholder:Translator.trans("max value")},pattern:{type:"text",label:Translator.trans("Pattern"),placeholder:Translator.trans("Pattern")},content:{type:"expression",label:Translator.trans("Content"),placeholder:Translator.trans("content")},round:{type:"number",label:Translator.trans("Round"),placeholder:Translator.trans("Number of decimals after the decimal point")},unit:{type:"text",label:Translator.trans("Unit"),placeholder:Translator.trans("unit text")},source:{type:"select",label:Translator.trans("Source"),placeholder:Translator.trans("source")},index:{type:"select",label:Translator.trans("Index"),placeholder:Translator.trans("Path to the data in JSONPath or XPath format")},memorize:{type:"checkbox",label:Translator.trans("Memorize"),placeholder:Translator.trans("Store into memo)")}};t.expressionOptions={constants:t.constants,functions:t.functions,operators:["+","-","*","%","/","&","|"],onCompleted:function(){},onEditing:function(){},onError:function(n){console&&console.log("error : "+n)},language:Admin.lang,operandHolder:{classes:["button","button-default"]},operatorHolder:{classes:["button","button-default"]},nestedExpression:{classes:["button","button-default"]}};t.sourceReturnTypes={json:Translator.trans("JSON"),xml:Translator.trans("XML"),singleValue:Translator.trans("Single value"),assocArray:Translator.trans("Associative array"),html:Translator.trans("HTML"),csv:Translator.trans("Comma separated value (csv)")};t.outputTypes={normal:Translator.trans("Normal"),inlinePDF:Translator.trans("Inline PDF"),downloadablePDF:Translator.trans("Downloadable PDF"),inlineFilledPDF:Translator.trans("Inline pre-filled PDF form"),downloadableFilledPDF:Translator.trans("Downloadable pre-filled PDF form"),html:Translator.trans("html")};t.updating=!1;t.setRegionalSettings=function(){var n=$("#simulator-attributes-panel-holder"),t={locale:n.find("p[data-attribute='locale']").attr("data-value"),dateFormat:n.find("p[data-attribute='dateFormat']").attr("data-value"),timezone:n.find("p[data-attribute='timezone']").attr("data-value"),decimalPoint:n.find("p[data-attribute='decimalPoint']").attr("data-value"),groupingSeparator:n.find("p[data-attribute='groupingSeparator']").attr("data-value"),groupingSize:n.find("p[data-attribute='groupingSize']").attr("data-value"),moneySymbol:n.find("p[data-attribute='moneySymbol']").attr("data-value"),symbolPosition:n.find("p[data-attribute='symbolPosition']").attr("data-value")};Date.setRegionalSettings(t);MoneyFunction.setRegionalSettings(t)};t.init=function(){Admin.wysihtml5Options.toolbar.insertData=!0;Admin.wysihtml5Options.toolbar.insertFootnoteReference=!0;$("#simulator-attributes-panel-holder").length&&t.setRegionalSettings();t.collectDataset();$(".save-simulator").hide()};t.changeDataIdInRichText=function(n,t){var i=new RegExp("#("+n+"\\b|"+n+"(L))","g"),r=new RegExp('\\<data\\s+([^\\s]*\\s*)value=\\"'+n+'\\"',"g");$("#simulator").find(".rich-text").each(function(){var u=!1,n=$(this).html();i.test(n)&&(n=n.replace(i,"#"+t+"$2"),u=!0);r.test(n)&&(n=n.replace(r,'<data $1value="'+t+'"'),u=!0);u&&$(this).html(n)})};t.changeDataIdInExpression=function(n,t){var i=new RegExp("#("+n+"\\b|"+n+"(L))","g");$("#simulator").find("span.attribute-expression").each(function(){var n=$(this).attr("data-value");i.test(n)&&$(this).attr("data-value",n.replace(i,"#"+t+"$2"))})};t.checkDataInExpression=function(n,t){var u=t.expressionbuilder("val"),i=u.match(/#\d+/g),r=!1;return i!=null&&$.each(i,function(t,i){if(i=="#"+n)return r=!0,!1}),!r};t.cleanRichtext=function(n){return n=n.replace(/<p>&nbsp;<\/p>/g,"\n"),n=n.replace(/<p><br><\/p>/g,"\n"),n=n.replace(/<br>/g,"\n"),n=n.replace(/<\/p>/g,"\n"),n.replace(/<p>/g,"")};t.paragraphs=function(n){var r;if(n.edition&&n.edition!="manual")return n;r=typeof n.content!="undefined"?n.content:n;r=t.cleanRichtext(r);var u=$.trim(r).split("\n"),i="";return $.each(u,function(n,t){t=$.trim(t);t.length==0?i+="<br>":(i+="<p>",i+=t,i+="<\/p>")}),$.each(["address","article","aside","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","li","main","nav","noscript","ol","output","pre","section","table","tfoot","ul","video"],function(n,t){i=i.replace(new RegExp("<p>\\s*<"+t+">","g"),"<"+t+">");i=i.replace(new RegExp("<"+t+">\\s*<\/p>","g"),"<"+t+">");i=i.replace(new RegExp("<p>\\s*<\/"+t+">","g"),"<\/"+t+">");i=i.replace(new RegExp("<\\/"+t+">\\s*<\\/p>","g"),"<\/"+t+">")}),typeof n.content!="undefined"?(n.content=i,n):i};t.simpleAttributeForDisplay=function(n,t,i,r,u,f,e,o,s){if(e||u&&u!==""){var h='<div class="form-group row">';return h+='    <label class="col-sm-4 col-form-label">'+r+"<\/label>",h+='    <div class="col-sm-8">',u=u||"",t==="text"||t==="number"?h+='        <p class="form-control-plaintext simple-value" data-attribute="'+i+'" data-value="'+u+'">'+f+"<\/p>":t==="checkbox"?h+='        <p class="form-control-plaintext simple-value" data-attribute="'+i+'" data-value="'+(u=="1"||u==1?1:0)+'">'+(u=="1"||u==1?Translator.trans("Yes"):Translator.trans("No"))+"<\/p>":t==="select"&&(s=JSON.parse(s),$.each(s,function(n,t){n==u&&(h+='       <p class="form-control-plaintext simple-value" data-attribute="'+i+'" data-value="'+n+'">'+t+"<\/p>")})),h+="    <\/div>",h+="<\/div>",$(h)}};t.simpleAttributeForInput=function(n,t,i,r,u,f,e,o){var s='<div class="form-group row">',h;return s+=t==="checkbox"?'    <label for="'+n+'" class="col-sm-8 col-form-label">':'    <label for="'+n+'" class="col-sm-4 col-form-label">',f||(s+='    <span tabindex="0" class="delete-attribute fas fa-times text-danger"><\/span>&nbsp;'),s+="    <span>"+r+"<\/span><\/label>",s+=t==="checkbox"?'    <div class="col-sm-4 input-group">':'    <div class="col-sm-8 input-group">',t==="text"||t==="number"?s+='        <input type="'+t+'" name="'+n+'" id="'+n+'" data-attribute="'+i+'" class="form-control simple-value" placeholder="'+e+'"  value="'+u+'" />':t==="checkbox"?(s+='        <input type="checkbox" name="'+n+'" id="'+n+'" data-attribute="'+i+'" class="form-control simple-value" value="1"',u=="1"&&(s+=' checked="checked"'),s+=" />"):t==="select"&&(o=JSON.parse(o),h=[],$.each(o,function(n,t){h.push({label:t,value:n})}),h.sort(function(n,t){return n.label.localeCompare(t.label)}),s+='        <select name="'+n+'" id="'+n+'" data-attribute="'+i+'" class="form-control simple-value" data-placeholder="'+e+'">',$.each(h,function(n,t){s+=t.value==u?'        <option value="'+t.value+'" selected="selected">'+t.label+"<\/option>":'        <option value="'+t.value+'">'+t.label+"<\/option>"}),s+="        <\/select>"),s+="    <\/div>",s+="<\/div>",$(s)};t.simpleToggleAttributeForInput=function(n,t,i,r,u){var f='<div class="form-group row">';return f+='    <label class="col-form-label">',u||(f+='    <span tabindex="0" class="delete-attribute fas fa-times text-danger"><\/span>&nbsp;'),f+='    <span class="col-sm-4">'+i+"<\/span>",f+='    <div style="display: inline-block;" class="col-sm-8 input-group checkbox-slider--b-flat checkbox-slider-primary">',f+='        <input type="checkbox" name="'+n+'" id="'+n+'" data-attribute="'+t+'" class="form-control simple-value" value="1"',r=="1"&&(f+=' checked="checked"'),f+=" /><span>&nbsp;&nbsp;&nbsp;&nbsp;<\/span>",f+="    <\/div><\/label>",f+="<\/div>",$(f)};t.expressionAttributeForDisplay=function(n,t,i,r,u,f,e){if(f||r!==""){var o='<div class="form-group row">';return o+='    <label class="col-sm-4 col-form-label">'+i+"<\/label>",o+='    <span data-attribute="'+t+'" class="attribute-expression" data-placeholder="'+e+'" data-value="'+r+'">'+u+"<\/span>",o+="<\/div>",$(o)}};t.expressionAttributeForInput=function(n,t,i,r,u,f){var e='<div class="form-group row">';return e+='    <label for="'+n+'" class="col-sm-4 col-form-label">',u||(e+='    <span tabindex="0" class="delete-attribute fas fa-times text-danger"><\/span>&nbsp;'),e+="    <span>"+i+"<\/span><\/label>",e+='    <span id="'+n+'" data-attribute="'+t+'" class="attribute-expression" data-placeholder="'+f+'"  data-value="'+r+'" />',e+="<\/div>",$(e)};t.removeAttribute=function(n){var i=n.parent("label.col-form-label").attr("for"),r=$("#"+i),t=r.attr("id").split("-"),u=t.pop(),f=t.join("-"),e=n.parents("div.attributes-container").children("div.optional-attributes").children("ul").children("li[data-element='"+f+"'][data-name='"+u+"']");e.show().focus();n.parent("label").parent("div.form-group").remove()};t.dropAttribute=function(n,i,r){var c=n.attr("data-element"),f=n.attr("data-name"),e=c+"-"+f;if(!$("#"+e).length){var l=n.attr("data-type"),o=n.text(),s=n.attr("data-placeholder"),h=n.attr("data-expression")?n.attr("data-expression")==="true":!1,u=h?t.expressionAttributeForInput(e,f,o,"",!1,s):t.simpleAttributeForInput(e,l,f,o,"",!1,s,decodeURI(n.attr("data-options")));i.append(u);$(u).find(".attribute-expression").expressionbuilder({fields:t.dataset,constants:t.expressionOptions.constants,functions:t.expressionOptions.functions,operators:t.expressionOptions.operators,onCompleted:t.expressionOptions.onCompleted,onEditing:t.expressionOptions.onEditing,onError:t.expressionOptions.onError,language:t.expressionOptions.language,operandHolder:t.expressionOptions.operandHolder,operatorHolder:t.expressionOptions.operatorHolder,nestedExpression:t.expressionOptions.nestedExpression});u.find("span.delete-attribute").on("click",function(){var n=$(this).parent().parent().find("[data-attribute]").attr("data-attribute");t.removeAttribute($(this));r&&r(n)}).on("keydown",function(n){var i=n.keyCode||n.which||n.key,u;i==13?(n.preventDefault(),u=$(this).parent().parent().find("[data-attribute]").attr("data-attribute"),t.removeAttribute($(this)),r&&r(u)):i==32&&n.preventDefault()});n.hide();h?u.find(".attribute-expression").focus():u.find(":input").focus()}};t.openCollapsiblePanel=function(n,t,i,r,u,f){var e,l,p,a,o,h,w;r="";var v=$("<div>",{id:n,"class":"panel-group",role:"tablist","aria-multiselectable":"true"}),c=$("<div>",{"class":"card bg-"+i}),s=$("<div>",{id:n+"-panel","class":"card-header",role:"tab","aria-multiselectable":"true"}),y=i==="light"?"secondary":i;return $.each(f,function(t,i){var e,r,u,f;if(i.dropdown){var o=$("<div>",{"class":"btn-group float-right update-button"}),r=$("<button>",{"class":"btn btn-"+y+" dropdown-toggle",title:i.label,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}),u=$("<span>",{"class":"button-label"});u.append(i.label);r.append(u);f=$("<span>",{"class":"fa "+i.icon});r.append(" ");r.append(f);e=$("<ul>",{"class":"dropdown-menu"});$.each(i.dropdown,function(t,i){var u=$("<li>"),r=$("<a>",{"class":i.class,title:i.label});r.append(i.label);r.attr("data-parent","#"+n);u.append(r);e.append(u)});o.append(r,e);s.append(o)}else r=$("<button>",{"class":"btn btn-"+y+" float-right update-button "+i.class,title:i.label}),r.attr("data-parent","#"+n),u=$("<span>",{"class":"button-label"}),u.append(i.label),r.append(u),f=$("<span>",{"class":"fa "+i.icon}),r.append(" "),r.append(f),s.append(r)}),i==="primary"&&(e=$("<button>",{"class":"btn btn-"+i+" float-right expand-all toggle-collapse-all",title:Translator.trans("Expand all")}),e.attr("data-parent","#"+n),l=$("<span>",{"class":"button-label"}),l.append(Translator.trans("Expand all")),e.append(l),p=$("<span>",{"class":"far fa-caret-square-right"}),e.append(" "),e.append(p),s.append(e)),a=$("<h4>",{"class":"card-title"}),o=$("<a>",{"data-toggle":"collapse","aria-expanded":"true"}),o.attr("data-parent","#"+n),o.attr("href","#collapse"+n),o.attr("aria-controls","collapse"+n),o.append(t),a.append(o),s.append(a),c.append(s),h=$("<div>",{"class":"panel-collapse collapse "+r,role:"tabpanel"}),h.attr("id","collapse"+n),h.attr("aria-labelledby",n+"-panel"),w=$("<div>",{"class":"card-body "+u}),h.append(w),c.append(h),v.append(c),v};t.showErrors=function(n,t){t&&$(".alert .error-message").text(t);var i=$(".alert ul");i.empty();$.each(n,function(n,t){i.append("<li>"+t+"<\/li>")});$(".alert").show()};t.hideErrors=function(){$(".alert .error-message").empty();$(".alert ul").empty();$(".alert").hide()};t.toast=function(){var n=$("<div>",{"class":"toast"});$.each(arguments,function(t,i){n.append($("<p>",{text:i}))});n.css({display:"block",opacity:.9,position:"fixed",padding:"7px","text-align":"center",width:"270px",left:($(window).width()-284)/2,top:$(window).height()/2}).appendTo("body").delay(1500).fadeOut(400,function(){$(this).remove()})};t.checkSimulatorOptions=function(n){var t=$.trim($("#simulator-name").val()),i;return t===""?(n.find(".error-message").text(Translator.trans("The simulator name is required")),n.find(".alert").show(),!1):/^[\w\-]+$/.test(t)?($("input[name='clone']").length>0||$("input[name='create']").length>0)&&(i=[],$("#simulators ul.nav li.nav-item a").each(function(){i.push($(this).attr("href").replace(/^.*\/([^\/]+)$/,"$1"))}),i.indexOf(t)>=0)?(n.find(".error-message").text(Translator.trans("The simulator « %simulator% » already exists.",{simulator:t})),n.find(".alert").show(),!1):t=="all"?(n.find(".error-message").text(Translator.trans("The name of the simulator can't be 'all'")),n.find(".alert").show(),!1):$.trim($("#simulator-label").val())===""?(n.find(".error-message").text(Translator.trans("The simulator label is required")),n.find(".alert").show(),!1):$("#simulator-groupingSeparator").val()===$("#simulator-decimalPoint").val()?(n.find(".error-message").text(Translator.trans("The simulator grouping separator and the decimal point can't be the same")),n.find(".alert").show(),!1):$("#simulator-groupingSize").val()===""?(n.find(".error-message").text(Translator.trans("The simulator grouping size is required")),n.find(".alert").show(),!1):$.trim($("#simulator-timezone").val())===""?(n.find(".error-message").text(Translator.trans("The simulator time zone is required")),n.find(".alert").show(),!1):!0:(n.find(".error-message").text(Translator.trans("Incorrect simulator name")),n.find(".alert").show(),!1)};t.bindSimulatorButtons=function(){$("#sources-panel").find("> button.add-source").on("click",function(n){n.preventDefault();t.addSource($($(this).attr("data-parent")))});$("#datas-panel").find("> button.add-datagroup, > div > ul li a.add-datagroup").on("click",function(n){n.preventDefault();t.addDatagroup($($(this).attr("data-parent")))});$("#datas-panel").find("> button.add-data, > div > ul li a.add-data").on("click",function(n){n.preventDefault();t.addData($($(this).attr("data-parent")))});$("#steps-panel").find("> button.add-step").on("click",function(n){n.preventDefault();t.addStep($($(this).attr("data-parent")))});$("#businessrules-panel").find("> button.add-rule").on("click",function(n){n.preventDefault();t.addRule($($(this).attr("data-parent")))});$("#profiles-panel").find("> button.add-profile").on("click",function(n){n.preventDefault();t.addProfile($($(this).attr("data-parent")))})};t.bindSimulatorOptions=function(n){n.find("textarea").wysihtml(Admin.wysihtml5Options);n.find(".sortable").sortable({cursor:"move",axis:"y"});$("#simulator-locale").on("change",function(){t.getRegionalSettings($(this).val(),function(n){if(n){$("#simulator-dateFormat").val(n.date_input_format);$("#simulator-decimalPoint").val(n.currency_decimal_point);$("#simulator-moneySymbol").val(n.currency_symbol);$("#simulator-groupingSeparator").val(n.currency_grouping_separator);$("#simulator-groupingSize").val(n.currency_grouping_size);var t=$("#simulator-timezone").val();$("#simulator-timezone").find("option").remove();$.each(n.date_timezones,function(i){var r=$("<option>",{value:i,text:i});(i==t||i==n.date_timezone)&&r.attr("selected",!0);$("#simulator-timezone").append(r)});$("#simulator-symbolPosition").val(n.currency_symbol_position)}})});n.find(".validate-edit-simulator").on("click",function(){t.checkSimulatorOptions(n)&&(n.find(".alert").hide(),$("#simulator-attributes-panel-holder").find("p[data-attribute='name']").attr("data-value",$("#simulator-name").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='name']").text($("#simulator-name").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='label']").attr("data-value",$("#simulator-label").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='label']").text($("#simulator-label").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='category']").attr("data-value",$("#simulator-category").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='category']").text($("#simulator-category").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='referer']").attr("data-value",$("#simulator-referer").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='referer']").text($("#simulator-referer").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='locale']").attr("data-value",$("#simulator-locale").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='locale']").text($("#simulator-locale option:selected").text()),$("#simulator-attributes-panel-holder").find("p[data-attribute='defaultView']").attr("data-value",$("#simulator-defaultView").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='defaultView']").text($("#simulator-defaultView").val()),$("#simulator-options-panel.card-header h4.card-title").text($("#simulator-label").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='dateFormat']").attr("data-value",$("#simulator-dateFormat").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='dateFormat']").text($("#simulator-dateFormat option:selected").text()),$("#simulator-attributes-panel-holder").find("p[data-attribute='timezone']").attr("data-value",$("#simulator-timezone").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='timezone']").text($("#simulator-timezone").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='decimalPoint']").attr("data-value",$("#simulator-decimalPoint").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='decimalPoint']").text($("#simulator-decimalPoint option:selected").text()),$("#simulator-attributes-panel-holder").find("p[data-attribute='groupingSeparator']").attr("data-value",$("#simulator-groupingSeparator").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='groupingSeparator']").text($("#simulator-groupingSeparator option:selected").text()),$("#simulator-attributes-panel-holder").find("p[data-attribute='groupingSize']").attr("data-value",$("#simulator-groupingSize").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='groupingSize']").text($("#simulator-groupingSize").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='moneySymbol']").attr("data-value",$("#simulator-moneySymbol").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='moneySymbol']").text($("#simulator-moneySymbol option:selected").text()),$("#simulator-attributes-panel-holder").find("p[data-attribute='symbolPosition']").attr("data-value",$("#simulator-symbolPosition").val()),$("#simulator-attributes-panel-holder").find("p[data-attribute='symbolPosition']").text($("#simulator-symbolPosition option:selected").text()),$("#simulator-dynamic").is(":checked")?($("#simulator-attributes-panel-holder").find("p[data-attribute='dynamic']").attr("data-value","1"),$("#simulator-attributes-panel-holder").find("p[data-attribute='dynamic']").text(Translator.trans("Yes"))):($("#simulator-attributes-panel-holder").find("p[data-attribute='dynamic']").attr("data-value","0"),$("#simulator-attributes-panel-holder").find("p[data-attribute='dynamic']").text(Translator.trans("No"))),$("#simulator-memo").is(":checked")?($("#simulator-attributes-panel-holder").find("p[data-attribute='memo']").attr("data-value","1"),$("#simulator-attributes-panel-holder").find("p[data-attribute='memo']").text(Translator.trans("Yes"))):($("#simulator-attributes-panel-holder").find("p[data-attribute='memo']").attr("data-value","0"),$("#simulator-attributes-panel-holder").find("p[data-attribute='memo']").text(Translator.trans("No"))),$("#simulator-description-panel-holder").find(".simulator-description").html(Admin.clearHTML($("#simulator-description"))),$("#simulator-description-panel-holder").find(".simulator-description").attr("data-edition","wysihtml"),$("#simulator-related-informations-panel-holder").find(".simulator-related-informations").html(Admin.clearHTML($("#simulator-related-informations"))),$("#simulator-related-informations-panel-holder").find(".simulator-related-informations").attr("data-edition","wysihtml"),$("#simulator-attributes-panel").remove(),$("#simulator-description-panel").remove(),$("#simulator-related-informations-panel").remove(),$("#simulator-buttons-panel").remove(),$("#simulator-attributes-panel-holder").show(),$("#simulator-description-panel-holder").show(),$("#simulator-related-informations-panel-holder").show(),t.setRegionalSettings(),Admin.updated=!0,$(".update-button").show(),$(".toggle-collapse-all").show(),t.updating=!1)});n.find(".cancel-edit-simulator").on("click",function(){$("#simulator-attributes-panel").remove();$("#simulator-description-panel").remove();$("#simulator-related-informations-panel").remove();$("#simulator-buttons-panel").remove();$("#simulator-attributes-panel-holder").show();$("#simulator-description-panel-holder").show();$("#simulator-related-informations-panel-holder").show();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();t.updating=!1});t.bindOptionalAttributes(n);$("#simulator-locale").trigger("change")};t.bindOptionalAttributes=function(n,i,r){n.find(".delete-attribute").on("click",function(){var n=$(this).parent().parent().find("[data-attribute]").attr("data-attribute");t.removeAttribute($(this));r&&r(n)}).on("keydown",function(n){var i=n.keyCode||n.which||n.key,u;i==13?(n.preventDefault(),u=$(this).parent().parent().find("[data-attribute]").attr("data-attribute"),t.removeAttribute($(this)),r&&r(u)):i==32&&n.preventDefault()});n.find(".optional-attributes li").each(function(){var n=$(this);n.draggable({cursor:"move",revert:!0,containment:n.closest(".attributes-container"),drag:function(n,t){t.helper.css("border","1px solid lightblue")},stop:function(n,t){t.helper.css("border","none")}})});n.find(".optional-attributes li").on("dblclick",function(){t.dropAttribute($(this),$(this).parents(".attributes-container").children("div:first-child"),r);i&&i($(this))});n.find(".optional-attributes li").on("keydown",function(n){var e=n.keyCode||n.which||n.key,u,f;switch(e){case 13:n.preventDefault();n.stopPropagation();t.dropAttribute($(this),$(this).parents(".attributes-container").children("div:first-child"),r);i&&i($(this));break;case 35:n.preventDefault();$(this).parent().children(":visible").last().focus();break;case 36:n.preventDefault();$(this).parent().children(":visible").first().focus();break;case 38:for(n.preventDefault(),u=$(this).prev();u.length>0&&!u.is(":visible");)u=u.prev();u.length==0&&(u=$(this).parent().children(":visible").last());u.focus();break;case 40:for(n.preventDefault(),f=$(this).next();f.length>0&&!f.is(":visible");)f=f.next();f.length==0&&(f=$(this).parent().children(":visible").first());f.focus()}});n.find(".attributes-container > div:first-child").droppable({accept:".optional-attributes li",drop:function(n,u){var f=u.draggable.parents(".attributes-container").children("div:first-child");t.dropAttribute(u.draggable,f,r);i&&i(u.draggable)}})};t.getRegionalSettings=function(n,t){var i=$(location).attr("pathname").replace(/\/simulators.+$/,"")+"/regional-settings/"+n;$.get(i,function(n){t(n)},"json").fail(function(){t(!1)})};t.drawSimulatorOptionsForInput=function(n){var w=$('<div class="card bg-light" id="simulator-attributes-panel"><\/div>'),b=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container droppable"><\/div>'),i=$("<div><\/div>"),c,e,u,l,a,o,v,s,y,p,f,r;return i.append(t.simpleAttributeForInput("simulator-name","text","name",Translator.trans("Name"),n.name,!0,Translator.trans("Simulator name without spaces or special characters"))),i.append(t.simpleAttributeForInput("simulator-label","text","label",Translator.trans("Label"),n.label,!0,Translator.trans("Simulator label"))),i.append(t.simpleAttributeForInput("simulator-category","text","category",Translator.trans("Category"),n.category,!0,Translator.trans("Simulator category"))),i.append(t.simpleAttributeForInput("simulator-defaultView","select","defaultView",Translator.trans("Default view"),n.defaultView,!0,Translator.trans("Default view"),JSON.stringify(views))),i.append(t.simpleAttributeForInput("simulator-referer","text","referer",Translator.trans("Main referer"),n.referer,!1,Translator.trans("referer URL"))),i.append(t.simpleAttributeForInput("simulator-locale","select","locale",Translator.trans("Locale"),n.locale,!0,Translator.trans("Locale"),JSON.stringify(languages))),i.append(t.simpleAttributeForInput("simulator-dateFormat","select","dateFormat",Translator.trans("Date format"),n.dateFormat,!0,Translator.trans("Select a format"),JSON.stringify(t.dateFormats))),c={},c[n.timezone]=n.timezone,i.append(t.simpleAttributeForInput("simulator-timezone","select","timezone",Translator.trans("Time zone"),n.timezone,!0,Translator.trans("Time zone"),JSON.stringify(c))),i.append(t.simpleAttributeForInput("simulator-decimalPoint","select","decimalPoint",Translator.trans("Decimal point"),n.decimalPoint,!0,Translator.trans("Decimal point"),JSON.stringify(t.decimalPoints))),i.append(t.simpleAttributeForInput("simulator-groupingSeparator","select","groupingSeparator",Translator.trans("Grouping separator"),n.groupingSeparator,!0,Translator.trans("Grouping separator"),JSON.stringify(t.groupingSeparators))),i.append(t.simpleAttributeForInput("simulator-groupingSize","number","groupingSize",Translator.trans("Grouping size"),n.groupingSeparator,!0,Translator.trans("Grouping size"))),i.append(t.simpleAttributeForInput("simulator-moneySymbol","select","moneySymbol",Translator.trans("Currency symbol"),n.moneySymbol,!0,Translator.trans("Select a symbol"),JSON.stringify(t.moneySymbols))),i.append(t.simpleAttributeForInput("simulator-symbolPosition","select","symbolPosition",Translator.trans("Symbol position"),n.symbolPosition,!0,Translator.trans("Select a position"),JSON.stringify({before:Translator.trans("before currency"),after:Translator.trans("after currency")}))),n.dynamic==1&&i.append(t.simpleAttributeForInput("simulator-dynamic","checkbox","dynamic",Translator.trans("Interactive UI"),n.dynamic,!1,"dynamic")),n.memo==1&&i.append(t.simpleAttributeForInput("simulator-memo","checkbox","memo",Translator.trans("Data memo ?"),n.memo,!1,"memo")),h.append(i),e=$('<div class="optional-attributes card bg-light"><\/div>'),e.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),u=$('<ul class="list-group"><\/ul>'),u.append('<li class="list-group-item" tabindex="0" data-element="simulator" data-type="text" data-name="referer" data-placeholder="'+Translator.trans("Main referer value")+'">'+Translator.trans("Main referer")+"<\/li>"),l=$('<li class="list-group-item" tabindex="0" data-element="simulator" data-type="checkbox" data-name="dynamic" data-placeholder="">'+Translator.trans("Interactive UI")+"<\/li>"),u.append(l),n.dynamic==1&&l.hide(),a=$('<li class="list-group-item" tabindex="0" data-element="simulator" data-type="checkbox" data-name="memo" data-placeholder="">'+Translator.trans("Data memo ?")+"<\/li>"),u.append(a),n.memo==1&&a.hide(),e.append(u),h.append(e),b.append(h),w.append(b),o=$('<div class="card bg-light" id="simulator-description-panel"><\/div>'),o.append('<div class="card-header">'+Translator.trans("Description")+"<\/div>"),v=$('<div class="card-body simulator-description rich-text"><\/div>'),v.append('<textarea rows="10" name="simulator-description" id="simulator-description" wrap="hard" class="form-control">'+t.paragraphs(n.description).content+"<\/textarea>"),o.append(v),s=$('<div class="card bg-light" id="simulator-related-informations-panel"><\/div>'),s.append('<div class="card-header">'+Translator.trans("Related informations")+"<\/div>"),y=$('<div class="card-body simulator-related-informations"><\/div>'),y.append('<textarea rows="10" name="simulator-related-informations" id="simulator-related-informations" wrap="hard" class="form-control">'+t.paragraphs(n.relatedInformations).content+"<\/textarea>"),s.append(y),p=$('<div class="card bg-light" id="simulator-buttons-panel"><\/div>'),f=$('<div class="card-body simulator-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-simulator">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-simulator">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),p.append(f),r=$('<div class="card-body"><\/div>'),r.append(w),r.append(o),r.append(s),r.append(p),r};n.Simulators=t})(this);$(function(){if($("#page-simulators").length){$(Simulators.init);$("button.edit-simulator").on("click",function(){var n=$("#simulator-attributes-panel-holder"),t=$("#simulator-description-panel-holder"),i=$("#simulator-related-informations-panel-holder"),u={name:n.find("p[data-attribute='name']").attr("data-value"),label:n.find("p[data-attribute='label']").attr("data-value"),category:n.find("p[data-attribute='category']").attr("data-value"),defaultView:n.find("p[data-attribute='defaultView']").attr("data-value"),referer:n.find("p[data-attribute='referer']").attr("data-value"),locale:n.find("p[data-attribute='locale']").attr("data-value"),dateFormat:n.find("p[data-attribute='dateFormat']").attr("data-value"),timezone:n.find("p[data-attribute='timezone']").attr("data-value"),decimalPoint:n.find("p[data-attribute='decimalPoint']").attr("data-value"),groupingSeparator:n.find("p[data-attribute='groupingSeparator']").attr("data-value"),groupingSize:n.find("p[data-attribute='groupingSize']").attr("data-value"),moneySymbol:n.find("p[data-attribute='moneySymbol']").attr("data-value"),symbolPosition:n.find("p[data-attribute='symbolPosition']").attr("data-value"),dynamic:n.find("p[data-attribute='dynamic']").attr("data-value"),memo:n.find("p[data-attribute='memo']").attr("data-value"),description:{content:t.find(".simulator-description").html(),edition:t.find(".simulator-description").attr("data-edition")},relatedInformations:{content:i.find(".simulator-related-informations").html(),edition:i.find(".simulator-related-informations").attr("data-edition")}},r;n.hide();t.hide();i.hide();t.after(Simulators.drawSimulatorOptionsForInput(u).children());r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,local:categories});$("#simulator-category").typeahead({minLength:0,hint:!0,highlight:!0},{name:"categories-list",source:function(n,t,i){n===""?t(categories):r.search(n,t,i)}});$("#simulator-groupingSize").attr("min","2");$("#simulator-groupingSize").attr("max","4");t.after(i);Simulators.bindSimulatorOptions(n.parent());$(".update-button").hide();$(".toggle-collapse-all").hide();Simulators.updating=!0});$("label.tree-toggler").click(function(){$(this).parent().toggleClass("closed");$(this).parent().hasClass("closed")?$(this).attr("aria-expanded","false"):$(this).attr("aria-expanded","true")});Simulators.bindSimulatorButtons();Simulators.bindProfileDataButtons();Simulators.bindProfileButtons();Simulators.bindRuleButtons();Simulators.bindDataButtons();Simulators.bindDatagroupButtons();Simulators.bindSourceButtons();Simulators.bindFieldButtons();Simulators.bindFieldRowButtons();Simulators.bindFieldSetColumnButtons();Simulators.bindSectionButtons();Simulators.bindChapterButtons();Simulators.bindBlockInfoButtons();Simulators.bindFieldSetButtons();Simulators.bindPanelButtons();Simulators.bindFootNotesButtons();Simulators.bindFootNoteButtons();Simulators.bindActionButtonButtons();Simulators.bindStepButtons();Simulators.bindSortableSources();Simulators.bindSortableDatas();Simulators.bindSortableSteps();Simulators.bindSortableFootNotes();Simulators.bindSortableActionButtons();Simulators.bindSortablePanels();Simulators.bindSortableBlocks();Simulators.bindSortableFieldRows();Simulators.bindSortableFieldSetColumns();Simulators.bindSortableFields();Simulators.bindSortableChapters();Simulators.bindSortableSections();Simulators.bindSortableRules();Simulators.bindSortableProfileDatas();Simulators.bindSortableProfiles();$("#page-simulators textarea").wysihtml(Admin.wysihtml5Options);$("#collapsedatas .choices-panel").each(function(){$(this).find(".choice-source-container").length>0&&$(this).find(".choice-container").hide()});Simulators.bindOptionalAttributes($("#page-simulators"));$("#page button.save-simulator").on("click",function(){var n={name:$("#simulator-attributes-panel-holder").find("p[data-attribute='name']").attr("data-value"),label:$("#simulator-attributes-panel-holder").find("p[data-attribute='label']").attr("data-value"),category:$("#simulator-attributes-panel-holder").find("p[data-attribute='category']").attr("data-value"),defaultView:$("#simulator-attributes-panel-holder").find("p[data-attribute='defaultView']").attr("data-value"),referer:$("#simulator-attributes-panel-holder").find("p[data-attribute='referer']").attr("data-value"),locale:$("#simulator-attributes-panel-holder").find("p[data-attribute='locale']").attr("data-value"),dateFormat:$("#simulator-attributes-panel-holder").find("p[data-attribute='dateFormat']").attr("data-value"),timezone:$("#simulator-attributes-panel-holder").find("p[data-attribute='timezone']").attr("data-value"),decimalPoint:$("#simulator-attributes-panel-holder").find("p[data-attribute='decimalPoint']").attr("data-value"),groupingSeparator:$("#simulator-attributes-panel-holder").find("p[data-attribute='groupingSeparator']").attr("data-value"),groupingSize:$("#simulator-attributes-panel-holder").find("p[data-attribute='groupingSize']").attr("data-value"),moneySymbol:$("#simulator-attributes-panel-holder").find("p[data-attribute='moneySymbol']").attr("data-value"),symbolPosition:$("#simulator-attributes-panel-holder").find("p[data-attribute='symbolPosition']").attr("data-value"),dynamic:$("#simulator-attributes-panel-holder").find("p[data-attribute='dynamic']").attr("data-value"),memo:$("#simulator-attributes-panel-holder").find("p[data-attribute='memo']").attr("data-value"),description:{content:$("#simulator-description-panel-holder").find(".simulator-description").html(),edition:$("#simulator-description-panel-holder").find(".simulator-description").attr("data-edition")},relatedInformations:{content:$("#simulator-related-informations-panel-holder").find(".simulator-related-informations").html(),edition:$("#simulator-related-informations-panel-holder").find(".simulator-related-informations").attr("data-edition")}};$("input[name=simulator]").val(JSON.stringify(n));$("input[name=sources]").val(JSON.stringify(Simulators.collectSources()));$("input[name=datas]").val(JSON.stringify(Simulators.collectDatas()));$("input[name=steps]").val(JSON.stringify(Simulators.collectSteps()));$("input[name=rules]").val(JSON.stringify(Simulators.collectRules()));$("input[name=profiles]").val(JSON.stringify(Simulators.collectProfiles()));Admin.updated=!1;$("#save-form").submit()});$(".panel-collapse").on("hidden.bs.collapse",function(){var n=$(this).parent().find("button.toggle-collapse-all");n.html(Translator.trans("Expand all")+' <span class="far fa-caret-square-right"><\/span>');n.addClass("expand-all").removeClass("collapse-all")});$(".panel-collapse").on("shown.bs.collapse",function(){var n=$(this).parent().find("button.toggle-collapse-all");n.html(Translator.trans("Collapse all")+' <span class="far fa-caret-square-up"><\/span>');n.addClass("collapse-all").removeClass("expand-all")});$(".panel-collapse").on("hide.bs.collapse show.bs.collapse",function(){return Simulators.updating&&Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),!Simulators.updating});$("button.toggle-collapse-all").on("click",function(){if(Simulators.updating)return Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans('first click "Cancel" or "Validate"')),!1;$(this).hasClass("expand-all")?($(this).parent().find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).hasClass("in")===!1&&$(n).collapse("show")}),$(this).html(Translator.trans("Collapse all")+' <span class="far fa-caret-square-up"><\/span>'),$(this).addClass("collapse-all").removeClass("expand-all")):$(this).hasClass("collapse-all")&&($(this).parent().find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("hide")}),$(this).html(Translator.trans("Expand all")+' <span class="far fa-caret-square-right"><\/span>'),$(this).addClass("expand-all").removeClass("collapse-all"))});if(($("#save-form input[name='create']").length||$("#save-form input[name='clone']").length)&&($("#simulator button.edit-simulator").trigger("click"),$("#simulator-name").val("")),$("#simulator-import-form").length){$("#simulator-import-form").find("input, textarea").on("change propertychange",function(){Admin.updated=!0});$("#simulator-import-form input[name='simulator-file'], #simulator-import-form input[name='simulator-stylesheet']").on("change",function(n){Simulators.hideErrors();var r=n.target.files,i=$(this),t=new FileReader;t.onload=function(n){i.data("content",n.target.result)};t.onerror=function(n){i.data("error",n.target.error.name)};t.readAsText(r[0],"UTF-8")});$("#btnDoImportSimulator").on("click",function(n){var u,i,s,f,h,e,c;n.preventDefault();var t=[],o=$("#simulator-import-form input[name='simulator-file']"),r=o.val();return(r==""?t.push(Translator.trans("Please, choose a simulator file")):/\.xml$/.test(r)||t.push(Translator.trans("The file extension of the simulator file must be '.xml'")),u=$("#simulator-import-form input[name='simulator-stylesheet']"),i=u.val(),i==""||/\.css$/.test(i)||t.push(Translator.trans("The file extension of the stylesheet must be '.css'")),s=$("#simulator-import-form input[name='simulator-pdfform']"),f=s.val(),f==""||/\.pdf$/.test(f)||t.push(Translator.trans("The file extension of the PDF Form must be '.pdf'")),h=$("#simulator-import-form input[name='simulator-pdfinfo']"),e=h.val(),e==""||/\.info$/.test(e)||t.push(Translator.trans("The file extension of the PDF Form infos must be '.info'")),t.length>0)?(Simulators.showErrors(t),!1):i!=""&&(c=u.data("content"),typeof CSSLint!="undefined"&&(results=CSSLint.verify(c,{}),messages=results.messages,$.each(results.messages,function(n,r){r.type=="error"&&t.push(i+" => Line "+r.line+" Column "+r.col+" : "+r.message)})),t.length>0)?(Simulators.showErrors(t,Translator.trans("CSS Validation errors")+" : "),!1):($.post("../../validate",{xml:o.data("content")},function(n){n.status=="Error"&&$.each(n.errors,function(n,i){t.push(r+" => "+i)})},"json").fail(function(){t.push(Translator.trans("XML Validation against schema fail"));Simulators.showErrors(t)}).done(function(){if(t.length>0)Simulators.showErrors(t,Translator.trans("XML Validation errors")+" : ");else return Simulators.hideErrors(),Admin.updated=!1,$("#simulator-import-form").submit(),!0}),!1)})}}}),function(){"use strict";Simulators.dataBackup=null;Simulators.datagroupBackup=null;Simulators.dataChoicesBackup=null;Simulators.dataset={};Simulators.datagroups={};Simulators.collectDataset=function(){$("#datas .data-container").each(function(){var i,t,n,r;$(this).hasClass("datagroup")?(n=$(this).find(".attributes-container p[data-attribute='name']").attr("data-value"),i={id:$(this).attr("data-id"),label:$(this).find(".attributes-container p[data-attribute='label']").attr("data-value"),description:{content:$(this).parent().find(".datagroup-description").html(),edition:$(this).parent().find(".datagroup-description").attr("data-edition")}},Simulators.datagroups[n]=i,$(this).parent().find(".datagroup-data-container").each(function(){var n=[],r,t;$(this).parent().find(".choice-container").each(function(){n.push({id:$(this).attr("data-id"),name:$(this).find("p[data-attribute='value']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value")})});r=$(this).find("p[data-attribute='name']").attr("data-value");t={id:parseInt($(this).attr("data-id")),datagroup:i.id,label:$(this).find("p[data-attribute='label']").attr("data-value"),type:$(this).find("p[data-attribute='type']").attr("data-value"),description:{content:$(this).parent().find(".data-description").html(),edition:$(this).parent().find(".data-description").attr("data-edition")}};n.length>0&&(t.options=n);Simulators.dataset[r]=t})):(t=[],$(this).parent().find(".choice-container").each(function(){t.push({id:$(this).attr("data-id"),name:$(this).find("p[data-attribute='value']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value")})}),n=$(this).find("p[data-attribute='name']").attr("data-value"),r={id:$(this).attr("data-id"),datagroup:"",label:$(this).find("p[data-attribute='label']").attr("data-value"),type:$(this).find("p[data-attribute='type']").attr("data-value"),description:{content:$(this).parent().find(".data-description").html(),edition:$(this).parent().find(".data-description").attr("data-edition")}},t.length>0&&(r.options=t),Simulators.dataset[n]=r)});Simulators.dataset.script={id:2e4,label:Translator.trans("Script"),type:"choice",options:[{label:Translator.trans("Disabled"),name:0},{label:Translator.trans("Enabled"),name:1}]};Simulators.dataset.dynamic={id:20001,label:Translator.trans("Interactive UI"),type:"choice",options:[{label:Translator.trans("No"),name:0},{label:Translator.trans("Yes"),name:1}]};$("#steps .step-container").each(function(){Simulators.addStepToDataset($(this).attr("data-id"))})};Simulators.addStepToDataset=function(n){Simulators.dataset["step"+n+".dynamic"]={id:1e4+parseInt(n),label:Translator.trans("Is step %id% interactive ?",{id:n}),type:"choice",options:[{label:Translator.trans("No"),name:0},{label:Translator.trans("Yes"),name:1}]}};Simulators.deleteStepInDataset=function(n){delete Simulators.dataset["step"+n+".dynamic"]};Simulators.findDatagroupById=function(n){var t=null;return $.each(Simulators.datagroups,function(i,r){if(r.id==n)return t=r,!1}),t};Simulators.findDatagroupNameById=function(n){var t=null;return $.each(Simulators.datagroups,function(i,r){if(r.id==n)return t=i,!1}),t};Simulators.findDataById=function(n){var t=null;return $.each(Simulators.dataset,function(i,r){if(r.id==n)return t=r,!1}),t};Simulators.findDataNameById=function(n){var t=null;return $.each(Simulators.dataset,function(i,r){if(r.id==n)return t=i,!1}),t};Simulators.replaceByDataLabel=function(n){return n.replace(/#(\d+)/g,function(n,t){var i=Simulators.findDataById(t);return i!=null?'<data value="'+i.id+'" class="data">« '+i.label+" »<\/data>":"#"+t})};Simulators.getChoiceLabel=function(n,t){var i="";return n.options&&$.each(n.options,function(n,r){if(r.name==t)return i=r.label,!1}),i};Simulators.replaceByValueLabel=function(n,t){if(/#\d+/.test(t))return Simulators.replaceByDataLabel(t);if(n.type==="choice"){var i=Simulators.getChoiceLabel(n,t);return i!==""?"« "+i+" »":t}return t};Simulators.maxDatasetId=function(){var n=0;return $.each(Simulators.dataset,function(t,i){var r=parseInt(i.id);r>n&&!/(dynamic|script)$/.test(t)&&(n=r)}),n};Simulators.isSourceIdInDatas=function(n){var t=!1,i=$("#datas").find(".data-container");return i.each(function(){var i=$(this).find("p[data-attribute='source']");if(i.attr("data-value")==n)return t=$(this).attr("data-id"),!1}),t};Simulators.changeSourceIdInDatas=function(n,t){var i=$("#datas").find(".data-container p[data-attribute='source']");i.each(function(){$(this).attr("data-value")==n&&($(this).attr("data-value",t),$(this).html()==n&&$(this).html(t))})};Simulators.changeSourceLabelInDatas=function(n,t){var i=$("#datas").find(".data-container p[data-attribute='source']");i.each(function(){$(this).attr("data-value")==n&&$(this).html(t)})};Simulators.isDataIdInDatas=function(n){var t=!1,i=new RegExp("#("+n+"\\b|"+n+"(L))","g"),r=new RegExp('\\<data\\s+([^\\s]*\\s*)value=\\"'+n+'\\"',"g"),u=$("#datas").find(".data-container, .datagroup-data-container");return u.each(function(){var n,u;if(!$(this).hasClass("datagroup")&&((n=$(this).find("span[data-attribute]"),$.inArray(n.attr("data-attribute"),["content","default","min","max"]>-1)&&i.test(n.attr("data-value")))||(u=$(this).find(".data-description").html(),i.test(u))||r.test(u)))return t=$(this).attr("data-id"),!1}),t};Simulators.isDataIdInDatagroups=function(n){var t=!1,i=new RegExp("#("+n+"\\b|"+n+"(L))","g"),r=new RegExp('\\<data\\s+([^\\s]*\\s*)value=\\"'+n+'\\"',"g"),u=$("#datas").find(".data-container.datagroup");return u.each(function(){var n=$(this).find(".datagroup-description").html();return i.test(n)?(t=$(this).attr("data-id"),!1):r.test(n)?(t=$(this).attr("data-id"),!1):void 0}),t};Simulators.renumberDatasPass1=function(n,t){var i=t-1;return n.each(function(){var r=$(this).find(".data-container, .datagroup-data-container"),u,n,e;if(i++,r.hasClass("datagroup"))u=r.parent().find(".datas-panel > .card-body > div"),i=Simulators.renumberDatasPass1(u,i);else if(n=r.attr("data-id"),i!=n){$(this).attr("id","data-"+i);var t=new RegExp("data-"+n+"([^\\d])?","g"),f=$(this).find("> .card > .card-header").find("> h4 > a"),o=$.trim(f.text()).replace(/#\d+\s+:/," #"+i+" :");f.text(o+" ");e=$(this).find("*");e.each(function(){var n;this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(t,"data-"+i+"$1"),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(t,"data-"+i+"$1"),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(t,"data-"+i+"$1"),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(t,"data-"+i+"$1"),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(t,"data-"+i+"$1"),$(this).attr("aria-labelledby",n))});Simulators.changeDataIdInSteps(n,"X"+i);Simulators.changeDataIdInRules(n,"X"+i);Simulators.changeDataIdInProfiles(n,"X"+i);Simulators.changeDataIdInRichText(n,"X"+i);Simulators.changeDataIdInExpression(n,"X"+i)}}),i};Simulators.renumberDatasPass2=function(n,t){var i=t-1;return n.each(function(){var t=$(this).find(".data-container, .datagroup-data-container"),u,r,n;i++;t.hasClass("datagroup")?(u=t.parent().find(".datas-panel > .card-body > div"),i=Simulators.renumberDatasPass2(u,i)):(r=t.attr("data-id"),i!=r&&(t.attr("data-id",i),n=Simulators.findDataById(r),n.id=i,Simulators.changeDataIdInSteps("X"+n.id,n.id),Simulators.changeDataIdInRules("X"+n.id,n.id),Simulators.changeDataIdInProfiles("X"+n.id,n.id),Simulators.changeDataIdInRichText("X"+n.id,n.id),Simulators.changeDataIdInExpression("X"+n.id,n.id)))}),i};Simulators.renumberDatas=function(n){Simulators.renumberDatasPass1(n,1);Simulators.renumberDatasPass2(n,1)};Simulators.renumberDatagroups=function(n){var t=0;n.each(function(){var r=$(this).find(".data-container"),i,n,u;r.hasClass("datagroup")&&(i=r.attr("data-id"),t++,t!=i&&($(this).attr("id","datagroup-"+t),n=new RegExp("datagroup-"+i+"([^\\d])?","g"),u=$(this).find("*"),u.each(function(){var i;this.hasAttribute("id")&&(i=$(this).attr("id"),i=i.replace(n,"datagroup-"+t+"$1"),$(this).attr("id",i));this.hasAttribute("data-parent")&&(i=$(this).attr("data-parent"),i=i.replace(n,"datagroup-"+t+"$1"),$(this).attr("data-parent",i));this.hasAttribute("href")&&(i=$(this).attr("href"),i=i.replace(n,"datagroup-"+t+"$1"),$(this).attr("href",i));this.hasAttribute("aria-controls")&&(i=$(this).attr("aria-controls"),i=i.replace(n,"datagroup-"+t+"$1"),$(this).attr("aria-controls",i));this.hasAttribute("aria-labelledby")&&(i=$(this).attr("aria-labelledby"),i=i.replace(n,"datagroup-"+t+"$1"),$(this).attr("aria-labelledby",i))}),Simulators.changeDatagroupIdInSteps(i,"X"+t)))});t=0;n.each(function(){var i=$(this).find(".data-container"),r,n;i.hasClass("datagroup")&&(r=i.attr("data-id"),t++,t!=r&&(i.attr("data-id",t),n=Simulators.findDatagroupById(r),n.id=t,Simulators.changeDatagroupIdInSteps("X"+n.id,n.id)))})};Simulators.bindSortableDatas=function(n){n||(n=$("#page-simulators #collapsedatas"));n.find("> .sortable, .datas-panel > .sortable").sortable({cursor:"move",containment:"parent",axis:"y",sort:function(){Simulators.updating&&(Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),setTimeout(function(){n.find("> .sortable, .datas-panel > .sortable").sortable("cancel")},0))},update:function(){Simulators.updating||(Simulators.renumberDatas(n.find("> .sortable > div")),Simulators.renumberDatagroups(n.find("> .sortable > div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.bindDataButtons=function(n){n||(n=$("#collapsedatas"));n.find("button.edit-data").on("click",function(n){n.preventDefault();Simulators.editData($($(this).attr("data-parent")))});n.find("button.delete-data").on("click",function(n){n.preventDefault();Simulators.deleteData($($(this).attr("data-parent")))})};Simulators.bindOptionalDataSource=function(n){n.find("select[data-attribute=source]").on("change",function(){var e=$(this).val(),t=n.find(":input[data-attribute=index]"),i=n.find(".optional-attributes").find("li[data-name=index]"),o=$("#collapsesources").find(".source-container[data-id="+e+"]").find("p[data-attribute=returnType]"),f,r,u;o.attr("data-value")=="assocArray"?(f=$("#collapsesources").find(".source-container[data-id="+e+"]").find("span[data-attribute=column]"),r={},f.each(function(){r["'"+$(this).attr("data-alias")+"'"]=$(this).attr("data-alias")}),t.length>0&&(t.is("select")?(t.empty(),f.each(function(){t.append($("<option>",{value:"'"+$(this).attr("data-alias")+"'",text:$(this).attr("data-alias")}))})):(u=Simulators.simpleAttributeForInput(t.attr("id"),"select","index","label","",!1,t.attr("placeholder"),JSON.stringify(r)),t.replaceWith(u.find("select")))),i.attr("data-type","select"),i.attr("data-options",encodeURI(JSON.stringify(r)))):(t.length>0&&(t.is("select")?(u=Simulators.simpleAttributeForInput(t.attr("id"),"text","index","label","",!1,t.attr("data-placeholder")),t.replaceWith(u.find("input"))):t.val("")),i.attr("data-type","text"),i.removeAttr("data-options"))})};Simulators.bindData=function(n){var t=$.extend(!0,{},Admin.wysihtml5Options,{toolbar:{insertFootnoteReference:!1}});n.find("textarea").wysihtml(t);n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-data").on("click",function(){n.replaceWith(Simulators.dataBackup);Simulators.dataBackup.find("button.edit-data").on("click",function(n){n.preventDefault();Simulators.editData($($(this).attr("data-parent")))});Simulators.dataBackup.find("button.delete-data").on("click",function(n){n.preventDefault();Simulators.deleteData($($(this).attr("data-parent")))});Simulators.dataChoicesBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-data").on("click",function(){n.remove();Simulators.dataChoicesBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-data, .validate-add-data").on("click",function(){var f,i,r,o,u;if(!Simulators.checkData(n))return!1;var a=n.parent(),e=n.find(".data-container"),l=e.find(".attributes-container"),t={id:e.attr("data-id"),datagroup:e.attr("data-datagroup")};if(l.find("input.simple-value, select.simple-value, span.attribute-expression").each(function(){var n;n=$(this).hasClass("attribute-expression")?$(this).expressionbuilder("val"):$(this).is(":checkbox")?$(this).is(":checked")?1:0:$(this).val();t[$(this).attr("data-attribute")]=n}),t.name&&(t.name=$.trim(t.name)),t.description={content:Admin.clearHTML(n.find(".data-description")),edition:"wysihtml"},f=Simulators.drawDataForDisplay(t),i=[],t.type=="choice"){var s=Simulators.drawChoicesForDisplay(t.id),h=s.find("> .card-body"),c=0;n.find(".choice-panel").each(function(){var n=$(this).find("input");i.push({id:++c,name:n.eq(0).val(),label:n.eq(1).val()});h.append(Simulators.drawChoiceForDisplay({id:c,value:n.eq(0).val(),label:n.eq(1).val()}))});n.find(".choice-source-container").each(function(){var n={id:"",idColumn:"",valueColumn:"",labelColumn:""};$(this).find("input.simple-value, select.simple-value").each(function(){n[$(this).attr("data-attribute")]=$(this).val()});h.append(Simulators.drawChoiceSourceForDisplay(n))});f.find(".collapse").find("> .card-body").append(s)}n.replaceWith(f);f.find("button.edit-data").on("click",function(n){n.preventDefault();Simulators.editData($($(this).attr("data-parent")))});f.find("button.delete-data").on("click",function(n){n.preventDefault();Simulators.deleteData($($(this).attr("data-parent")))});Simulators.dataChoicesBackup=null;$(this).hasClass("validate-edit-data")&&(r=Simulators.dataBackup.find("p[data-attribute='name']").attr("data-value"),o=Simulators.dataset[r].label,Simulators.dataset[r].options&&(u=Simulators.dataset[r].options,u.length>0&&$.each(u,function(n){n<i.length&&(u[n].label!=i[n].label&&Simulators.changeDataChoiceLabelInProfiles(t.id,u[n].name,i[n].label),u[n].name!=i[n].name&&Simulators.changeDataChoiceValueInProfiles(t.id,u[n].name,i[n].name))})),t.label!=o&&(Simulators.changeDataLabelInSteps(t.id,o,t.label),Simulators.changeDataLabelInRules(t.id,t.label),Simulators.changeDataLabelInProfiles(t.id,t.label),Simulators.changeDataLabelInSources(r,t.label)),t.name!=r&&(Simulators.changeDataNameInRules(r,t.name),Simulators.changeDataNameInSources(r,t.name),delete Simulators.dataset[r]));Simulators.dataset[t.name]={id:t.id,label:t.label,type:t.type,description:{content:t.description.content,edition:"wysihtml"}};i.length>0&&(Simulators.dataset[t.name].options=i);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;$("html, body").animate({scrollTop:f.offset().top-$("#navbar").height()},500);Simulators.updating=!1});Simulators.bindOptionalAttributes(n,function(t){t.attr("data-name")=="source"&&Simulators.bindOptionalDataSource(n)});n.find("select[data-attribute=type]").on("change",function(){var u=$(this).val(),t,f,e,i,r;u==="choice"?(Simulators.dataChoicesBackup?t=Simulators.dataChoicesBackup:(f=$(this).attr("id"),e=f.match(/^data-(\d+)-type/)[1],t=Simulators.drawChoicesForInput(e),t.find("button.delete-choice-source").removeClass("update-button").hide(),t.find(".edit-choice-source").removeClass("update-button").hide()),n.find(".description-panel").after(t),Simulators.bindChoices(t)):Simulators.dataChoicesBackup=n.find(".choices-panel").detach();i=n.find(".attributes-container");r=n.find(".optional-attributes");u==="text"||u==="textarea"?(i.find("span[data-attribute='min']").prev().find("span:last-child").text(Translator.trans("Minimum length")),i.find("span[data-attribute='max']").prev().find("span:last-child").text(Translator.trans("Maximum length")),r.find("li[data-name='min']").text(Translator.trans("Minimum length")),r.find("li[data-name='max']").text(Translator.trans("Maximum length"))):(i.find("span[data-attribute='min']").prev().find("span:last-child").text(Translator.trans("Minimum value")),i.find("span[data-attribute='max']").prev().find("span:last-child").text(Translator.trans("Maximum value")),r.find("li[data-name='min']").text(Translator.trans("Minimum value")),r.find("li[data-name='max']").text(Translator.trans("Maximum value")))});Simulators.bindOptionalDataSource(n);n.find(".attribute-expression").each(function(){var n=$(this);n.expressionbuilder({fields:Simulators.dataset,constants:Simulators.expressionOptions.constants,functions:Simulators.expressionOptions.functions,operators:Simulators.expressionOptions.operators,initial:n.attr("data-value"),onCompleted:Simulators.expressionOptions.onCompleted,onEditing:Simulators.expressionOptions.onEditing,onError:Simulators.expressionOptions.onError,language:Simulators.expressionOptions.language,operandHolder:Simulators.expressionOptions.operandHolder,operatorHolder:Simulators.expressionOptions.operatorHolder,nestedExpression:Simulators.expressionOptions.nestedExpression})})};Simulators.bindDatagroupButtons=function(n){n||(n=$("#collapsedatas"));n.find("button.edit-datagroup").on("click",function(n){n.preventDefault();Simulators.editDatagroup($($(this).attr("data-parent")))});n.find("button.delete-datagroup").on("click",function(n){n.preventDefault();Simulators.deleteDatagroup($($(this).attr("data-parent")))});n.find("button.add-data").on("click",function(n){n.preventDefault();Simulators.addData($($(this).attr("data-parent")))})};Simulators.bindDatagroup=function(n){var t=$.extend(!0,{},Admin.wysihtml5Options,{toolbar:{insertFootnoteReference:!1}});n.find("textarea").wysihtml(t);n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-datagroup").on("click",function(){n.replaceWith(Simulators.datagroupBackup);Simulators.datagroupBackup.find("button.edit-datagroup").on("click",function(n){n.preventDefault();Simulators.editDatagroup($($(this).attr("data-parent")))});Simulators.datagroupBackup.find("button.add-data").on("click",function(n){n.preventDefault();Simulators.addData($($(this).attr("data-parent")))});Simulators.datagroupBackup.find("button.delete-datagroup").on("click",function(n){n.preventDefault();Simulators.deleteDatagroup($($(this).attr("data-parent")))});Simulators.dataChoicesBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-datagroup").on("click",function(){n.remove();Simulators.dataChoicesBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-datagroup, .validate-add-datagroup").on("click",function(){var o=n.parent(),f=n.find(".data-container"),e,t,i,r,u;if(!Simulators.checkDatagroup(n))return!1;e=f.find(".attributes-container");t={id:f.attr("data-id")};e.find("input.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).is(":checkbox")?$(this).is(":checked")?1:0:$(this).val()});t.name&&(t.name=$.trim(t.name));t.description={content:Admin.clearHTML(n.find(".datagroup-description")),edition:"wysihtml"};n.find(".datagroup-description").attr("data-edition","wysihtml");i=Simulators.drawDatagroupForDisplay(t);i.find(".description-panel").after(n.find(".datas-panel"));n.replaceWith(i);$(this).hasClass("validate-edit-datagroup")&&(r=Simulators.datagroupBackup.find("p[data-attribute='name']").attr("data-value"),u=Simulators.datagroups[r].label,t.label!=u&&(Simulators.changeDatagroupLabelInSteps(t.id,u,t.label),Simulators.changeDatagroupLabelInRules(r,t.label)),t.name!=r&&(Simulators.changeDatagroupNameInRules(r,t.name),delete Simulators.datagroups[r]));Simulators.datagroups[t.name]={id:t.id,label:t.label,description:{content:t.description.content,edition:t.description.edition}};i.find("button.edit-datagroup").on("click",function(n){n.preventDefault();Simulators.editDatagroup($($(this).attr("data-parent")))});i.find("button.add-data").on("click",function(n){n.preventDefault();Simulators.addData($($(this).attr("data-parent")))});i.find("button.delete-datagroup").on("click",function(n){n.preventDefault();Simulators.deleteDatagroup($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1})};Simulators.bindChoices=function(n){n.find("button.add-choice").on("click",function(){var t=n.find("> .card-body"),r=t.children("div.card").length+1,u=n.attr("id").match(/^data-(\d+)/)[1],f={id:r,dataId:u,value:"",label:""},i=Simulators.drawChoiceForInput(f);n.find("button.add-choice-source").removeClass("update-button").hide();t.append(i);Simulators.bindChoice(i)});n.find("button.add-choice-source").on("click",function(){var i=n.find("> .card-body"),r=n.attr("id").match(/^data-(\d+)/)[1],u={id:1,dataId:r,idColumn:"",valueColumn:"",labelColumn:""},t=Simulators.drawChoiceSourceForInput(u);n.find("button.add-choice").removeClass("update-button").hide();n.find("button.add-choice-source").removeClass("update-button").hide();n.find("button.delete-choice-source").addClass("update-button").show();i.append(t);Simulators.bindChoiceSource(t)});n.find("button.delete-choice-source").on("click",function(){var t=n.find("> .card-body");t.find(".attributes-container").remove();n.find("button.add-choice").addClass("update-button").show();n.find("button.add-choice-source").addClass("update-button").show();n.find("button.delete-choice-source").removeClass("update-button").hide()})};Simulators.drawChoicesForDisplay=function(n){var t=$("<div>",{"class":"card bg-light choices-panel",id:"data-"+n+"-choices-panel"}),i;return t.append('<div class="card-header">'+Translator.trans("Choices")+"<\/div>"),i=$('<div class="card-body"><\/div>'),t.append(i),t};Simulators.drawChoicesForInput=function(n){var t=$("<div>",{"class":"card bg-light choices-panel",id:"data-"+n+"-choices-panel"}),i;return t.append('<div class="card-header"><button class="btn btn-secondary float-right update-button delete-choice-source" title="'+Translator.trans("Delete source")+'"><span class="button-label">'+Translator.trans("Delete source")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button><button class="btn btn-secondary float-right update-button add-choice-source" title="'+Translator.trans("Add source")+'"><span class="button-label">'+Translator.trans("Add source")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><button class="btn btn-secondary float-right update-button add-choice" title="'+Translator.trans("Add choice")+'"><span class="button-label">'+Translator.trans("Add choice")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button>'+Translator.trans("Choices")+"<\/div>"),i=$('<div class="card-body"><\/div>'),t.append(i),t};Simulators.bindChoice=function(n){n.find("button.delete-choice").on("click",function(){var t=n.parents(".choices-panel"),i;n.remove();t.find("> .card-body").children().length==0&&(i=t.find("> .card-header"),i.find("button.add-choice-source").addClass("update-button").show())})};Simulators.drawChoiceForDisplay=function(n){var t=$("<div>",{"class":"card bg-light choice-container","data-id":n.id});t.append('<div class="card-header">'+Translator.trans("Choice %id%",{id:n.id})+"<\/div>");var r=$("<div>",{"class":"card-body",id:"data-"+n.dataId+"-choice-"+n.id+"-panel"}),u=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>");return i.append(Simulators.simpleAttributeForDisplay("data-"+n.dataId+"-choice-"+n.id,"text","value",Translator.trans("Value"),n.value,n.value,!0,Translator.trans("Choice value"))),i.append(Simulators.simpleAttributeForDisplay("data-"+n.dataId+"-choice-"+n.id,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Choice label"))),u.append(i),r.append(u),t.append(r),t};Simulators.drawChoiceForInput=function(n){var t=$("<div>",{"class":"card bg-light choice-panel","data-id":n.id});t.append('<div class="card-header"><button class="btn btn-secondary float-right update-button delete-choice" title="'+Translator.trans("Delete")+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button>'+Translator.trans("Choice %id%",{id:n.id})+"<\/div>");var r=$("<div>",{"class":"card-body",id:"data-"+n.dataId+"-choice-"+n.id+"-panel"}),u=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>");return i.append('<div class="form-group row"><label for="data-'+n.dataId+"-choice-"+n.id+'-value" class="col-sm-4 col-form-label">'+Translator.trans("Value")+'<\/label><div class="col-sm-8 input-group"><input type="text" name="data-'+n.dataId+"-choice-"+n.id+'-value" id="data-'+n.dataId+"-choice-"+n.id+'-value" class="form-control simple-value" placeholder="'+Translator.trans("Choice value")+'"  value="'+n.value+'" /><\/div><\/div>'),i.append('<div class="form-group row"><label for="data-'+n.dataId+"-choice-"+n.id+'-label" class="col-sm-4 col-form-label">'+Translator.trans("Label")+'<\/label><div class="col-sm-8 input-group"><input type="text" name="data-'+n.dataId+"-choice-"+n.id+'-label" id="data-'+n.dataId+"-choice-"+n.id+'-label" class="form-control simple-value" placeholder="'+Translator.trans("Choice label")+'"  value="'+n.label+'" /><\/div><\/div>'),u.append(i),r.append(u),t.append(r),t};Simulators.bindChoiceSource=function(n){n.find("select[data-attribute=id]").on("change",function(){var o=$(this).val(),f=$("#collapsesources").find(".source-container[data-id="+o+"]").find("span[data-attribute=column]"),e,r,u,i,t;f.length>0?(r=n.find("select[data-attribute=valueColumn]"),r.length>0?r.empty():(t=n.find("input[data-attribute=valueColumn]"),r=$("<select>",{name:t.attr("name"),id:t.attr("id"),"data-attribute":t.attr("data-attribute"),"class":t.attr("class"),"data-placeholder":t.attr("placeholder")}),t.replaceWith(r)),f.each(function(){r.append($("<option>",{value:$(this).attr("data-alias"),text:$(this).attr("data-alias")}))}),u=n.find("select[data-attribute=labelColumn]"),u.length>0?u.empty():(t=n.find("input[data-attribute=labelColumn]"),u=$("<select>",{name:t.attr("name"),id:t.attr("id"),"data-attribute":t.attr("data-attribute"),"class":t.attr("class"),"data-placeholder":t.attr("placeholder")}),t.replaceWith(u)),f.each(function(){u.append($("<option>",{value:$(this).attr("data-alias"),text:$(this).attr("data-alias")}))}),i=n.find("select[data-attribute=idColumn]"),i.length>0?i.empty():(t=n.find("input[data-attribute=idColumn]"),i=$("<select>",{name:t.attr("name"),id:t.attr("id"),"data-attribute":t.attr("data-attribute"),"class":t.attr("class"),"data-placeholder":t.attr("placeholder")}),t.replaceWith(i)),f.each(function(){i.append($("<option>",{value:$(this).attr("data-alias"),text:$(this).attr("data-alias")}))}),i=n.find(".optional-attributes").find("li[data-name=idColumn]"),e={},f.each(function(){e[$(this).attr("data-alias")]=$(this).attr("data-alias")}),i.attr("data-type","select"),i.attr("data-options",encodeURI(JSON.stringify(e)))):(r=n.find("select[data-attribute=valueColumn]"),r.length>0&&(t=$("<input>",{type:"text",name:r.attr("name"),id:r.attr("id"),"data-attribute":r.attr("data-attribute"),"class":r.attr("class"),placeholder:r.attr("data-placeholder")}),r.replaceWith(t)),u=n.find("select[data-attribute=labelColumn]"),u.length>0&&(t=$("<input>",{type:"text",name:u.attr("name"),id:u.attr("id"),"data-attribute":u.attr("data-attribute"),"class":u.attr("class"),placeholder:u.attr("data-placeholder")}),u.replaceWith(t)),i=n.find("select[data-attribute=idColumn]"),i.length>0&&(t=$("<input>",{type:"text",name:i.attr("name"),id:i.attr("id"),"data-attribute":i.attr("data-attribute"),"class":i.attr("class"),placeholder:i.attr("data-placeholder")}),i.replaceWith(t)),i=n.find(".optional-attributes").find("li[data-name=idColumn]"),i.attr("data-type","text"),i.removeAttr("data-options"))});Simulators.bindOptionalAttributes(n)};Simulators.drawChoiceSourceForDisplay=function(n){var r={},i,t;return $("#collapsesources").find(".source-container").each(function(){r[$(this).attr("data-id")]=$(this).find("p[data-attribute=label]").attr("data-value")||Translator.trans("Source")+" "+$(this).attr("data-id")}),i=$('<div class="attributes-container choice-source-container" data-id="'+n.id+'"><\/div>'),t=$("<div><\/div>"),t.append(Simulators.simpleAttributeForDisplay("data-"+n.dataId+"-choicesource-"+n.id,"select","id",Translator.trans("Source"),n.id,n.id,!0,Translator.trans("Select a source"),JSON.stringify(r))),t.append(Simulators.simpleAttributeForDisplay("data-"+n.dataId+"-choicesource-"+n.id,"text","idColumn",Translator.trans("Source column id"),n.idColumn,n.idColumn,!1,Translator.trans("Source column id"))),t.append(Simulators.simpleAttributeForDisplay("data-"+n.dataId+"-choicesource-"+n.id,"text","valueColumn",Translator.trans("Source column value"),n.valueColumn,n.valueColumn,!0,Translator.trans("Source column value"))),t.append(Simulators.simpleAttributeForDisplay("data-"+n.dataId+"-choicesource-"+n.id,"text","labelColumn",Translator.trans("Source column label"),n.labelColumn,n.labelColumn,!0,Translator.trans("Source column label"))),i.append(t),i};Simulators.drawChoiceSourceForInput=function(n){var s={},i,r,u,t,f,e,o;return $("#collapsesources").find(".source-container").each(function(){s[$(this).attr("data-id")]=$(this).find("p[data-attribute=label]").attr("data-value")||Translator.trans("Source")+" "+$(this).attr("data-id")}),i={},r=$("#collapsesources").find(".source-container[data-id="+n.id+"]").find("span[data-attribute=column]"),r.each(function(){i[$(this).attr("data-alias")]=$(this).attr("data-alias")}),u=$('<div class="attributes-container choice-source-container" data-id="'+n.id+'"><\/div>'),t=$("<div><\/div>"),t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-id","select","id",Translator.trans("Source"),n.id,!0,Translator.trans("Select a source"),JSON.stringify(s))),r.length>0?(t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-valueColumn","select","valueColumn",Translator.trans("Source column value"),n.valueColumn,!0,Translator.trans("Source column value"),JSON.stringify(i))),t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-labelColumn","select","labelColumn",Translator.trans("Source column label"),n.labelColumn,!0,Translator.trans("Source column label"),JSON.stringify(i)))):(t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-valueColumn","text","valueColumn",Translator.trans("Source column value"),n.valueColumn,!0,Translator.trans("Source column value"))),t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-labelColumn","text","labelColumn",Translator.trans("Source column label"),n.labelColumn,!0,Translator.trans("Source column label")))),f=$('<div class="optional-attributes card bg-light"><\/div>'),f.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),e=$('<ul class="list-group"><\/ul>'),o=$('<li class="list-group-item" tabindex="0" data-element="data-'+n.dataId+"-choicesource-"+n.id+'" data-type="select" data-name="idColumn" data-placeholder="'+Translator.trans("Source column id value")+'" data-options="'+encodeURI(JSON.stringify(i))+'">'+Translator.trans("Source column id")+"<\/li>"),e.append(o),f.append(e),n.idColumn&&(r.length>0?t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-idColumn","select","idColumn",Translator.trans("Source column id"),n.idColumn,!1,Translator.trans("Source column id"),JSON.stringify(i))):t.append(Simulators.simpleAttributeForInput("data-"+n.dataId+"-choicesource-"+n.id+"-idColumn","text","idColumn",Translator.trans("Source column id"),n.idColumn,!1,Translator.trans("Source column id"))),o.hide()),u.append(t),u.append(f),u};Simulators.drawDataForDisplay=function(n){var t="data-"+n.id,e=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),u=$("<div>",{"class":"card bg-info"});u.append('<div class="card-header" role="tab" id="'+t+'-panel"><button class="btn btn-info float-right update-button delete-data" title="'+Translator.trans("Delete")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button><button class="btn btn-info float-right update-button edit-data" title="'+Translator.trans("Edit")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Edit")+'<\/span> <span class="fas fa-pencil-alt"><\/span><\/button><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" : "+n.label+"<\/a><\/h4><\/div>");var o=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),f=$('<div class="card-body"><\/div>'),r=$('<div class="card bg-light" id="'+t+'-attributes-panel" data-datagroup="'+n.datagroup+'" data-id="'+n.id+'"><\/div>');n.datagroup==""?r.addClass("data-container"):r.addClass("datagroup-data-container");var s=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>");return i.append(Simulators.simpleAttributeForDisplay(t,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Data name"))),i.append(Simulators.simpleAttributeForDisplay(t,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Data label"))),i.append(Simulators.simpleAttributeForDisplay(t,"select","type",Translator.trans("Type"),n.type,n.type,!0,Translator.trans("Select a data type"),JSON.stringify(Admin.types))),$.each(Simulators.optionalAttributes,function(r,u){var f,e,o;n[r]&&(r=="source"?(e=$("#collapsesources").find(".source-container[data-id="+n[r]+"]").find("p[data-attribute=label]").attr("data-value")||n[r],f=Simulators.simpleAttributeForDisplay(t,"text",r,u.label,n[r],e,!1,u.placeholder)):r=="index"?(o=$("#collapsesources").find(".source-container[data-id="+n.source+"]").find("p[data-attribute=returnType]"),f=o.attr("data-value")=="assocArray"?Simulators.simpleAttributeForDisplay(t,"text",r,u.label,n[r],n[r],!1,u.placeholder):Simulators.simpleAttributeForDisplay(t,"text",r,u.label,"'"+n[r]+"'","'"+n[r]+"'",!1,u.placeholder)):f=u.type==="expression"?r=="min"?n.type=="text"||n.type=="textarea"?Simulators.expressionAttributeForDisplay(t,r,Translator.trans("Minimum length"),n[r],Simulators.replaceByDataLabel(n[r]),!1,u.placeholder):Simulators.expressionAttributeForDisplay(t,r,Translator.trans("Minimum value"),n[r],Simulators.replaceByDataLabel(n[r]),!1,u.placeholder):r=="max"?n.type=="text"||n.type=="textarea"?Simulators.expressionAttributeForDisplay(t,r,Translator.trans("Maximum length"),n[r],Simulators.replaceByDataLabel(n[r]),!1,u.placeholder):Simulators.expressionAttributeForDisplay(t,r,Translator.trans("Maximum value"),n[r],Simulators.replaceByDataLabel(n[r]),!1,u.placeholder):Simulators.expressionAttributeForDisplay(t,r,u.label,n[r],Simulators.replaceByDataLabel(n[r]),!1,u.placeholder):Simulators.simpleAttributeForDisplay(t,u.type,r,u.label,n[r],n[r],!1,u.placeholder),i.append(f))}),h.append(i),s.append(h),r.append(s),f.append(r),f.append('<div class="card bg-light" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body data-description rich-text" data-edition="'+n.description.edition+'">'+n.description.content+"<\/div><\/div>"),o.append(f),u.append(o),e.append(u),e};Simulators.drawDataForInput=function(n){var t="data-"+n.id,v=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),o=$("<div>",{"class":"card bg-info"}),f,h,e,k,a,r;o.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" : "+n.label+"<\/a><\/h4><\/div>");var y=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),u=$('<div class="card-body"><\/div>'),p=$('<div class="card bg-light data-container" id="'+t+'-attributes-panel" data-datagroup="'+n.datagroup+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),w=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>");i.append('<div class="form-group row"><label for="'+t+'-name" class="col-sm-4 col-form-label">'+Translator.trans("Name")+'<\/label><div class="col-sm-8 input-group"><input type="text" name="'+t+'-name" id="'+t+'-name" data-attribute="name" class="form-control simple-value" placeholder="'+Translator.trans("Data name without spaces or special characters")+'" value="'+n.name+'" /><\/div><\/div>');i.append('<div class="form-group row"><label for="'+t+'-label" class="col-sm-4 col-form-label">'+Translator.trans("Label")+'<\/label><div class="col-sm-8 input-group"><input type="text" name="'+t+'-label" id="'+t+'-label" data-attribute="label" class="form-control simple-value" placeholder="'+Translator.trans("Data label")+'" value="'+n.label+'" /><\/div><\/div>');i.append(Simulators.simpleAttributeForInput(t+"-type","select","type","Type",n.type,!0,Translator.trans("Select a data type"),JSON.stringify(Admin.types)));s.append(i);f=$('<div class="optional-attributes card bg-light"><\/div>');f.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>");h=$('<ul class="list-group"><\/ul>');e={};$("#collapsesources").find(".source-container").each(function(){e[$(this).attr("data-id")]=$(this).find("p[data-attribute=label]").attr("data-value")||Translator.trans("Source")+" "+$(this).attr("data-id")});var c={},b=n.source||1,l=$("#collapsesources").find(".source-container[data-id="+b+"]").find("p[data-attribute=returnType]");return l.attr("data-value")=="assocArray"&&(k=$("#collapsesources").find(".source-container[data-id="+b+"]").find("span[data-attribute=column]"),k.each(function(){c["'"+$(this).attr("data-alias")+"'"]=$(this).attr("data-alias")})),$.each(Simulators.optionalAttributes,function(r,u){var o,f,s;o=r==="source"?$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="'+u.type+'" data-name="'+r+'" data-placeholder="'+u.placeholder+'" data-options="'+encodeURI(JSON.stringify(e))+'">'+u.label+"<\/li>"):r==="index"?l.attr("data-value")=="assocArray"?$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="'+u.type+'" data-name="'+r+'" data-placeholder="'+u.placeholder+'" data-options="'+encodeURI(JSON.stringify(c))+'">'+u.label+"<\/li>"):$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="'+r+'" data-placeholder="'+u.placeholder+'">'+u.label+"<\/li>"):u.type==="expression"?r=="min"?n.type=="text"||n.type=="textarea"?$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="'+r+'" data-expression="true" data-placeholder="'+u.placeholder+'">'+Translator.trans("Minimum length")+"<\/li>"):$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="'+r+'" data-expression="true" data-placeholder="'+u.placeholder+'">'+Translator.trans("Minimum value")+"<\/li>"):r=="max"?n.type=="text"||n.type=="textarea"?$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="'+r+'" data-expression="true" data-placeholder="'+u.placeholder+'">'+Translator.trans("Maximum length")+"<\/li>"):$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="'+r+'" data-expression="true" data-placeholder="'+u.placeholder+'">'+Translator.trans("Maximum value")+"<\/li>"):$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="'+r+'" data-expression="true" data-placeholder="'+u.placeholder+'">'+u.label+"<\/li>"):$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="'+u.type+'" data-name="'+r+'" data-placeholder="'+u.placeholder+'">'+u.label+"<\/li>");h.append(o);n[r]&&(r==="source"?f=Simulators.simpleAttributeForInput(t+"-"+r,"select",r,u.label,n[r],!1,u.placeholder,JSON.stringify(e)):r==="index"?l.attr("data-value")=="assocArray"?f=Simulators.simpleAttributeForInput(t+"-"+r,"select",r,u.label,n[r],!1,u.placeholder,JSON.stringify(c)):(s=n[r].replace(/^'/,"").replace(/'$/,""),f=Simulators.simpleAttributeForInput(t+"-"+r,"text",r,u.label,s,!1,u.placeholder)):f=u.type==="expression"?r=="min"?n.type=="text"||n.type=="textarea"?Simulators.expressionAttributeForInput(t+"-"+r,r,Translator.trans("Minimum length"),n[r],!1,u.placeholder):Simulators.expressionAttributeForInput(t+"-"+r,r,Translator.trans("Minimum value"),n[r],!1,u.placeholder):r=="max"?n.type=="text"||n.type=="textarea"?Simulators.expressionAttributeForInput(t+"-"+r,r,Translator.trans("Maximum length"),n[r],!1,u.placeholder):Simulators.expressionAttributeForInput(t+"-"+r,r,Translator.trans("Maximum value"),n[r],!1,u.placeholder):Simulators.expressionAttributeForInput(t+"-"+r,r,u.label,n[r],!1,u.placeholder):Simulators.simpleAttributeForInput(t+"-"+r,u.type,r,u.label,n[r],!1,u.placeholder),i.append(f),o.hide())}),f.append(h),s.append(f),w.append(s),p.append(w),u.append(p),u.append('<div class="card bg-light description-panel" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-description" id="'+t+'-description" wrap="hard" class="form-control data-description">'+Simulators.paragraphs(n.description).content+"<\/textarea><\/div><\/div>"),a=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),r=$('<div class="card-body data-buttons"><\/div>'),r.append('<button class="btn btn-success float-right validate-edit-data">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),r.append('<button class="btn btn-secondary float-right cancel-edit-data">'+Translator.trans("Cancel")+"<\/span><\/button>"),r.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),a.append(r),u.append(a),y.append(u),o.append(y),v.append(o),v};Simulators.drawDatagroupForDisplay=function(n){var t="datagroup-"+n.id,f=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),r=$("<div>",{"class":"card bg-success"});r.append('<div class="card-header" role="tab" id="'+t+'-panel"><button class="btn btn-success float-right update-button delete-datagroup" title="'+Translator.trans("Delete")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button><button class="btn btn-success float-right update-button add-data" title="'+Translator.trans("Add data")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Add data")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><button class="btn btn-success float-right update-button edit-datagroup" title="'+Translator.trans("Edit datagroup")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Edit datagroup")+'<\/span> <span class="fas fa-pencil-alt"><\/span><\/button><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">'+Translator.trans("Group")+" "+n.label+"<\/a><\/h4><\/div>");var e=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),i=$('<div class="card-body"><\/div>'),o=$('<div class="card bg-light data-container datagroup" id="'+t+'-attributes-panel" data-id="'+n.id+'"><\/div>'),s=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),u=$("<div><\/div>");return u.append(Simulators.simpleAttributeForDisplay(t,"text","name",Translator.trans("Group Name"),n.name,n.name,!0,Translator.trans("Group Name"))),u.append(Simulators.simpleAttributeForDisplay(t,"text","label",Translator.trans("Group Label"),n.label,n.label,!0,Translator.trans("Group Label"))),h.append(u),s.append(h),o.append(s),i.append(o),i.append('<div class="card bg-light description-panel" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body datagroup-description rich-text" data-edition="'+n.description.edition+'">'+n.description.content+"<\/div><\/div>"),i.append('<div class="card bg-light datas-panel" id="'+t+'-datas-panel"><div class="card-body sortable"><\/div><\/div>'),e.append(i),r.append(e),f.append(r),f};Simulators.drawDatagroupForInput=function(n){var t="datagroup-"+n.id,o=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),u=$("<div>",{"class":"card bg-success"}),e,i;u.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">'+Translator.trans("Group")+" "+n.label+"<\/a><\/h4><\/div>");var s=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),r=$('<div class="card-body"><\/div>'),h=$('<div class="card bg-light data-container datagroup" id="'+t+'-attributes-panel" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),c=$('<div class="card-body"><\/div>'),l=$('<div class="attributes-container"><\/div>'),f=$("<div><\/div>");return f.append('<div class="form-group row"><label for="'+t+'-name" class="col-sm-2 col-form-label">'+Translator.trans("Group Name")+'<\/label><div class="col-sm-10"><input type="text" name="'+t+'-name" id="'+t+'-name" data-attribute="name" class="form-control simple-value" placeholder="'+Translator.trans("Group name without spaces or special characters")+'" value="'+n.name+'" /><\/div><\/div>'),f.append('<div class="form-group row"><label for="'+t+'-label" class="col-sm-2 col-form-label">'+Translator.trans("Group Label")+'<\/label><div class="col-sm-10"><input type="text" name="'+t+'-label" id="'+t+'-label" data-attribute="label" class="form-control simple-value" placeholder="'+Translator.trans("Group label")+'" value="'+n.label+'" /><\/div><\/div>'),l.append(f),c.append(l),h.append(c),r.append(h),r.append('<div class="card bg-light description-panel" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-description" id="'+t+'-description" wrap="hard" class="form-control datagroup-description">'+Simulators.paragraphs(n.description).content+"<\/textarea><\/div><\/div>"),e=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),i=$('<div class="card-body datagroup-buttons"><\/div>'),i.append('<button class="btn btn-success float-right validate-edit-datagroup">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),i.append('<button class="btn btn-secondary float-right cancel-edit-datagroup">'+Translator.trans("Cancel")+"<\/span><\/button>"),i.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),e.append(i),r.append(e),s.append(r),u.append(s),o.append(u),o};Simulators.checkData=function(n){var c=n.attr("id"),t=n.find(".data-container").attr("data-id"),v=n.find(".data-container").attr("data-name"),i=$.trim($("#"+c+"-name").val()),h,o,r,u,f,e,s,l,a;if(i==="")return n.find(".error-message").text(Translator.trans("The data name is required")),n.find(".alert").show(),!1;if(!/^\w+$/.test(i))return n.find(".error-message").text(Translator.trans("Incorrect data name")),n.find(".alert").show(),!1;if(i!=v&&Simulators.dataset[i]&&Simulators.dataset[i].id!=t)return n.find(".error-message").text(Translator.trans("This data name already exists")),n.find(".alert").show(),!1;if(h=$.trim($("#"+c+"-label").val()),h==="")return n.find(".error-message").text(Translator.trans("The data label is required")),n.find(".alert").show(),!1;if(o=n.find(".data-container select[data-attribute=source]"),o.length>0&&$("#source-"+o.val()+"-source-parameters-panel").find(".source-parameter-container p[data-attribute=data][data-value='"+i+"']").length>0)return n.find(".error-message").text(Translator.trans("Circular reference between data «%data%» and source «%source%»",{data:h,source:o.find("option:selected").text()})),n.find(".alert").show(),!1;if(t=n.find(".data-container").attr("data-id"),r=n.find(".data-container span[data-attribute=default]"),r.length>0){if(!r.expressionbuilder("completed"))return n.find(".error-message").text(Translator.trans("Please, complete the input of the default value")),n.find(".alert").show(),!1;if(r.expressionbuilder("state"),!Simulators.checkDataInExpression(t,r))return n.find(".error-message").text(Translator.trans("The default value can not refer to the data itself")),n.find(".alert").show(),!1}if(u=n.find(".data-container span[data-attribute=min]"),u.length>0){if(!u.expressionbuilder("completed"))return n.find(".error-message").text(Translator.trans("Please, complete the input of min")),n.find(".alert").show(),!1;if(u.expressionbuilder("state"),!Simulators.checkDataInExpression(t,u))return n.find(".error-message").text(Translator.trans("min can not refer to the data itself")),n.find(".alert").show(),!1}if(f=n.find(".data-container span[data-attribute=max]"),f.length>0){if(!f.expressionbuilder("completed"))return n.find(".error-message").text(Translator.trans("Please, complete the input of max")),n.find(".alert").show(),!1;if(f.expressionbuilder("state"),!Simulators.checkDataInExpression(t,f))return n.find(".error-message").text(Translator.trans("max can not refer to the data itself")),n.find(".alert").show(),!1}if(e=n.find(".data-container span[data-attribute=content]"),e.length>0){if(!e.expressionbuilder("completed"))return n.find(".error-message").text(Translator.trans("Please, complete the input of Content")),n.find(".alert").show(),!1;if(e.expressionbuilder("state"),!Simulators.checkDataInExpression(t,e))return n.find(".error-message").text(Translator.trans("Content can not refer to the data itself")),n.find(".alert").show(),!1}if(s=n.find(".data-container input[data-attribute=pattern]"),s.length>0&&s.val()!=""){if(l=n.find(".data-container select[data-attribute=type]"),l.val()!="text")return n.find(".error-message").text(Translator.trans("pattern attribute only applies to data of type 'text'")),n.find(".alert").show(),!1;try{a=new RegExp(s.val());a.test("dummy")}catch(y){return n.find(".error-message").text(Translator.trans("Invalid pattern: %error%",{error:y.message})),n.find(".alert").show(),!1}}return!0};Simulators.addData=function(n){var i,r,f,t,e,u;try{$(".toggle-collapse-all").hide();$(".update-button").hide();i="";n.attr("id")!="datas"&&(r=n.find(".data-container.datagroup"),r.length>0&&(i=r.attr("data-id")));f={id:Simulators.maxDatasetId()+1,datagroup:i,name:"",label:"",description:{content:"",edition:""}};t=Simulators.drawDataForInput(f);t.find("button.cancel-edit-data").addClass("cancel-add-data").removeClass("cancel-edit-data");t.find("button.validate-edit-data").addClass("validate-add-data").removeClass("validate-edit-data");u=n.attr("id");e=u==="datas"?$("#collapsedatas").find("> div.sortable"):n.find(".datas-panel > div.sortable");e.append(t);Simulators.bindData(t);$("#collapse"+u).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(o){console&&console.log(o.message)}};Simulators.editData=function(n){var u,t,r,h,o,s;try{$(".update-button").hide();$(".toggle-collapse-all").hide();var e=n.find(".data-container, .datagroup-data-container"),f=e.find(".attributes-container"),i={id:e.attr("data-id"),datagroup:e.attr("data-datagroup"),name:f.find("p[data-attribute='name']").attr("data-value"),label:f.find("p[data-attribute='label']").attr("data-value"),type:f.find("p[data-attribute='type']").attr("data-value"),description:{content:n.find(".data-description").html(),edition:n.find(".data-description").attr("data-edition")}};$.each(Simulators.optionalAttributes,function(n){var t=f.find("p[data-attribute='"+n+"'], span[data-attribute='"+n+"']");t.length>0&&(i[n]=t.attr("data-value"))});u=Simulators.drawDataForInput(i);i.type==="choice"&&(t=Simulators.drawChoicesForInput(i.id),r=n.find("div.choice-source-container"),r.length>0?(t.find("button.delete-choice-source").addClass("update-button").show(),t.find("button.add-choice").removeClass("update-button").hide(),t.find("button.add-choice-source").removeClass("update-button").hide(),h={id:r.eq(0).attr("data-id"),dataId:i.id,valueColumn:r.eq(0).find("p[data-attribute='valueColumn']").attr("data-value"),labelColumn:r.eq(0).find("p[data-attribute='labelColumn']").attr("data-value"),idColumn:r.eq(0).find("p[data-attribute='idColumn']").attr("data-value")},o=Simulators.drawChoiceSourceForInput(h),t.find("> .card-body").append(o),Simulators.bindChoiceSource(o)):(s=n.find("div.choice-container"),s.length>0&&(t.find("button.add-choice-source").removeClass("update-button").hide(),t.find("button.delete-choice-source").removeClass("update-button").hide(),s.each(function(){var r={id:$(this).attr("data-id"),dataId:i.id,value:$(this).find("p[data-attribute='value']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value")},n=Simulators.drawChoiceForInput(r);t.find("> .card-body").append(n);Simulators.bindChoice(n)}))),u.find(".description-panel").after(t),Simulators.bindChoices(t));Simulators.dataBackup=n.replaceWith(u);Simulators.bindData(u);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:u.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(c){console&&console.log(c.message)}};Simulators.isDataDeleteable=function(n,t){var r,u,f,e,i,o;return(r=Simulators.isDataIdInDatas(n))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in data #%id%. You must modify this data before you can delete this one",{id:r})}),!1):(u=Simulators.isDataIdInDatagroups(n))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in datagroup #%id%. You must modify this datagroup before you can delete this data",{id:u})}),!1):(f=Simulators.isDataNameInSources(t))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in source #%id%. You must modify this source before you can delete this data",{id:f})}),!1):(e=Simulators.isDataIdInSteps(n))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in step #%id%. You must modify this step before you can delete this data",{id:e})}),!1):(i=Simulators.isDataIdInRules(n))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in rule #%id%. You must modify this rule before you can delete this data",{id:i})}),!1):(i=Simulators.isDataNameInRules(t))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in rule #%id%. You must modify this rule before you can delete this data",{id:i})}),!1):(o=Simulators.isDataInProfiles(n))!==!1?(bootbox.alert({title:Translator.trans("Deleting data"),message:Translator.trans("This data is used in profile #%id%. You must modify this profile before you can delete this data",{id:o})}),!1):!0};Simulators.deleteData=function(n){try{var t=n.find(".data-container, .datagroup-data-container"),u=t.attr("data-id"),i=t.find(".attributes-container"),r=i.find("p[data-attribute='name']").attr("data-value"),f=i.find("p[data-attribute='label']").attr("data-value");if(!Simulators.isDataDeleteable(u,r))return;bootbox.confirm({title:Translator.trans("Deleting data"),message:Translator.trans("Are you sure you want to delete the data : %label% ?",{label:f}),callback:function(t){t&&(delete Simulators.dataset[r],n.remove(),Simulators.renumberDatas($("#page-simulators #collapsedatas").find("> .sortable > div")),$(".save-simulator").show(),Admin.updated=!0)}})}catch(e){console&&console.log(e.message)}};Simulators.checkDatagroup=function(n){var i=n.attr("id"),r=n.find(".data-container.datagroup").attr("data-id"),u=n.find(".data-container.datagroup").attr("data-name"),t=$.trim($("#"+i+"-name").val());return t===""?(n.find(".error-message").text(Translator.trans("The datagroup name is required")),n.find(".alert").show(),!1):/^\w+$/.test(t)?t!=u&&Simulators.datagroups[t]&&Simulators.datagroups[t].id!=r?(n.find(".error-message").text(Translator.trans("This datagroup name already exists")),n.find(".alert").show(),!1):!0:(n.find(".error-message").text(Translator.trans("Incorrect datagroup name")),n.find(".alert").show(),!1)};Simulators.addDatagroup=function(){try{$(".update-button").hide();$(".toggle-collapse-all").hide();var t={id:parseInt(Simulators.maxDatasetId())+1,name:"",label:"",description:{content:"",edition:""}},n=Simulators.drawDatagroupForInput(t);n.find("button.cancel-edit-datagroup").addClass("cancel-add-datagroup").removeClass("cancel-edit-datagroup");n.find("button.validate-edit-datagroup").addClass("validate-add-datagroup").removeClass("validate-edit-datagroup");$("#collapsedatas").find("> div.sortable").append(n);Simulators.bindDatagroup(n);$("#collapsedatas").collapse("show");n.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(i){console&&console.log(i.message)}};Simulators.editDatagroup=function(n){try{$(".update-button").hide();$(".toggle-collapse-all").hide();var t=n.find(".data-container.datagroup"),r=t.find(".attributes-container"),u={id:t.attr("data-id"),name:r.find("p[data-attribute='name']").attr("data-value"),label:r.find("p[data-attribute='label']").attr("data-value"),description:{content:n.find(".datagroup-description").html(),edition:n.find(".datagroup-description").attr("data-edition")}},i=Simulators.drawDatagroupForInput(u);Simulators.datagroupBackup=n.clone();t.replaceWith(i.find(".data-container.datagroup"));n.find(".description-panel").eq(0).replaceWith(i.find(".description-panel").eq(0));n.find(".description-panel").eq(0).after(i.find(".buttons-panel"));Simulators.bindDatagroup(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(f){console&&console.log(f.message)}};Simulators.deleteDatagroup=function(n){var f,i;try{var t=n.find(".data-container.datagroup"),r=t.find(".attributes-container"),e=r.find("p[data-attribute='label']").attr("data-value"),u;if((u=Simulators.isDatagroupIdInSteps(t.attr("data-id")))!==!1){bootbox.alert({title:Translator.trans("Deleting datagroup"),message:Translator.trans("This datagroup is used in step #%id%. You must modify this step before you can delete this datagroup",{id:u})});return}if((f=Simulators.isDatagroupNameInRules(name))!==!1){bootbox.alert({title:Translator.trans("Deleting datagroup"),message:Translator.trans("This datagroup is used in rule #%id%. You must modify this rule before you can delete this datagroup",{id:f})});return}i=t.find(".datas-panel > div.card-body > div.panel-group");i.each(function(){var t=$(this),n=t.find(".data-container, .datagroup-data-container"),i=n.attr("data-id"),r=n.find(".attributes-container p[data-attribute='name']").attr("data-value");!Simulators.isDataDeleteable(i,r)});bootbox.confirm({title:Translator.trans("Deleting datagroup"),message:Translator.trans("Are you sure you want to delete the data group : %label% ?",{label:e}),callback:function(t){if(t){i.each(function(){var n=$(this);Simulators.deleteData(n)});var u=r.find("p[data-attribute='name']").attr("data-value"),f=n.parent();n.remove();Simulators.renumberDatagroups(f.find("> div"));Simulators.deleteDatagroupInActions(u);delete Simulators.datagroups[u];$(".save-simulator").show();Admin.updated=!0}}})}catch(o){console&&console.log(o.message)}};Simulators.collectDatas=function(){var n=[];return $("#datas .data-container").each(function(){var t,i,r;$(this).hasClass("datagroup")?(t=[],$(this).parent().find(".datagroup-data-container").each(function(){var i=[],n;$(this).parent().find(".choice-container").each(function(){i.push({id:$(this).attr("data-id"),value:$(this).find("p[data-attribute='value']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value")})});n={};$(this).parent().find(".choice-source-container").each(function(){n={id:$(this).attr("data-id"),idColumn:$(this).find("p[data-attribute='idColumn']").attr("data-value"),valueColumn:$(this).find("p[data-attribute='valueColumn']").attr("data-value"),labelColumn:$(this).find("p[data-attribute='labelColumn']").attr("data-value")}});t.push({element:"data",id:$(this).attr("data-id"),name:$(this).find("p[data-attribute='name']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value"),type:$(this).find("p[data-attribute='type']").attr("data-value"),"default":$(this).find("span[data-attribute='default']").attr("data-value"),min:$(this).find("span[data-attribute='min']").attr("data-value"),max:$(this).find("span[data-attribute='max']").attr("data-value"),pattern:$(this).find("p[data-attribute='pattern']").attr("data-value"),content:$(this).find("span[data-attribute='content']").attr("data-value"),round:$(this).find("p[data-attribute='round']").attr("data-value"),unit:$(this).find("p[data-attribute='unit']").attr("data-value"),source:$(this).find("p[data-attribute='source']").attr("data-value"),index:$(this).find("p[data-attribute='index']").attr("data-value"),memorize:$(this).find("input[data-attribute='memorize']").is(":checked")?1:0,description:{content:$(this).parent().find(".data-description").html(),edition:$(this).parent().find(".data-description").attr("data-edition")},choices:i,choicesource:n})}),n.push({element:"datagroup",id:$(this).attr("data-id"),name:$(this).find("p[data-attribute='name']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value"),description:{content:$(this).parent().find(".datagroup-description").html(),edition:"wysihtml"},datas:t})):(i=[],$(this).parent().find(".choice-container").each(function(){i.push({id:$(this).attr("data-id"),value:$(this).find("p[data-attribute='value']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value")})}),r={},$(this).parent().find(".choice-source-container").each(function(){r={id:$(this).attr("data-id"),idColumn:$(this).find("p[data-attribute='idColumn']").attr("data-value"),valueColumn:$(this).find("p[data-attribute='valueColumn']").attr("data-value"),labelColumn:$(this).find("p[data-attribute='labelColumn']").attr("data-value")}}),n.push({element:"data",id:$(this).attr("data-id"),name:$(this).find("p[data-attribute='name']").attr("data-value"),label:$(this).find("p[data-attribute='label']").attr("data-value"),type:$(this).find("p[data-attribute='type']").attr("data-value"),"default":$(this).find("span[data-attribute='default']").attr("data-value"),min:$(this).find("span[data-attribute='min']").attr("data-value"),max:$(this).find("span[data-attribute='max']").attr("data-value"),pattern:$(this).find("p[data-attribute='pattern']").attr("data-value"),content:$(this).find("span[data-attribute='content']").attr("data-value"),round:$(this).find("p[data-attribute='round']").attr("data-value"),unit:$(this).find("p[data-attribute='unit']").attr("data-value"),source:$(this).find("p[data-attribute='source']").attr("data-value"),index:$(this).find("p[data-attribute='index']").attr("data-value"),memorize:$(this).find("input[data-attribute='memorize']").is(":checked")?1:0,description:{content:$(this).parent().find(".data-description").html(),edition:$(this).parent().find(".data-description").attr("data-edition")},choices:i,choicesource:r}))}),n}}(this),function(){"use strict";Simulators.profilesBackup=null;Simulators.profileBackup=null;Simulators.profileDataBackup=null;Simulators.isDataInProfiles=function(n){var t=!1,i=$("#profiles").find(".profile-data-container");return i.each(function(){if(this.hasAttribute("data-id")&&$(this).attr("data-id")==n)return t=$(this).attr("data-profile"),!1}),t};Simulators.changeDataIdInProfiles=function(n,t){var i=new RegExp("-data-"+n+"\\b","g"),r=$("#profiles").find(".profile-data-container");r.each(function(){var r,u;i.test($(this).attr("id"))&&(r=$(this).attr("id"),r=r.replace(i,"-data-"+t),$(this).attr("id",r));this.hasAttribute("data-id")&&$(this).attr("data-id")==n&&$(this).attr("data-id",t);u=$(this).find("*");u.each(function(){if(this.hasAttribute("id")&&i.test($(this).attr("id"))){var n=$(this).attr("id");n=n.replace(i,"-data-"+t);$(this).attr("id",n)}})})};Simulators.changeDataLabelInProfiles=function(n,t){var i=$("#profiles").find(".profile-data-container");i.each(function(){if(this.hasAttribute("data-id")&&$(this).attr("data-id")==n){var i=$(this).find("p[data-attribute='data']");i.each(function(){$(this).attr("data-value",t);$(this).html(t)})}})};Simulators.changeDataChoiceLabelInProfiles=function(n,t,i){var r=$("#profiles").find(".profile-data-container");r.each(function(){if(this.hasAttribute("data-id")&&$(this).attr("data-id")==n){var r=$(this).find("p[data-attribute='default']");r.each(function(){this.hasAttribute("data-value")&&$(this).attr("data-value")==t&&$(this).html(i)})}})};Simulators.changeDataChoiceValueInProfiles=function(n,t,i){var r=$("#profiles").find(".profile-data-container");r.each(function(){if(this.hasAttribute("data-id")&&$(this).attr("data-id")==n){var r=$(this).find("p[data-attribute='default']");r.each(function(){this.hasAttribute("data-value")&&$(this).attr("data-value")==t&&$(this).attr("data-value",i)})}})};Simulators.maxProfileId=function(){var n=0,t=$("#profiles").find(".profile-container");return t.each(function(){var t=parseInt($(this).attr("data-id"));t>n&&(n=t)}),n};Simulators.renumberProfiles=function(n){n.each(function(n){var o=$(this).find("div.profile-container"),r=o.attr("data-id"),t=n+1,e;if(t!=r){$(this).attr("id","profile-"+t);var i=new RegExp("profile-"+r+"\\b","g"),f=$(this).find("> .card > .card-header").find("> h4 > a"),u=f.text();u=u.replace("#"+r,"#"+t);f.text(u);e=$(this).find("*");e.each(function(){var n;this.hasAttribute("data-profile")&&$(this).attr("data-profile")==r&&$(this).attr("data-profile",t);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(i,"profile-"+t),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(i,"profile-"+t),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(i,"profile-"+t),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(i,"profile-"+t),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(i,"profile-"+t),$(this).attr("aria-labelledby",n))})}});n.each(function(n){var t=$(this).find("div.profile-container"),r=t.attr("data-id"),i=n+1;i!=r&&t.attr("data-id",i)})};Simulators.bindSortableProfiles=function(n){n||(n=$("#profiles-profiles-panel"));n.find("> .sortable").sortable({cursor:"move",containment:"parent",axis:"y",sort:function(){Simulators.updating&&(Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),setTimeout(function(){n.find("> .sortable").sortable("cancel")},0))},update:function(n,t){if(!Simulators.updating){var r=$(this),i=$(t.item).find(".profile-container"),u=i.attr("data-id");Simulators.renumberProfiles($(t.item).parent().find("> div"));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0}}})};Simulators.drawProfilesForDisplay=function(n){var r=$('<div class="card bg-light profiles-container" id="profiles-attributes-panel"><\/div>'),u=$('<div class="card-body"><\/div>'),i=$('<div class="attributes-container"><\/div>'),f=$("<div><\/div>"),t='<div class="form-group row">';return t+='    <label class="col-sm-2 col-form-label">'+Translator.trans("Title")+"<\/label>",t+='    <div class="col-sm-10">',t+='        <p data-attribute="label" data-value="'+n.label+'" class="form-control-plaintext simple-value">'+n.label+"<\/p>",t+="    <\/div>",t+="<\/div>",f.append(t),i.append(f),i.append('<button class="btn btn-secondary float-right update-button edit-profiles-label" data-parent="#profiles-attributes-panel" title="'+n.label+'"><span class="button-label">'+Translator.trans("Edit")+'<\/span> <span class="fas fa-pencil-alt"><\/span><\/button>'),u.append(i),r.append(u),r};Simulators.drawProfilesForInput=function(n){var u=$('<div class="card bg-light profiles-container"><\/div>'),i=$('<div class="card-body"><\/div>'),f=$('<div class="attributes-container"><\/div>'),e=$("<div><\/div>"),r,t;return e.append(Simulators.simpleAttributeForInput("profiles-label","text","label",Translator.trans("Title"),n.label,!0,Translator.trans("Enter profiles title"))),f.append(e),i.append(f),r=$('<div class="card bg-light buttons-panel" id="profiles-buttons-panel"><\/div>'),t=$('<div class="card-body profiles-buttons"><\/div>'),t.append('<button class="btn btn-success float-right validate-edit-profiles-label">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),t.append('<button class="btn btn-secondary float-right cancel-edit-profiles-label">'+Translator.trans("Cancel")+"<\/span><\/button>"),t.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),r.append(t),i.append(r),u.append(i),u};Simulators.bindProfiles=function(n){n.find(".cancel-edit-profiles-label").click(function(){n.replaceWith(Simulators.profilesBackup);Simulators.profilesBackup.find("button.edit-profiles-label").click(function(n){n.preventDefault();Simulators.editProfilesLabel($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-profiles-label").click(function(){if(!Simulators.checkProfilesLabel(n))return!1;var i=n.find(".attributes-container"),r={label:i.find("input[data-attribute=label]").val()},t=Simulators.drawProfilesForDisplay(r);n.replaceWith(t);t.find("button.edit-profiles-label").click(function(n){n.preventDefault();Simulators.editProfilesLabel($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1})};Simulators.checkProfilesLabel=function(n){var t=$.trim(n.find(".attributes-container input[data-attribute=label]").val());return t===""?(n.find(".error-message").text(Translator.trans("The profiles title is required")),n.find(".alert").show(),!1):!0};Simulators.editProfilesLabel=function(n){try{$(".update-button").hide();$(".toggle-collapse-all").hide();var i={label:n.find("p[data-attribute=label]").attr("data-value")||""},t=Simulators.drawProfilesForInput(i);Simulators.profilesBackup=n.replaceWith(t);Simulators.bindProfiles(t);Simulators.updating=!0}catch(r){console&&console.log(r.message)}};Simulators.drawProfileForDisplay=function(n){var t="profile-"+n.id,u=Simulators.openCollapsiblePanel(t,"#"+n.id+" : "+n.label,"info","","",[{"class":"delete-profile",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-profile",label:Translator.trans("Edit"),icon:"fa-pencil"}]),o=u.find(".card-body"),f=$('<div class="card bg-light profile-container" id="'+t+'-attributes-panel" data-id="'+n.id+'"><\/div>'),i=$('<div class="card-body"><\/div>'),e=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(t,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Name"))),r.append(Simulators.simpleAttributeForDisplay(t,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Label"))),e.append(r),i.append(e),i.append('<div class="card bg-light description-panel" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body profile-description rich-text" data-edition="'+n.description.edition+'">'+n.description.content+"<\/div><\/div>"),f.append(i),o.append(f),u};Simulators.drawProfileForInput=function(n){var t="profile-"+n.id,e=Simulators.openCollapsiblePanel(t,"#"+n.id+" : "+n.label,"info","","",[]),c=e.find(".card-body"),o=$('<div class="card bg-light profile-container" id="'+t+'-attributes-panel" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),r=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),u=$("<div><\/div>"),l=Simulators.simpleAttributeForInput(t+"-name","text","name",Translator.trans("Name"),n.name,!0,Translator.trans("Enter profile name")),h,f,i;return u.append(l),h=Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!0,Translator.trans("Enter profile label")),u.append(h),s.append(u),r.append(s),o.append(r),c.append(o),r.append('<div class="card bg-light description-panel elements-container" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-description" id="'+t+'-description" wrap="hard" class="form-control profile-description">'+n.description.content+"<\/textarea><\/div><\/div>"),f=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),i=$('<div class="card-body profile-buttons"><\/div>'),i.append('<button class="btn btn-success float-right validate-edit-profile">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),i.append('<button class="btn btn-secondary float-right cancel-edit-profile">'+Translator.trans("Cancel")+"<\/span><\/button>"),i.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),f.append(i),r.append(f),e};Simulators.bindProfileButtons=function(n){n||(n=$("#profiles"));n.find("button.edit-profiles-label").click(function(n){n.preventDefault();Simulators.editProfilesLabel($($(this).attr("data-parent")))});n.find("button.edit-profile").click(function(n){n.preventDefault();Simulators.editProfile($($(this).attr("data-parent")))});n.find("button.delete-profile").click(function(n){n.preventDefault();Simulators.deleteProfile($($(this).attr("data-parent")))});n.find("button.add-profile-data").click(function(n){n.preventDefault();Simulators.addProfileData($($(this).attr("data-parent")))})};Simulators.bindProfile=function(n){n.find("textarea").wysihtml(Admin.wysihtml5Options);n.find(".cancel-edit-profile").click(function(){n.find(".profile-container").replaceWith(Simulators.profileBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-profile").click(function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-profile, .validate-add-profile").click(function(){var h=n.parent(),r=n.find(".profile-container"),i,u,f,e;if(!Simulators.checkProfile(n))return!1;var o=r.attr("data-id"),s=r.find(".attributes-container"),t={id:o};s.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.description={content:Admin.clearHTML(n.find(".profile-description")),edition:"wysihtml"};t.datas=$(this).hasClass("validate-edit-profile")?Simulators.collectProfileDatas(Simulators.profileBackup):[];i=Simulators.drawProfileForDisplay(t);$(this).hasClass("validate-edit-profile")?(u=Simulators.profileBackup.find("p[data-attribute='label']").attr("data-value"),t.label!=u&&(f=n.find("> .card > .card-header").find("> h4 > a"),f.text("#"+t.id+" : "+t.label)),r.replaceWith(i.find(".profile-container")),i=n):(e=$('<div class="card bg-success profile-datas-panel" id="profile-'+t.id+'-profile-datas-panel"><div class="card-header"><button class="btn btn-success float-right update-button add-profile-data" title="'+Translator.trans("Add")+'" data-parent="#profile-'+t.id+'-profile-datas-panel"><span class="button-label">'+Translator.trans("Add")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><h4 class="card-title">'+Translator.trans("Datas")+'<\/h4><\/div><div class="card-body sortable"><\/div><\/div>'),i.find(".profile-container").after(e),n.replaceWith(i),Simulators.bindProfileButtons(i));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)})};Simulators.checkProfile=function(n){var r=n.attr("id"),f=n.find(".profile-container").attr("data-id"),e=n.find(".profile-container").attr("data-name"),t=$.trim($("#"+r+"-name").val()),i,u;return t===""?(n.find(".error-message").text(Translator.trans("The profile name is required")),n.find(".alert").show(),!1):/^\w+$/.test(t)?t!=e&&(i=!1,$("#profiles").find("div.profile-container").each(function(){var r=$(this).find(".attributes-container"),n=$(this).find(".attributes-container p[data-attribute=name]").attr("data-value");if(t==n&&f!=$(this).attr("data-id"))return i=!0,!1}),i)?(n.find(".error-message").text(Translator.trans("This profile name already exists")),n.find(".alert").show(),!1):(u=$.trim($("#"+r+"-label").val()),u==="")?(n.find(".error-message").text(Translator.trans("The profile label is required")),n.find(".alert").show(),!1):!0:(n.find(".error-message").text(Translator.trans("Incorrect profile name")),n.find(".alert").show(),!1)};Simulators.addProfile=function(){var t,n;try{$(".update-button").hide();$(".toggle-collapse-all").hide();t={id:Simulators.maxProfileId()+1,name:"",label:"",description:{content:"",edition:""}};n=Simulators.drawProfileForInput(t);n.find("button.cancel-edit-profile").addClass("cancel-add-profile").removeClass("cancel-edit-profile");n.find("button.validate-edit-profile").addClass("validate-add-profile").removeClass("validate-edit-profile");$("#profiles-profiles-panel").find("> div.sortable").append(n);Simulators.bindProfile(n);$("#collapseprofiles").collapse("show");n.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(i){console&&console.log(i.message)}};Simulators.editProfile=function(n){var u;try{var t=n.find(".profile-container"),i=t.attr("data-id"),r=t.find(".attributes-container"),f={id:i,name:r.find("p[data-attribute='name']").attr("data-value"),label:r.find("p[data-attribute='label']").attr("data-value"),description:{content:t.find(".profile-description").html(),edition:t.find(".profile-description").attr("data-edition")}};$(".update-button").hide();$(".toggle-collapse-all").hide();u=Simulators.drawProfileForInput(f);Simulators.profileBackup=t.replaceWith(u.find(".profile-container"));Simulators.bindProfile(n);$("#collapseprofile-"+i).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(e){console&&console.log(e.message)}};Simulators.deleteProfile=function(n){try{var t=n.find(".profile-container"),i=t.find(".attributes-container"),r=i.find("p[data-attribute='label']").attr("data-value");bootbox.confirm({title:Translator.trans("Deleting profile"),message:Translator.trans("Are you sure you want to delete the profile : %label%",{label:r}),callback:function(t){if(t){var i=n.parent();n.remove();Simulators.renumberProfiles(i.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(u){console&&console.log(u.message)}};Simulators.renumberProfileDatas=function(n){n.each(function(n){var r=$(this).find("div.profile-data-container"),o=r.attr("data-profile"),u=r.attr("data-id"),s=Simulators.findDataById(r.find("p[data-attribute=data]").attr("data-value")).label,t=n+1,i,f,e;t!=u&&(r.attr("data-id",t),$(this).attr("id","profile-"+o+"-profile-data-"+t),i=new RegExp("profile-data-"+u+"([^\\d])?","g"),f=$(this).find("> .card > .card-header").find("> h4 > a"),f.text(" "+Translator.trans("Data %id%",{id:t})+" : "+s),e=$(this).find("*"),e.each(function(){var n;this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(i,"profile-data-"+t+"$1"),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(i,"profile-data-"+t+"$1"),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(i,"profile-data-"+t+"$1"),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(i,"profile-data-"+t+"$1"),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(i,"profile-data-"+t+"$1"),$(this).attr("aria-labelledby",n))}))})};Simulators.bindSortableProfileDatas=function(n){n||(n=$("#page-simulators .profile-datas-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",sort:function(){Simulators.updating&&(Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),setTimeout(function(){n.find(".sortable").sortable("cancel")},0))},update:function(n,t){Simulators.updating||(Simulators.renumberProfileDatas($(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawProfileDataForDisplay=function(n){var t="profile-"+n.profileId+"-profile-data-"+n.id,u=Simulators.openCollapsiblePanel(t,Translator.trans("Data %id%",{id:n.id})+" : "+Simulators.findDataById(n.data).label,"light","in","sortable",[{"class":"delete-profile-data",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-profile-data",label:Translator.trans("Edit"),icon:"fa-plus-circle"}]),h=u.find(".card-body"),f=$('<div class="card bg-light profile-data-container" id="'+t+'-attributes-panel" data-profile="'+n.profileId+'" data-id="'+n.id+'"><\/div>'),e=$('<div class="card-body"><\/div>'),o=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>"),s={},r={};return $.each(Simulators.dataset,function(t,i){s[i.id]=i.label;i.id==n.data&&i.type=="choice"&&$.each(i.options,function(n,t){r[t.name]=t.label})}),i.append(Simulators.simpleAttributeForDisplay(t,"select","data",Translator.trans("Data"),n.data,n.data,!0,Translator.trans("Profile data"),JSON.stringify(s))),$.isEmptyObject(r)?i.append(Simulators.simpleAttributeForDisplay(t,"text","default",Translator.trans("Profile data value"),n.default,n.default,!0,Translator.trans("Profile data value"))):i.append(Simulators.simpleAttributeForDisplay(t,"select","default",Translator.trans("Profile data value"),n.default,n.default,!0,Translator.trans("Profile data value"),JSON.stringify(r))),o.append(i),e.append(o),f.append(e),h.append(f),u};Simulators.drawProfileDataForInput=function(n){var t="profile-"+n.profileId+"-profile-data-"+n.id,s=Simulators.openCollapsiblePanel(t,Translator.trans("Data %id%",{id:n.id}),"light","in","sortable",[{"class":"delete-profile-data",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-profile-data",label:Translator.trans("Edit"),icon:"fa-plus-circle"}]),a=s.find(".card-body"),e=$('<div class="card bg-light profile-data-container" id="'+t+'-attributes-panel" data-profile="'+n.profileId+'" data-id="'+n.id+'"><\/div>'),h=$('<div class="card-body"><\/div>'),c=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>"),l=[],u,f,o,i;return $("#collapseprofile-"+n.profileId).find(".profile-data-container").each(function(){$(this).attr("data-id")!=n.id&&l.push($(this).find("p[data-attribute=data]").attr("data-value"))}),u={},n.data==0&&(u[0]=Translator.trans("Select a data")),f={},$.each(Simulators.dataset,function(t,i){$.inArray(i.id,l)==-1&&(u[i.id]=i.label,i.id==n.data&&i.type=="choice"&&$.each(i.options,function(n,t){f[t.name]=t.label}))}),r.append(Simulators.simpleAttributeForInput(t+"-data","select","data",Translator.trans("Data"),n.data,!0,Translator.trans("Select a data"),JSON.stringify(u))),$.isEmptyObject(f)?r.append(Simulators.simpleAttributeForInput(t+"-default","text","default",Translator.trans("Profile data value"),n.default,!0,Translator.trans("Profile data value"))):r.append(Simulators.simpleAttributeForInput(t+"-default","select","default",Translator.trans("Profile data value"),n.default,!0,Translator.trans("Select a value"),JSON.stringify(f))),c.append(r),h.append(c),e.append(h),a.append(e),o=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),i=$('<div class="card-body data-buttons"><\/div>'),i.append('<button class="btn btn-success float-right validate-edit-profile-data">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),i.append('<button class="btn btn-secondary float-right cancel-edit-profile-data">'+Translator.trans("Cancel")+"<\/span><\/button>"),i.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),o.append(i),e.append(o),s};Simulators.bindProfileDataButtons=function(n){n||(n=$("#simulator"));n.find("button.edit-profile-data").click(function(n){n.preventDefault();Simulators.editProfileData($($(this).attr("data-parent")))});n.find("button.delete-profile-data").click(function(n){n.preventDefault();Simulators.deleteProfileData($($(this).attr("data-parent")))})};Simulators.bindProfileData=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-profile-data").click(function(){n.find(".profile-data-container").replaceWith(Simulators.profileDataBackup);Simulators.profileDataBackup.find("button.edit-profile-data").click(function(n){n.preventDefault();Simulators.editProfileData($($(this).attr("data-parent")))});Simulators.profileDataBackup.find("button.delete-profile-data").click(function(n){n.preventDefault();Simulators.deleteProfileData($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-profile-data").click(function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-profile-data, .validate-add-profile-data").click(function(){var i=n.find(".profile-data-container"),t;if(!Simulators.checkProfileData(n))return!1;var u=i.attr("data-profile"),f=i.attr("data-id"),e=i.find(".attributes-container"),r={profileId:u,id:f,data:"","default":""};e.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){r[$(this).attr("data-attribute")]=$(this).val()});t=Simulators.drawProfileDataForDisplay(r);$(this).hasClass("validate-edit-profile-data")?(i.replaceWith(t.find(".profile-data-container")),t=n):(n.replaceWith(t),Simulators.bindProfileDataButtons(t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500)});n.find("select[data-attribute=data]").change(function(){var i=Simulators.findDataById($(this).val()),t=n.find("*[data-attribute=default]"),r;i&&(i.type=="choice"||i.type=="multichoice"?(r=$("<select>",{id:t.attr("id"),"class":"form-control simple-value",name:t.attr("name"),"data-attribute":t.attr("data-attribute"),placeholder:t.attr("placeholder")}),$.each(i.options,function(n,t){r.append($("<option>",{value:t.name,text:t.label}))})):r=$("<input>",{id:t.attr("id"),"class":"form-control simple-value",name:t.attr("name"),"data-attribute":t.attr("data-attribute"),placeholder:t.attr("placeholder")}),t.replaceWith(r))})};Simulators.checkProfileData=function(n){var i=n.attr("id"),r=$("#"+i+"-data").val(),t,u;if(r==0)return n.find(".error-message").text(Translator.trans("The profile data is required")),n.find(".alert").show(),!1;if(t=$.trim($("#"+i+"-default").val()),t==="")return n.find(".error-message").text(Translator.trans("The data value is required")),n.find(".alert").show(),!1;u=Simulators.findDataById(r);switch(u.type){case"date":if(!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect data value")),n.find(".alert").show(),!1;break;case"money":if(!/^\d+(\,\d{1,2})?$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect data value")),n.find(".alert").show(),!1;break;case"integer":if(!/^\d+$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect data value")),n.find(".alert").show(),!1;break;case"number":case"percent":if(!/^-{0,1}\d*\,{0,1}\d+$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect data value")),n.find(".alert").show(),!1}return!0};Simulators.addProfileData=function(n){var t,i;try{var r=n.parent().parent().find(".profile-container"),u=r.attr("data-id"),f=n.find("> .card-body > div"),e={id:f.length+1,profileId:u,data:0,"default":""};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawProfileDataForInput(e);t.find("button.cancel-edit-profile-data").addClass("cancel-add-profile-data").removeClass("cancel-edit-profile-data");t.find("button.validate-edit-profile-data").addClass("validate-add-profile-data").removeClass("validate-edit-profile-data");i=n.find("> div.sortable");i.append(t);Simulators.bindProfileData(t);t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(o){console&&console.log(o.message)}};Simulators.editProfileData=function(n){var r;try{var i=n.find(".profile-data-container"),u=i.attr("data-profile"),f=i.attr("data-id"),t=Simulators.collectProfileData(i);t.data=t.id;t.id=f;t.profileId=u;$(".update-button").hide();$(".toggle-collapse-all").hide();r=Simulators.drawProfileDataForInput(t);Simulators.profileDataBackup=i.replaceWith(r.find(".profile-data-container"));Simulators.bindProfileData(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(e){console&&console.log(e.message)}};Simulators.deleteProfileData=function(n){try{var t=n.find(".profile-data-container"),u=t.attr("data-profile"),i=t.attr("data-id");bootbox.confirm({title:Translator.trans("Deleting profile data"),message:Translator.trans("Are you sure you want to delete the profile data : %id%",{id:i}),callback:function(t){if(t){var i=n.parent();n.remove();Simulators.renumberProfileDatas(i.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(r){console&&console.log(r.message)}};Simulators.collectProfileData=function(n){return{id:n.find("p[data-attribute='data']").attr("data-value"),"default":n.find("p[data-attribute='default']").attr("data-value")}};Simulators.collectProfileDatas=function(n){var t=[],i=n.parent().find("div.profile-data-container");return i.each(function(){t.push(Simulators.collectProfileData($(this)))}),t};Simulators.collectProfiles=function(){var t=$("#profiles").find("p[data-attribute=label]").attr("data-value"),n=[],i=$("#profiles").find("div.profile-container");return i.each(function(t){var i=$(this).find(".attributes-container");n.push({id:t+1,name:i.find("p[data-attribute='name']").attr("data-value"),label:i.find("p[data-attribute='label']").attr("data-value")||"",description:{content:$(this).parent().find(".profile-description").html()||"",edition:$(this).parent().find(".profile-description").attr("data-edition")||"wysihtml"},datas:Simulators.collectProfileDatas($(this))})}),{label:t,profiles:n}}}(this),function(){"use strict";Simulators.isDataIdInRules=function(n){var t=!1,i=new RegExp("#("+n+"\\b|"+n+"(L))","g");return $.each(rules,function(r,u){if(i.test(u.conditions)||u.connector&&Simulators.isDataIdInConnector(u.connector,n))return t=u.id,!1;$.each(u.ifdata,function(n,r){if(r.value=="setAttribute"){var f=r.fields[0].fields[0].fields[0].value;if(i.test(f))return t=u.id,!1}});$.each(u.elsedata,function(n,r){if(r.value=="setAttribute"){var f=r.fields[0].fields[0].fields[0].value;if(i.test(f))return t=u.id,!1}})}),t};Simulators.changeDataIdInRules=function(n,t){var i=new RegExp("#("+n+"\\b|"+n+"(L))","g"),u=$("#business-rules").find(".rule-conditions"),r;u.each(function(){var r,u;i.test($(this).attr("data-value"))&&(r=$(this).attr("data-value"),r=r.replace(i,"#"+t),$(this).attr("data-value",r));u=$(this).find("data.data");u.each(function(){$(this).attr("value")==n&&$(this).attr("value",t)})});r=$("#business-rules").find(".rule-action");r.each(function(){var r,u;this.hasAttribute("data-data")&&$(this).attr("data-data")==n&&$(this).attr("data-data",t);this.hasAttribute("data-name")&&($(this).attr("data-name")=="setAttribute"||$(this).attr("data-name")=="unsetAttribute")&&i.test($(this).attr("data-value"))&&(r=$(this).attr("data-value"),r=r.replace(i,"#"+t+"$2"),$(this).attr("data-value",r));u=$(this).find("data.data");u.each(function(){$(this).attr("value")==n&&$(this).attr("value",t)})});$.each(rules,function(r,u){i.test(u.conditions)&&(u.conditions=u.conditions.replace(i,"#"+t+"$2"));u.connector&&Simulators.changeDataIdInConnector(u.connector,n,t);$.each(u.ifdata,function(n,r){if(r.value=="setAttribute"){var u=r.fields[0].fields[0].fields[0].value;i.test(u)&&(u=u.replace(i,"#"+t),r.fields[0].fields[0].fields[0].value=u)}});$.each(u.elsedata,function(n,r){if(r.value=="setAttribute"){var u=r.fields[0].fields[0].fields[0].value;i.test(u)&&(u=u.replace(i,"#"+t),r.fields[0].fields[0].fields[0].value=u)}})})};Simulators.isDataNameInRules=function(n){var t=!1;return $.each(rules,function(i,r){if(r.connector&&Simulators.isDataNameInConnector(r.connector,n))return t=r.id,!1;$.each(r.ifdata,function(i,u){if(u.value=="setAttribute"||u.value=="unsetAttribute"){if(u.fields[0].fields[0].value==n)return t=r.id,!1}else if((u.value=="notifyError"||u.value=="notifyWarning")&&u.fields[1].value=="data"&&u.fields[1].fields[0].value==n)return t=r.id,!1});$.each(r.elsedata,function(i,u){if(u.value=="setAttribute"||u.value=="unsetAttribute"){if(u.fields[0].fields[0].value==n)return t=r.id,!1}else if((u.value=="notifyError"||u.value=="notifyWarning")&&u.fields[1].value=="data"&&u.fields[1].fields[0].value==n)return t=r.id,!1})}),t};Simulators.changeDataNameInRules=function(n,t){$.each(rules,function(i,r){r.connector&&Simulators.changeDataNameInConnector(r.connector,n,t);$.each(r.ifdata,function(i,r){r.value=="setAttribute"||r.value=="unsetAttribute"?r.fields[0].fields[0].value==n&&(r.fields[0].fields[0].value=t):(r.value=="notifyError"||r.value=="notifyWarning")&&r.fields[1].value=="data"&&r.fields[1].fields[0].value==n&&r.fields[1].fields[0].value==t});$.each(r.elsedata,function(i,r){r.value=="setAttribute"||r.value=="unsetAttribute"?r.fields[0].fields[0].value==n&&(r.fields[0].fields[0].value=t):(r.value=="notifyError"||r.value=="notifyWarning")&&r.fields[1].value=="data"&&r.fields[1].fields[0].value==n&&r.fields[1].fields[0].value==t})})};Simulators.changeDataLabelInRules=function(n,t){var i=$("#business-rules").find(".rule-conditions, .rule-action");i.each(function(){var i=$(this).find("data.data");i.each(function(){$(this).attr("value")==n&&$(this).text("«"+t+"»")})})};Simulators.isDataIdInConnector=function(n,t){var i=!1,r;return n.all?$.each(n.all,function(n,r){if(Simulators.isDataIdInConnector(r,t))return i=!0,!1}):n.any?$.each(n.any,function(n,r){if(Simulators.isDataIdInConnector(r,t))return i=!0,!1}):n.none?$.each(n.none,function(n,r){if(Simulators.isDataIdInConnector(r,t))return i=!0,!1}):(r=new RegExp("#("+t+"\\b|"+t+"(L))","g"),n.value&&r.test(n.value)&&(i=!0)),i};Simulators.changeDataIdInConnector=function(n,t,i){if(n.all)$.each(n.all,function(n,r){Simulators.changeDataIdInConnector(r,t,i)});else if(n.any)$.each(n.any,function(n,r){Simulators.changeDataIdInConnector(r,t,i)});else if(n.none)$.each(n.none,function(n,r){Simulators.changeDataIdInConnector(r,t,i)});else{var r=new RegExp("#("+t+"\\b|"+t+"(L))","g");n.value&&r.test(n.value)&&(n.value=n.value.replace(r,"#"+i+"$2"))}};Simulators.isDataNameInConnector=function(n,t){var i=!1;if(n.all)$.each(n.all,function(n,r){if(Simulators.isDataNameInConnector(r,t))return i=!0,!1});else if(n.any)$.each(n.any,function(n,r){if(Simulators.isDataNameInConnector(r,t))return i=!0,!1});else if(n.none)$.each(n.none,function(n,r){if(Simulators.isDataNameInConnector(r,t))return i=!0,!1});else if(n.name==t)return i=!0,!1;return i};Simulators.changeDataNameInConnector=function(n,t,i){n.all?$.each(n.all,function(n,r){Simulators.changeDataNameInConnector(r,t,i)}):n.any?$.each(n.any,function(n,r){Simulators.changeDataNameInConnector(r,t,i)}):n.none?$.each(n.none,function(n,r){Simulators.changeDataNameInConnector(r,t,i)}):n.name==t&&(n.name=i)};Simulators.isDatagroupNameInRules=function(n){var t=!1;return $.each(rules,function(i,r){$.each(r.ifdata,function(i,u){if((u.value=="notifyError"||u.value=="notifyWarning")&&u.fields[1].value=="datagroup"&&u.fields[1].fields[0].value==n)return t=r.id,!1});$.each(r.elsedata,function(i,u){if((u.value=="notifyError"||u.value=="notifyWarning")&&u.fields[1].value=="datagroup"&&u.fields[1].fields[0].value==n)return t=r.id,!1})}),t};Simulators.changeDatagroupNameInRules=function(n,t){var i=$("#business-rules").find(".rule-action");i.each(function(){this.hasAttribute("data-datagroup")&&$(this).attr("data-datagroup")==n&&$(this).attr("data-datagroup",t);var i=$(this).find("data.datagroup");i.each(function(){$(this).attr("value")==n&&$(this).attr("value",t)})});$.each(actions,function(i,r){(r.name=="notifyError"||r.name=="notifyWarning")&&$.each(r.fields[1].options,function(i,r){r.name=="datagroup"&&$.each(r.fields,function(i,r){$.each(r.options,function(i,r){if(r.name==n)return r.name=t,!1})})})});$.each(rules,function(i,r){$.each(r.ifdata,function(i,r){(r.value=="notifyError"||r.value=="notifyWarning")&&r.fields[1].value=="datagroup"&&r.fields[1].fields[0].value==n&&r.fields[1].fields[0].value==t});$.each(r.elsedata,function(i,r){(r.value=="notifyError"||r.value=="notifyWarning")&&r.fields[1].value=="datagroup"&&r.fields[1].fields[0].value==n&&r.fields[1].fields[0].value==t})})};Simulators.changeDatagroupLabelInRules=function(n,t){var i=$("#business-rules").find(".rule-action");i.each(function(){var i=$(this).find("data.datagroup");i.each(function(){$(this).attr("value")==n&&$(this).text("«"+t+"»")})});$.each(actions,function(i,r){(r.name=="notifyError"||r.name=="notifyWarning")&&$.each(r.fields[1].options,function(i,r){r.name=="datagroup"&&$.each(r.fields,function(i,r){$.each(r.options,function(i,r){if(r.name==n)return r.label=t,!1})})})})};Simulators.deleteDatagroupInActions=function(n){Simulators.deleteInArray(actions,[{key:"name",val:"notifyError",list:"fields"},{key:"name",val:"target",list:"options"},{key:"name",val:"datagroup",list:"fields"},{key:"name",val:"datagroupName",list:"options"},{key:"name",val:n}]);Simulators.deleteInArray(actions,[{key:"name",val:"notifyWarning",list:"fields"},{key:"name",val:"target",list:"options"},{key:"name",val:"datagroup",list:"fields"},{key:"name",val:"datagroupName",list:"options"},{key:"name",val:n}])};Simulators.isStepInRules=function(n){var t=!1;return $.each(rules,function(i,r){return($.each(r.ifdata,function(i,u){var f=Simulators.findInArray([u],[{key:"value",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]);return f?(t=r.id,!1):(f=Simulators.findInArray([u],[{key:"value",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]),f?(t=r.id,!1):void 0)}),t!==!1)?!1:($.each(r.elsedata,function(i,u){var f=Simulators.findInArray([u],[{key:"value",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]);return f?(t=r.id,!1):(f=Simulators.findInArray([u],[{key:"value",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]),f?(t=r.id,!1):void 0)}),t!==!1?!1:void 0)}),t};Simulators.changeStepIdInRules=function(n,t){var i;$.each(["step","action","footnote","panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"],function(i,r){var u=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n}]);u&&(u.name=t);u=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n}]);u&&(u.name=t)});i=$("#business-rules").find(".rule-action");i.each(function(){this.hasAttribute("data-step")&&$(this).attr("data-step")==n&&$(this).attr("data-step",t)});$.each(rules,function(i,r){$.each(r.ifdata,function(i,r){var u=Simulators.findInArray([r],[{key:"value",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]);u&&(u.value=t);u=Simulators.findInArray([r],[{key:"value",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]);u&&(u.value=t)});$.each(r.elsedata,function(i,r){var u=Simulators.findInArray([r],[{key:"value",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]);u&&(u.value=t);u=Simulators.findInArray([r],[{key:"value",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n}]);u&&(u.value=t)})})};Simulators.changeStepLabelInRules=function(n,t){var i,r;t||(t=Translator.trans("Step %id% (nolabel)",{id:n}));i=["step","action","footnote","panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"];$.each(i,function(i,r){var u=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n}]);u&&(u.label=t);u=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n}]);u&&(u.label=t)});r=$("#business-rules").find(".rule-action");r.each(function(){if(this.hasAttribute("data-step")&&$(this).attr("data-step")==n){var r=$(this).attr("data-target"),i=$(this).find("span.action-step");r=="step"?i.text(" «"+t+"»"):i.text(" "+Translator.trans("of step «%label%»",{label:t}))}})};Simulators.addStepInActions=function(n){var t={label:n.label?n.label:Translator.trans("Step %id% (nolabel)",{id:n.id}),name:n.id},i={label:Translator.trans("Is step %id% interactive ?",{id:n.id}),name:"step"+n.id+".dynamic",fields:[{label:Translator.trans("whose label is"),name:"choiceId",fieldType:"select",options:[{label:Translator.trans("No"),name:0},{label:Translator.trans("Yes"),name:1}]}]};$.each(["hideObject","showObject"],function(n,r){var u=Simulators.findInArray(actions,[{key:"name",val:r,list:"fields"},{key:"name",val:"objectId"}]);u.options.length==0?(u.options.push({label:Translator.trans("step"),name:"step",fields:[{label:"",name:"stepId",fieldType:"select",options:[t]}]}),u.options.push({label:Translator.trans("choice"),name:"choice",fields:[{label:Translator.trans("of data"),name:"fieldName",fieldType:"select",options:[i]}]})):(Simulators.addInArray(u.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"}],t),Simulators.addInArray(u.options,[{key:"name",val:"choice",list:"fields"},{key:"name",val:"fieldName",list:"options"}],i))})};Simulators.deleteStepInActions=function(n){$.each(["step","action","footnote","panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"],function(t,i){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n}])})};Simulators.isFootNoteInRules=function(n,t){var i=!1;return $.each(rules,function(r,u){return($.each(u.ifdata,function(r,f){var e=Simulators.findInArray([f],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);return e?(i=u.id,!1):(e=Simulators.findInArray([f],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]),e?(i=u.id,!1):void 0)}),i!==!1)?!1:($.each(u.elsedata,function(r,f){var e=Simulators.findInArray([f],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);return e?(i=u.id,!1):(e=Simulators.findInArray([f],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]),e?(i=u.id,!1):void 0)}),i!==!1?!1:void 0)}),i};Simulators.changeFootNoteIdInRules=function(n,t,i){var r;$.each(["footnote"],function(r,u){var f=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"footnoteId",list:"options"},{key:"name",val:t}]);f&&(f.name=i);f=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"footnoteId",list:"options"},{key:"name",val:t}]);f&&(f.name=i)});r=$("#business-rules").find(".rule-action");r.each(function(){if(this.hasAttribute("data-footnote")&&$(this).attr("data-step")==n&&$(this).attr("data-footnote")==t){$(this).attr("data-footnote",i);var r=$(this).attr("data-target"),u=$(this).find("span.action-footnote");r=="footnote"&&u.text(" «"+Translator.trans("FootNote %id%",{id:i})+"»")}});$.each(rules,function(r,u){$.each(u.ifdata,function(r,u){var f=Simulators.findInArray([u],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i);f=Simulators.findInArray([u],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i)});$.each(u.elsedata,function(r,u){var f=Simulators.findInArray([u],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i);f=Simulators.findInArray([u],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"footnote",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i)})})};Simulators.addFootNoteInActions=function(n){var t={label:Translator.trans("FootNote %id%",{id:n.id}),name:n.id},i=n.stepId;$.each(["hideObject","showObject"],function(n,r){var f=Simulators.findInArray(actions,[{key:"name",val:r,list:"fields"},{key:"name",val:"objectId"}]),u=Simulators.findInArray(f.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i}]),e=Simulators.findInArray(f.options,[{key:"name",val:"footnote"}]),o;e?(o=Simulators.findInArray(e.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"footnoteId"}]),o?o.options.push(t):Simulators.addInArray(e.fields,[{key:"name",val:"stepId",list:"options"}],{label:u.label,name:u.name,fields:[{label:Translator.trans("whose label is"),name:"footnoteId",fieldType:"select",options:[t]}]})):f.options.push({label:Translator.trans("footnote"),name:"footnote",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:u.label,name:u.name,fields:[{label:Translator.trans("whose label is"),name:"footnoteId",fieldType:"select",options:[t]}]}]}]})})};Simulators.deleteFootNoteInActions=function(n,t){$.each(["footnote"],function(i,r){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"footnoteId",list:"options"},{key:"name",val:t}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"footnoteId",list:"options"},{key:"name",val:t}])})};Simulators.changeActionButtonNameInRules=function(n,t,i){var r;$.each(["action"],function(r,u){var f=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"actionId",list:"options"},{key:"name",val:t}]);f&&(f.name=i);f=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"actionId",list:"options"},{key:"name",val:t}]);f&&(f.name=i)});r=$("#business-rules").find(".rule-action");r.each(function(){this.hasAttribute("data-action")&&$(this).attr("data-step")==n&&$(this).attr("data-action")==t&&$(this).attr("data-action",i)});$.each(rules,function(r,u){$.each(u.ifdata,function(r,u){var f=Simulators.findInArray([u],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i);f=Simulators.findInArray([u],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i)});$.each(u.elsedata,function(r,u){var f=Simulators.findInArray([u],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i);f=Simulators.findInArray([u],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);f&&(f.value=i)})})};Simulators.changeActionButtonLabelInRules=function(n,t,i){var r,u;i||(i=t);r=["action"];$.each(r,function(r,u){var f=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"actionId",list:"options"},{key:"name",val:t}]);f&&(f.label=i);f=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"actionId",list:"options"},{key:"name",val:t}]);f&&(f.label=i)});u=$("#business-rules").find(".rule-action");u.each(function(){var r,u;this.hasAttribute("data-action")&&$(this).attr("data-step")==n&&$(this).attr("data-action")==t&&(r=$(this).attr("data-target"),r=="action"&&(u=$(this).find("span.action-action"),u.text(" «"+i+"»")))})};Simulators.addActionButtonInActions=function(n){var t={label:n.label,name:n.name},i=n.stepId;$.each(["hideObject","showObject"],function(n,r){var f=Simulators.findInArray(actions,[{key:"name",val:r,list:"fields"},{key:"name",val:"objectId"}]),u=Simulators.findInArray(f.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i}]),e=Simulators.findInArray(f.options,[{key:"name",val:"action"}]),o;e?(o=Simulators.findInArray(e.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"actionId"}]),o?o.options.push(t):Simulators.addInArray(e.fields,[{key:"name",val:"stepId",list:"options"}],{label:u.label,name:u.name,fields:[{label:Translator.trans("whose label is"),name:"actionId",fieldType:"select",options:[t]}]})):f.options.push({label:Translator.trans("actionbutton"),name:"action",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:u.label,name:u.name,fields:[{label:Translator.trans("whose label is"),name:"actionId",fieldType:"select",options:[t]}]}]}]})})};Simulators.deleteActionButtonInActions=function(n,t){$.each(["action"],function(i,r){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"actionId",list:"options"},{key:"name",val:t}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"actionId",list:"options"},{key:"name",val:t}])})};Simulators.isActionButtonInRules=function(n,t){var i=!1;return $.each(rules,function(r,u){return($.each(u.ifdata,function(r,f){var e=Simulators.findInArray([f],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);return e?(i=u.id,!1):(e=Simulators.findInArray([f],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]),e?(i=u.id,!1):void 0)}),i!==!1)?!1:($.each(u.elsedata,function(r,f){var e=Simulators.findInArray([f],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);return e?(i=u.id,!1):(e=Simulators.findInArray([f],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"action",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]),e?(i=u.id,!1):void 0)}),i!==!1?!1:void 0)}),i};Simulators.isPanelInRules=function(n,t){var r=["panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"],i=!1;return $.each(rules,function(u,f){return $.each(r,function(r,u){return($.each(f.ifdata,function(r,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);return o?(i=f.id,!1):(o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]),o?(i=f.id,!1):void 0)}),i!==!1)?!1:($.each(f.elsedata,function(r,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);return o?(i=f.id,!1):(o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]),o?(i=f.id,!1):void 0)}),i!==!1?!1:void 0)}),i!==!1?!1:void 0}),i};Simulators.changePanelIdInRules=function(n,t,i){var r=["panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"],u;$.each(r,function(r,u){var f=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t}]);f&&(f.name=i);f=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t}]);f&&(f.name=i)});u=$("#business-rules").find(".rule-action");u.each(function(){this.hasAttribute("data-panel")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-panel",i)});$.each(rules,function(u,f){$.each(r,function(r,u){$.each(f.ifdata,function(r,f){var e=Simulators.findInArray([f],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);e&&(e.value=i);e=Simulators.findInArray([f],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);e&&(e.value=i)});$.each(f.elsedata,function(r,f){var e=Simulators.findInArray([f],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);e&&(e.value=i);e=Simulators.findInArray([f],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:u,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t}]);e&&(e.value=i)})})})};Simulators.changePanelLabelInRules=function(n,t,i){var r,u;i||(i=Translator.trans("Panel %id% (nolabel)",{id:t}));r=["panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"];$.each(r,function(r,u){var f=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t}]);f&&(f.label=i);f=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t}]);f&&(f.label=i)});u=$("#business-rules").find(".rule-action");u.each(function(){if(this.hasAttribute("data-panel")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t){var u=$(this).attr("data-target"),r=$(this).find("span.action-panel");switch(u){case"panel":r.text(" «"+i+"»");break;case"fieldset":case"blockinfo":r.text(" "+Translator.trans("in panel «%panel%»",{panel:i}));break;case"chapter":case"section":case"field":case"prenote":case"postnote":case"choice":r.text(" "+Translator.trans("of panel «%panel%»",{panel:i}))}}})};Simulators.addPanelInActions=function(n){var t={label:n.label!=""?n.label:Translator.trans("Panel %id% (nolabel)",{id:n.id}),name:n.id},i=n.stepId;$.each(["hideObject","showObject"],function(n,r){var f=Simulators.findInArray(actions,[{key:"name",val:r,list:"fields"},{key:"name",val:"objectId"}]),u=Simulators.findInArray(f.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i}]),e=Simulators.findInArray(f.options,[{key:"name",val:"panel"}]),o;e?(o=Simulators.findInArray(e.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId"}]),o?o.options.push(t):Simulators.addInArray(e.fields,[{key:"name",val:"stepId",list:"options"}],{label:u.label,name:u.name,fields:[{label:Translator.trans("whose label is"),name:"panelId",fieldType:"select",options:[t]}]})):f.options.push({label:Translator.trans("panel"),name:"panel",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:u.label,name:u.name,fields:[{label:Translator.trans("whose label is"),name:"panelId",fieldType:"select",options:[t]}]}]}]})})};Simulators.deletePanelInActions=function(n,t){$.each(["panel","fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"],function(i,r){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t}])})};Simulators.isFieldSetInRules=function(n,t,i){var u=["fieldset","column","fieldrow","field","prenote","postnote"],r=!1;return $.each(rules,function(f,e){return $.each(u,function(u,f){return($.each(e.ifdata,function(u,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]);return s&&s.value==i?(r=e.id,!1):(s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]),s&&s.value==i?(r=e.id,!1):void 0)}),r!==!1)?!1:($.each(e.elsedata,function(u,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]);return s&&s.value==i?(r=e.id,!1):(s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]),s&&s.value==i?(r=e.id,!1):void 0)}),r!==!1?!1:void 0)}),r!==!1?!1:void 0}),r};Simulators.changeFieldSetIdInRules=function(n,t,i,r){var u=["fieldset","column","fieldrow","field","prenote","postnote"],f;$.each(u,function(u,f){var e=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i}]);e&&(e.name=r);e=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i}]);e&&(e.name=r)});f=$("#business-rules").find(".rule-action");f.each(function(){this.hasAttribute("data-fieldset")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-fieldset",r)});$.each(rules,function(f,e){$.each(u,function(u,f){$.each(e.ifdata,function(u,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]);o&&o.value==i&&(o.value=r);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]);o&&o.value==i&&(o.value=r)});$.each(e.elsedata,function(u,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]);o&&o.value==i&&(o.value=r);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"fieldsetId"}]);o&&o.value==i&&(o.value=r)})})})};Simulators.changeFieldSetLegendInRules=function(n,t,i,r){var u,f;r||(r=Translator.trans("Fieldset %id% (nolegend)",{id:i}));u=["fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"];$.each(u,function(u,f){var e=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i}]);e&&(e.label=r);e=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i}]);e&&(e.label=r)});f=$("#business-rules").find(".rule-action");f.each(function(){if(this.hasAttribute("data-fieldset")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i){var f=$(this).attr("data-target"),u=$(this).find("span.action-fieldset");switch(f){case"fieldset":u.text(" «"+r+"»");break;case"field":case"prenote":case"postnote":case"choice":u.text(" "+Translator.trans("in fieldset «%fieldset%»",{fieldset:r}))}}})};Simulators.addFieldSetInActions=function(n){var t={label:n.legend.content!=""?n.legend.content.trim():Translator.trans("Fieldset %id% (nolegend)",{id:n.id}),name:n.id},i=n.stepId,r=n.panelId;$.each(["hideObject","showObject"],function(n,u){var f=Simulators.findInArray(actions,[{key:"name",val:u,list:"fields"},{key:"name",val:"objectId"}]),e=Simulators.findInArray(f.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i}]),o=Simulators.findInArray(f.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r}]),s=Simulators.findInArray(f.options,[{key:"name",val:"fieldset"}]),h;s?(h=Simulators.findInArray(s.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId"}]),h?h.options.push(t):Simulators.addInArray(s.fields,[{key:"name",val:"stepId",list:"options"}],{label:e.label,name:e.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("whose label is"),name:"fieldsetId",fieldType:"select",options:[t]}]}]}]})):f.options.push({label:Translator.trans("fieldset"),name:"fieldset",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:e.label,name:e.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("whose label is"),name:"fieldsetId",fieldType:"select",options:[t]}]}]}]}]}]})})};Simulators.deleteFieldSetInActions=function(n,t,i){$.each(["fieldset","column","fieldrow","field","prenote","postnote","blockinfo","chapter","section"],function(r,u){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i}])})};Simulators.isFieldSetColumnInRules=function(n,t,i,r){var u=!1;return $.each(rules,function(f,e){return($.each(e.ifdata,function(f,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]);return s&&s.value==r?(u=e.id,!1):(s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]),s&&s.value==r?(u=e.id,!1):void 0)}),u!==!1)?!1:($.each(e.elsedata,function(f,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]);return s&&s.value==r?(u=e.id,!1):(s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]),s&&s.value==r?(u=e.id,!1):void 0)}),u!==!1?!1:void 0)}),u};Simulators.changeFieldSetColumnIdInRules=function(n,t,i,r,u){var f;$.each(["column"],function(f,e){var o=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"columnId",list:"options"},{key:"name",val:r}]);o&&(o.name=u);o=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"columnId",list:"options"},{key:"name",val:r}]);o&&(o.name=u)});f=$("#business-rules").find(".rule-action");f.each(function(){this.hasAttribute("data-column")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-column")==r&&$(this).attr("data-column",u)});$.each(rules,function(f,e){$.each(e.ifdata,function(f,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]);o&&o.value==r&&(o.value=u);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]);o&&o.value==r&&(o.value=u)});$.each(e.elsedata,function(f,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]);o&&o.value==r&&(o.value=u);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"column",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"columnId"}]);o&&o.value==r&&(o.value=u)})})};Simulators.changeFieldSetColumnLabelInRules=function(n,t,i,r,u){var f,e;u||(u=Translator.trans("Column %id% (nolabel)",{id:r}));f=["column","field"];$.each(f,function(f,e){var o=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"columnId",list:"options"},{key:"name",val:r}]);o&&(o.label=u);o=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"columnId",list:"options"},{key:"name",val:r}]);o&&(o.label=u)});e=$("#business-rules").find(".rule-action");e.each(function(){if(this.hasAttribute("data-column")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-column")==r){var e=$(this).attr("data-target"),f=$(this).find("span.action-column");switch(e){case"column":f.text(" «"+u+"»");break;case"field":f.text(" "+Translator.trans("in")+" "+u)}}})};Simulators.addFieldSetColumnInActions=function(n){var i={label:n.label!=""?n.label:Translator.trans("Column %id% (nolabel)",{id:n.id}),name:n.id},t=n.stepId,r=n.panelId,u=n.fieldsetId;$.each(["hideObject","showObject"],function(n,f){var e=Simulators.findInArray(actions,[{key:"name",val:f,list:"fields"},{key:"name",val:"objectId"}]),o=Simulators.findInArray(e.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t}]),s=Simulators.findInArray(e.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r}]),h=Simulators.findInArray(e.options,[{key:"name",val:"fieldset",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u}]),c=Simulators.findInArray(e.options,[{key:"name",val:"column"}]),l;c?(l=Simulators.findInArray(c.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"columnId"}]),l?l.options.push(i):Simulators.addInArray(c.fields,[{key:"name",val:"stepId",list:"options"}],{label:o.label,name:o.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("whose label is"),name:"columnId",fieldType:"select",options:[i]}]}]}]}]}]})):e.options.push({label:Translator.trans("column"),name:"column",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("whose label is"),name:"columnId",fieldType:"select",options:[i]}]}]}]}]}]}]}]})})};Simulators.deleteFieldSetColumnInActions=function(n,t,i,r){$.each(["column"],function(u,f){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"columnId",list:"options"},{key:"name",val:r}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"columnId",list:"options"},{key:"name",val:r}])})};Simulators.isFieldRowInRules=function(n,t,i,r){var f=["fieldrow","field","prenote","postnote"],u=!1;return $.each(rules,function(e,o){return $.each(f,function(f,e){return($.each(o.ifdata,function(f,s){var h=Simulators.findInArray([s],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]);return h&&h.value==r?(u=o.id,!1):(h=Simulators.findInArray([s],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]),h&&h.value==r?(u=o.id,!1):void 0)}),u!==!1)?!1:($.each(o.elsedata,function(f,s){var h=Simulators.findInArray([s],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]);return h&&h.value==r?(u=o.id,!1):(h=Simulators.findInArray([s],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]),h&&h.value==r?(u=o.id,!1):void 0)}),u!==!1?!1:void 0)}),u!==!1?!1:void 0}),u};Simulators.changeFieldRowIdInRules=function(n,t,i,r,u){var f=["fieldrow","field","prenote","postnote"],e;$.each(f,function(f,e){var o=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r}]);o&&(o.name=u);o=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r}]);o&&(o.name=u)});e=$("#business-rules").find(".rule-action");e.each(function(){this.hasAttribute("data-fieldrow")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-fieldrow")==r&&$(this).attr("data-fieldrow",u)});$.each(rules,function(e,o){$.each(f,function(f,e){$.each(o.ifdata,function(f,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]);s&&s.value==r&&(s.value=u);s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]);s&&s.value==r&&(s.value=u)});$.each(o.elsedata,function(f,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]);s&&s.value==r&&(s.value=u);s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldrowId"}]);s&&s.value==r&&(s.value=u)})})})};Simulators.changeFieldRowLabelInRules=function(n,t,i,r,u){var f,e;u||(u=Translator.trans("FieldRow %id% (nolabel)",{id:r}));f=["fieldrow","field"];$.each(f,function(f,e){var o=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r}]);o&&(o.label=u);o=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r}]);o&&(o.label=u)});e=$("#business-rules").find(".rule-action");e.each(function(){if(this.hasAttribute("data-fieldrow")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-fieldrow")==r){var e=$(this).attr("data-target"),f=$(this).find("span.action-fieldrow");switch(e){case"fieldrow":f.text(" «"+u+"»");break;case"field":f.text(" "+Translator.trans("in")+" "+u)}}})};Simulators.addFieldRowInActions=function(n){var i={label:n.label!=""?n.label:Translator.trans("FieldRow %id% (nolabel)",{id:n.id}),name:n.id},t=n.stepId,r=n.panelId,u=n.fieldsetId;$.each(["hideObject","showObject"],function(n,f){var e=Simulators.findInArray(actions,[{key:"name",val:f,list:"fields"},{key:"name",val:"objectId"}]),o=Simulators.findInArray(e.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t}]),s=Simulators.findInArray(e.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r}]),h=Simulators.findInArray(e.options,[{key:"name",val:"fieldset",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u}]),c=Simulators.findInArray(e.options,[{key:"name",val:"fieldrow"}]),l;c?(l=Simulators.findInArray(c.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"fieldrowId"}]),l?l.options.push(i):Simulators.addInArray(c.fields,[{key:"name",val:"stepId",list:"options"}],{label:o.label,name:o.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("whose label is"),name:"fieldrowId",fieldType:"select",options:[i]}]}]}]}]}]})):e.options.push({label:Translator.trans("fieldrow"),name:"fieldrow",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("whose label is"),name:"fieldrowId",fieldType:"select",options:[i]}]}]}]}]}]}]}]})})};Simulators.deleteFieldRowInActions=function(n,t,i,r){$.each(["fieldrow","field","prenote","postnote"],function(u,f){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r}])})};Simulators.isFieldInRules=function(n,t,i,r,u){var f=!1;return $.each(rules,function(e,o){var s;return($.each(o.ifdata,function(e,h){return(s=r===""?Simulators.findInArray([h],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([h],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]),s&&s.value==u)?(f=o.id,!1):(s=r===""?Simulators.findInArray([h],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([h],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]),s&&s.value==u?(f=o.id,!1):void 0)}),f!==!1)?!1:($.each(o.elsedata,function(e,h){return(s=r===""?Simulators.findInArray([h],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([h],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]),s&&s.value==u)?(f=o.id,!1):(s=r===""?Simulators.findInArray([h],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([h],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]),s&&s.value==u?(f=o.id,!1):void 0)}),f!==!1?!1:void 0)}),f};Simulators.changeFieldIdInRules=function(n,t,i,r,u,f){var e;$.each(["field","prenote","postnote"],function(e,o){var s;s=r===""?Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]):Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]);s&&(s.name=f);s=r===""?Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]):Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]);s&&(s.name=f)});e=$("#business-rules").find(".rule-action");e.each(function(){this.hasAttribute("data-field")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-fieldrow")==r&&$(this).attr("data-field")==u&&$(this).attr("data-field",f)});$.each(rules,function(e,o){var s;$.each(o.ifdata,function(e,o){s=r===""?Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]);s&&s.value==u&&(s.value=f);s=r===""?Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]);s&&s.value==u&&(s.value=f)});$.each(o.elsedata,function(e,o){s=r===""?Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]);s&&s.value==u&&(s.value=f);s=r===""?Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"fieldId"}]):Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"field",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"fieldId"}]);s&&s.value==u&&(s.value=f)})})};Simulators.changeFieldLabelInRules=function(n,t,i,r,u,f){var e,o;f||(f=Translator.trans("Field %id% (nolabel)",{id:u}));e=["field","prenote","postnote"];$.each(e,function(e,o){var s;s=r===""?Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]):Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]);s&&(s.label=f);s=r===""?Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]):Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]);s&&(s.label=f)});o=$("#business-rules").find(".rule-action");o.each(function(){var o,e;if(this.hasAttribute("data-field")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-fieldset")==i&&$(this).attr("data-fieldrow")==r&&$(this).attr("data-field")==u){o=$(this).attr("data-target");e=$(this).find("span.action-field");switch(o){case"field":e=$(this).find("span.action-field");e.text(" «"+f+"»");break;case"prenote":e=$(this).find("span.action-prenote");e.text(" "+Translator.trans("of field «%label%»",{label:f}));break;case"postnote":e=$(this).find("span.action-postnote");e.text(" "+Translator.trans("of field «%label%»",{label:f}))}}})};Simulators.addFieldInActions=function(n){var t={label:n.label!=""?n.label:Translator.trans("Field %id% (nolabel)",{id:n.position}),name:n.position},i=n.stepId,r=n.panelId,u=n.fieldsetId,f=n.fieldrowId;$.each(["hideObject","showObject"],function(n,e){var s=Simulators.findInArray(actions,[{key:"name",val:e,list:"fields"},{key:"name",val:"objectId"}]),h=Simulators.findInArray(s.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i}]),c=Simulators.findInArray(s.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r}]),o=Simulators.findInArray(s.options,[{key:"name",val:"fieldset",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u}]),a,v,l,y;o.disposition==="grid"?(a=Simulators.findInArray(s.options,[{key:"name",val:"fieldrow",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:f}]),l=Simulators.findInArray(s.options,[{key:"name",val:"field"}]),l?(v=Simulators.findInArray(l.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"fieldId"}]),v?v.options.push(t):Simulators.addInArray(l.fields,[{key:"name",val:"stepId",list:"options"}],{label:h.label,name:h.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:c.label,name:c.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("of fieldrow"),name:"fieldrowId",fieldType:"select",options:[{label:a.label,name:a.name,fields:[{label:Translator.trans("whose label is"),name:"fieldId",fieldType:"select",options:[t]}]}]}]}]}]}]}]})):s.options.push({label:Translator.trans("field"),name:"field",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:c.label,name:c.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("of fieldrow"),name:"fieldrowId",fieldType:"select",options:[{label:a.label,name:a.name,fields:[{label:Translator.trans("whose label is"),name:"fieldId",fieldType:"select",options:[t]}]}]}]}]}]}]}]}]}]})):(l=Simulators.findInArray(s.options,[{key:"name",val:"field"}]),l?(y=Simulators.findInArray(l.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"fieldId"}]),y?y.options.push(t):Simulators.addInArray(l.fields,[{key:"name",val:"stepId",list:"options"}],{label:h.label,name:h.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:c.label,name:c.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("whose label is"),name:"fieldId",fieldType:"select",options:[t]}]}]}]}]}]})):s.options.push({label:Translator.trans("field"),name:"field",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:c.label,name:c.name,fields:[{label:Translator.trans("of fieldset"),name:"fieldsetId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("whose label is"),name:"fieldId",fieldType:"select",options:[t]}]}]}]}]}]}]}]}))})};Simulators.deleteFieldInActions=function(n,t,i,r,u){$.each(["field","prenote","postnote"],function(f,e){r===""?Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]):Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]);r===""?Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}]):Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"fieldsetId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"fieldrowId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"fieldId",list:"options"},{key:"name",val:u}])})};Simulators.isBlockInfoInRules=function(n,t,i){var u=["blockinfo","chapter","section"],r=!1;return $.each(rules,function(f,e){return $.each(u,function(u,f){return($.each(e.ifdata,function(u,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]);return s&&s.value==i?(r=e.id,!1):(s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]),s&&s.value==i?(r=e.id,!1):void 0)}),r!==!1)?!1:($.each(e.elsedata,function(u,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]);return s&&s.value==i?(r=e.id,!1):(s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]),s&&s.value==i?(r=e.id,!1):void 0)}),r!==!1?!1:void 0)}),r!==!1?!1:void 0}),r};Simulators.changeBlockInfoIdInRules=function(n,t,i,r){var u=["blockinfo","chapter","section"],f;$.each(u,function(u,f){var e=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i}]);e&&(e.name=r);e=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i}]);e&&(e.name=r)});f=$("#business-rules").find(".rule-action");f.each(function(){this.hasAttribute("data-blockinfo")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-blockinfo")==i&&$(this).attr("data-blockinfo",r)});$.each(rules,function(f,e){$.each(u,function(u,f){$.each(e.ifdata,function(u,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]);o&&o.value==i&&(o.value=r);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]);o&&o.value==i&&(o.value=r)});$.each(e.elsedata,function(u,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]);o&&o.value==i&&(o.value=r);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:f,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"name",val:"blockinfoId"}]);o&&o.value==i&&(o.value=r)})})})};Simulators.changeBlockInfoLabelInRules=function(n,t,i,r){var u,f;r||(r=Translator.trans("Blockinfo %id% (nolabel)",{id:i}));u=["blockinfo","chapter","section"];$.each(u,function(u,f){var e=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i}]);e&&(e.label=r);e=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i}]);e&&(e.label=r)});f=$("#business-rules").find(".rule-action");f.each(function(){if(this.hasAttribute("data-blockinfo")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-blockinfo")==i){var f=$(this).attr("data-target"),u=$(this).find("span.action-blockinfo");switch(f){case"blockinfo":u.text(" «"+r+"»");break;case"chapter":u.text(" "+Translator.trans("in blockinfo «%blockinfo%»",{blockinfo:r}));break;case"section":u.text(" "+Translator.trans("of blockinfo «%blockinfo%»",{blockinfo:r}))}}})};Simulators.addBlockInfoInActions=function(n){var t={label:n.label!=""?n.label:Translator.trans("Blockinfo %id% (nolabel)",{id:n.id}),name:n.id},i=n.stepId,r=n.panelId;$.each(["hideObject","showObject"],function(n,u){var f=Simulators.findInArray(actions,[{key:"name",val:u,list:"fields"},{key:"name",val:"objectId"}]),e=Simulators.findInArray(f.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i}]),o=Simulators.findInArray(f.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r}]),s=Simulators.findInArray(f.options,[{key:"name",val:"blockinfo"}]),h;s?(h=Simulators.findInArray(s.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"blockinfoId"}]),h?h.options.push(t):Simulators.addInArray(s.fields,[{key:"name",val:"stepId",list:"options"}],{label:e.label,name:e.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("whose label is"),name:"blockinfoId",fieldType:"select",options:[t]}]}]}]})):f.options.push({label:Translator.trans("blockinfo"),name:"blockinfo",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:e.label,name:e.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("whose label is"),name:"blockinfoId",fieldType:"select",options:[t]}]}]}]}]}]})})};Simulators.deleteBlockInfoInActions=function(n,t,i){$.each(["blockinfo","chapter","section"],function(r,u){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i}])})};Simulators.isChapterInRules=function(n,t,i,r){var f=["chapter","section"],u=!1;return $.each(rules,function(e,o){return $.each(f,function(f,e){return($.each(o.ifdata,function(f,s){var h=Simulators.findInArray([s],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]);return h&&h.value==r?(u=o.id,!1):(h=Simulators.findInArray([s],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]),h&&h.value==r?(u=o.id,!1):void 0)}),u!==!1)?!1:($.each(o.elsedata,function(f,s){var h=Simulators.findInArray([s],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]);return h&&h.value==r?(u=o.id,!1):(h=Simulators.findInArray([s],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:e,list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]),h&&h.value==r?(u=o.id,!1):void 0)}),u!==!1?!1:void 0)}),u!==!1?!1:void 0}),u};Simulators.changeChapterIdInRules=function(n,t,i,r,u){var f;$.each(["chapter","section"],function(f,e){var o=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r}]);o&&(o.name=u);o=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r}]);o&&(o.name=u)});f=$("#business-rules").find(".rule-action");f.each(function(){this.hasAttribute("data-chapter")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-blockinfo")==i&&$(this).attr("data-chapter")==r&&$(this).attr("data-chapter",u)});$.each(rules,function(f,e){$.each(e.ifdata,function(f,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]);o&&o.value==r&&(o.value=u);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]);o&&o.value==r&&(o.value=u)});$.each(e.elsedata,function(f,e){var o=Simulators.findInArray([e],[{key:"value",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]);o&&o.value==r&&(o.value=u);o=Simulators.findInArray([e],[{key:"value",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"name",val:"chapterId"}]);o&&o.value==r&&(o.value=u)})})};Simulators.changeChapterLabelInRules=function(n,t,i,r,u){var f,e;u||(u=Translator.trans("Chapter %id% (nolabel)",{id:r}));f=["chapter","section"];$.each(f,function(f,e){var o=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r}]);o&&(o.label=u);o=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r}]);o&&(o.label=u)});e=$("#business-rules").find(".rule-action");e.each(function(){if(this.hasAttribute("data-chapter")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-blockinfo")==i&&$(this).attr("data-chapter")==r){var e=$(this).attr("data-target"),f=$(this).find("span.action-chapter");switch(e){case"chapter":f.text(" «"+u+"»");break;case"section":f.text(" "+Translator.trans("in")+" "+u)}}})};Simulators.addChapterInActions=function(n){var i={label:n.label!=""?n.label:Translator.trans("Chapter %id% (nolabel)",{id:n.id}),name:n.id},t=n.stepId,r=n.panelId,u=n.blockinfoId;$.each(["hideObject","showObject"],function(n,f){var e=Simulators.findInArray(actions,[{key:"name",val:f,list:"fields"},{key:"name",val:"objectId"}]),o=Simulators.findInArray(e.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t}]),s=Simulators.findInArray(e.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r}]),h=Simulators.findInArray(e.options,[{key:"name",val:"blockinfo",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:u}]),c=Simulators.findInArray(e.options,[{key:"name",val:"chapter"}]),l;c?(l=Simulators.findInArray(c.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"chapterId"}]),l?l.options.push(i):Simulators.addInArray(c.fields,[{key:"name",val:"stepId",list:"options"}],{label:o.label,name:o.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of blockinfo"),name:"blockinfoId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("whose label is"),name:"chapterId",fieldType:"select",options:[i]}]}]}]}]}]})):e.options.push({label:Translator.trans("chapter"),name:"chapter",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:o.label,name:o.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of blockinfo"),name:"blockinfoId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("whose label is"),name:"chapterId",fieldType:"select",options:[i]}]}]}]}]}]}]}]})})};Simulators.deleteChapterInActions=function(n,t,i,r){$.each(["chapter","section"],function(u,f){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r}])})};Simulators.isSectionInRules=function(n,t,i,r,u){var f=!1;return $.each(rules,function(e,o){return($.each(o.ifdata,function(e,s){var h=Simulators.findInArray([s],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]);return h&&h.value==u?(f=o.id,!1):(h=Simulators.findInArray([s],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]),h&&h.value==u?(f=o.id,!1):void 0)}),f!==!1)?!1:($.each(o.elsedata,function(e,s){var h=Simulators.findInArray([s],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]);return h&&h.value==u?(f=o.id,!1):(h=Simulators.findInArray([s],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]),h&&h.value==u?(f=o.id,!1):void 0)}),f!==!1?!1:void 0)}),f};Simulators.changeSectionIdInRules=function(n,t,i,r,u,f){var e;$.each(["section"],function(e,o){var s=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"sectionId",list:"options"},{key:"name",val:u}]);s&&(s.name=f);s=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"sectionId",list:"options"},{key:"name",val:u}]);s&&(s.name=f)});e=$("#business-rules").find(".rule-action");e.each(function(){this.hasAttribute("data-section")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-blockinfo")==i&&$(this).attr("data-chapter")==r&&$(this).attr("data-section")==u&&$(this).attr("data-section",f)});$.each(rules,function(e,o){$.each(o.ifdata,function(e,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]);s&&s.value==u&&(s.value=f);s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]);s&&s.value==u&&(s.value=f)});$.each(o.elsedata,function(e,o){var s=Simulators.findInArray([o],[{key:"value",val:"hideObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]);s&&s.value==u&&(s.value=f);s=Simulators.findInArray([o],[{key:"value",val:"showObject",list:"fields"},{key:"value",val:"section",list:"fields"},{key:"value",val:n,list:"fields"},{key:"value",val:t,list:"fields"},{key:"value",val:i,list:"fields"},{key:"value",val:r,list:"fields"},{key:"name",val:"sectionId"}]);s&&s.value==u&&(s.value=f)})})};Simulators.changeSectionLabelInRules=function(n,t,i,r,u,f){var e,o;f||(f=Translator.trans("Section %id% (nolabel)",{id:u}));e=["section"];$.each(e,function(e,o){var s=Simulators.findInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"sectionId",list:"options"},{key:"name",val:u}]);s&&(s.label=f);s=Simulators.findInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:o,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"sectionId",list:"options"},{key:"name",val:u}]);s&&(s.label=f)});o=$("#business-rules").find(".rule-action");o.each(function(){if(this.hasAttribute("data-section")&&$(this).attr("data-step")==n&&$(this).attr("data-panel")==t&&$(this).attr("data-blockinfo")==i&&$(this).attr("data-chapter")==r&&$(this).attr("data-section")==u){var e=$(this).attr("data-target"),o=$(this).find("span.action-section");e=="section"&&o.text(" "+f)}})};Simulators.addSectionInActions=function(n){var r={label:n.label!=""?n.label:Translator.trans("Section %id% (nolabel)",{id:n.id}),name:n.id},t=n.stepId,i=n.panelId,u=n.blockinfoId,f=n.chapterId;$.each(["hideObject","showObject"],function(n,e){var o=Simulators.findInArray(actions,[{key:"name",val:e,list:"fields"},{key:"name",val:"objectId"}]),s=Simulators.findInArray(o.options,[{key:"name",val:"step",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t}]),h=Simulators.findInArray(o.options,[{key:"name",val:"panel",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:i}]),c=Simulators.findInArray(o.options,[{key:"name",val:"blockinfo",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:u}]),l=Simulators.findInArray(o.options,[{key:"name",val:"chapter",list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:f}]),a=Simulators.findInArray(o.options,[{key:"name",val:"section"}]),v;a?(v=Simulators.findInArray(a.fields,[{key:"name",val:"stepId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:u,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:f,list:"fields"},{key:"name",val:"sectionId"}]),v?v.options.push(r):Simulators.addInArray(a.fields,[{key:"name",val:"stepId",list:"options"}],{label:s.label,name:s.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("of blockinfo"),name:"blockinfoId",fieldType:"select",options:[{label:c.label,name:c.name,fields:[{label:Translator.trans("of chapter"),name:"chapterId",fieldType:"select",options:[{label:l.label,name:l.name,fields:[{label:Translator.trans("whose label is"),name:"sectionId",fieldType:"select",options:[r]}]}]}]}]}]}]}]})):o.options.push({label:Translator.trans("chapter"),name:"chapter",fields:[{label:Translator.trans("of step"),name:"stepId",fieldType:"select",options:[{label:s.label,name:s.name,fields:[{label:Translator.trans("of panel"),name:"panelId",fieldType:"select",options:[{label:h.label,name:h.name,fields:[{label:Translator.trans("of blockinfo"),name:"blockinfoId",fieldType:"select",options:[{label:c.label,name:c.name,fields:[{label:Translator.trans("of chapter"),name:"chapterId",fieldType:"select",options:[{label:l.label,name:l.name,fields:[{label:Translator.trans("whose label is"),name:"sectionId",fieldType:"select",options:[r]}]}]}]}]}]}]}]}]}]})})};Simulators.deleteSectionInActions=function(n,t,i,r,u){$.each(["section"],function(f,e){Simulators.deleteInArray(actions,[{key:"name",val:"hideObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"sectionId",list:"options"},{key:"name",val:u}]);Simulators.deleteInArray(actions,[{key:"name",val:"showObject",list:"fields"},{key:"name",val:"objectId",list:"options"},{key:"name",val:e,list:"fields"},{key:"name",val:"stepId",list:"options"},{key:"name",val:n,list:"fields"},{key:"name",val:"panelId",list:"options"},{key:"name",val:t,list:"fields"},{key:"name",val:"blockinfoId",list:"options"},{key:"name",val:i,list:"fields"},{key:"name",val:"chapterId",list:"options"},{key:"name",val:r,list:"fields"},{key:"name",val:"sectionId",list:"options"},{key:"name",val:u}])})};Simulators.collectRuleConnector=function(n){var i=n.find(".rule-conditions"),r=i.attr("data-rule-id"),t=null;return $.each(rules,function(n,i){if(i.id==r)return t=i.connector||null,!1}),t};Simulators.collectRuleActions=function(n){var t=[];return n.find(".rule-action").each(function(){var n=$(this).attr("data-target"),i,r;switch($(this).attr("data-name")){case"notifyError":case"notifyWarning":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"message",value:$(this).attr("data-value")},{name:"target",value:n,fields:[]}]};switch(n){case"data":i.fields[1].fields.push({name:"fieldName",value:Simulators.findDataNameById($(this).attr("data-data"))});break;case"datagroup":i.fields[1].fields.push({name:"datagroupName",value:$(this).attr("data-datagroup")})}break;case"hideObject":case"showObject":switch(n){case"field":case"prenote":case"postnote":r=Simulators.findInArray(steps,[{key:"id",val:$(this).attr("data-step"),list:"panels"},{key:"id",val:$(this).attr("data-panel"),list:"blocks"},{key:"id",val:$(this).attr("data-fieldset")}]);i=r.disposition==="grid"?{name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset"),fields:[{name:"fieldrowId",value:$(this).attr("data-fieldrow"),fields:[{name:"fieldId",value:$(this).attr("data-"+n)}]}]}]}]}]}]}:{name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset"),fields:[{name:"fieldId",value:$(this).attr("data-"+n)}]}]}]}]}]};break;case"section":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"blockinfoId",value:$(this).attr("data-blockinfo"),fields:[{name:"chapterId",value:$(this).attr("data-chapter"),fields:[{name:"sectionId",value:$(this).attr("data-section")}]}]}]}]}]}]};break;case"chapter":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"blockinfoId",value:$(this).attr("data-blockinfo"),fields:[{name:"chapterId",value:$(this).attr("data-chapter")}]}]}]}]}]};break;case"column":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset"),fields:[{name:"columnId",value:$(this).attr("data-column")}]}]}]}]}]};break;case"fieldrow":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset"),fields:[{name:"fieldrowId",value:$(this).attr("data-fieldrow")}]}]}]}]}]};break;case"fieldset":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset")}]}]}]}]};break;case"blockinfo":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"blockinfoId",value:$(this).attr("data-blockinfo")}]}]}]}]};break;case"panel":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel")}]}]}]};break;case"step":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step")}]}]};break;case"footnote":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"footnoteId",value:$(this).attr("data-footnote")}]}]}]};break;case"action":i={name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"actionId",value:$(this).attr("data-action")}]}]}]};break;case"choice":r=Simulators.findInArray(steps,[{key:"id",val:$(this).attr("data-step"),list:"panels"},{key:"id",val:$(this).attr("data-panel"),list:"blocks"},{key:"id",val:$(this).attr("data-fieldset")}]);i=r.disposition==="grid"?{name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset"),fields:[{name:"fieldrowId",value:$(this).attr("data-fieldrow"),fields:[{name:"fieldId",value:$(this).attr("data-field"),fields:[{name:"choiceId",value:$(this).attr("data-choice")}]}]}]}]}]}]}]}:{name:"action-select",value:$(this).attr("data-name"),fields:[{name:"objectId",value:n,fields:[{name:"stepId",value:$(this).attr("data-step"),fields:[{name:"panelId",value:$(this).attr("data-panel"),fields:[{name:"fieldsetId",value:$(this).attr("data-fieldset"),fields:[{name:"fieldId",value:$(this).attr("data-field"),fields:[{name:"choiceId",value:$(this).attr("data-choice")}]}]}]}]}]}]}}break;case"setAttribute":i={name:"action-select",value:"setAttribute",fields:[{name:"attributeId",value:n,fields:[{name:"fieldName",value:Simulators.findDataNameById($(this).attr("data-data")),fields:[{name:"newValue",value:$(this).attr("data-value")}]}]}]};break;case"unsetAttribute":i={name:"action-select",value:"unsetAttribute",fields:[{name:"attributeId",value:n,fields:[{name:"fieldName",value:Simulators.findDataNameById($(this).attr("data-data"))}]}]}}t.push(i)}),t};Simulators.findRuleIndexByName=function(n){var t=-1;return $.each(rules,function(i,r){if(r.name==n)return t=i,!1}),t};Simulators.renumberRules=function(){$.each(rules,function(n,t){var i=n+1;t.name=="R"+t.id&&(t.name="R"+i,$("#"+t.elementId).find("span.rule-name").html(t.name));t.label=="R"+t.id&&(t.label="R"+i,$("#"+t.elementId).find("span.rule-label").html(t.label));t.id=i;$("#"+t.elementId).find("span.rule-id").html(t.id);$("#"+t.elementId).find("ul.rule-conditions").attr("data-rule-id",t.id)})};Simulators.sortRulesFromUI=function(){var n=[];$("#business-rules").children("div.rule-container").each(function(){var t=$.trim($(this).find("span.rule-name").text()),i=Simulators.findRuleIndexByName(t);n.push(rules[i])});rules=n.slice(0);Simulators.renumberRules()};Simulators.bindSortableRules=function(){$("#business-rules").sortable({cursor:"move",containment:"parent",axis:"y",sort:function(){Simulators.updating&&(Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),setTimeout(function(){$("#business-rules").sortable("cancel")},0))},update:function(){Simulators.updating||(Simulators.sortRulesFromUI(),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.maxRuleId=function(){var n=0;return $.each(rules,function(t,i){var r=parseInt(i.id);r>n&&(n=r)}),n};Simulators.bindRuleButtons=function(n){n||(n=$("#businessrules"));n.find("button.edit-rule").on("click",function(n){n.preventDefault();Simulators.editRule($($(this).attr("data-parent")))});n.find("button.delete-rule").on("click",function(n){n.preventDefault();Simulators.deleteRule($($(this).attr("data-parent")))})};Simulators.bindRule=function(n){var t=$("#"+n.elementId);t.find(".conditions").conditionsBuilder({fields:Simulators.dataset,expressionOptions:Simulators.expressionOptions,conditions:n.conditions,connector:n.connector});t.find(".add-if-action").removeClass("update-button").show();t.find(".if-actions").actionsBuilder({fields:Simulators.dataset,expressionOptions:Simulators.expressionOptions,addButton:t.find(".add-if-action"),actions:actions,data:n.ifdata});t.find(".add-else-action").removeClass("update-button").show();t.find(".else-actions").actionsBuilder({fields:Simulators.dataset,expressionOptions:Simulators.expressionOptions,addButton:t.find(".add-else-action"),actions:actions,data:n.elsedata});t.find("> div > button.delete-rule").on("click",function(t){t.preventDefault();var i=Simulators.findRuleIndexByName(n.name);$(this).parents("div.rule-container").remove();rules.splice(i,1);Simulators.renumberRules()});t.find(".input-rule-name").on("keypress",function(n){n.keyCode==13&&(n.preventDefault(),$(this).trigger("change"))});t.find(".input-rule-name").on("input propertychange",function(){var n=this;setTimeout(function(){$(n).trigger("change")},0)});t.find(".input-rule-name").on("paste",function(){var n=this;setTimeout(function(){$(n).trigger("change");$(this).focusNextInputField()},0)});t.find(".input-rule-name").on("change",function(){t.find(".rule-name").text($(this).val())});t.find(".input-rule-label").on("keypress",function(n){n.keyCode==13&&(n.preventDefault(),$(this).trigger("change"))});t.find(".input-rule-label").on("input propertychange",function(){var n=this;setTimeout(function(){$(n).trigger("change")},0)});t.find(".input-rule-label").on("paste",function(){var n=this;setTimeout(function(){$(n).trigger("change");$(this).focusNextInputField()},0)});t.find(".input-rule-label").on("change",function(){t.find(".rule-label").text($(this).val())});t.find(".cancel-edit-rule").on("click",function(){t.replaceWith(Simulators.ruleBackup);Simulators.ruleBackup.find("button.edit-rule").on("click",function(n){n.preventDefault();Simulators.editRule($($(this).attr("data-parent")))});Simulators.ruleBackup.find("button.delete-rule").on("click",function(n){n.preventDefault();Simulators.deleteRule($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});t.find(".cancel-add-rule").on("click",function(){t.remove();rules.pop();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});t.find(".validate-add-rule, .validate-edit-rule").on("click",function(){var r,n,i;if(!Simulators.checkRule(t))return!1;r=t.find(".conditions").conditionsBuilder("conditions");n={elementId:"",id:t.find(".rule-id").text(),name:t.find(".input-rule-name").val(),label:t.find(".input-rule-label").val(),conditions:r,connector:r,ifdata:t.find(".if-actions").actionsBuilder("actions"),elsedata:t.find(".else-actions").actionsBuilder("actions")};n.conditions.all&&n.conditions.all.length==1?n.conditions=n.conditions.all[0]:n.conditions.any&&n.conditions.any.length==1&&(n.conditions=n.conditions.any[0]);n.connector.all&&n.connector.all.length==1?n.connector=n.connector.all[0]:n.connector.any&&n.connector.any.length==1&&(n.connector=n.connector.any[0]);i=Simulators.drawRuleForDisplay(n);n.elementId=i.attr("id");$.each(rules,function(t,i){if(i.id==n.id)return rules[t]=n,!1});t.replaceWith(i);Simulators.bindRuleButtons(i);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)})};Simulators.drawRuleForDisplay=function(n){var i="rule-"+Math.floor(Math.random()*1e5),o=$("<div>",{id:i,"class":"card bg-info sortable rule-container"}),u,f,s,e,t,r;return o.append('<div class="card-header" role="tab"><button class="btn btn-info float-right update-button delete-rule" title="'+Translator.trans("Delete")+'" data-parent="#'+i+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button><button class="btn btn-info float-right update-button edit-rule" title="'+Translator.trans("Edit")+'" data-parent="#'+i+'"><span class="button-label">'+Translator.trans("Edit")+'<\/span> <span class="fas fa-pencil-alt"><\/span><\/button><h4 class="card-title"><a data-toggle="collapse" data-parent="#business-rules" href="#collapse'+i+'" aria-expanded="true" aria-controls="collapse'+i+'">'+Translator.trans("Rule")+' #<span class="rule-id">'+n.id+'<\/span> <span class="rule-name">'+n.name+'<\/span> : <span class="rule-label">'+n.label+"<\/span><\/a><\/h4><\/div>"),u=$("<div>",{id:"collapse"+i,"class":"card-body panel-collapse collapse in",role:"tabpanel"}),f=$('<div class="card bg-light conditions-panel"><\/div>'),f.append('<div class="card-header"><h4>'+Translator.trans("When ...")+"<\/h4><\/div>"),s=$('<div class="card-body"><\/div>'),e=jQuery.extend(!0,{},n.connector),Simulators.plainConditions(e),s.append('<ul class="rule-conditions" data-value="'+e+'" data-rule-element-id="'+i+'" data-rule-id="'+n.id+'">'+Simulators.drawConditionForDisplay(e)+"<\/ul>"),f.append(s),u.append(f),n.ifdata.length>0&&(t=$('<div class="card bg-light if-actions-panel"><\/div>'),t.append('<div class="card-header"><h4>'+Translator.trans("then do ...")+"<\/h4><\/div>"),r=$('<div class="card-body"><\/div>'),$.each(n.ifdata,function(n,t){var i=Simulators.drawRuleActionForDisplay(n+1,t);r.append(i)}),t.append(r),u.append(t)),n.elsedata.length>0&&(t=$('<div class="card bg-light else-actions-panel"><\/div>'),t.append('<div class="card-header"><h4>'+Translator.trans("else do ...")+"<\/h4><\/div>"),r=$('<div class="card-body"><\/div>'),$.each(n.elsedata,function(n,t){var i=Simulators.drawRuleActionForDisplay(n+1,t);r.append(i)}),t.append(r),u.append(t)),o.append(u),o};Simulators.drawConditionsForDisplay=function(n){var t=[];return $.each(n,function(n,i){t.push(Simulators.drawConditionForDisplay(i))}),t.join("")};Simulators.drawConditionForDisplay=function(n){return n.all?'<li class="condition">'+Translator.trans("All of the following conditions are met")+" :<ul>"+Simulators.drawConditionsForDisplay(n.all)+"<\/ul><\/li>":n.any?'<li class="condition">'+Translator.trans("Any of the following conditions is met")+" :<ul>"+Simulators.drawConditionsForDisplay(n.any)+"<\/ul><\/li>":n.none?'<li class="condition">'+Translator.trans("None of the following conditions is met")+" :<ul>"+Simulators.drawConditionsForDisplay(n.none)+"<\/ul><\/li>":'<li class="condition"><data class="data" value="'+n.id+'">«'+n.name+"»<\/data> "+n.operator+" "+n.value+"<\/li>"};Simulators.getPlainOperator=function(n,t){var i={"=":Translator.trans("is equal to"),"!=":Translator.trans("is not equal to"),">":Translator.trans("is greater than"),">=":Translator.trans("is greater than or equal to"),"<":Translator.trans("is less than"),"<=":Translator.trans("is less than or equal to"),isTrue:Translator.trans("is true"),isFalse:Translator.trans("is false"),"~":Translator.trans("contains"),"!~":Translator.trans("not contains"),matches:Translator.trans("matches"),present:Translator.trans("is present"),blank:Translator.trans("is not present")},r={"=":Translator.trans("is"),"!=":Translator.trans("is not"),">":Translator.trans("is after"),">=":Translator.trans("is not before"),"<":Translator.trans("is before"),"<=":Translator.trans("is not after"),"~":Translator.trans("contains"),"!~":Translator.trans("not contains"),present:Translator.trans("is present"),blank:Translator.trans("is not present")};return t=="date"||t=="day"||t=="month"||t=="year"?r[n]?r[n]:n:i[n]?i[n]:n};Simulators.plainConditions=function(n){var r,u,t,i;$.isArray(n)?$.each(n,function(t){Simulators.plainConditions(n[t])}):n.name?(u="boolean",n.name==="script"?(t=Simulators.dataset[n.name],n.id=t.id,n.name=Translator.trans("Javascript"),n.operator=Translator.trans("is"),n.value=n.value==1?Translator.trans("enabled"):Translator.trans("disabled")):n.name==="dynamic"?(t=Simulators.dataset[n.name],n.id=t.id,n.name=Translator.trans("User Interface"),n.operator=n.value==1?Translator.trans("is"):Translator.trans("is not"),n.value=Translator.trans("interactive")):(r=n.name.match(/step(\d+)\.dynamic$/))?(t=Simulators.dataset[n.name],n.id=t.id,n.name=Translator.trans("User Interface for step %id%",{id:r[1]}),n.operator=n.value==1?Translator.trans("is"):Translator.trans("is not"),n.value=Translator.trans("interactive")):(r=n.name.match(/^#(\d+)$/))?(t=Simulators.findDataById(r[1]),u=t.type,n.id=t.id,n.name=t.label,t.type==="choice"&&(i=Simulators.getChoiceLabel(t,n.value),i!=""&&(n.value="«"+i+"»"))):(t=Simulators.dataset[n.name],u=t.type,n.id=t.id,n.name=t.label,t.type==="choice"&&(i=Simulators.getChoiceLabel(t,n.value),i!=""&&(n.value="«"+i+"»"))),n.operator&&(n.operator=Simulators.getPlainOperator(n.operator,u)),n.value&&(n.value=Simulators.replaceByDataLabel(n.value))):n.all?Simulators.plainConditions(n.all):n.any?Simulators.plainConditions(n.any):n.none&&Simulators.plainConditions(n.none)};Simulators.drawRuleActionForDisplay=function(n,t){var c=t.value,s="",l=null,d=null,g="",ut="",r="",f="",e="",v="",nt="",o="",a="",y="",tt="",p="",w="",it="",rt="",b="",k="",h,i,ft,et,u;switch(c){case"notifyError":case"notifyWarning":s=t.fields[1].value;k=t.fields[0].value;switch(s){case"data":l=Simulators.dataset[t.fields[1].fields[0].value];g=l.id;break;case"datagroup":d=Simulators.datagroups[t.fields[1].fields[0].value];ut=d.name}break;case"setAttribute":s=t.fields[0].value;k=t.fields[0].fields[0].fields[0].value;l=Simulators.dataset[t.fields[0].fields[0].value];g=l.id;break;case"unsetAttribute":s=t.fields[0].value;l=Simulators.dataset[t.fields[0].fields[0].value];g=l.id;break;case"hideObject":case"showObject":s=t.fields[0].value;r=t.fields[0].fields[0].value;switch(s){case"field":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;h=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]);h.disposition==="grid"?(o=t.fields[0].fields[0].fields[0].fields[0].fields[0].value,a=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value):a=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"prenote":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;h=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]);h.disposition==="grid"?(o=t.fields[0].fields[0].fields[0].fields[0].fields[0].value,p=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value):p=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"postnote":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;h=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]);h.disposition==="grid"?(o=t.fields[0].fields[0].fields[0].fields[0].fields[0].value,w=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value):w=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"section":f=t.fields[0].fields[0].fields[0].value;v=t.fields[0].fields[0].fields[0].fields[0].value;y=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;tt=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"chapter":f=t.fields[0].fields[0].fields[0].value;v=t.fields[0].fields[0].fields[0].fields[0].value;y=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"fieldrow":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;o=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"column":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;nt=t.fields[0].fields[0].fields[0].fields[0].fields[0].value;break;case"fieldset":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;break;case"blockinfo":f=t.fields[0].fields[0].fields[0].value;v=t.fields[0].fields[0].fields[0].fields[0].value;break;case"panel":f=t.fields[0].fields[0].fields[0].value;break;case"footnote":it=t.fields[0].fields[0].fields[0].value;break;case"action":rt=t.fields[0].fields[0].fields[0].value;break;case"choice":f=t.fields[0].fields[0].fields[0].value;e=t.fields[0].fields[0].fields[0].fields[0].value;h=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]);h.disposition==="grid"?(o=t.fields[0].fields[0].fields[0].fields[0].fields[0].value,a=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value,b=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value):(a=t.fields[0].fields[0].fields[0].fields[0].fields[0].value,b=t.fields[0].fields[0].fields[0].fields[0].fields[0].fields[0].value)}}if(i=$("<div>",{"class":"rule-action","data-id":n,"data-name":c,"data-target":s,"data-data":g,"data-datagroup":ut,"data-step":r,"data-panel":f,"data-fieldset":e,"data-column":nt,"data-fieldrow":o,"data-field":a,"data-blockinfo":v,"data-chapter":y,"data-section":tt,"data-prenote":p,"data-postnote":w,"data-action":rt,"data-footnote":it,"data-choice":b,"data-value":k}),c==="notifyError"||c==="notifyWarning")ft=c==="notifyError"?Translator.trans("notify Error"):Translator.trans("notify Warning"),i.append('<span class="action-name">'+ft+' : <\/span> <span class="action-value">'+Simulators.replaceByDataLabel(k)+'<\/span> <span class="action-target"> '+Translator.trans("on")+" "+Translator.trans("the "+s)+" <\/span>"),s==="data"?i.append('<span class="action-data"><data class="data" value="'+l.id+'">«'+l.label+"»<\/data><\/span>"):s==="datagroup"&&i.append('<span class="action-datagroup"><data class="datagroup" value="'+d.name+'">«'+d.label+"»<\/data><\/span>");else if(c==="hideObject"||c==="showObject"){et=Simulators.findAction(c,actions);i.append('<span class="action-name">'+(c==="hideObject"?Translator.trans("hide"):Translator.trans("show"))+"<\/span>");u=Simulators.findActionOption("objectId",s,et);i.append('<span class="action-target"> '+Translator.trans("the "+s)+"<\/span>");switch(s){case"step":i.append('<span class="action-step"> «'+Simulators.findActionField([{stepId:r}],u).label+"»<\/span>");break;case"panel":i.append('<span class="action-panel"> «'+Simulators.findActionField([{stepId:r},{panelId:f}],u).label+"»<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"fieldset":i.append('<span class="action-fieldset"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label+"»<\/span>");i.append('<span class="action-panel"> '+Translator.trans("in panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"column":i.append('<span class="action-column"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{columnId:nt}],u).label+"»<\/span>");i.append('<span class="action-fieldset"> '+Translator.trans("in fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>");i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"fieldrow":i.append('<span class="action-fieldrow"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o}],u).label+"»<\/span>");i.append('<span class="action-fieldset"> '+Translator.trans("in fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>");i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"blockinfo":i.append('<span class="action-blockinfo"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{blockinfoId:v}],u).label+"»<\/span>");i.append('<span class="action-panel"> '+Translator.trans("in panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"chapter":i.append('<span class="action-chapter"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{blockinfoId:v},{chapterId:y}],u).label+"»<\/span>");i.append('<span class="action-blockinfo"> '+Translator.trans("in blockinfo «%blockinfo%»",{blockinfo:Simulators.findActionField([{stepId:r},{panelId:f},{blockinfoId:v}],u).label})+"<\/span>");i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"section":i.append('<span class="action-section"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{blockinfoId:v},{chapterId:y},{sectionId:tt}],u).label+"»<\/span>");i.append('<span class="action-chapter"> '+Translator.trans("in")+" "+Simulators.findActionField([{stepId:r},{panelId:f},{blockinfoId:v},{chapterId:y}],u).label+"<\/span>");i.append('<span class="action-blockinfo"> '+Translator.trans("of blockinfo «%blockinfo%»",{blockinfo:Simulators.findActionField([{stepId:r},{panelId:f},{blockinfoId:v}],u).label})+"<\/span>");i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"field":h.disposition==="grid"?(i.append('<span class="action-field"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o},{fieldId:a}],u).label+"»<\/span>"),i.append('<span class="action-fieldrow"> '+Translator.trans("in")+" "+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o}],u).label+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("of fieldset «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>")):(i.append('<span class="action-field"> «'+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldId:a}],u).label+"»<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("in fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>"));i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"prenote":h.disposition==="grid"?(i.append('<span class="action-prenote"> '+Translator.trans("of field «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o},{fieldId:p}],u).label})+"<\/span>"),i.append('<span class="action-fieldrow"> '+Translator.trans("in")+" "+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o}],u).label+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("of fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>")):(i.append('<span class="action-prenote"> '+Translator.trans("of field «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldId:p}],u).label})+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("in fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>"));i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"postnote":h.disposition==="grid"?(i.append('<span class="action-postnote"> '+Translator.trans("of field «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o},{fieldId:w}],u).label})+"<\/span>"),i.append('<span class="action-fieldrow"> '+Translator.trans("in")+" "+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o}],u).label+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("of fieldset «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>")):(i.append('<span class="action-postnote"> '+Translator.trans("of field «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldId:w}],u).label})+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("in fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>"));i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"footnote":i.append('<span class="action-footnote"> «'+Simulators.findActionField([{stepId:r},{footnoteId:it}],u).label+"»<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"action":i.append('<span class="action-action"> «'+Simulators.findActionField([{stepId:r},{actionId:rt}],u).label+"»<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>");break;case"choice":h.disposition==="grid"?(i.append('<span class="action-choice"> '+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o},{fieldId:a},{choiceId:b}],u).label+"<\/span>"),i.append('<span class="action-field"> '+Translator.trans("of field «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o},{fieldId:a}],u).label})+"<\/span>"),i.append('<span class="action-fieldrow"> '+Translator.trans("in")+" "+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldrowId:o}],u).label+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("of fieldset «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>")):(i.append('<span class="action-choice"> '+Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldId:a},{choiceId:b}],u).label+"<\/span>"),i.append('<span class="action-field"> '+Translator.trans("of field «%label%»",{label:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e},{fieldId:a}],u).label})+"<\/span>"),i.append('<span class="action-fieldset"> '+Translator.trans("in fieldset «%fieldset%»",{fieldset:Simulators.findActionField([{stepId:r},{panelId:f},{fieldsetId:e}],u).label})+"<\/span>"));i.append('<span class="action-panel"> '+Translator.trans("of panel «%panel%»",{panel:Simulators.findActionField([{stepId:r},{panelId:f}],u).label})+"<\/span>");i.append('<span class="action-step"> '+Translator.trans("of step «%label%»",{label:Simulators.findActionField([{stepId:r}],u).label})+"<\/span>")}}else c==="setAttribute"?i.append('<span class="action-name">'+Translator.trans("set")+'<\/span> <span class="action-target">'+Translator.trans("the "+s)+'<\/span> <span class="action-data"> '+Translator.trans("of «%label%»",{label:l.label})+'<\/span> <span class="action-value"> '+Translator.trans("to")+" "+Translator.trans(Simulators.replaceByValueLabel(l,k))+"<\/span>"):c==="unsetAttribute"&&i.append('<span class="action-name">'+Translator.trans("unset")+'<\/span> <span class="action-target">'+Translator.trans("the "+s)+'<\/span> <span class="action-data"> '+Translator.trans("of «%label%»",{label:l.label})+"<\/span>");return i};Simulators.findAction=function(n,t){for(var r,i=0;i<t.length;i++)if(r=t[i],r.name==n)return r;return null};Simulators.findActionField=function(n,t){for(var r,u,i=0;i<n.length;i++)if(r=Object.keys(n[i])[0],u=n[i][r],t=Simulators.findActionOption(r,u,t),!t)return null;return t};Simulators.findActionOption=function(n,t,i){for(var f,e,r,o,s=i.fields||[],u=0;u<s.length;u++)if(f=s[u],f.name==n)for(e=f.options||[],r=0;r<e.length;r++)if(o=e[r],o.name==t)return o;return null};Simulators.drawRuleForInput=function(n){var i="rule-"+Math.floor(Math.random()*1e5),u=$("<div>",{id:i,"class":"card bg-info sortable rule-container"}),t,f,r;return u.append('<div class="card-header" role="tab"><button class="btn btn-info float-right update-button delete-rule" title="'+Translator.trans("Delete")+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button><h4 class="card-title"><a data-toggle="collapse" data-parent="#business-rules" href="#collapse'+i+'" aria-expanded="true" aria-controls="collapse'+i+'">#<span class="rule-id">'+n.id+"<\/span> "+Translator.trans("Rule")+' <span class="rule-name">'+n.name+'<\/span> : <span class="rule-label">'+n.label+"<\/span><\/a><\/h4><\/div>"),t=$("<div>",{id:"collapse"+i,"class":"card-body panel-collapse collapse",role:"tabpanel"}),u.append(t),t.append('<div class="card bg-light"><div class="card-body form-inline"><div class="form-group"><label>'+Translator.trans("Name")+'<\/label><input type="text" class="input-rule-name" value="'+n.name+'" /><\/div><div class="form-group"><label>'+Translator.trans("Label")+'<\/label><input type="text" class="input-rule-label" value="'+n.label+'" /><\/div><\/div><\/div>'),t.append('<div class="card bg-light"><div class="card-header"><h4>'+Translator.trans("When ...")+'<\/h4><\/div><div class="card-body"><div class="conditions"><\/div><\/div><\/div>'),t.append('<div class="card bg-light"><div class="card-header"><button class="btn btn-info float-right update-button add-if-action" title="'+Translator.trans("Add Action")+'"><span class="button-label">'+Translator.trans("Add Action")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><h4>'+Translator.trans("then do ...")+'<\/h4><\/div><div class="card-body"><div class="if-actions"><\/div><\/div><\/div>'),t.append('<div class="card bg-light"><div class="card-header"><button class="btn btn-info float-right update-button add-else-action" title="'+Translator.trans("Add Action")+'"><span class="button-label">'+Translator.trans("Add Action")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><h4>'+Translator.trans("else do ...")+'<\/h4><\/div><div class="card-body"><div class="else-actions"><\/div><\/div><\/div>'),f=$('<div class="card bg-light buttons-panel" id="'+i+'-buttons-panel"><\/div>'),r=$('<div class="card-body rule-buttons"><\/div>'),r.append('<button class="btn btn-success float-right validate-edit-rule">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),r.append('<button class="btn btn-secondary float-right cancel-edit-rule">'+Translator.trans("Cancel")+"<\/span><\/button>"),r.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),f.append(r),t.append(f),u};Simulators.checkRule=function(n){var e=n.find("input.input-rule-name").val(),o,i,u,r,f,t;return e===""?(n.find(".error-message").text(Translator.trans("The rule name is required")),n.find(".alert").show(),!1):/^\w+$/.test(e)?(o=n.find("input.input-rule-label").val(),o==="")?(n.find(".error-message").text(Translator.trans("The rule label is required")),n.find(".alert").show(),!1):(i=n.find(".conditions"),i.find(".rule").length==0)?(n.find(".error-message").text(Translator.trans("Please enter at least one condition")),n.find(".alert").show(),!1):(u=!1,i.find(".editable-select").each(function(){if($(this).attr("data-value")=="")return u=!0,!1}),i.find(".expression").each(function(){if(!$(this).expressionbuilder("completed"))return u=!0,!1;$(this).expressionbuilder("state")}),u)?(n.find(".error-message").text(Translator.trans("Please, complete the input of the rule conditions")),n.find(".alert").show(),!1):(r=n.find(".actions"),r.find(".action").length==0)?(n.find(".error-message").text(Translator.trans("Please enter at least one action")),n.find(".alert").show(),!1):(f=!1,r.find(".editable-select, .editable-textarea, .editable-text").each(function(){if($(this).attr("data-value")=="")return f=!0,!1}),r.find(".expression").each(function(){if(!$(this).expressionbuilder("completed"))return f=!0,!1;$(this).expressionbuilder("state")}),f)?(n.find(".error-message").text(Translator.trans("Please, complete the input of the rule actions")),n.find(".alert").show(),!1):(t=!1,r.find(".editable-select[data-value=setAttribute]").each(function(){return $(this).next().find(".editable-select[name=attributeId]").each(function(){var n,r;if(($(this).attr("data-value")=="content"||$(this).attr("data-value")=="default")&&((n=$(this).next().find(".editable-select[name=fieldName]").attr("data-value"),i.find(".editable-select.field").each(function(){if($(this).attr("data-value")==n)return t=!0,!1}),t)||(r=Simulators.dataset[n].id,i.find(".value.expression").each(function(){if(!Simulators.checkDataInExpression(r,$(this)))return t=!0,!1}),t)||($(this).next().find(".editable-select[name=fieldName]").next().find(".expression").each(function(){if(!Simulators.checkDataInExpression(r,$(this)))return t=!0,!1}),t)))return!1}),t?!1:void 0}),t)?(n.find(".error-message").text(Translator.trans("You can not change the content or the default value of a data when it is used in a condition")),n.find(".alert").show(),!1):!0:(n.find(".error-message").text(Translator.trans("Incorrect rule name")),n.find(".alert").show(),!1)};Simulators.addRule=function(){var i,t,n;try{i=Simulators.maxRuleId()+1;t={id:i,name:"R"+i,label:"",conditions:"",connector:null,ifdata:[],elsedata:[]};rules.push(t);$(".toggle-collapse-all").hide();$(".update-button").hide();n=Simulators.drawRuleForInput(t);n.find("button.cancel-edit-rule").addClass("cancel-add-rule").removeClass("cancel-edit-rule");n.find("button.validate-edit-rule").addClass("validate-add-rule").removeClass("validate-edit-rule");$("#business-rules").append(n);t.elementId=n.attr("id");Simulators.bindRule(t);$("#collapsebusinessrules").collapse("show");n.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(r){console&&console.log(r.message)}};Simulators.editRule=function(n){var i,t;try{i={id:n.find(".rule-id").text(),name:n.find(".rule-name").text(),label:n.find(".rule-label").text(),conditions:n.find(".rule-conditions").attr("data-value"),connector:Simulators.collectRuleConnector(n.find(".conditions-panel")),ifdata:Simulators.collectRuleActions(n.find(".if-actions-panel")),elsedata:Simulators.collectRuleActions(n.find(".else-actions-panel"))};$(".update-button").hide();$(".toggle-collapse-all").hide();t=Simulators.drawRuleForInput(i);i.elementId=t.attr("id");Simulators.ruleBackup=n.replaceWith(t);Simulators.bindRule(i);$("#collapse"+t.attr("id")).collapse("show");$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(r){console&&console.log(r.message)}};Simulators.deleteRule=function(n){try{var r=n.find(".rule-id").text(),t=n.find(".rule-label").text();bootbox.confirm({title:Translator.trans("Deleting rule"),message:Translator.trans("Are you sure you want to delete the rule : %label% ?",{label:t}),callback:function(t){t&&(n.remove(),Simulators.sortRulesFromUI(),$(".save-simulator").show(),Admin.updated=!0)}})}catch(i){console&&console.log(i.message)}};Simulators.collectRules=function(){var n=[];return $("#business-rules .rule-container").each(function(){var t=$(this).find(".rule-conditions").attr("data-rule-id");$.each(rules,function(i,r){if(r.id==t)return n.push(r),!1})}),n}}(this),function(){"use strict";Simulators.SQLFunctions={sqlite:{abs:{arity:1,args:["number"],type:"number"},concat:{arity:-1,args:["text"],type:"text"},ifnull:{arity:2,args:["text","text"],type:"text"},instr:{arity:2,args:["text","text"],type:"number"},length:{arity:1,args:["text"],type:"number"},like:{arity:2,args:["text","text"],type:"boolean"},lower:{arity:1,args:["text"],type:"text"},ltrim:{arity:1,args:["text"],type:"text"},max:{arity:-1,args:["number"],type:"number"},min:{arity:-1,args:["number"],type:"number"},nullif:{arity:2,args:["text","text"],type:"text"},quote:{arity:1,args:["text"],type:"text"},random:{arity:0,args:[],type:"number"},replace:{arity:3,args:["text","text","text"],type:"text"},round:{arity:2,args:["number","number"],type:"number"},rtrim:{arity:1,args:["text"],type:"text"},soundex:{arity:1,args:["text"],type:"text"},trim:{arity:1,args:["text"],type:"text"},upper:{arity:1,args:["text"],type:"text"},strftime:{arity:2,args:["text","date"],type:"text"}},mysqli:{ascii:{arity:1,args:["text"],type:"number"},concat:{arity:-1,args:["text"],type:"text"},char:{arity:1,args:["number"],type:"text"},char_length:{arity:1,args:["text"],type:"number"},character_length:{arity:1,args:["text"],type:"number"},elt:{arity:1,args:["number"],type:"text"},format:{arity:2,args:["number","number"],type:"text"},insert:{arity:4,args:["text","number","number","text"],type:"text"},instr:{arity:2,args:["text","text"],type:"number"},left:{arity:2,args:["text","number"],type:"text"},length:{arity:1,args:["text"],type:"number"},locate:{arity:3,args:["text","text","number"],type:"number"},lower:{arity:1,args:["text"],type:"text"},lpad:{arity:3,args:["text","number","text"],type:"text"},ltrim:{arity:1,args:["text"],type:"text"},mid:{arity:3,args:["text","number","number"],type:"text"},position:{arity:3,args:["text","text","number"],type:"number"},quote:{arity:1,args:["text"],type:"text"},repeat:{arity:2,args:["text","number"],type:"text"},replace:{arity:3,args:["text","text","text"],type:"text"},reverse:{arity:1,args:["text"],type:"text"},right:{arity:2,args:["text","number"],type:"text"},rpad:{arity:3,args:["text","number","text"],type:"text"},rtrim:{arity:1,args:["text"],type:"text"},soundex:{arity:1,args:["text"],type:"text"},space:{arity:1,args:["number"],type:"text"},strcmp:{arity:1,args:["text","text"],type:"number"},substring:{arity:3,args:["text","number","number"],type:"text"},substring_index:{arity:3,args:["text","text","number"],type:"text"},trim:{arity:1,args:["text"],type:"text"},upper:{arity:1,args:["text"],type:"text"},abs:{arity:1,args:["number"],type:"number"},acos:{arity:1,args:["number"],type:"number"},asin:{arity:1,args:["number"],type:"number"},atan:{arity:1,args:["number"],type:"number"},atan2:{arity:1,args:["number"],type:"number"},ceil:{arity:1,args:["number"],type:"number"},ceiling:{arity:1,args:["number"],type:"number"},cos:{arity:1,args:["number"],type:"number"},cot:{arity:1,args:["number"],type:"number"},degrees:{arity:1,args:["number"],type:"number"},exp:{arity:1,args:["number"],type:"number"},floor:{arity:1,args:["number"],type:"number"},ln:{arity:1,args:["number"],type:"number"},log:{arity:1,args:["number"],type:"number"},log10:{arity:1,args:["number"],type:"number"},log2:{arity:1,args:["number"],type:"number"},power:{arity:2,args:["number","number"],type:"number"},radians:{arity:1,args:["number"],type:"number"},rand:{arity:1,args:["number"],type:"number"},round:{arity:2,args:["number","number"],type:"number"},sin:{arity:1,args:["number"],type:"number"},sqrt:{arity:1,args:["number"],type:"number"},tan:{arity:1,args:["number"],type:"number"},truncate:{arity:2,args:["number","number"],type:"number"},adddate:{arity:2,args:["date","number"],type:"date"},date_format:{arity:2,args:["date","text"],type:"text"},datediff:{arity:2,args:["date","date"],type:"number"},dayname:{arity:1,args:["date"],type:"text"},dayofmonth:{arity:1,args:["date"],type:"number"},dayofweek:{arity:1,args:["date"],type:"number"},dayofyear:{arity:1,args:["date"],type:"number"},from_days:{arity:1,args:["number"],type:"date"},last_day:{arity:1,args:["date"],type:"date"},makedate:{arity:3,args:["number","number","number"],type:"date"},month:{arity:1,args:["date"],type:"number"},monthname:{arity:1,args:["date"],type:"text"},now:{arity:0,args:[],type:"date"},quarter:{arity:1,args:["date"],type:"number"},str_to_date:{arity:1,args:["number"],type:"number"},subdate:{arity:2,args:["date","number"],type:"date"},to_days:{arity:1,args:["date"],type:"number"},week:{arity:2,args:["date","number"],type:"number"},weekday:{arity:1,args:["date"],type:"number"},weekofyear:{arity:1,args:["date"],type:"number"},year:{arity:1,args:["date"],type:"number"},yearweek:{arity:2,args:["date","number"],type:"number"}},pgsql:{ascii:{arity:1,args:["text"],type:"number"},concat:{arity:-1,args:["text"],type:"text"},char:{arity:1,args:["number"],type:"text"},char_length:{arity:1,args:["text"],type:"number"},character_length:{arity:1,args:["text"],type:"number"},initcap:{arity:1,args:["text"],type:"text"},length:{arity:1,args:["text"],type:"number"},lower:{arity:1,args:["text"],type:"text"},lpad:{arity:3,args:["text","number","text"],type:"text"},ltrim:{arity:2,args:["text","text"],type:"text"},repeat:{arity:2,args:["text","number"],type:"text"},replace:{arity:3,args:["text","text","text"],type:"text"},rpad:{arity:3,args:["text","number","text"],type:"text"},rtrim:{arity:2,args:["text","text"],type:"text"},split_part:{arity:3,args:["text","text","number"],type:"text"},strpos:{arity:2,args:["text","text"],type:"number"},substr:{arity:3,args:["text","number","number"],type:"text"},translate:{arity:3,args:["text","text","text"],type:"text"},upper:{arity:1,args:["text"],type:"text"},abs:{arity:1,args:["number"],type:"number"},acos:{arity:1,args:["number"],type:"number"},asin:{arity:1,args:["number"],type:"number"},atan:{arity:1,args:["number"],type:"number"},atan2:{arity:1,args:["number"],type:"number"},cbrt:{arity:1,args:["number"],type:"number"},ceil:{arity:1,args:["number"],type:"number"},ceiling:{arity:1,args:["number"],type:"number"},cos:{arity:1,args:["number"],type:"number"},cot:{arity:1,args:["number"],type:"number"},degrees:{arity:1,args:["number"],type:"number"},exp:{arity:1,args:["number"],type:"number"},floor:{arity:1,args:["number"],type:"number"},ln:{arity:1,args:["number"],type:"number"},log:{arity:1,args:["number"],type:"number"},mod:{arity:2,args:["number","number"],type:"number"},power:{arity:2,args:["number","number"],type:"number"},radians:{arity:1,args:["number"],type:"number"},random:{arity:0,args:[],type:"number"},round:{arity:2,args:["number","number"],type:"number"},sin:{arity:1,args:["number"],type:"number"},sqrt:{arity:1,args:["number"],type:"number"},tan:{arity:1,args:["number"],type:"number"},trunc:{arity:2,args:["number","number"],type:"number"},date_part:{arity:2,args:["text","date"],type:"number"},date_trunc:{arity:2,args:["text","date"],type:"date"},now:{arity:0,args:[],type:"date"}}};Simulators.SQLConstants={sqlite:{CURRENT_DATE:{type:"date"},CURRENT_TIME:{type:"date"}},mysqli:{CURRENT_DATE:{type:"date"},CURRENT_TIME:{type:"date"}},pgsql:{CURRENT_DATE:{type:"date"},CURRENT_TIME:{type:"date"}}};Simulators.SQLBaseOperators={present:Translator.trans("is present"),blank:Translator.trans("is not present")};Simulators.SQLTextOperators=$.extend({},Simulators.SQLBaseOperators,{"=":Translator.trans("is equal to"),"!=":Translator.trans("is not equal to"),"~":Translator.trans("contains"),"!~":Translator.trans("not contains")});Simulators.SQLNumericOperators=$.extend({},Simulators.SQLBaseOperators,{"=":Translator.trans("is equal to"),"!=":Translator.trans("is not equal to"),">":Translator.trans("is greater than"),">=":Translator.trans("is greater than or equal to"),"<":Translator.trans("is less than"),"<=":Translator.trans("is less than or equal to"),"~":Translator.trans("contains"),"!~":Translator.trans("not contains")});Simulators.SQLDateOperators=$.extend({},Simulators.SQLBaseOperators,{"=":Translator.trans("corresponds to"),"!=":Translator.trans("does not corresponds to"),">":Translator.trans("is after"),">=":Translator.trans("is not before"),"<":Translator.trans("is before"),"<=":Translator.trans("is not after")});Simulators.SQLBooleanOperators=$.extend({},Simulators.SQLBaseOperators,{isTrue:Translator.trans("is true"),isFalse:Translator.trans("is false")});Simulators.SQLExpressionOptions={constants:Simulators.SQLConstants,functions:Simulators.SQLFunctions,operators:["+","-","*","%","/","&","|"],onCompleted:function(){},onEditing:function(){},onError:function(n){console&&console.log("error : "+n)},language:Admin.lang,operandHolder:{classes:["button","button-default"]},operatorHolder:{classes:["button","button-default"]},nestedExpression:{classes:["button","button-default"]}};Simulators.columnset={};Simulators.parameterset={};Simulators.findColumnById=function(n,t){var i=null;return $.each(t,function(t,r){if(r.id==n)return i=r,!1}),i};Simulators.sourceBackup=null;Simulators.isDataNameInSources=function(n){var t=!1,i=$("#sources").find(".source-parameter-container");return i.each(function(){var i=$(this).attr("data-id"),r=$(this).find("p[data-attribute='data']");return r.each(function(){if($(this).attr("data-value")==n)return t=i,!1}),t!==!1?!1:void 0}),t};Simulators.changeDataNameInSources=function(n,t){var i=$("#sources").find(".source-parameter-container");i.each(function(){var i=$(this).find("p[data-attribute='data']");i.each(function(){$(this).attr("data-value")==n&&$(this).attr("data-value",t)})})};Simulators.changeDataLabelInSources=function(n,t){var i=$("#sources").find(".source-parameter-container");i.each(function(){var i=$(this).find("p[data-attribute='data']");i.each(function(){$(this).attr("data-value")==n&&$(this).html(t)})})};Simulators.maxSourceId=function(){var n=0,t=$("#sources").find(".source-container");return t.each(function(){var t=parseInt($(this).attr("data-id"));t>n&&(n=t)}),n};Simulators.renumberSources=function(n){n.each(function(n){var e=$(this).find("div.source-container"),r=e.attr("data-id"),t=n+1,f;if(t!=r){$(this).attr("id","source-"+t);var i=new RegExp("source-"+r+"([^\\d])?","g"),u=$(this).find("> .card > .card-header").find("> h4 > a"),o=$.trim(u.text()).replace(/#\d+\s+/," #"+t+" ");u.text(o+" ");f=$(this).find("*");f.each(function(){var n;this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(i,"source-"+t+"$1"),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(i,"source-"+t+"$1"),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(i,"source-"+t+"$1"),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(i,"source-"+t+"$1"),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(i,"source-"+t+"$1"),$(this).attr("aria-labelledby",n))});Simulators.changeSourceIdInDatas(r,"X"+t)}});n.each(function(n){var i=$(this).find("div.source-container"),r=i.attr("data-id"),t=n+1;t!=r&&(i.attr("data-id",t),Simulators.changeSourceIdInDatas("X"+t,t))})};Simulators.bindSortableSources=function(n){n||(n=$("#page-simulators #collapsesources"));n.find("> .sortable").sortable({cursor:"move",containment:"parent",axis:"y",sort:function(){Simulators.updating&&(Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),setTimeout(function(){n.find("> .sortable").sortable("cancel")},0))},update:function(n,t){if(!Simulators.updating){var r=$(this),i=$(t.item).find(".source-container"),u=i.attr("data-id");Simulators.renumberSources($(t.item).parent().find("> div"));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0}}})};Simulators.drawSourceForDisplay=function(n){var t="source-"+n.id,s=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),r=$("<div>",{"class":"card bg-info"}),y,u,f,e,o;r.append('<div class="card-header" role="tab" id="'+t+'-panel"><button class="btn btn-info float-right update-button delete-source" title="'+Translator.trans("Delete")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button><button class="btn btn-info float-right update-button edit-source" title="'+Translator.trans("Edit")+'" data-parent="#'+t+'"><span class="button-label">'+Translator.trans("Edit")+'<\/span> <span class="fas fa-pencil-alt"><\/span><\/button><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" "+n.label+"<\/a><\/h4><\/div>");var h=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),c=$('<div class="card-body"><\/div>'),l=$('<div class="card bg-light source-container" id="'+t+'-attributes-panel" data-id="'+n.id+'"><\/div>'),a=$('<div class="card-body"><\/div>'),v=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>");return i.append(Simulators.simpleAttributeForDisplay(t,"text","label",Translator.trans("Label"),n.label,n.label,!1,Translator.trans("Label"))),i.append(Simulators.simpleAttributeForDisplay(t,"text","datasource",Translator.trans("Datasource"),n.datasource,n.datasource,!0,Translator.trans("Datasource"))),datasources[n.datasource].type!=="uri"&&(i.append(Simulators.simpleAttributeForDisplay(t,"select","requestType",Translator.trans("Request type"),n.requestType,n.requestType,!0,Translator.trans("Select a request type"),JSON.stringify({simple:Translator.trans("Simple"),complex:Translator.trans("Complex")}))),n.requestType=="simple"?(y=datasources[n.datasource].tables[n.table.toLowerCase()].label,i.append(Simulators.simpleAttributeForDisplay(t,"text","table",Translator.trans("Table"),n.table,"«"+y+"»",!0,Translator.trans("Table"))),u=Simulators.simpleAttributeForDisplay(t,"text","columns",Translator.trans("Selected columns"),"","",!0,Translator.trans("Selected columns")),f=u.find("p[data-attribute='columns']"),$.each(n.columns,function(n,t){n>0&&f.append("<span>, <\/span>");var i=$("<span>",{"data-attribute":"column","data-value":t.column,"data-alias":t.alias});t.alias&&t.alias!=""&&t.alias.toLowerCase()!=t.column.toLowerCase()?i.append("«"+t.label+"» "+Translator.trans("alias")+" "+t.alias):i.append("«"+t.label+"»");f.append(i)}),i.append(u),n.where==="true"?i.append(Simulators.simpleAttributeForDisplay(t,"text","filter",Translator.trans("Filter"),encodeURIComponent(n.where),Translator.trans("No filter"),!1,Translator.trans("Filter"))):i.append(Simulators.simpleAttributeForDisplay(t,"text","filter",Translator.trans("Filter"),encodeURIComponent(n.where),n.where,!1,Translator.trans("Filter"))),e=Simulators.simpleAttributeForDisplay(t,"text","orderbykeys",Translator.trans("Order by"),"","",!0,Translator.trans("Order by")),o=e.find("p[data-attribute='orderbykeys']"),$.each(n.orderby,function(n,t){n>0&&o.append("<span>, <\/span>");var i=$("<span>",{"data-attribute":"orderbykey","data-value":t.key,"data-order":t.order});t.order=="desc"?i.append("«"+t.label+"» "+Translator.trans("in descending order")):i.append("«"+t.label+"» "+Translator.trans("in ascending order"));o.append(i)}),i.append(e),n.nbresult==""||n.nbresult==0?i.append(Simulators.simpleAttributeForDisplay(t,"number","nbresult",Translator.trans("Number of results"),n.nbresult,Translator.trans("All results"),!0,Translator.trans("Number of results"))):i.append(Simulators.simpleAttributeForDisplay(t,"number","nbresult",Translator.trans("Number of results"),n.nbresult,n.nbresult,!0,Translator.trans("Number of results"))),n.from==""||n.from==0?i.append(Simulators.simpleAttributeForDisplay(t,"number","from",Translator.trans("From"),n.from,Translator.trans("from start"),!0,Translator.trans("From"))):i.append(Simulators.simpleAttributeForDisplay(t,"number","from",Translator.trans("From"),n.from,n.from,!0,Translator.trans("From")))):n.request&&i.append(Simulators.simpleAttributeForDisplay(t,"text","request",Translator.trans("Request"),encodeURIComponent(n.request),n.request,!1,Translator.trans("Request")))),i.append(Simulators.simpleAttributeForDisplay(t,"select","returnType",Translator.trans("Return type"),n.returnType,n.returnType,!0,Translator.trans("Select a return type"),JSON.stringify(Simulators.sourceReturnTypes))),n.returnPath&&i.append(Simulators.simpleAttributeForDisplay(t,"text","returnPath",Translator.trans("Return path"),n.returnPath,n.returnPath,!1,Translator.trans("Return path"))),n.returnType&&n.returnType=="csv"&&(n.separator&&i.append(Simulators.simpleAttributeForDisplay(t,"text","separator",Translator.trans("Separator"),n.separator,n.separator,!1,Translator.trans("Separator"))),n.delimiter&&i.append(Simulators.simpleAttributeForDisplay(t,"text","delimiter",Translator.trans("Delimiter"),n.delimiter,n.delimiter,!1,Translator.trans("Delimiter")))),v.append(i),a.append(v),l.append(a),c.append(l),h.append(c),r.append(h),s.append(r),s};Simulators.drawSourceParametersForDisplay=function(n){var t=$("<div>",{"class":"card bg-light source-parameters-panel",id:"source-"+n+"-source--parameters-panel"}),i;return t.append('<div class="card-header">'+Translator.trans("Parameters")+"<\/div>"),i=$('<div class="card-body"><\/div>'),t.append(i),t};Simulators.drawSourceParameterForDisplay=function(n,t){var u=$("<div>",{"class":"card bg-light source-parameter-container","data-id":t.id}),f,h;u.append('<div class="card-header">'+Translator.trans("Parameter %id%",{id:t.id})+"<\/div>");var e=$("<div>",{"class":"card-body",id:"source-"+t.sourceId+"-source-parameter-"+t.id+"-panel"}),o=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>"),s={},r="";return t.origin=="data"&&$.each(Simulators.dataset,function(n,i){s[n]=i.label;n==t.data&&(r=i.type)}),datasources[n].type==="uri"&&(f={queryString:Translator.trans("Query string parameter"),path:Translator.trans("PATH"),header:Translator.trans("HTTP header")},datasources[n].method==="post"&&(f.data=Translator.trans("POST data")),i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"select","type",Translator.trans("Type"),t.type,t.type,!0,Translator.trans("Select a type"),JSON.stringify(f)))),h={data:Translator.trans("Data"),constant:Translator.trans("Constant")},i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"text","name",Translator.trans("Name"),t.name,t.name,!0,Translator.trans("Parameter name"))),i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"select","origin",Translator.trans("Origin"),t.origin,t.origin,!0,Translator.trans("Select an origin"),JSON.stringify(h))),t.origin=="data"?(i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"select","data",Translator.trans("Data"),t.data,t.data,!0,Translator.trans("Select a data"),JSON.stringify(s))),(r==="date"||r==="day"||r==="month"||r==="year")&&i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"text","format",Translator.trans("Format"),t.format,Translator.trans(t.format),!0,Translator.trans("Parameter format")))):i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"text","constant",Translator.trans("Constant"),t.constant,t.constant,!0,Translator.trans("Parameter constant"))),i.append(Simulators.simpleAttributeForDisplay("source-"+t.sourceId+"-source-parameter-"+t.id,"checkbox","optional",Translator.trans("Optional"),t.optional,t.optional,!0,Translator.trans("Optional"))),o.append(i),e.append(o),u.append(e),u};Simulators.requestColumnsAttributeForInput=function(n,t,i,r,u,f){var e='<div class="form-group row">';return e+='    <label for="'+n+'" class="col-sm-4 col-form-label">',e+="    "+i+"<\/label>",e+='    <div id="'+n+'" class="col-sm-8 input-group">',e+='        <ul class="request-columns-container form-control" tabindex="0" title="'+Translator.trans("Click the + button on the right to add a column")+'" data-source="'+t+'" data-database-type="'+u+'" data-datasource="'+r+'" data-table="'+f+'">',e+="        <\/ul>",e+='        <span class="input-group-addon"><a href="#" class="add-request-column">+<\/a><\/span>',e+="    <\/div>",e+="<\/div>",$(e)};Simulators.requestColumnAttributeForInput=function(n,t,i){var r='            <li class="request-column-container">';return r+='              <a href="#" class="delete-request-column">x<\/a>',r+='              <span data-attribute="column" class="attribute-expression" data-placeholder="'+t+'"  data-value="'+n+'" />',i&&i!=""&&i.toLowerCase()!=n.toLowerCase()&&(r+='              <span class="column-alias"> '+Translator.trans("alias")+" <\/span>",r+='              <span class="editable-text" data-value="'+i+'">'+i+"<\/span>"),r+="            <\/li>",$(r)};Simulators.requestFilterAttributeForInput=function(n,t,i,r,u,f){var e='<div class="request-filter-tools-container form-group row">';return e+='    <label for="'+n+'-tools" class="col-sm-4 col-form-label"><\/label>',e+='    <div id="'+n+'-tools" class="col-sm-8">',e+='        <div class="request-filter-connector-container">',e+='            <span class="editable-select connector" data-value="'+i+'">'+Translator.trans(i=="all"?"All of the following":i=="any"?"Any of the following":"Advanced")+"<\/span>",e+="        <\/div>",e+='        <div class="request-filter-parenthesis-container">',e+='            <a class="parenthesis" href="#">+ ( )<\/a>',e+="        <\/div>",e+="    <\/div>",e+="<\/div>",e+='<div class="request-filter-conditions-container form-group row">',e+='    <label for="'+n+'-conditions" class="col-sm-4 col-form-label">'+Translator.trans("Filter")+"<\/label>",e+='    <div id="'+n+'-conditions" class="col-sm-8 input-group">',e+='        <ul class="request-filter-conditions form-control" tabindex="0" title="'+Translator.trans("Click the + button on the right to add a condition")+'" data-source="'+t+'" data-database-type="'+u+'" data-datasource="'+r+'" data-table="'+f+'">',e+="        <\/ul>",e+='        <span class="input-group-addon"><a href="#" class="add-request-condition">+<\/a><\/span>',e+="    <\/div>",e+="<\/div>",e+='<div class="request-filter-expression-container form-group row">',e+='    <label for="'+n+'-expression" class="col-sm-4 col-form-label"><\/label>',e+='    <div id="'+n+'-expression" class="col-sm-8 input-group">',e+='        <ul class="form-control request-filter-expression" data-source="'+t+'" data-database-type="'+u+'" data-datasource="'+r+'" data-table="'+f+'">',e+="        <\/ul>",e+="    <\/div>",e+="<\/div>",$(e)};Simulators.refreshRequestFilterDisplay=function(n){var t=n.prev(),i=n.next(),r=n.find(".request-filter-conditions").children().length;r<2?(t.hide(),n.css("margin-top","0px"),n.find(".request-filter-condition-num").hide(),i.hide()):(t.show(),n.css("margin-top","-10px"),n.find(".request-filter-condition-num").show(),t.find(".connector").attr("data-value")=="advanced"?(t.find(".request-filter-parenthesis-container").show(),i.show()):t.find(".request-filter-parenthesis-container").hide())};Simulators.requestFilterParenthesisAttributeForInput=function(n){var i=n=="("?"[":"]",t='<li class="request-expression-token-wrap request-parenthesis-container">';return t+='    <div href="#" class="request-expression-token request-bracket" data-value="'+n+'">',t+="    "+i+'<a href="#" class="fas fa-times request-expression-delete-token"><\/a>',t+="    <\/div>",t+="<\/li>",$(t)};Simulators.requestFilterConnectorAttributeForInput=function(n){var t='<li class="request-expression-token-wrap request-connector-container">';return t+='    <div class="request-expression-token request-connector" data-value="'+n+'">',t+="    "+Translator.trans(n),t+="    <\/div>",t+="<\/li>",$(t)};Simulators.requestFilterConditionNumAttributeForInput=function(n){var t='<li class="request-expression-token-wrap request-condition-container">';return t+='    <div class="request-expression-token request-condition" data-value="'+n+'">',t+="    "+n,t+="    <\/div>",t+="<\/li>",$(t)};Simulators.requestFilterConditionAttributeForInput=function(n,t,i,r,u,f){var e='            <li class="request-filter-condition-container">';return e+='              <span class="request-expression-token request-filter-condition-num" data-value="'+n+'">'+n+"<\/span>",e+='              <div class="request-filter-condition-edition-container">',e+='                  <a href="#" class="delete-request-filter-condition">x<\/a>',e+='                  <span data-attribute="operand" class="attribute-expression operand" data-placeholder="'+i+'"  data-value="'+t+'" />',r!=""&&(e+='                  <span class="editable-select operator" data-attribute="operator" data-type="number" data-value="'+r+'">'+Simulators.SQLNumericOperators[r]+"<\/span>",u!=""&&(e+='                  <span data-attribute="value" class="attribute-expression value" data-placeholder="'+f+'"  data-value="'+u+'" />')),e+="              <\/div>",e+="            <\/li>",$(e)};Simulators.requestOrderByKeysAttributeForInput=function(n,t,i,r,u,f){var e='<div class="form-group row">';return e+='    <label for="'+n+'" class="col-sm-4 col-form-label">',e+="    "+i+"<\/label>",e+='    <div id="'+n+'" class="col-sm-8 input-group">',e+='        <ul class="request-orderbykeys-container form-control" tabindex="0" title="'+Translator.trans("Click the + button on the right to add a sort key")+'" data-source="'+t+'" data-database-type="'+u+'" data-datasource="'+r+'" data-table="'+f+'">',e+="        <\/ul>",e+='        <span class="input-group-addon"><a href="#" class="add-request-orderbykey">+<\/a><\/span>',e+="    <\/div>",e+="<\/div>",$(e)};Simulators.requestOrderByKeyAttributeForInput=function(n,t,i){var r='            <li class="request-orderbykey-container">';return r+='              <a href="#" class="delete-request-orderbykey">x<\/a>',r+='              <span data-attribute="orderbykey" class="attribute-expression" data-placeholder="'+t+'"  data-value="'+n+'" />',r+='              <span class="editable-select" data-value="'+i+'">'+Translator.trans(i=="desc"?"in descending order":"in ascending order")+"<\/span>",r+="            <\/li>",$(r)};Simulators.drawSourceForInput=function(n){var t="source-"+n.id,et=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),v=$("<div>",{"class":"card bg-info"}),at,w,b,k,o,vt,s,h,yt,u,l,a,bt,g,nt,tt,it,rt,ut,c,ft,f;v.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+"<\/a><\/h4><\/div>");var ot=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),y=$('<div class="card-body"><\/div>'),st=$('<div class="card bg-light source-container" id="'+t+'-attributes-panel" data-id="'+n.id+'"><\/div>'),ht=$('<div class="card-body"><\/div>'),ct=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>"),p={};n.datasource==""&&(p[""]=Translator.trans("Select a data source"));var e="",r="",lt={};if($.each(datasources,function(t,i){p[t]=t;t==n.datasource&&(e=i.type,r=i.dbtype,i.type!=="uri"&&$.each(i.tables,function(n,t){lt[t.name]=t.label}))}),Simulators.columnset={},n.datasource&&n.table&&(Simulators.columnset=datasources[n.datasource].tables[n.table.toLowerCase()].columns),at={simple:Translator.trans("Simple"),complex:Translator.trans("Complex")},i.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Source label"),n.label,!0,Translator.trans("Source label"))),i.append(Simulators.simpleAttributeForInput(t+"-datasource","select","datasource",Translator.trans("Datasource"),n.datasource,!0,Translator.trans("Select a data source"),JSON.stringify(p))),w=Simulators.simpleAttributeForInput(t+"-requestType","select","requestType",Translator.trans("Request type"),n.requestType,!0,Translator.trans("Select a request type"),JSON.stringify(at)),i.append(w),b=Simulators.simpleAttributeForInput(t+"-request","text","request",Translator.trans("Request"),n.request,!0,Translator.trans("Enter a SQL request")),i.append(b),k=Simulators.simpleAttributeForInput(t+"-table","select","table",Translator.trans("Table"),n.table,!0,Translator.trans("Select a table"),JSON.stringify(lt)),i.append(k),o=Simulators.requestColumnsAttributeForInput(t+"-request-columns",n.id,Translator.trans("Selected columns"),n.datasource,r,n.table),vt=o.find(".request-columns-container"),$.each(n.columns,function(n,t){vt.append(Simulators.requestColumnAttributeForInput(t.column,Translator.trans("Select a column"),t.alias))}),i.append(o),s="all",n.filter!=""&&n.filter!="true"){yt=new SQLSelectTokenizer(datasources[n.datasource].tables,Simulators.SQLFunctions[r]);h=yt.parseWhere(n.filter,n.table);var pt=!1,wt=!1,d=!1;$.each(h.expression,function(n,t){t=="("||t==")"?pt=!0:t=="and"?wt=!0:t=="or"&&(d=!0)});pt||wt&&d?s="advanced":d&&(s="any")}return u=Simulators.requestFilterAttributeForInput(t+"-request-filter",n.id,s,n.datasource,r,n.table),i.append(u),n.filter!=""&&n.filter!="true"&&(c=u.find(".request-filter-conditions"),l=u.find(".request-filter-expression"),$.each(h.conditions,function(n,t){var i=Simulators.requestFilterConditionAttributeForInput(n+1,t.operand,Translator.trans("Select a column"),t.operator,t.value,Translator.trans("Select a value"));c.append(i)}),$.each(h.expression,function(n,t){t=="("||t==")"?l.append(Simulators.requestFilterParenthesisAttributeForInput(t)):t=="and"||t=="or"?l.append(Simulators.requestFilterConnectorAttributeForInput(t)):l.append(Simulators.requestFilterConditionNumAttributeForInput(t))})),a=Simulators.requestOrderByKeysAttributeForInput(t+"-request-orderbykeys",n.id,Translator.trans("Order by"),n.datasource,r,n.table),bt=a.find(".request-orderbykeys-container"),$.each(n.orderby,function(n,t){bt.append(Simulators.requestOrderByKeyAttributeForInput(t.key,Translator.trans("Select a column"),t.order))}),i.append(a),g=Simulators.simpleAttributeForInput(t+"-nbresult","number","nbresult",Translator.trans("Number of results"),n.nbresult,!0,Translator.trans("Number of results")),i.append(g),nt=Simulators.simpleAttributeForInput(t+"-from","number","from",Translator.trans("From"),n.from,!0,Translator.trans("From")),i.append(nt),tt=Simulators.simpleAttributeForInput(t+"-returnType","select","returnType",Translator.trans("Return type"),n.returnType,!0,Translator.trans("Select a return type"),JSON.stringify(Simulators.sourceReturnTypes)),i.append(tt),it=Simulators.simpleAttributeForInput(t+"-returnPath","text","returnPath",Translator.trans("Return path"),n.returnPath,!0,Translator.trans("Enter a return path")),i.append(it),rt=Simulators.simpleAttributeForInput(t+"-separator","text","separator",Translator.trans("Separator"),n.separator,!0,Translator.trans("Enter a separator")),i.append(rt),ut=Simulators.simpleAttributeForInput(t+"-delimiter","text","delimiter",Translator.trans("Delimiter"),n.delimiter,!0,Translator.trans("Enter a delimiter")),i.append(ut),(n.datasource==""||e==="uri")&&w.hide(),(n.datasource==""||e==="uri"||n.requestType==="simple")&&b.hide(),n.datasource==""||e==="uri"||n.requestType==="complex"?(k.hide(),o.hide(),u.hide(),a.hide(),g.hide(),nt.hide()):(c=i.find(".request-filter-conditions-container"),Simulators.refreshRequestFilterDisplay(c)),n.datasource==""&&tt.hide(),(n.datasource==""||n.returnType==="singleValue")&&it.hide(),(n.datasource==""||n.returnType!=="csv")&&(rt.hide(),ut.hide()),ct.append(i),ht.append(ct),st.append(ht),y.append(st),ft=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),f=$('<div class="card-body source-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-source">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-source">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),ft.append(f),y.append(ft),ot.append(y),v.append(ot),et.append(v),et};Simulators.bindSourceButtons=function(n){n||(n=$("#collapsesources"));n.find("button.edit-source").on("click",function(n){n.preventDefault();Simulators.editSource($($(this).attr("data-parent")))});n.find("button.delete-source").on("click",function(n){n.preventDefault();Simulators.deleteSource($($(this).attr("data-parent")))})};Simulators.bindRequestColumnAttribute=function(n){var t=n.hasClass("request-column-container")?n:n.find(".request-column-container");t.find(".attribute-expression").each(function(){var n=$(this),t=n.parent().parent().attr("data-database-type");n.expressionbuilder({fields:Simulators.columnset,constants:Simulators.SQLExpressionOptions.constants[t],functions:Simulators.SQLExpressionOptions.functions[t],operators:Simulators.SQLExpressionOptions.operators,parameters:Simulators.parameterset,initial:n.attr("data-value"),onCompleted:function(n,t){var r=t.expressionbuilder("val"),s,i;t.attr("data-value",r.replace(/#(\d+)/g,function(n,t){var i=Simulators.findColumnById(t,Simulators.columnset);return i!=null?i.name:n}));var f=t.parent().parent(),e=f.attr("data-datasource"),o=f.attr("data-table"),h="",u=r.match(/^#(\d+)$/);u||(u=datasources[e].tables[o.toLowerCase()].columns.hasOwnProperty(r.toLowerCase()),u&&(h=datasources[e].tables[o.toLowerCase()].columns[r.toLowerCase()].label));u||(s=t.next(),s.length==0&&(i=$('<span class="editable-text text-warning" data-value=""><\/span>'),t.after(i),t.after('<span class="column-alias"> '+Translator.trans("alias")+" <\/span>"),i.editable(function(n){return $(this).attr("data-value",n),n},{name:i.attr("name"),id:"text-"+Math.floor(Math.random()*1e5),type:"text",placeholder:Translator.trans("click to enter the column alias"),tooltip:Translator.trans("click to edit the column alias"),style:"inherit",callback:function(){i.removeClass("text-warning")}})))},onEditing:Simulators.SQLExpressionOptions.onEditing,onError:Simulators.SQLExpressionOptions.onError,language:Simulators.SQLExpressionOptions.language,operandHolder:Simulators.SQLExpressionOptions.operandHolder,operatorHolder:Simulators.SQLExpressionOptions.operatorHolder,nestedExpression:Simulators.SQLExpressionOptions.nestedExpression})});t.find(".editable-text").each(function(){var n=$(this);n.editable(function(n){return $(this).attr("data-value",n),n},{name:n.attr("name"),id:"text-"+Math.floor(Math.random()*1e5),type:"text",placeholder:Translator.trans("click to enter the column alias"),tooltip:Translator.trans("click to edit the column alias"),style:"inherit"})});n.find(".delete-request-column").on("click",function(n){n.preventDefault();$(this).parent().remove()})};Simulators.bindRequestOrderByKeyAttribute=function(n){var t=n.hasClass("request-orderbykey-container")?n:n.find(".request-orderbykey-container");t.find(".attribute-expression").each(function(){var n=$(this),t=n.parent().parent().attr("data-database-type");n.expressionbuilder({fields:Simulators.columnset,constants:Simulators.SQLExpressionOptions.constants[t],functions:Simulators.SQLExpressionOptions.functions[t],operators:Simulators.SQLExpressionOptions.operators,parameters:Simulators.parameterset,initial:n.attr("data-value"),onCompleted:function(n,t){var i=t.expressionbuilder("val");t.attr("data-value",i.replace(/#(\d+)/g,function(n,t){var i=Simulators.findColumnById(t,Simulators.columnset);return i!=null?i.name:n}))},onEditing:Simulators.SQLExpressionOptions.onEditing,onError:Simulators.SQLExpressionOptions.onError,language:Simulators.SQLExpressionOptions.language,operandHolder:Simulators.SQLExpressionOptions.operandHolder,operatorHolder:Simulators.SQLExpressionOptions.operatorHolder,nestedExpression:Simulators.SQLExpressionOptions.nestedExpression})});t.find(".editable-select").each(function(){var n=$(this);n.editable(function(n,t){return $(this).attr("data-value",n),t.data.selected=n,t.data[n]},{data:{asc:Translator.trans("in ascending order"),desc:Translator.trans("in descending order"),selected:n.attr("data-value")||"asc"},name:n.attr("name"),type:"select",placeholder:Translator.trans("click to enter the sort order"),tooltip:Translator.trans("click to edit the sort order"),style:"inherit"})});n.find(".delete-request-orderbykey").on("click",function(n){n.preventDefault();$(this).parent().remove()})};Simulators.bindRequestFilterConnectorAttribute=function(n){var t=n.hasClass("request-connector-container")?n:n.find(".request-connector-container");t.find(".request-connector").on("click",function(n){n.preventDefault();$(this).attr("data-value")=="and"?($(this).attr("data-value","or"),$(this).text(Translator.trans("or"))):($(this).attr("data-value","and"),$(this).text(Translator.trans("and")))})};Simulators.bindRequestFilterParenthesisAttribute=function(n){var t=n.hasClass("request-parenthesis-container")?n:n.find(".request-parenthesis-container");t.find(".request-expression-delete-token").on("click",function(n){var t,r;n.preventDefault();var u=$(this).parent().parent(),f=u.find(".request-bracket").attr("data-value"),i=0;if(f=="("){for(t=u.next();t.length>0;){if(r=t.find(".request-expression-token").attr("data-value"),r==")")if(i==0){t.remove();break}else i--;else r=="("&&i++;t=t.next()}u.remove()}else{for(t=u.prev();t.length>0;){if(r=t.find(".request-expression-token").attr("data-value"),r=="(")if(i==0){t.remove();break}else i--;else r==")"&&i++;t=t.prev()}u.remove()}})};Simulators.bindRequestFilterToolsAttribute=function(n){var t=n.hasClass("request-filter-tools-container")?n:n.find(".request-filter-tools-container");t.find(".editable-select").each(function(){var n=$(this);n.editable(function(n,i){return $(this).attr("data-value",n),n=="advanced"?(t.find(".request-filter-parenthesis-container").show(),t.parent().find(".request-filter-expression-container").show()):(t.find(".request-filter-parenthesis-container").hide(),t.parent().find(".request-filter-expression-container").hide()),i.data.selected=n,i.data[n]},{data:{all:Translator.trans("All of the following"),any:Translator.trans("Any of the following"),advanced:Translator.trans("Advanced"),selected:n.attr("data-value")||"all"},name:n.attr("name"),type:"select",placeholder:Translator.trans("Select the filter type"),tooltip:Translator.trans("Select the filter type"),style:"inherit"});n.attr("data-value")=="advanced"?(t.find(".request-filter-parenthesis-container").show(),t.parent().find(".request-filter-expression-container").show()):(t.find(".request-filter-parenthesis-container").hide(),t.parent().find(".request-filter-expression-container").hide())});t.find(".parenthesis").on("click",function(n){var i,r,u;n.preventDefault();i=t.parent().find(".request-filter-expression");i.children().length>0&&(r=Simulators.requestFilterParenthesisAttributeForInput("("),i.prepend(r),Simulators.bindRequestFilterParenthesisAttribute(r),u=Simulators.requestFilterParenthesisAttributeForInput(")"),i.append(u),Simulators.bindRequestFilterParenthesisAttribute(u))})};Simulators.bindRequestFilterConditionAttribute=function(n){var t=n.hasClass("request-filter-condition-container")?n:n.find(".request-filter-condition-container");t.find(".attribute-expression.operand").each(function(){var n=$(this),t=n.parent().parent().parent().attr("data-database-type");n.expressionbuilder({fields:Simulators.columnset,constants:Simulators.SQLExpressionOptions.constants[t],functions:Simulators.SQLExpressionOptions.functions[t],operators:Simulators.SQLExpressionOptions.operators,parameters:Simulators.parameterset,initial:n.attr("data-value"),onCompleted:function(n,t){var e=t.expressionbuilder("val"),r;t.attr("data-value",e.replace(/#(\d+)/g,function(n,t){var i=Simulators.findColumnById(t,Simulators.columnset);return i!=null?i.name:n}));var i=t.next(),u=!1,f="";i.length>0&&i.attr("data-type")!=n&&(f=i.attr("data-value"),i.editable("destroy"),i.remove(),u=!0);(i.length==0||u)&&(r=$('<span class="editable-select operator" data-type="'+n+'" data-attribute="operator" data-value="'+f+'"><\/span>'),t.after(r),Simulators.bindRequestFilterConditionOperator(r))},onEditing:Simulators.SQLExpressionOptions.onEditing,onError:Simulators.SQLExpressionOptions.onError,language:Simulators.SQLExpressionOptions.language,operandHolder:Simulators.SQLExpressionOptions.operandHolder,operatorHolder:Simulators.SQLExpressionOptions.operatorHolder,nestedExpression:Simulators.SQLExpressionOptions.nestedExpression})});t.find(".editable-select.operator").each(function(){Simulators.bindRequestFilterConditionOperator($(this))});t.find(".attribute-expression.value").each(function(){Simulators.bindRequestFilterConditionValue($(this))});n.find(".delete-request-filter-condition").on("click",function(n){n.preventDefault();var t=$(this).parents(".request-filter-conditions-container"),i=t.next(),r=$(this).parent().prev().attr("data-value");i.find(".request-filter-expression").find(".request-condition[data-value='"+r+"']").parent().each(function(){$(this).prev().find("div").hasClass("request-bracket")&&$(this).prev().find("div").attr("data-value")=="("&&$(this).next().find("div").hasClass("request-bracket")&&$(this).next().find("div").attr("data-value")==")"&&($(this).prev().remove(),$(this).next().remove());$(this).prev().find("div").hasClass("request-connector")?$(this).prev().remove():$(this).next().find("div").hasClass("request-connector")&&$(this).next().remove();$(this).remove()});$(this).parent().parent().remove();Simulators.renumberRequestFilterConditions(i.parent());Simulators.refreshRequestFilterDisplay(t)})};Simulators.renumberRequestFilterConditions=function(n){var i=n.find(".request-filter-conditions"),t=n.find(".request-filter-expression");i.children().each(function(n){var i=n+1,r=$(this).find(".request-filter-condition-num"),u=r.attr("data-value");i!=u&&(r.attr("data-value",i),r.text(i),t.find(".request-condition[data-value='"+u+"']").each(function(){$(this).attr("data-value","X"+i);$(this).text(i)}))});t.find(".request-condition").each(function(){$(this).attr("data-value").charAt(0)=="X"&&$(this).attr("data-value",$(this).text())})};Simulators.bindRequestFilterConditionOperator=function(n){var i=n.prev().expressionbuilder("type"),t;switch(i){case"text":case"textarea":t=Simulators.SQLTextOperators;break;case"date":t=Simulators.SQLDateOperators;break;case"boolean":t=Simulators.SQLBooleanOperators;break;default:t=Simulators.SQLNumericOperators}n.attr("data-value")!=""&&(t.selected=n.attr("data-value"),n.text(t[n.attr("data-value")]));n.editable(function(t,i){return n.attr("data-value",t),i.data.selected=t,i.data[t]},{data:t,name:n.attr("name"),type:"select",placeholder:Translator.trans("click to select the operator"),tooltip:Translator.trans("click to select the operator"),style:"inherit",callback:function(){var t=n.next();$.inArray(n.attr("data-value"),["blank","present","isTrue","isFalse"])==-1?t.length==0&&(t=$('<span data-attribute="value" class="attribute-expression value" data-value="" />'),n.after(t),Simulators.bindRequestFilterConditionValue(t)):t.length>0&&t.remove()}})};Simulators.bindRequestFilterConditionValue=function(n){var t=n.parent().parent().parent().attr("data-database-type");n.expressionbuilder({fields:Simulators.columnset,constants:Simulators.SQLExpressionOptions.constants[t],functions:Simulators.SQLExpressionOptions.functions[t],operators:Simulators.SQLExpressionOptions.operators,parameters:Simulators.parameterset,initial:n.attr("data-value"),onCompleted:function(n,t){var i=t.expressionbuilder("val");t.attr("data-value",i.replace(/#(\d+)/g,function(n,t){var i=Simulators.findColumnById(t,Simulators.columnset);return i!=null?i.name:n}))},onEditing:Simulators.SQLExpressionOptions.onEditing,onError:Simulators.SQLExpressionOptions.onError,language:Simulators.SQLExpressionOptions.language,operandHolder:Simulators.SQLExpressionOptions.operandHolder,operatorHolder:Simulators.SQLExpressionOptions.operatorHolder,nestedExpression:Simulators.SQLExpressionOptions.nestedExpression})};Simulators.composeSimpleSQLRequest=function(n,t){var i="SELECT",o=[],f,r,e,u;return n.find(".request-column-container").each(function(){var n=$(this).find("span[data-attribute=column]").attr("data-value");o.push(n)}),i+=" "+o.join(", "),i+=" FROM "+n.find("select[data-attribute=table]").val(),f=Simulators.composeSQLWhereClause(n),f.length>0&&(i+=" WHERE "+f),r=[],n.find(".request-orderbykey-container").each(function(){var n=$(this).find("span[data-attribute=orderbykey]").attr("data-value"),t=$(this).find("span[data-attribute=orderbykey]").next().attr("data-value");t=="desc"?r.push(n+" DESC"):r.push(n)}),r.length>0&&(i+=" ORDER BY "+r.join(", ")),e=n.find("input[data-attribute=nbresult]").val(),u=n.find("input[data-attribute=from]").val(),e>0?(i+=" LIMIT "+e,u>0&&(i+=" OFFSET "+u)):u>0&&t=="pgsql"&&(i+="LIMIT ALL OFFSET "+u),i.replace(/\$(\d+)\$([sdf])\b/g,function(n,t,i){return"%"+t+"$"+i})};Simulators.composeSQLWhereClause=function(n){var t=[],i,r;return n.find(".request-filter-condition-edition-container").each(function(){var i=$(this).find("span[data-attribute=operand]").attr("data-value"),r=$(this).find("span[data-attribute=operator]").attr("data-value"),n=$(this).find("span[data-attribute=value]").attr("data-value");switch(r){case"present":t.push(i+" IS NOT NULL");break;case"blank":t.push(i+" IS NULL");break;case"~":n.length>1&&n.charAt(0)=="'"&&(n=n.substr(1,n.length-2));t.push(i+" LIKE '%"+n+"%'");break;case"!~":n.length>1&&n.charAt(0)=="'"&&(n=n.substr(1,n.length-2));t.push(i+" NOT LIKE '%"+n+"%'");break;default:t.push(i+" "+r+" "+n)}}),i="",t.length>0&&(r=n.find(".request-filter-tools-container .connector").attr("data-value"),r=="all"?i+=t.join(" AND "):r=="any"?i+=t.join(" OR "):n.find(".request-filter-expression-container .request-expression-token").each(function(){if($(this).hasClass("request-condition")){var n=parseInt($(this).attr("data-value"),10);i+=t[n-1]}else i+=$(this).hasClass("request-connector")?" "+$(this).attr("data-value").toUpperCase()+" ":$(this).attr("data-value")})),i};Simulators.bindSource=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-source").on("click",function(){n.replaceWith(Simulators.sourceBackup);Simulators.sourceBackup.find("button.edit-source").on("click",function(n){n.preventDefault();Simulators.editSource($($(this).attr("data-parent")))});Simulators.sourceBackup.find("button.delete-source").on("click",function(n){n.preventDefault();Simulators.deleteSource($($(this).attr("data-parent")))});Simulators.sourceParametersBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-source").on("click",function(){n.remove();Simulators.sourceParametersBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-source, .validate-add-source").on("click",function(){var h,u,f,c,i,e,l;if(!Simulators.checkSource(n))return!1;var o=n.parent(),s=n.find(".source-container"),r=s.find(".attributes-container"),t={id:s.attr("data-id")};if(r.find("input.simple-value:visible, select.simple-value:visible").each(function(){t[$(this).attr("data-attribute")]=$(this).is(":checkbox")?$(this).is(":checked")?1:0:$(this).val()}),$(this).hasClass("validate-edit-source")&&(h=Simulators.sourceBackup.find("p[data-attribute=label]").attr("data-value")||"",t.label!=h&&Simulators.changeSourceLabelInDatas(t.id,t.label)),u=[],r.find(".request-column-container").each(function(){var f=$(this).find(".attribute-expression"),e=f.data("settings").fields,n=f.attr("data-value"),i="",t="",r;e.hasOwnProperty(n.toLowerCase())?(t=n,n=n.toLowerCase(),i=e[n].label):(i=n,t=n);r=$(this).find(".editable-text");r.length>0&&(t=$.trim(r.text()));u.push({column:n,label:i,alias:t})}),t.columns=u,t.where=Simulators.composeSQLWhereClause(n)||"true",f=[],r.find(".request-orderbykey-container").each(function(){var i=$(this).find(".attribute-expression"),r=i.data("settings").fields,n=i.attr("data-value"),t="",u,e;r.hasOwnProperty(n.toLowerCase())?(n=n.toLowerCase(),t=r[n].label):t=n;u=$(this).find(".editable-select");e=u.attr("data-value");f.push({key:n,label:t,order:e})}),t.orderby=f,c=datasources[t.datasource].type,c!=="uri"&&t.request==""){o.find(".alert .error-message").text(Translator.trans("The request field is required"));o.find(".alert").show();return}i=Simulators.drawSourceForDisplay(t);n.find(".source-parameter-panel").length&&(e=Simulators.drawSourceParametersForDisplay(t.id),l=e.find("> .card-body"),n.find(".source-parameter-panel").each(function(){var n=$(this),i={id:n.attr("data-id")};n.find("input.simple-value:visible, select.simple-value:visible, span.attribute-expression:visible").each(function(){var n;n=$(this).hasClass("attribute-expression")?$(this).expressionbuilder("val"):$(this).is(":checkbox")?$(this).is(":checked")?1:0:$(this).val();i[$(this).attr("data-attribute")]=n});l.append(Simulators.drawSourceParameterForDisplay(t.datasource,i))}),i.find(".collapse").find("> .card-body").append(e));n.replaceWith(i);i.find("button.edit-source").on("click",function(n){n.preventDefault();Simulators.editSource($($(this).attr("data-parent")))});i.find("button.delete-source").on("click",function(n){n.preventDefault();Simulators.deleteSource($($(this).attr("data-parent")))});Simulators.sourceParametersBackup=null;$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500);Simulators.updating=!1});n.find("select[data-attribute=datasource]").on("change",function(){var t=$(this).val(),r,i;if(datasources[t]){n.find(".request-columns-container").attr("data-datasource",t);r=datasources[t].type;switch(r){case"uri":n.find("select[data-attribute=requestType]").parent().parent().hide();n.find("select[data-attribute=table]").parent().parent().hide();n.find("input[data-attribute=request]").parent().parent().hide();n.find("input[data-attribute=request]").val("");n.find(".request-columns-container").parent().parent().hide();n.find(".request-columns-container").empty();n.find(".request-filter-tools-container").hide();n.find(".request-filter-conditions-container").hide();n.find(".request-filter-conditions").empty();n.find(".request-filter-expression-container").hide();n.find(".request-filter-expression").empty();n.find(".request-orderbykeys-container").parent().parent().hide();n.find(".request-orderbykeys-container").empty();n.find("input[data-attribute=nbresult]").parent().parent().hide();n.find("input[data-attribute=nbresult]").val("");n.find("input[data-attribute=from]").parent().parent().hide();n.find("input[data-attribute=from]").val("");n.find("select[data-attribute=returnType]").parent().parent().show();n.find("select[data-attribute=returnType]").val("json");n.find("input[data-attribute=returnPath]").parent().parent().show();n.find("input[data-attribute=returnPath]").val("");break;default:n.find(".request-columns-container").attr("data-database-type",datasources[t].dbtype);i=n.find("select[data-attribute=table]");i.empty();$.each(datasources[t].tables,function(n,t){i.append('<option value="'+t.name+'">'+t.label+"<\/option>")});n.find("select[data-attribute=requestType]").parent().parent().show();n.find("select[data-attribute=requestType]").trigger("change");n.find("select[data-attribute=returnType]").parent().parent().show();n.find("select[data-attribute=returnType]").val("assocArray");n.find("input[data-attribute=returnPath]").parent().parent().show();n.find("input[data-attribute=returnPath]").val("");i.trigger("change")}}});n.find("select[data-attribute=requestType]").on("change",function(t){var y=$(this).val(),e=n.find("select[data-attribute=datasource]").val(),c=datasources[e].dbtype,s,v,f,h,r;if(y=="simple"){if(r=n.find("input[data-attribute=request]").val(),r!="")try{var p=new SQLSelectTokenizer(datasources[e].tables,Simulators.SQLFunctions[c]),l=0,u=r.replace(/('%([sdf])'|%([sdf])\b)/g,function(){return l++,"$"+l+"$"+arguments[arguments.length-3]});u=u.replace(/'%(\d+)\$([sdf])'/g,function(n,t,i){return"$"+t+"$"+i});u=u.replace(/%(\d+)\$([sdf])\b/g,function(n,t,i){return"$"+t+"$"+i});var i=p.parseSelect(u),o=i.from[0].table,a=datasources[e].tables[o.toLowerCase()].columns;n.find("select[data-attribute=table]").val(o).trigger("change");n.find(".request-columns-container").attr("data-table",o);s=n.find(".request-columns-container");s.empty();$.each(i.select,function(n,t){var i=Simulators.requestColumnAttributeForInput(t.column,Translator.trans("Select a column"),t.alias);s.append(i);Simulators.bindRequestColumnAttribute(i)});v=n.find(".request-filter-conditions");f=n.find(".request-filter-expression");i.where!=""&&i.where!="true"&&i.conditions&&i.conditions.conditions&&($.each(i.conditions.conditions,function(n,t){a.hasOwnProperty(t.operand.toLowerCase())&&(t.operand=t.operand.toLowerCase());a.hasOwnProperty(t.value.toLowerCase())&&(t.value=t.value.toLowerCase());var i=Simulators.requestFilterConditionAttributeForInput(n+1,t.operand,Translator.trans("Select a column"),t.operator,t.value,Translator.trans("Select a value"));v.append(i)}),i.conditions.expression&&$.each(i.conditions.expression,function(n,t){t=="("||t==")"?f.append(Simulators.requestFilterParenthesisAttributeForInput(t)):t=="and"||t=="or"?f.append(Simulators.requestFilterConnectorAttributeForInput(t)):f.append(Simulators.requestFilterConditionNumAttributeForInput(t))}),Simulators.bindRequestFilterConditionAttribute(n),Simulators.bindRequestFilterConnectorAttribute(n),Simulators.bindRequestFilterParenthesisAttribute(n));h=n.find(".request-orderbykeys-container");h.empty();$.each(i.orderby,function(n,t){var i=Simulators.requestOrderByKeyAttributeForInput(t.key,Translator.trans("Select a column"),t.order);h.append(i);Simulators.bindRequestOrderByKeyAttribute(i)});n.find("input[data-attribute=nbresult]").val(i.limit);n.find("input[data-attribute=from]").val(i.offset)}catch(t){console&&console.log(t.message)}n.find("input[data-attribute=request]").parent().parent().hide();n.find("select[data-attribute=table]").parent().parent().show();n.find(".request-columns-container").parent().parent().show();n.find(".request-filter-tools-container").show();n.find(".request-filter-conditions-container").show();n.find(".request-filter-expression-container").show();Simulators.refreshRequestFilterDisplay(n.find(".request-filter-conditions-container"));n.find(".request-orderbykeys-container").parent().parent().show();n.find("input[data-attribute=nbresult]").parent().parent().show();n.find("input[data-attribute=from]").parent().parent().show()}else r=Simulators.composeSimpleSQLRequest(n,c),n.find("input[data-attribute=request]").val(r),n.find("input[data-attribute=request]").parent().parent().show(),n.find("select[data-attribute=table]").parent().parent().hide(),n.find(".request-columns-container").parent().parent().hide(),n.find(".request-filter-tools-container").hide(),n.find(".request-filter-conditions-container").hide(),n.find(".request-filter-expression-container").hide(),n.find(".request-orderbykeys-container").parent().parent().hide(),n.find("input[data-attribute=nbresult]").parent().parent().hide(),n.find("input[data-attribute=from]").parent().parent().hide()});n.find("select[data-attribute=table]").on("change",function(){var t=$(this).val(),i=n.find("select[data-attribute=datasource]").val();Simulators.columnset={};i&&t&&(Simulators.columnset=datasources[i].tables[t.toLowerCase()].columns);n.find("input[data-attribute=request]").val("");n.find(".request-columns-container").attr("data-table",t);n.find(".request-columns-container").empty();n.find(".request-filter-conditions").empty();n.find(".request-filter-expression").empty();n.find(".request-orderbykeys-container").empty();n.find("input[data-attribute=nbresult]").val("");n.find("input[data-attribute=from]").val("")});n.find("select[data-attribute=returnType]").on("change",function(){var t=$(this).val();t==="singleValue"?(n.find("input[data-attribute=returnPath]").parent().parent().hide(),n.find("input[data-attribute=returnPath]").val("")):n.find("input[data-attribute=returnPath]").parent().parent().show();t==="csv"?(n.find("input[data-attribute=separator]").parent().parent().show(),n.find("input[data-attribute=delimiter]").parent().parent().show()):(n.find("input[data-attribute=separator]").parent().parent().hide(),n.find("input[data-attribute=delimiter]").parent().parent().hide(),n.find("input[data-attribute=separator]").val(""),n.find("input[data-attribute=delimiter]").val(""))});n.find(".request-columns-container").sortable({cursor:"move",containment:"parent"});n.find(".add-request-column").on("click",function(n){n.preventDefault();var i=$(this).parent().parent().find(".request-columns-container"),t=Simulators.requestColumnAttributeForInput("",Translator.trans("Select a column"),"");i.append(t);Simulators.bindRequestColumnAttribute(t)});Simulators.bindRequestColumnAttribute(n);n.find(".request-columns-container").on("click",function(t){t.target&&$(t.target).hasClass("request-columns-container")&&(t.preventDefault(),n.find(".add-request-column").trigger("click"))});n.find(".request-columns-container").keydown(function(t){t.target&&$(t.target).hasClass("request-columns-container")&&t.keyCode==13&&(t.preventDefault(),n.find(".add-request-column").trigger("click"))});n.find(".add-request-condition").on("click",function(t){var i,o,u;t.preventDefault();var r=n.find(".request-filter-conditions"),f=r.children().length+1,e=Simulators.requestFilterConditionAttributeForInput(f,"",Translator.trans("Select a column"),"","",Translator.trans("Select a value"));r.append(e);Simulators.bindRequestFilterConditionAttribute(e);i=n.find(".request-filter-expression");o=n.find(".editable-select.connector").attr("data-value")=="any"?"or":"and";i.children().length>0&&(u=Simulators.requestFilterConnectorAttributeForInput(o),i.append(u),Simulators.bindRequestFilterConnectorAttribute(u));i.append(Simulators.requestFilterConditionNumAttributeForInput(f));Simulators.refreshRequestFilterDisplay(r.parent().parent())});Simulators.bindRequestFilterConnectorAttribute(n);n.find(".request-filter-expression").sortable({cursor:"move",containment:"parent",axis:"x"});Simulators.bindRequestFilterToolsAttribute(n);Simulators.bindRequestFilterConditionAttribute(n);Simulators.bindRequestFilterParenthesisAttribute(n);n.find(".request-filter-conditions").on("click",function(t){t.target&&$(t.target).hasClass("request-filter-conditions")&&(t.preventDefault(),n.find(".add-request-condition").trigger("click"))});n.find(".request-filter-conditions").keydown(function(t){t.target&&$(t.target).hasClass("request-filter-conditions")&&t.keyCode==13&&(t.preventDefault(),n.find(".add-request-condition").trigger("click"))});n.find(".add-request-orderbykey").on("click",function(n){n.preventDefault();var i=$(this).parent().parent().find(".request-orderbykeys-container"),t=Simulators.requestOrderByKeyAttributeForInput("",Translator.trans("Select a column"),"");i.append(t);Simulators.bindRequestOrderByKeyAttribute(t)});Simulators.bindRequestOrderByKeyAttribute(n);n.find(".request-orderbykeys-container").on("click",function(t){t.target&&$(t.target).hasClass("request-orderbykeys-container")&&(t.preventDefault(),n.find(".add-request-orderbykey").trigger("click"))});n.find(".request-orderbykeys-container").keydown(function(t){t.target&&$(t.target).hasClass("request-orderbykeys-container")&&t.keyCode==13&&(t.preventDefault(),n.find(".add-request-orderbykey").trigger("click"))})};Simulators.drawSourceParametersForInput=function(n){var t=$("<div>",{"class":"card bg-light source-parameters-panel",id:"source-"+n+"-source-parameters-panel"}),i;return t.append('<div class="card-header"><button class="btn btn-secondary float-right update-button add-source-parameter" title="'+Translator.trans("Add parameter")+'"><span class="button-label">'+Translator.trans("Add parameter")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button>'+Translator.trans("Parameters")+"<\/div>"),i=$('<div class="card-body"><\/div>'),t.append(i),t};Simulators.drawSourceParameterForInput=function(n,t){var u=$("<div>",{"class":"card bg-light source-parameter-panel","data-id":t.id,"data-name":t.name}),r,a,f,e,o,s;u.append('<div class="card-header"><button class="btn btn-secondary float-right update-button delete-source-parameter" title="'+Translator.trans("Delete")+'"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button>'+Translator.trans("Parameter %id%",{id:t.id})+"<\/div>");var h=$("<div>",{"class":"card-body",id:"data-"+t.sourceId+"-source-parameter-"+t.id+"-panel"}),c=$('<div class="attributes-container"><\/div>'),i=$("<div><\/div>"),l={};return $.each(Simulators.dataset,function(n,t){l[n]=t.label}),datasources[n].type==="uri"?(r={queryString:Translator.trans("Query string parameter"),path:Translator.trans("PATH"),header:Translator.trans("HTTP header")},datasources[n].method==="post"&&(r.data=Translator.trans("POST data"))):(r={columnValue:Translator.trans("Column value")},t.type="columnValue"),a={data:Translator.trans("Data"),constant:Translator.trans("Constant")},f=Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"select","type",Translator.trans("Type"),t.type,!0,Translator.trans("Select a type"),JSON.stringify(r)),i.append(f),datasources[n].type!=="uri"&&f.hide(),i.append(Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"text","name",Translator.trans("Name"),t.name,!0,Translator.trans("Parameter name"))),i.append(Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"select","origin",Translator.trans("Origin"),t.origin,!0,Translator.trans("Select an origin"),JSON.stringify(a))),e=Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"select","data",Translator.trans("Data"),t.data,!0,Translator.trans("Select a data"),JSON.stringify(l)),i.append(e),o=Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"select","format",Translator.trans("Format"),t.format,!0,Translator.trans("Date format of the parameter"),JSON.stringify(Simulators.parameterDateFormats)),i.append(o),s=Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"text","constant",Translator.trans("Constant"),t.constant,!0,Translator.trans("Constant value of the parameter")),i.append(s),i.append(Simulators.simpleAttributeForInput("source-"+t.sourceId+"-source-parameter-"+t.id,"checkbox","optional",Translator.trans("Optional"),t.optional,!0,Translator.trans("Optional"))),t.origin==="data"?s.hide():(e.hide(),o.hide()),c.append(i),h.append(c),u.append(h),u};Simulators.bindParameters=function(n){n.find("button.add-source-parameter").on("click",function(){var u=n.parent().parent().find(".source-container").find("select[data-attribute=datasource]").val(),r=n.find("> .card-body"),i=r.children("div.card").length+1,f=n.attr("id").match(/^source-(\d+)/)[1],e={id:i,sourceId:f,type:"",name:"",origin:"data",data:"",format:"",constant:"",optional:"0"},t;Simulators.parameterset[i]={num:i,name:"unknown",type:"unknown"};t=Simulators.drawSourceParameterForInput(u,e);r.append(t);Simulators.bindParameter(t);t.find("select[data-attribute=data]").trigger("change");$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500)})};Simulators.bindParameter=function(n){n.find("button.delete-source-parameter").on("click",function(){var t=$(this).parents(".source-parameter-panel").attr("data-id"),i;delete Simulators.parameterset[t];i=n.parents(".source-parameters-panel");n.remove()});n.find("select[data-attribute=origin]").on("change",function(){var t=$(this).val(),i=$(this).parents(".source-parameter-panel").attr("data-id");t==="data"?(n.find("input[data-attribute=constant]").parent().parent().hide(),n.find("input[data-attribute=constant]").val(""),n.find("select[data-attribute=data]").parent().parent().show(),n.find("select[data-attribute=data]").trigger("change")):(n.find("input[data-attribute=constant]").parent().parent().show(),n.find("select[data-attribute=data]").parent().parent().hide(),n.find("select[data-attribute=format]").parent().parent().hide(),n.find("select[data-attribute=format]").val(""),Simulators.parameterset[i].type="text")});n.find("select[data-attribute=data]").on("change",function(){var i=$(this).val(),r=$(this).parents(".source-parameter-panel").attr("data-id"),t;if(Simulators.dataset[i]){t=Simulators.dataset[i].type;switch(t){case"date":case"day":case"month":case"year":n.find("select[data-attribute=format]").parent().parent().show();break;default:n.find("select[data-attribute=format]").parent().parent().hide();n.find("select[data-attribute=format]").val("")}Simulators.parameterset[r].type=t}});n.find("input[data-attribute=name]").on("change",function(){var n=$(this).parents(".source-parameter-panel").attr("data-id");Simulators.parameterset[n].name=$(this).val()})};Simulators.checkParameter=function(n,t){var c=t.find(".source-container").attr("data-id"),i=n.attr("data-id"),l=n.attr("data-name"),r=$.trim(n.find("input[data-attribute=name]").val()),f,e,u,o,s,h;if(r==="")return t.find(".error-message").text(Translator.trans("Parameter %id% : the name is required",{id:i})),t.find(".alert").show(),!1;if(!/^\w+$/.test(r))return t.find(".error-message").text(Translator.trans("Parameter %id% : Incorrect name",{id:i})),t.find(".alert").show(),!1;if(r!=l&&(f=!1,$.each(Simulators.parameterset,function(n,t){if(r==t.name&&i!=n)return f=!0,!1}),f))return t.find(".error-message").text(Translator.trans("Parameter %id% : This parameter name already exists",{id:i})),t.find(".alert").show(),!1;if(e=n.find("select[data-attribute=origin]").val(),e==="data"){if(u=n.find("select[data-attribute=data]").val(),o=Simulators.dataset[u].id,$("#datas").find(".data-container[data-id="+o+"] p[data-attribute='source'][data-value="+c+"]").length>0)return t.find(".error-message").text(Translator.trans("Circular reference between parameter %id% and data «%data%»",{id:i,data:Simulators.dataset[u].label})),t.find(".alert").show(),!1;if(Simulators.dataset[u].type=="date"&&(s=n.find("select[data-attribute=format]").val(),!s))return t.find(".error-message").text(Translator.trans("Parameter %id% : the format is required",{id:i})),t.find(".alert").show(),!1}else if(h=$.trim(n.find("input[data-attribute=constant]").val()),h=="")return t.find(".error-message").text(Translator.trans("Parameter %id% : the constant value is required",{id:i})),t.find(".alert").show(),!1;return!0};Simulators.checkSource=function(n){var t=n.attr("id"),c=$("#"+t+"-datasource").val(),i,l,a,u,f,e,r,o,s,h;if(c==="")return n.find(".error-message").text(Translator.trans("Select a data source")),n.find(".alert").show(),!1;if(i=$("#"+t+"-returnType").val(),datasources[c].type==="uri"){if(l=$("#"+t+"-returnPath").val(),i=="xml"&&!Simulators.isValidXPath(l))return n.find(".error-message").text(Translator.trans("Invalid return path")),n.find(".alert").show(),!1}else if(a=$("#"+t+"-requestType").val(),a=="simple"){if(u=n.find(".request-columns-container"),u.children().length==0)return n.find(".error-message").text(Translator.trans("Please select at least one column")),n.find(".alert").show(),!1;if(f=!1,e=!1,u.find(".request-column-container").find("span[data-attribute=column]").each(function(){if(!$(this).expressionbuilder("completed"))return f=!0,!1;if($(this).expressionbuilder("state"),$(this).next("span.column-alias").length>0){var n=$(this).next().next().attr("data-value");if(n==""||!/^\w+$/.test(n))return e=!0,!1}}),f)return n.find(".error-message").text(Translator.trans("Please complete the column entry")),n.find(".alert").show(),!1;if(e)return n.find(".error-message").text(Translator.trans("Invalid column alias")),n.find(".alert").show(),!1;if(r=!1,n.find(".request-filter-condition-edition-container").find("span.attribute-expression").each(function(){if(!$(this).expressionbuilder("completed"))return r=!0,!1;$(this).expressionbuilder("state")}),n.find(".request-filter-condition-edition-container").find("span.editable-select.operator").each(function(){if($(this).attr("data-value")=="")return r=!0,!1}),r)return n.find(".error-message").text(Translator.trans("Please complete the filter input")),n.find(".alert").show(),!1;if(n.find("span.editable-select.connector").attr("data-value")=="advanced"&&!Simulators.checkFilterExpression(n))return!1;if(o=n.find(".request-orderbykeys-container"),o.children().length>0&&(s=!1,o.find(".request-orderbykey-container").find("span[data-attribute=orderbykey]").each(function(){if(!$(this).expressionbuilder("completed"))return s=!0,!1;$(this).expressionbuilder("state")}),s))return n.find(".error-message").text(Translator.trans("Please complete the sort key entry")),n.find(".alert").show(),!1;if(i!="singleValue"&&i!="assocArray")return n.find(".error-message").text(Translator.trans("Invalid return type")),n.find(".alert").show(),!1}return h=!0,n.find(".source-parameter-panel").each(function(){if(!Simulators.checkParameter($(this),n))return h=!1,!1}),h};Simulators.checkFilterExpression=function(n){var i="",t="",r=0,u=0;return(n.find(".request-filter-expression").find(".request-expression-token").each(function(){switch($(this).attr("data-value")){case"(":if(t!=""&&$.isNumeric(t))return i='You cannot open a parenthesis right after a condition ID! You need to use a logical operator "and" or "or"',!1;r++;break;case")":if(t=="")return i="A closing parenthesis can not begin an expression",!1;if(t=="(")return i='You cannot use closing parenthesis ")" right after an opening parenthesis "("',!1;if(t=="and"||t=="or")return i='You cannot use closing parenthesis ")" right after a logical operator',!1;u++;break;case"and":case"or":if(t=="")return i="A logical operator can not begin an expression",!1;if(t=="(")return i="You cannot use logical operator right after opening parenthesis",!1;if(t=="and"||t=="or")return i="You cannot use two logical operators next to each other",!1;break;default:if(t==")")return i='You cannot use condition ID right after closing a parenthesis! You need to use a logical operator "and" or "or"',!1;if($.isNumeric(t))return i="You cannot use two condition ID's next to each other",!1}t=$(this).attr("data-value")}),i!="")?(n.find(".error-message").text(Translator.trans(i)),n.find(".alert").show(),!1):u!=r?(n.find(".error-message").text(Translator.trans("The opening and closing parenthesis do not match")),n.find(".alert").show(),!1):!0};Simulators.isValidXPath=function(n){var t=new XPathEvaluator;try{t.createExpression(n,null)}catch(i){return!1}return n=="/"||n=="."?!1:!0};Simulators.addSource=function(n){var r,i,t,u,f;$(".update-button").hide();$(".toggle-collapse-all").hide();r={id:Simulators.maxSourceId()+1,label:"",datasource:"",requestType:"simple",request:"",table:"",columns:[],filter:"",orderby:[],nbresult:0,from:0,returnType:"",returnPath:"",separator:"",delimiter:""};Simulators.parameterset={};i=n.find("div.source-parameter-container");i.length>0&&i.each(function(n){var t=$(this).find("p[data-attribute='origin']").attr("data-value")||"data";Simulators.parameterset[n+1]={num:n+1,name:$(this).find("p[data-attribute='name']").attr("data-value"),type:t==="data"?Simulators.dataset[$(this).find("p[data-attribute='data']").attr("data-value")].type:"text"}});t=Simulators.drawSourceForInput(r);t.find("button.cancel-edit-source").addClass("cancel-add-source").removeClass("cancel-edit-source");t.find("button.validate-edit-source").addClass("validate-add-source").removeClass("validate-edit-source");f=n.attr("id");u=f==="sources"?$("#collapsesources").find("> div.sortable"):n.find(".sources-panel > div.sortable");u.append(t);Simulators.bindSource(t);$("#collapsesources").collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0};Simulators.editSource=function(n){$(".update-button").hide();$(".toggle-collapse-all").hide();var f=n.find(".source-container"),o=f.attr("data-id"),t=f.find(".attributes-container"),r={id:f.attr("data-id"),label:t.find("p[data-attribute='label']").attr("data-value")||"",datasource:t.find("p[data-attribute='datasource']").attr("data-value"),requestType:t.find("p[data-attribute='requestType']").attr("data-value"),request:decodeURIComponent(t.find("p[data-attribute='request']").attr("data-value")),table:t.find("p[data-attribute='table']").attr("data-value"),columns:Simulators.collectRequestColumns(t),filter:decodeURIComponent(t.find("p[data-attribute='filter']").attr("data-value")),orderby:Simulators.collectRequestOrderByKeys(t),nbresult:t.find("p[data-attribute='nbresult']").attr("data-value")||0,from:t.find("p[data-attribute='from']").attr("data-value")||0,returnType:t.find("p[data-attribute='returnType']").attr("data-value"),returnPath:t.find("p[data-attribute='returnPath']").attr("data-value")||"",separator:t.find("p[data-attribute='separator']").attr("data-value"),delimiter:t.find("p[data-attribute='delimiter']").attr("data-value")},u=Simulators.drawSourceForInput(r),i=Simulators.drawSourceParametersForInput(r.id),e=n.find("div.source-parameter-container");Simulators.parameterset={};e.length>0&&(i.find("button.add-parameter").removeClass("update-button").hide(),i.find("button.delete-source-parameter").removeClass("update-button").hide(),e.each(function(n){var u={id:$(this).attr("data-id"),sourceId:r.id,type:$(this).find("p[data-attribute='type']").attr("data-value")||"columnValue",name:$(this).find("p[data-attribute='name']").attr("data-value"),origin:$(this).find("p[data-attribute='origin']").attr("data-value")||"data",data:$(this).find("p[data-attribute='data']").attr("data-value")||"",format:$(this).find("p[data-attribute='format']").attr("data-value")||"",constant:$(this).find("p[data-attribute='constant']").attr("data-value")||"",optional:$(this).find("p[data-attribute='optional']").attr("data-value")||"0"},t;Simulators.parameterset[n+1]={num:n+1,name:$(this).find("p[data-attribute='name']").attr("data-value"),type:u.origin==="data"?Simulators.dataset[$(this).find("p[data-attribute='data']").attr("data-value")].type:"text"};t=Simulators.drawSourceParameterForInput(r.datasource,u);i.find("> .card-body").append(t);Simulators.bindParameter(t);t.find("select[data-attribute=data]").trigger("change")}));u.find(".source-buttons").before(i);Simulators.bindParameters(i);Simulators.sourceBackup=n.replaceWith(u);Simulators.bindSource(u);$("#collapsesource-"+o).collapse("show");$("html, body").animate({scrollTop:u.offset().top-$("#navbar").height()},500);Simulators.updating=!0};Simulators.deleteSource=function(n){var i=n.find(".source-container"),f=i.find(".attributes-container"),u=i.attr("data-id"),t,r;if((t=Simulators.isSourceIdInDatas(u))!==!1){r=Simulators.findDataById(t);bootbox.alert({title:Translator.trans("Deleting source"),message:Translator.trans("This source is used in data #%id% : %label%. You must modify this data before you can delete this source",{id:t,label:r.label})});return}bootbox.confirm({title:Translator.trans("Deleting source"),message:Translator.trans("Are you sure you want to delete this source"),callback:function(t){if(t){var i=n.parent();n.remove();Simulators.renumberSources(i.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})};Simulators.collectRequestColumns=function(n){var t=[],i=n.find("p[data-attribute='columns']");return i.find("span[data-attribute='column']").each(function(){t.push({column:$(this).attr("data-value"),alias:$(this).attr("data-alias")})}),t};Simulators.collectRequestOrderByKeys=function(n){var t=[],i=n.find("p[data-attribute='orderbykeys']");return i.find("span[data-attribute='orderbykey']").each(function(){t.push({key:$(this).attr("data-value"),order:$(this).attr("data-order")})}),t};Simulators.collectSources=function(){var n=[],t=$("#sources").find("div.source-container");return t.each(function(t){var i=$(this).find(".attributes-container"),u=i.find("p[data-attribute='datasource']").attr("data-value"),f=[],e=$(this).parent().find("div.source-parameter-container"),r;e.each(function(){f.push({type:$(this).find("p[data-attribute='type']").attr("data-value")||"columnValue",name:$(this).find("p[data-attribute='name']").attr("data-value"),origin:$(this).find("p[data-attribute='origin']").attr("data-value")||"data",data:$(this).find("p[data-attribute='data']").attr("data-value")||"",format:$(this).find("p[data-attribute='format']").attr("data-value")||"",constant:$(this).find("p[data-attribute='constant']").attr("data-value")||"",optional:$(this).find("p[data-attribute='optional']").attr("data-value")||"0"})});datasources[u].type==="uri"?r={id:t+1,label:i.find("p[data-attribute='label']").attr("data-value")||"",datasource:u,returnType:i.find("p[data-attribute='returnType']").attr("data-value"),returnPath:i.find("p[data-attribute='returnPath']").attr("data-value")||"",separator:i.find("p[data-attribute='separator']").attr("data-value"),delimiter:i.find("p[data-attribute='delimiter']").attr("data-value"),parameters:f}:(r={id:t+1,label:i.find("p[data-attribute='label']").attr("data-value")||"",datasource:u,requestType:i.find("p[data-attribute='requestType']").attr("data-value"),request:decodeURIComponent(i.find("p[data-attribute='request']").attr("data-value")),table:i.find("p[data-attribute='table']").attr("data-value"),columns:Simulators.collectRequestColumns(i),filter:decodeURIComponent(i.find("p[data-attribute='filter']").attr("data-value")),orderby:Simulators.collectRequestOrderByKeys(i),nbresult:i.find("p[data-attribute='nbresult']").attr("data-value")||0,from:i.find("p[data-attribute='from']").attr("data-value")||0,returnType:i.find("p[data-attribute='returnType']").attr("data-value"),returnPath:i.find("p[data-attribute='returnPath']").attr("data-value")||"",separator:i.find("p[data-attribute='separator']").attr("data-value"),delimiter:i.find("p[data-attribute='delimiter']").attr("data-value"),parameters:f},r.requestType=="simple"&&(r.dbtype=datasources[u].dbtype));n.push(r)}),n}}(this),function(){"use strict";Simulators.stepBackup=null;Simulators.footnotesBackup=null;Simulators.footnoteBackup=null;Simulators.actionButtonBackup=null;Simulators.panelBackup=null;Simulators.fieldsetBackup=null;Simulators.fieldrowBackup=null;Simulators.columnBackup=null;Simulators.fieldBackup=null;Simulators.blockinfoBackup=null;Simulators.chapterBackup=null;Simulators.sectionBackup=null;Simulators.findInArray=function(n,t){var r,i;if(n)for(r=t.shift(),i=0;i<n.length;i++)if(n[i][r.key]!=undefined&&n[i][r.key]==r.val)return r.list?Simulators.findInArray(n[i][r.list],t):n[i];return null};Simulators.updateInArray=function(n,t,i){var u,r;if(n)for(u=t.shift(),r=0;r<n.length;r++)if(n[r][u.key]!=undefined&&n[r][u.key]==u.val)return u.list?Simulators.updateInArray(n[r][u.list],t,i):(n[r]=i,!0);return!1};Simulators.addInArray=function(n,t,i){var u,r;if(n){if(t.length==0)return n.push(i),!0;for(u=t.shift(),r=0;r<n.length;r++)if(n[r][u.key]!=undefined&&n[r][u.key]==u.val)return Simulators.addInArray(n[r][u.list],t,i)}return!1};Simulators.deleteInArray=function(n,t){var r,i;if(n)for(r=t.shift(),i=0;i<n.length;i++)if(n[i][r.key]!=undefined&&n[i][r.key]==r.val)return r.list?Simulators.deleteInArray(n[i][r.list],t):(n.splice(i,1),!0);return!1};Simulators.moveInArray=function(n,t,i){var u,r,f;if(n)for(u=t.shift(),r=0;r<n.length;r++)if(n[r][u.key]!=undefined&&n[r][u.key]==u.val)return u.list?Simulators.moveInArray(n[r][u.list],t,i):r==i?!1:(f=n.splice(r,1),n.splice(i,0,f[0]),!0);return!1};Simulators.collectSteps=function(){return steps};Simulators.isDataIdInSteps=function(n){var i=new RegExp("#("+n+"\\b|"+n+"(L))","g"),r=new RegExp('\\<data\\s+([^\\s]*\\s*)value=\\"'+n+'\\"',"g"),t=!1;return $.each(steps,function(u,f){return i.test(f.description.content)?(t=f.id,!1):r.test(f.description.content)?(t=f.id,!1):(f.footNotes&&f.footNotes.footNotes&&$.each(f.footNotes.footNotes,function(n,u){return i.test(u.text.content)?(t=f.id,!1):r.test(u.text.content)?(t=f.id,!1):void 0}),t!==!1)?!1:($.each(f.panels||[],function(u,e){return $.each(e.blocks||[],function(u,e){if(e.type=="fieldset"){if(i.test(e.legend.content)||r.test(e.legend.content))return t=f.id,!1;e.fieldrows?$.each(e.fieldrows||[],function(u,e){return $.each(e.fields,function(u,e){return e.data==n?(t=f.id,!1):e.Note&&e.Note.text&&(i.test(e.Note.text.content)||r.test(e.Note.text.content))?(t=f.id,!1):void 0}),t!==!1?!1:void 0}):e.fields&&$.each(e.fields,function(u,e){return e.data==n?(t=f.id,!1):e.Note&&e.Note.text&&(i.test(e.Note.text.content)||r.test(e.Note.text.content))?(t=f.id,!1):void 0})}else $.each(e.chapters||[],function(n,u){return $.each(u.sections||[],function(n,u){return i.test(u.content.content)?(t=f.id,!1):r.test(u.content.content)?(t=f.id,!1):i.test(u.annotations.content)?(t=f.id,!1):r.test(u.annotations.content)?(t=f.id,!1):void 0}),t!==!1?!1:void 0});if(t!==!1)return!1}),t!==!1?!1:void 0}),t!==!1?!1:void 0)}),t};Simulators.changeDataIdInSteps=function(n,t){var i=new RegExp("#("+n+"\\b|"+n+"(L))","g"),r=new RegExp('\\<data\\s+([^\\s]*\\s*)value=\\"'+n+'\\"',"g");$.each(steps,function(u,f){i.test(f.description.content)&&(f.description.content=f.description.content.replace(i,"#"+t+"$2"));r.test(f.description.content)&&(f.description.content=f.description.content.replace(r,'<data $1value="'+t+'"'));f.footNotes&&f.footNotes.footNotes&&$.each(f.footNotes.footNotes,function(n,u){i.test(u.text.content)&&(u.text.content=u.text.content.replace(i,"#"+t+"$2"));r.test(u.text.content)&&(u.text.content=u.text.content.replace(r,'<data $1value="'+t+'"'))});$.each(f.panels||[],function(u,f){$.each(f.blocks||[],function(u,f){f.type=="fieldset"?(i.test(f.legend.content)&&(f.legend.content=f.legend.content.replace(i,"#"+t+"$2")),r.test(f.legend.content)&&(f.legend.content=f.legend.content.replace(r,'<data $1value="'+t+'"')),f.fieldrows?$.each(f.fieldrows||[],function(u,f){$.each(f.fields,function(u,f){f.data==n&&(f.data=t);f.Note&&f.Note.text&&(i.test(f.Note.text.content)&&(f.Note.text.content=f.Note.text.content.replace(i,"#"+t+"$2")),r.test(f.Note.text.content)&&(f.Note.text.content=f.Note.text.content.replace(r,'<data $1value="'+t+'"')))})}):f.fields&&$.each(f.fields,function(u,f){f.data==n&&(f.data=t);f.Note&&f.Note.text&&(i.test(f.Note.text.content)&&(f.Note.text.content=f.Note.text.content.replace(i,"#"+t+"$2")),r.test(f.Note.text.content)&&(f.Note.text.content=f.Note.text.content.replace(r,'<data $1value="'+t+'"')))})):$.each(f.chapters||[],function(n,u){$.each(u.sections||[],function(n,u){i.test(u.content.content)&&(u.content.content=u.content.content.replace(i,"#"+t+"$2"));r.test(u.content.content)&&(u.content.content=u.content.content.replace(r,'<data $1value="'+t+'"'));i.test(u.annotations.content)&&(u.annotations.content=u.annotations.content.replace(i,"#"+t+"$2"));r.test(u.annotations.content)&&(u.annotations.content=u.annotations.content.replace(r,'<data $1value="'+t+'"'))})})})})})};Simulators.isDatagroupIdInSteps=function(n){var t=!1;return $.each(steps,function(i,r){return $.each(r.panels||[],function(i,u){return $.each(u.blocks||[],function(i,u){return u.type=="fieldset"&&u.fieldrows&&$.each(u.fieldrows||[],function(i,u){if(u.datagroup==n)return t=r.id,!1}),t!==!1?!1:void 0}),t!==!1?!1:void 0}),t!==!1?!1:void 0}),t};Simulators.changeDatagroupIdInSteps=function(n,t){$.each(steps,function(i,r){$.each(r.panels||[],function(i,r){$.each(r.blocks||[],function(i,r){r.type=="fieldset"&&r.fieldrows&&$.each(r.fieldrows||[],function(i,r){r.datagroup==n&&(r.datagroup=t)})})})})};Simulators.changeDataLabelInSteps=function(n,t,i){var r=$("#steps").find(".field-container p[data-attribute='data']");r.each(function(){$(this).attr("data-value")==t&&($(this).attr("data-value",i),$(this).html(i))})};Simulators.changeDatagroupLabelInSteps=function(n,t,i){var r=$("#steps").find(".fieldrow-container p[data-attribute='datagroup']");r.each(function(){$(this).attr("data-value")==t&&($(this).attr("data-value",i),$(this).html(i))})};Simulators.isFootnoteIdReferenced=function(n,t){var r=new RegExp("\\[[^\\^]+\\^"+t+"\\([^\\)]+\\)\\]","g"),u=new RegExp('\\<dfn\\s+([^\\s]*\\s*)data-footnote=\\"'+t+'\\"',"g"),i=!1,f;return $("#simulator-options-panel").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text()))return i=Translator.trans("The label of the simulator contains a reference to this footnote"),!1}),i===!1&&$("#step-"+n).find(".step-container").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".step-container");return i=Translator.trans("The label of the step #%id% contains a reference to this footnote",{id:n.attr("data-id")}),!1}}),i===!1&&$("#step-"+n).find(".panel-container").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".panel-container");return i=Translator.trans("The label of the panel #%id% of step #%stepId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step")}),!1}}),i===!1&&$("#step-"+n).find(".field-container").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".field-container");return i=n.attr("data-fieldrow")?Translator.trans("The label of the field #%id% of step #%stepId% / panel %panelId% / fieldset #%fieldsetId% / fieldrow #%fieldrowId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),fieldsetId:n.attr("data-fieldset"),fieldrowId:n.attr("data-fieldrow")}):Translator.trans("The label of the field #%id% of step #%stepId% / panel #%panelId% / fieldset #%fieldsetId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),fieldsetId:n.attr("data-fieldset")}),!1}}),i===!1&&$("#step-"+n).find(".column-container").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".column-container");return i=Translator.trans("The label of the column #%id% of step #%stepId% / panel %panelId% / fieldset #%fieldsetId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),fieldsetId:n.attr("data-fieldset")}),!1}}),i===!1&&$("#step-"+n).find(".block-container.blockinfo").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".block-container.blockinfo");return i=Translator.trans("The label of the blockinfo #%id% of step #%stepId% / panel #%panelId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel")}),!1}}),i===!1&&$("#step-"+n).find(".chapter-container").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".chapter-container");return i=Translator.trans("The label of the chapter #%id% of step #%stepId% / panel %panelId% / blockinfo #%blockinfoId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),blockinfoId:n.attr("data-blockinfo")}),!1}}),i===!1&&$("#step-"+n).find(".section-container").find("[data-attribute=label]").each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".section-container");return i=Translator.trans("The label of the section #%id% of step #%stepId% / panel %panelId% / blockinfo #%blockinfoId% / chapter #%chapterId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),blockinfoId:n.attr("data-blockinfo"),chapterId:n.attr("data-chapter")}),!1}}),i===!1&&(f=$("#simulator-description-panel-holder").find(".rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text()))return i=Translator.trans("The description of the simulator contains a reference to this footnote"),!1})),i===!1&&(f=$("#simulator-related-informations-panel-holder").find(".rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text()))return i=Translator.trans("The related informations of the simulator contains a reference to this footnote"),!1})),i===!1&&(f=$("#step-"+n).find(".step-description.rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".step-container");return i=Translator.trans("The description of the step #%id% contains a reference to this footnote",{id:n.attr("data-id")}),!1}})),i===!1&&(f=$("#step-"+n).find(".fieldset-legend.rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".block-container.fieldset");return i=Translator.trans("The legend of the fieldset #%id% of step #%stepId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step")}),!1}})),i===!1&&(f=$("#step-"+n).find(".field-note.rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parents(".field-container");return i=n.attr("data-fieldrow")?Translator.trans("The note of the field #%id% of step #%stepId% / panel %panelId% / fieldset #%fieldsetId% / fieldrow #%fieldrowId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),fieldsetId:n.attr("data-fieldset"),fieldrowId:n.attr("data-fieldrow")}):Translator.trans("The note of the field #%id% of step #%stepId% / panel #%panelId% / fieldset #%fieldsetId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),fieldsetId:n.attr("data-fieldset")}),!1}})),i===!1&&(f=$("#step-"+n).find(".section-content.rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parent().prev();return i=Translator.trans("The content of the section #%id% of step #%stepId% / panel %panelId% / blockinfo #%blockinfoId% / chapter #%chapterId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),blockinfoId:n.attr("data-blockinfo"),chapterId:n.attr("data-chapter")}),!1}})),i===!1&&(f=$("#step-"+n).find(".section-annotations.rich-text"),f.each(function(){if(r.test($(this).text())||u.test($(this).text())){var n=$(this).parent().prev().prev();return i=Translator.trans("The annotations of the section #%id% of step #%stepId% / panel %panelId% / blockinfo #%blockinfoId% / chapter #%chapterId% contains a reference to this footnote",{id:n.attr("data-id"),stepId:n.attr("data-step"),panelId:n.attr("data-panel"),blockinfoId:n.attr("data-blockinfo"),chapterId:n.attr("data-chapter")}),!1}})),i};Simulators.renumberSteps=function(n){var t=0;$.each(steps,function(i,r){var f=r.id,u,h,c,l;if(f==0&&(t=1),u=i+1-t,f!=0&&u!=f){r.id=u;var o=n.eq(i),e=new RegExp("step-"+f,"g"),s=o.attr("id");s=s.replace(e,"step-"+u);o.attr("id",s);h=o.find("> .card > .card-header").find("> h4 > a");h.text(" "+Translator.trans("Step")+" #"+u+" : "+r.label+" ");c=o.find(".step-container");c.attr("data-id",u);l=o.find("*");l.each(function(){var n;this.hasAttribute("data-step")&&$(this).attr("data-step",u);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(e,"step-"+u),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(e,"step-"+u),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(e,"step-"+u),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(e,"step-"+u),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(e,"step-"+u),$(this).attr("aria-labelledby",n))});Simulators.changeStepIdInActionButtons(f,"X"+u);Simulators.changeStepIdInRules(f,"X"+u)}});$.each(steps,function(n,t){Simulators.changeStepIdInActionButtons("X"+t.id,t.id);Simulators.changeStepIdInRules("X"+t.id,t.id)})};Simulators.bindSortableSteps=function(n){n||(n=$("#collapsesteps"));n.find("> .sortable").sortable({cursor:"move",containment:"parent",axis:"y",sort:function(){Simulators.updating&&(Simulators.toast(Translator.trans("An update is in progress,"),Translator.trans("first click «Cancel» or «Validate»")),setTimeout(function(){n.find("> .sortable").sortable("cancel")},0))},update:function(n,t){if(!Simulators.updating){var r=$(this),u=$(t.item).find(".step-container"),i=u.attr("data-id");i==0||steps[t.item.index()].id==0?(r.sortable("cancel"),Simulators.toast(Translator.trans("step 0 cannot be moved"))):Simulators.moveInArray(steps,[{key:"id",val:i}],t.item.index())&&(Simulators.renumberSteps($(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}}})};Simulators.drawStepForDisplay=function(n,t){var i="step-"+n.id,u=[{"class":"delete-step",label:Translator.trans("Delete"),icon:"fa-minus-circle"}];n.footNotes&&n.footNotes.length!=0?u.push({"class":"add-panel",label:Translator.trans("Add panel"),icon:"fa-plus-circle"}):u.push({label:Translator.trans("Add"),icon:"fa-plus-circle",dropdown:[{"class":"add-panel",label:Translator.trans("Add panel")},{"class":"add-footnotes",label:Translator.trans("Add footnotes")}]});u.push({"class":"edit-step",label:Translator.trans("Edit"),icon:"fa-pencil"});var e=Simulators.openCollapsiblePanel(i,Translator.trans("Step")+" #"+n.id+" : "+n.label,"info",t,"",u),h=e.find(".card-body"),o=$('<div class="card bg-light step-container" id="'+i+'-attributes-panel" data-id="'+n.id+'"><\/div>'),f=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Step Name"),n.name,n.name,!0,Translator.trans("Step Name"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Step Label"),n.label,n.label,!0,Translator.trans("Step Label"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","template",Translator.trans("Step Template"),n.template,n.template,!0,Translator.trans("Step Template"))),r.append(Simulators.simpleAttributeForDisplay(i,"select","output",Translator.trans("Output"),n.output,n.output,!1,Translator.trans("Select an output"),JSON.stringify(Simulators.outputTypes))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","pdfFooter",Translator.trans("Footer in PDF"),n.pdfFooter,n.pdfFooter,!1,Translator.trans("Footer in PDF"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","dynamic",Translator.trans("Interactive UI"),n.dynamic,n.dynamic,!1,Translator.trans("Interactive UI"))),s.append(r),f.append(s),f.append('<div class="card bg-light description-panel" id="'+i+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body step-description rich-text" data-edition="'+n.description.edition+'">'+n.description.content+"<\/div><\/div>"),o.append(f),h.append(o),e};Simulators.drawStepForInput=function(n){var t="step-"+n.id,e=[{"class":"delete-step",label:Translator.trans("Delete"),icon:"fa-minus-circle"}],s,u,i,c,f;n.footNotes?e.push({"class":"add-panel",label:Translator.trans("Add panel"),icon:"fa-plus-circle"}):e.push({label:Translator.trans("Add"),icon:"fa-plus-circle",dropdown:[{"class":"add-panel",label:Translator.trans("Add panel")},{"class":"add-footnotes",label:Translator.trans("Add footnotes")}]});e.push({"class":"edit-step",label:Translator.trans("Edit"),icon:"fa-pencil"});var l=Simulators.openCollapsiblePanel(t,Translator.trans("Step")+" #"+n.id+" : "+n.label,"info","","",e),v=l.find(".card-body"),a=$('<div class="card bg-light step-container" id="'+t+'-attributes-panel" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),o=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForInput(t+"-name","text","name",Translator.trans("Step Name"),n.name,!0,Translator.trans("Step Name"))),r.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Step Label"),n.label,!0,Translator.trans("Step Label"))),r.append(Simulators.simpleAttributeForInput(t+"-template","text","template",Translator.trans("Step Template"),n.template,!0,Translator.trans("Step Template"))),h.append(r),s=$('<div class="optional-attributes card bg-light"><\/div>'),s.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),u=$('<ul class="list-group"><\/ul>'),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="select" data-name="output" data-placeholder="'+Translator.trans("Select an output")+'" data-options="'+encodeURI(JSON.stringify(Simulators.outputTypes))+'">'+Translator.trans("Output")+"<\/li>"),u.append(i),n.output&&(r.append(Simulators.simpleAttributeForInput(t+"-output","select","output",Translator.trans("Output"),n.output,!1,Translator.trans("Select an output"),JSON.stringify(Simulators.outputTypes))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="pdfFooter" data-placeholder="'+Translator.trans("Footer in PDF")+'">'+Translator.trans("Footer in PDF")+"<\/li>"),u.append(i),n.pdfFooter&&(r.append(Simulators.simpleAttributeForInput(t+"-pdfFooter","checkbox","pdfFooter",Translator.trans("Footer in PDF"),n.pdfFooter,!1,Translator.trans("Footer in PDF"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="dynamic" data-placeholder="'+Translator.trans("Interactive UI")+'">'+Translator.trans("Interactive UI")+"<\/li>"),u.append(i),n.dynamic&&(r.append(Simulators.simpleAttributeForInput(t+"-dynamic","checkbox","dynamic",Translator.trans("Interactive UI"),n.dynamic,!1,Translator.trans("Interactive UI"))),i.hide()),s.append(u),h.append(s),o.append(h),a.append(o),v.append(a),o.append('<div class="card bg-light description-panel elements-container" id="'+t+'-description-panel"><div class="card-header">'+Translator.trans("Description")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-description" id="'+t+'-description" wrap="hard" class="form-control step-description">'+Simulators.paragraphs(n.description).content+"<\/textarea><\/div><\/div>"),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),f=$('<div class="card-body step-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-step">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-step">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(f),o.append(c),l};Simulators.bindStepButtons=function(n){n||(n=$("#collapsesteps"));n.find("button.edit-step").on("click",function(n){n.preventDefault();Simulators.editStep($($(this).attr("data-parent")))});n.find("button.delete-step").on("click",function(n){n.preventDefault();Simulators.deleteStep($($(this).attr("data-parent")))});n.find("button.add-action-button").on("click",function(n){n.preventDefault();Simulators.addActionButton($($(this).attr("data-parent")))});n.find("button.add-footnotes, a.add-footnotes").on("click",function(n){n.preventDefault();Simulators.addFootNotes($($(this).attr("data-parent")))});n.find("button.add-panel, a.add-panel").on("click",function(n){n.preventDefault();Simulators.addPanel($($(this).attr("data-parent")))})};Simulators.bindStep=function(n){n.find("textarea").wysihtml(Admin.wysihtml5Options);n.find(".cancel-edit-step").on("click",function(){n.find(".step-container").replaceWith(Simulators.stepBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-step").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-step, .validate-add-step").on("click",function(){var l=n.parent(),o=n.find(".step-container"),s,u,i,h,f,e;if(!Simulators.checkStep(n))return!1;var r=o.attr("data-id"),t={id:r,output:"",dynamic:"0"},c=o.find(".attributes-container");c.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).is(":checkbox")?$(this).is(":checked")?1:0:$(this).val()});t.name&&(t.name=$.trim(t.name));t.description={content:Admin.clearHTML(n.find(".step-description")),edition:"wysihtml"};s="";$(this).hasClass("validate-edit-step")?(u=Simulators.findInArray(steps,[{key:"id",val:r}]),s=u.label,t.panels=u.panels,t.actions=u.actions,t.footNotes=u.footNotes):(t.panels=[],t.actions=[],t.footNotes=[]);i=Simulators.drawStepForDisplay(t,"in");$(this).hasClass("validate-edit-step")?(o.replaceWith(i.find(".step-container")),t.label!=s&&(h=n.find("> .card > .card-header").find("> h4 > a"),h.text(" "+Translator.trans("Step")+" #"+t.id+" : "+t.label),Simulators.changeStepLabelInActionButtons(r,t.name,t.label),Simulators.changeStepLabelInRules(r,t.label)),Simulators.updateInArray(steps,[{key:"id",val:r}],t),i=n):(f=$('<div class="card bg-light panels-panel" id="step-'+t.id+'-panels-panel"><div class="card-body sortable"><\/div><\/div>'),i.find(".step-container").after(f),Simulators.bindSortablePanels(f),e=$('<div class="actions-buttons-panel"><\/div>'),e.append(Simulators.drawActionButtonsForDisplay(t)),f.after(e),Simulators.bindSortableActionButtons(e),n.replaceWith(i),Simulators.bindStepButtons(i),Simulators.addInArray(steps,[],t),Simulators.addStepToDataset(t.id),Simulators.addStepInActions(t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkStep=function(n){var t=n.attr("id"),i=$.trim($("#"+t+"-name").val()),u,f,e,r;return i===""?(n.find(".error-message").text(Translator.trans("The step name is required")),n.find(".alert").show(),!1):/^\w+$/.test(i)?(u=$.trim($("#"+t+"-label").val()),u==="")?(n.find(".error-message").text(Translator.trans("The step label is required")),n.find(".alert").show(),!1):(f=$.trim($("#"+t+"-template").val()),f==="")?(n.find(".error-message").text(Translator.trans("The step template is required")),n.find(".alert").show(),!1):(e=n.find(".step-container").attr("data-id"),r=!1,$.each(steps,function(n,t){if(t.id!=e&&t.name==i)return r=!0,!1}),r)?(n.find(".error-message").text(Translator.trans("This step name already exists")),n.find(".alert").show(),!1):!0:(n.find(".error-message").text(Translator.trans("Incorrect step name")),n.find(".alert").show(),!1)};Simulators.addStep=function(){var t,i,n;try{t=0;$.each(steps,function(n,i){i.id>t&&(t=i.id)});i={id:parseInt(t)+1,name:"",label:"",template:"pages:article.html.twig",output:"normal",pdfFooter:"0",dynamic:"1",description:{content:"",edition:""},panels:[],actions:[],footNotes:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();n=Simulators.drawStepForInput(i);n.find("button.cancel-edit-step").addClass("cancel-add-step").removeClass("cancel-edit-step");n.find("button.validate-edit-step").addClass("validate-add-step").removeClass("validate-edit-step");$("#collapsesteps").find("> div.sortable").append(n);Simulators.bindStep(n);$("#collapsesteps").collapse("show");n.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(r){console&&console.log(r.message)}};Simulators.editStep=function(n){var r;try{var t=n.find(".step-container"),i=t.attr("data-id"),u=Simulators.findInArray(steps,[{key:"id",val:i}]);$(".update-button").hide();$(".toggle-collapse-all").hide();r=Simulators.drawStepForInput(u);Simulators.stepBackup=t.replaceWith(r.find(".step-container"));Simulators.bindStep(n);$("#collapsestep-"+i).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(f){console&&console.log(f.message)}};Simulators.deleteStep=function(n){var u;try{var f=n.find(".step-container"),t=f.attr("data-id"),i=Simulators.findInArray(steps,[{key:"id",val:t}]),e=i.label?i.label:i.name,r;if((r=Simulators.isStepInRules(t))!==!1){bootbox.alert({title:Translator.trans("Deleting step"),message:Translator.trans("This step is used in rule #%id%. You must modify this rule before you can delete this step",{id:r})});return}if((u=Simulators.isStepIdInActionButtons(t))!==!1){bootbox.alert({title:Translator.trans("Deleting step"),message:Translator.trans("This step is used in action button « %label% ». You must modify this action button before you can delete this step",{label:u})});return}bootbox.confirm({title:Translator.trans("Deleting step"),message:Translator.trans("Are you sure you want to delete the step : %label%",{label:e}),callback:function(i){if(i){Simulators.deleteInArray(steps,[{key:"id",val:t}]);var r=n.parent();n.remove();Simulators.deleteStepInActions(t);Simulators.renumberSteps(r.find("> div"));Simulators.deleteStepInDataset(steps.length+1);$(".save-simulator").show();Admin.updated=!0}}})}catch(o){console&&console.log(o.message)}}}(this),function(){"use strict";Simulators.bindSortableActionButtons=function(n){n||(n=$("#steps .actions-buttons-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".action-button-container"),r=i.attr("data-step"),u=Simulators.findInArray(steps,[{key:"id",val:r}]),f=i.attr("data-id");Simulators.moveInArray(u.actions,[{key:"name",val:f}],t.item.index())&&($(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.changeStepIdInActionButtons=function(n,t){$.each(steps,function(i,r){$.each(r.actions,function(i,u){if(u.for=="jumpToStep")u.uri==n&&(u.uri=t,$("#step-"+r.id+"-action-button-"+u.name).find("p[data-attribute='uri']").attr("data-value",t));else if(u.for=="function"){var f=JSON.parse(u.uri.replace(/'/g,'"'));f.arguments.step&&f.arguments.step==n&&(f.arguments.step=t,u.uri=JSON.stringify(f).replace(/"/g,"'"))}})})};Simulators.isStepIdInActionButtons=function(n){var t=!1;return $.each(steps,function(i,r){return $.each(r.actions,function(i,r){if(r.for=="jumpToStep"){if(r.uri==n)return t=r.label,!1}else if(r.for=="function"){var u=JSON.parse(r.uri.replace(/'/g,'"'));if(u.arguments.step&&u.arguments.step==n)return t=r.label,!1}}),t!==!1?!1:void 0}),t};Simulators.changeStepLabelInActionButtons=function(n,t,i){i=i||Translator.trans("Step %id% (nolabel)",{id:n});$.each(steps,function(t,r){$.each(r.actions,function(t,u){u.for=="jumpToStep"&&u.uri==n&&$("#step-"+r.id+"-action-button-"+u.name).find("p[data-attribute='uri']").text(i)})})};Simulators.changePanelIdInActionButtons=function(n,t,i){$.each(steps,function(r,u){$.each(u.actions,function(r,f){if(f.for=="function"){var e=JSON.parse(f.uri.replace(/'/g,'"'));e.arguments.step&&e.arguments.step==n&&e.arguments.panel&&e.arguments.panel==t&&(e.arguments.panel=i,f.uri=JSON.stringify(e).replace(/"/g,"'"),$("#step-"+u.id+"-action-button-"+f.name).find("p[data-attribute='panel']").attr("data-value",i))}})})};Simulators.changePanelLabelInActionButtons=function(n,t,i){i=i||Translator.trans("Panel %id% (nolabel)",{id:t});$.each(steps,function(r,u){$.each(u.actions,function(r,f){if(f.for=="function"){var e=JSON.parse(f.uri.replace(/'/g,'"'));e.arguments.step&&e.arguments.step==n&&e.arguments.panel&&e.arguments.panel==t&&$("#step-"+u.id+"-action-button-"+f.name).find("p[data-attribute='panel']").text(i)}})})};Simulators.isPanelIdInActionButtons=function(n,t){var i=!1;return $.each(steps,function(r,u){return $.each(u.actions,function(r,u){if(u.for=="function"){var f=JSON.parse(u.uri.replace(/'/g,'"'));if(f.arguments.step&&f.arguments.step==n&&f.arguments.panel&&f.arguments.panel==t)return i=u.label,!1}}),i!==!1?!1:void 0}),i};Simulators.changeFieldsetIdInActionButtons=function(n,t,i,r){$.each(steps,function(u,f){$.each(f.actions,function(u,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&(o.arguments.fieldset&&o.arguments.fieldset==i?(o.arguments.fieldset=r,e.uri=JSON.stringify(o).replace(/"/g,"'"),$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='fieldset']").attr("data-value",r)):o.arguments.blockgroup&&o.arguments.blockgroup==i&&(o.arguments.blockgroup=r,e.uri=JSON.stringify(o).replace(/"/g,"'"),$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='blockgroup']").attr("data-value",r)))}})})};Simulators.changeFieldsetLegendInActionButtons=function(n,t,i,r){r=r||Translator.trans("Fieldset %id% (nolegend)",{id:i});$.each(steps,function(u,f){$.each(f.actions,function(u,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&(o.arguments.fieldset&&o.arguments.fieldset==i?$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='fieldset']").text(r):o.arguments.blockgroup&&o.arguments.blockgroup==i&&$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='blockgroup']").text(r))}})})};Simulators.isFieldsetIdInActionButtons=function(n,t,i){var r=!1;return $.each(steps,function(u,f){return $.each(f.actions,function(u,f){if(f.for=="function"){var e=JSON.parse(f.uri.replace(/'/g,'"'));if(e.arguments.step&&e.arguments.step==n&&e.arguments.panel&&e.arguments.panel==t&&(e.arguments.fieldset&&e.arguments.fieldset==i||e.arguments.blockgroup&&e.arguments.blockgroup==i))return r=f.label,!1}}),r!==!1?!1:void 0}),r};Simulators.changeFieldrowIdInActionButtons=function(n,t,i,r,u){$.each(steps,function(f,e){$.each(e.actions,function(f,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.fieldset&&s.arguments.fieldset==i&&s.arguments.fieldrow&&s.arguments.fieldrow==r&&(s.arguments.fieldrow=u,o.uri=JSON.stringify(s).replace(/"/g,"'"),$("#step-"+e.id+"-action-button-"+o.name).find("p[data-attribute='fieldrow']").attr("data-value",u))}})})};Simulators.changeFieldrowLabelInActionButtons=function(n,t,i,r,u){u=u||Translator.trans("Fieldrow %id% (nolabel)",{id:r});$.each(steps,function(f,e){$.each(e.actions,function(f,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.fieldset&&s.arguments.fieldset==i&&s.arguments.fieldrow&&s.arguments.fieldrow==r&&$("#step-"+e.id+"-action-button-"+o.name).find("p[data-attribute='fieldrow']").text(u)}})})};Simulators.isFieldrowIdInActionButtons=function(n,t,i,r){var u=!1;return $.each(steps,function(f,e){return $.each(e.actions,function(f,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));if(o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&o.arguments.fieldset&&o.arguments.fieldset==i&&o.arguments.fieldrow&&o.arguments.fieldrow==r)return u=e.label,!1}}),u!==!1?!1:void 0}),u};Simulators.changeFieldrowFieldPositionInActionButtons=function(n,t,i,r,u,f){$.each(steps,function(e,o){$.each(o.actions,function(e,s){if(s.for=="function"){var h=JSON.parse(s.uri.replace(/'/g,'"'));h.arguments.step&&h.arguments.step==n&&h.arguments.panel&&h.arguments.panel==t&&h.arguments.fieldset&&h.arguments.fieldset==i&&h.arguments.fieldrow&&h.arguments.fieldrow==r&&(h.arguments.field&&h.arguments.field==u||h.arguments.prenote&&h.arguments.prenote==u||h.arguments.postnote&&h.arguments.postnote==u)&&(h.arguments.field?h.arguments.field=f:h.arguments.prenote?h.arguments.prenote=f:h.arguments.postnote&&(h.arguments.postnote=f),s.uri=JSON.stringify(h).replace(/"/g,"'"),$("#step-"+o.id+"-action-button-"+s.name).find("p[data-attribute='field']").attr("data-value",f))}})})};Simulators.changeFieldrowFieldLabelInActionButtons=function(n,t,i,r,u,f){f=f||Translator.trans("Field %id% (nolabel)",{id:u});$.each(steps,function(e,o){$.each(o.actions,function(e,s){if(s.for=="function"){var h=JSON.parse(s.uri.replace(/'/g,'"'));h.arguments.step&&h.arguments.step==n&&h.arguments.panel&&h.arguments.panel==t&&h.arguments.fieldset&&h.arguments.fieldset==i&&h.arguments.fieldrow&&h.arguments.fieldrow==r&&(h.arguments.field&&h.arguments.field==u||h.arguments.prenote&&h.arguments.prenote==u||h.arguments.postnote&&h.arguments.postnote==u)&&$("#step-"+o.id+"-action-button-"+s.name).find("p[data-attribute='field']").text(f)}})})};Simulators.isFieldrowFieldPositionInActionButtons=function(n,t,i,r,u){var f=!1;return $.each(steps,function(e,o){return $.each(o.actions,function(e,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));if(s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.fieldset&&s.arguments.fieldset==i&&s.arguments.fieldrow&&s.arguments.fieldrow==r&&(s.arguments.field&&s.arguments.field==u||s.arguments.prenote&&s.arguments.prenote==u||s.arguments.postnote&&s.arguments.postnote==u))return f=o.label,!1}}),f!==!1?!1:void 0}),f};Simulators.changeFieldPositionInActionButtons=function(n,t,i,r,u){$.each(steps,function(f,e){$.each(e.actions,function(f,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.fieldset&&s.arguments.fieldset==i&&(s.arguments.field&&s.arguments.field==r||s.arguments.prenote&&s.arguments.prenote==r||s.arguments.postnote&&s.arguments.postnote==r)&&(s.arguments.field?s.arguments.field=u:s.arguments.prenote?s.arguments.prenote=u:s.arguments.postnote&&(s.arguments.postnote=u),o.uri=JSON.stringify(s).replace(/"/g,"'"),$("#step-"+e.id+"-action-button-"+o.name).find("p[data-attribute='field']").attr("data-value",u))}})})};Simulators.changeFieldLabelInActionButtons=function(n,t,i,r,u){u=u||Translator.trans("Field %id% (nolabel)",{id:r});$.each(steps,function(f,e){$.each(e.actions,function(f,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.fieldset&&s.arguments.fieldset==i&&(s.arguments.field&&s.arguments.field==r||s.arguments.prenote&&s.arguments.prenote==r||s.arguments.postnote&&s.arguments.postnote==r)&&$("#step-"+e.id+"-action-button-"+o.name).find("p[data-attribute='field']").text(u)}})})};Simulators.isFieldPositionInActionButtons=function(n,t,i,r){var u=!1;return $.each(steps,function(f,e){return $.each(e.actions,function(f,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));if(o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&o.arguments.fieldset&&o.arguments.fieldset==i&&(o.arguments.field&&o.arguments.field==r||o.arguments.prenote&&o.arguments.prenote==r||o.arguments.postnote&&o.arguments.postnote==r))return u=e.label,!1}}),u!==!1?!1:void 0}),u};Simulators.changeBlockinfoIdInActionButtons=function(n,t,i,r){$.each(steps,function(u,f){$.each(f.actions,function(u,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&(o.arguments.blockinfo&&o.arguments.blockinfo==i?(o.arguments.blockinfo=r,e.uri=JSON.stringify(o).replace(/"/g,"'"),$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='blockinfo']").attr("data-value",r)):o.arguments.blockgroup&&o.arguments.blockgroup==i&&(o.arguments.blockgroup=r,e.uri=JSON.stringify(o).replace(/"/g,"'"),$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='blockgroup']").attr("data-value",r)))}})})};Simulators.changeBlockinfoLabelInActionButtons=function(n,t,i,r){r=r||Translator.trans("Blockinfo %id% (nolabel)",{id:i});$.each(steps,function(u,f){$.each(f.actions,function(u,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&(o.arguments.blockinfo&&o.arguments.blockinfo==i?$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='blockinfo']").text(r):o.arguments.blockgroup&&o.arguments.blockgroup==i&&$("#step-"+f.id+"-action-button-"+e.name).find("p[data-attribute='blockgroup']").text(r))}})})};Simulators.isBlockinfoIdInActionButtons=function(n,t,i){var r=!1;return $.each(steps,function(u,f){return $.each(f.actions,function(u,f){if(f.for=="function"){var e=JSON.parse(f.uri.replace(/'/g,'"'));if(e.arguments.step&&e.arguments.step==n&&e.arguments.panel&&e.arguments.panel==t&&(e.arguments.blockinfo&&e.arguments.blockinfo==i||e.arguments.blockgroup&&e.arguments.blockgroup==i))return r=f.label,!1}}),r!==!1?!1:void 0}),r};Simulators.changeChapterIdInActionButtons=function(n,t,i,r,u){$.each(steps,function(f,e){$.each(e.actions,function(f,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.blockinfo&&s.arguments.blockinfo==i&&s.arguments.chapter&&s.arguments.chapter==r&&(s.arguments.chapter=u,o.uri=JSON.stringify(s).replace(/"/g,"'"),$("#step-"+e.id+"-action-button-"+o.name).find("p[data-attribute='chapter']").attr("data-value",u))}})})};Simulators.changeChapterLabelInActionButtons=function(n,t,i,r,u){u=u||Translator.trans("Chapter %id% (nolabel)",{id:r});$.each(steps,function(f,e){$.each(e.actions,function(f,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.blockinfo&&s.arguments.blockinfo==i&&s.arguments.chapter&&s.arguments.chapter==r&&$("#step-"+e.id+"-action-button-"+o.name).find("p[data-attribute='chapter']").text(u)}})})};Simulators.isChapterIdInActionButtons=function(n,t,i,r){var u=!1;return $.each(steps,function(f,e){return $.each(e.actions,function(f,e){if(e.for=="function"){var o=JSON.parse(e.uri.replace(/'/g,'"'));if(o.arguments.step&&o.arguments.step==n&&o.arguments.panel&&o.arguments.panel==t&&o.arguments.blockinfo&&o.arguments.blockinfo==i&&o.arguments.chapter&&o.arguments.chapter==r)return u=e.label,!1}}),u!==!1?!1:void 0}),u};Simulators.changeSectionIdInActionButtons=function(n,t,i,r,u,f){$.each(steps,function(e,o){$.each(o.actions,function(e,s){if(s.for=="function"){var h=JSON.parse(s.uri.replace(/'/g,'"'));h.arguments.step&&h.arguments.step==n&&h.arguments.panel&&h.arguments.panel==t&&h.arguments.blockinfo&&h.arguments.blockinfo==i&&h.arguments.chapter&&h.arguments.chapter==r&&(h.arguments.section&&h.arguments.section==u||h.arguments.content&&h.arguments.content==u||h.arguments.annotations&&h.arguments.annotations==u)&&(h.arguments.section?h.arguments.section=f:h.arguments.content?h.arguments.content=f:h.arguments.annotations&&(h.arguments.annotations=f),s.uri=JSON.stringify(h).replace(/"/g,"'"),$("#step-"+o.id+"-action-button-"+s.name).find("p[data-attribute='section']").attr("data-value",f))}})})};Simulators.changeSectionLabelInActionButtons=function(n,t,i,r,u,f){f=f||Translator.trans("Section %id% (nolabel)",{id:u});$.each(steps,function(e,o){$.each(o.actions,function(e,s){if(s.for=="function"){var h=JSON.parse(s.uri.replace(/'/g,'"'));h.arguments.step&&h.arguments.step==n&&h.arguments.panel&&h.arguments.panel==t&&h.arguments.blockinfo&&h.arguments.blockinfo==i&&h.arguments.chapter&&h.arguments.chapter==r&&(h.arguments.section&&h.arguments.section==u||h.arguments.content&&h.arguments.content==u||h.arguments.annotations&&h.arguments.annotations==u)&&$("#step-"+o.id+"-action-button-"+s.name).find("p[data-attribute='section']").text(f)}})})};Simulators.isSectionIdInActionButtons=function(n,t,i,r,u){var f=!1;return $.each(steps,function(e,o){return $.each(o.actions,function(e,o){if(o.for=="function"){var s=JSON.parse(o.uri.replace(/'/g,'"'));if(s.arguments.step&&s.arguments.step==n&&s.arguments.panel&&s.arguments.panel==t&&s.arguments.blockinfo&&s.arguments.blockinfo==i&&s.arguments.chapter&&s.arguments.chapter==r&&(s.arguments.section&&s.arguments.section==u||s.arguments.content&&s.arguments.content==u||s.arguments.annotations&&s.arguments.annotations==u))return f=o.label,!1}}),f!==!1?!1:void 0}),f};Simulators.changeFootnoteIdInActionButtons=function(n,t,i){$.each(steps,function(r,u){$.each(u.actions,function(r,f){var e,o;f.for=="function"&&(e=JSON.parse(f.uri.replace(/'/g,'"')),e.arguments.step&&e.arguments.step==n&&e.arguments.footnote&&e.arguments.footnote==t&&(e.arguments.footnote=i,f.uri=JSON.stringify(e).replace(/"/g,"'"),o=Translator.trans("FootNote #%id%",{id:i}),$("#step-"+u.id+"-action-button-"+f.name).find("p[data-attribute='footnote']").attr("data-value",i).text(o)))})})};Simulators.isFootnoteIdInActionButtons=function(n,t){var i=!1;return $.each(steps,function(r,u){return $.each(u.actions,function(r,u){if(u.for=="function"){var f=JSON.parse(u.uri.replace(/'/g,'"'));if(f.arguments.step&&f.arguments.step==n&&f.arguments.footnote&&f.arguments.footnote==t)return i=u.label,!1}}),i!==!1?!1:void 0}),i};Simulators.drawActionButtonsForDisplay=function(n){var i="step-"+n.id+"-action-buttons",t=Simulators.openCollapsiblePanel(i,Translator.trans("Actions Buttons"),"success","in","sortable",[{"class":"add-action-button",label:Translator.trans("Add action button"),icon:"fa-plus-circle"}]),r=t.find(".card-body");return $.each(n.actions,function(t,i){i.stepId=n.id;r.append(Simulators.drawActionButtonForDisplay(i))}),t};Simulators.drawActionButtonForDisplay=function(n){var i="step-"+n.stepId+"-action-button-"+n.name,o=Simulators.openCollapsiblePanel(i,Translator.trans("Action Button")+" : "+n.label,"light","in","sortable",[{"class":"delete-action-button",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-action-button",label:Translator.trans("Edit"),icon:"fa-plus-circle"}]),tt=o.find(".card-body"),s=$('<div class="card bg-light action-button-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-id="'+n.name+'"><\/div>'),h=$('<div class="card-body"><\/div>'),c=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>"),l,t,f,e,a,v,y,p,w,b,k,d,g,nt,u;r.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Button name")));r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Button label")));r.append(Simulators.simpleAttributeForDisplay(i,"select","shape",Translator.trans("Action shape"),n.shape,n.shape,!0,Translator.trans("Select an action shape"),JSON.stringify({button:Translator.trans("Button"),link:Translator.trans("Text link or icon")})));r.append(Simulators.simpleAttributeForDisplay(i,"select","location",Translator.trans("Location"),n.location,n.location,!0,Translator.trans("Select a location"),JSON.stringify({top:Translator.trans("At the top of the simulation form"),right:Translator.trans("On the right of the simulation form"),bottom:Translator.trans("At the bottom of the simulation form"),left:Translator.trans("On the left of the simulation form")})));r.append(Simulators.simpleAttributeForDisplay(i,"select","what",Translator.trans("What"),n.what,n.what,!0,Translator.trans("Select an action"),JSON.stringify({submit:Translator.trans("Submit"),reset:Translator.trans("Reset"),execute:Translator.trans("Execute")})));switch(n.what){case"submit":r.append(Simulators.simpleAttributeForDisplay(i,"select","for",Translator.trans("For"),n.for,n.for,!0,Translator.trans("Select a target step"),JSON.stringify({priorStep:Translator.trans("Prior step"),currentStep:Translator.trans("Current step"),nextStep:Translator.trans("Next step"),jumpToStep:Translator.trans("Jump to step"),newSimulation:Translator.trans("New simulation"),externalPage:Translator.trans("External page")})));n.for=="jumpToStep"?(l=Simulators.makeTargetSteps(n.stepId),r.append(Simulators.simpleAttributeForDisplay(i,"select","uri",Translator.trans("Target step"),n.uri,n.uri,!0,Translator.trans("Select a target step"),JSON.stringify(l)))):n.for=="externalPage"&&r.append(Simulators.simpleAttributeForDisplay(i,"text","uri",Translator.trans("External page URL"),n.uri,n.uri,!0,Translator.trans("External page URL")));break;case"execute":r.append(Simulators.simpleAttributeForDisplay(i,"select","for",Translator.trans("What?"),n.for,n.for,!0,Translator.trans("Select a target step"),JSON.stringify({"function":Translator.trans("Function")})));n.for=="function"&&(t=JSON.parse(n.uri.replace(/'/g,'"')),r.append(Simulators.simpleAttributeForDisplay(i,"select","function",Translator.trans("Function"),t.function,t.function,!0,Translator.trans("Select a function"),JSON.stringify(functions.labels))),r.append(Simulators.simpleAttributeForDisplay(i,"select","appliedto",Translator.trans("Applied to"),t.appliedto,t.appliedto,!0,Translator.trans("Select a target"),JSON.stringify({page:Translator.trans("Full page"),article:Translator.trans("Simulation block"),data:Translator.trans("Data"),datagroup:Translator.trans("Datagroup"),step:Translator.trans("Step"),panel:Translator.trans("Panel"),blockgroup:Translator.trans("Grouping of information block/group of fields"),fieldset:Translator.trans("FieldSet"),fieldrow:Translator.trans("Fieldrow"),field:Translator.trans("Field"),prenote:Translator.trans("PreNote"),postnote:Translator.trans("PostNote"),blockinfo:Translator.trans("BlockInfo"),chapter:Translator.trans("Chapter"),section:Translator.trans("Section"),content:Translator.trans("Section content"),annotations:Translator.trans("Section annotations"),footnote:Translator.trans("FootNote")}))),t.arguments.data?(f={},$.each(Simulators.dataset,function(n,t){f[t.id]=t.label}),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","data",Translator.trans("Data"),t.arguments.data,t.arguments.data,!0,Translator.trans("Select a data"),JSON.stringify(f)))):t.arguments.datagroup?(e={},$.each(Simulators.datagroups,function(n,t){e[t.id]=t.label}),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","datagroup",Translator.trans("Datagroup"),t.arguments.datagroup,t.arguments.datagroup,!0,Translator.trans("Select a datagroup"),JSON.stringify(e)))):t.arguments.step&&(t.arguments.footnote?(a=Simulators.makeTargetFootnotes(t.arguments.step),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","footnote",Translator.trans("Footnote"),t.arguments.footnote,t.arguments.footnote,!0,Translator.trans("Select a footnote"),JSON.stringify(a)))):t.arguments.panel&&(v=Simulators.makeTargetPanels(t.arguments.step),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","panel",Translator.trans("Panel"),t.arguments.panel,t.arguments.panel,!0,Translator.trans("Select a panel"),JSON.stringify(v))),t.arguments.blockgroup?(y=Simulators.makeTargetBlockGroups(t.arguments.step,t.arguments.panel),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","blockgroup",Translator.trans("Block belonging to the grouping"),t.arguments.blockgroup,t.arguments.blockgroup,!0,Translator.trans("Select a block belonging to the group"),JSON.stringify(y)))):t.arguments.fieldset?(p=Simulators.makeTargetFieldsets(t.arguments.step,t.arguments.panel),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","fieldset",Translator.trans("FieldSet"),t.arguments.fieldset,t.arguments.fieldset,!0,Translator.trans("Select a fieldset"),JSON.stringify(p))),t.arguments.fieldrow&&(w=Simulators.makeTargetFieldrows(t.arguments.step,t.arguments.panel,t.arguments.fieldset),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","fieldrow",Translator.trans("Fieldrow"),t.arguments.fieldrow,t.arguments.fieldrow,!0,Translator.trans("Select a fieldrow"),JSON.stringify(w)))),t.arguments.field?(b=Simulators.makeTargetFields(t.arguments.step,t.arguments.panel,t.arguments.fieldset,t.arguments.fieldrow),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","field",Translator.trans("Field"),t.arguments.field,t.arguments.field,!0,Translator.trans("Select a field"),JSON.stringify(b)))):t.arguments.prenote?(k=Simulators.makeTargetPrenotes(t.arguments.step,t.arguments.panel,t.arguments.fieldset,t.arguments.fieldrow),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","field",Translator.trans("Field"),t.arguments.prenote,t.arguments.prenote,!0,Translator.trans("Select a field"),JSON.stringify(k)))):t.arguments.postnote&&(d=Simulators.makeTargetPostnotes(t.arguments.step,t.arguments.panel,t.arguments.fieldset,t.arguments.fieldrow),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","field",Translator.trans("Field"),t.arguments.postnote,t.arguments.postnote,!0,Translator.trans("Select a field"),JSON.stringify(d))))):t.arguments.blockinfo&&(g=Simulators.makeTargetBlockinfos(t.arguments.step,t.arguments.panel),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","blockinfo",Translator.trans("BlockInfo"),t.arguments.blockinfo,t.arguments.blockinfo,!0,Translator.trans("Select a blockinfo"),JSON.stringify(g))),t.arguments.chapter&&(nt=Simulators.makeTargetChapters(t.arguments.step,t.arguments.panel,t.arguments.blockinfo),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","chapter",Translator.trans("Chapter"),t.arguments.chapter,t.arguments.chapter,!0,Translator.trans("Select a chapter"),JSON.stringify(nt))),t.arguments.section?(u=Simulators.makeTargetSections(t.arguments.step,t.arguments.panel,t.arguments.blockinfo,t.arguments.chapter),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","section",Translator.trans("Section"),t.arguments.section,t.arguments.section,!0,Translator.trans("Select a section"),JSON.stringify(u)))):t.arguments.content?(u=Simulators.makeTargetSections(t.arguments.step,t.arguments.panel,t.arguments.blockinfo,t.arguments.chapter),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","section",Translator.trans("Section"),t.arguments.content,t.arguments.content,!0,Translator.trans("Select a section"),JSON.stringify(u)))):t.arguments.annotations&&(u=Simulators.makeTargetSections(t.arguments.step,t.arguments.panel,t.arguments.blockinfo,t.arguments.chapter),r.append(Simulators.simpleAttributeForDisplay(i+"-argument","select","section",Translator.trans("Section"),t.arguments.annotations,t.arguments.annotations,!0,Translator.trans("Select a section"),JSON.stringify(u)))))))))}return r.append(Simulators.simpleAttributeForDisplay(i,"select","class",Translator.trans("Class"),n.class,n.class,!1,Translator.trans("Button class"),JSON.stringify({"btn-primary":Translator.trans("Primary"),"btn-secondary":Translator.trans("Secondary")}))),c.append(r),h.append(c),s.append(h),tt.append(s),o};Simulators.makeTargetSteps=function(n){var t={};return $.each(steps,function(i,r){if(r.id!=n){var u=r.label?r.label:Translator.trans("Step %id% (nolabel)",{id:r.id});t[r.id]=u}}),t};Simulators.makeTargetFootnotes=function(n){var t={};return $.each(steps,function(i,r){if(r.id==n&&r.footNotes&&r.footNotes.footNotes)return $.each(r.footNotes.footNotes,function(n,i){var r=Translator.trans("FootNote #%id%",{id:i.id});t[i.id]=r}),!1}),t};Simulators.makeTargetPanels=function(n){var t={};return $.each(steps,function(i,r){if(r.id==n)return $.each(r.panels,function(n,i){var r=i.label?i.label:Translator.trans("Panel %id% (nolabel)",{id:i.id});t[i.id]=r}),!1}),t};Simulators.makeTargetBlockGroups=function(n,t){var i={};return $.each(steps,function(r,u){if(u.id==n)return $.each(u.panels,function(n,r){if(r.id==t)return $.each(r.blocks,function(n,t){if(t.display!="inline"){var r;r=t.type=="fieldset"?t.legend.content?t.legend.content:Translator.trans("Fieldset %id% (nolegend)",{id:t.id}):t.label?t.label:Translator.trans("Blockinfo %id% (nolabel)",{id:t.id});i[t.id]=r}}),!1}),!1}),i};Simulators.makeTargetFieldsets=function(n,t){var i={};return $.each(steps,function(r,u){if(u.id==n)return $.each(u.panels,function(n,r){if(r.id==t)return $.each(r.blocks,function(n,t){if(t.type=="fieldset"){var r=t.legend.content?t.legend.content:Translator.trans("Fieldset %id% (nolegend)",{id:t.id});i[t.id]=r}}),!1}),!1}),i};Simulators.makeTargetFieldrows=function(n,t,i){var r={};return $.each(steps,function(u,f){if(f.id==n)return $.each(f.panels,function(n,u){if(u.id==t)return $.each(u.blocks,function(n,t){if(t.type=="fieldset"&&t.id==i&&t.fieldrows)return $.each(t.fieldrows,function(n,t){var i=t.label?t.label:Translator.trans("Fieldrow %id% (nolabel)",{id:t.id});r[t.id]=i}),!1}),!1}),!1}),r};Simulators.makeTargetFields=function(n,t,i,r){var u={};return $.each(steps,function(f,e){if(e.id==n)return $.each(e.panels,function(n,f){if(f.id==t)return $.each(f.blocks,function(n,t){if(t.type=="fieldset"&&t.id==i)if(r&&r!="")t.fieldrows&&$.each(t.fieldrows,function(n,t){if(t.id==r)return $.each(t.fields,function(n,t){var i=t.label?t.label:Translator.trans("Field %id% (nolabel)",{id:t.position});u[t.position]=i}),!1});else return $.each(t.fields,function(n,t){var i=t.label?t.label:Translator.trans("Field %id% (nolabel)",{id:t.position});u[t.position]=i}),!1}),!1}),!1}),u};Simulators.makeTargetPrenotes=function(n,t,i,r){var u={};return $.each(steps,function(f,e){if(e.id==n)return $.each(e.panels,function(n,f){if(f.id==t)return $.each(f.blocks,function(n,t){if(t.type=="fieldset"&&t.id==i)if(r&&r!="")t.fieldrows&&$.each(t.fieldrows,function(n,t){if(t.id==r)return $.each(t.fields,function(n,t){if(t.Note&&t.Note.position=="beforeField"){var i=t.label?t.label:Translator.trans("Field %id% (nolabel)",{id:t.position});u[t.position]=i}}),!1});else return $.each(t.fields,function(n,t){if(t.Note&&t.Note.position=="beforeField"){var i=t.label?t.label:Translator.trans("Field %id% (nolabel)",{id:t.position});u[t.position]=i}}),!1}),!1}),!1}),u};Simulators.makeTargetPostnotes=function(n,t,i,r){var u={};return $.each(steps,function(f,e){if(e.id==n)return $.each(e.panels,function(n,f){if(f.id==t)return $.each(f.blocks,function(n,t){if(t.type=="fieldset"&&t.id==i)if(r&&r!="")t.fieldrows&&$.each(t.fieldrows,function(n,t){if(t.id==r)return $.each(t.fields,function(n,t){if(t.Note&&t.Note.position=="afterField"){var i=t.label?t.label:Translator.trans("Field %id% (nolabel)",{id:t.position});u[t.position]=i}}),!1});else return $.each(t.fields,function(n,t){if(t.Note&&t.Note.position=="afterField"){var i=t.label?t.label:Translator.trans("Field %id% (nolabel)",{id:t.position});u[t.position]=i}}),!1}),!1}),!1}),u};Simulators.makeTargetBlockinfos=function(n,t){var i={};return $.each(steps,function(r,u){if(u.id==n)return $.each(u.panels,function(n,r){if(r.id==t)return $.each(r.blocks,function(n,t){if(t.type=="blockinfo"){var r=t.label?t.label:Translator.trans("Blockinfo %id% (nolabel)",{id:t.id});i[t.id]=r}}),!1}),!1}),i};Simulators.makeTargetChapters=function(n,t,i){var r={};return $.each(steps,function(u,f){if(f.id==n)return $.each(f.panels,function(n,u){if(u.id==t)return $.each(u.blocks,function(n,t){if(t.type=="blockinfo"&&t.id==i)return $.each(t.chapters,function(n,t){var i=t.label?t.label:Translator.trans("Chapter %id% (nolabel)",{id:t.id});r[t.id]=i}),!1}),!1}),!1}),r};Simulators.makeTargetSections=function(n,t,i,r){var u={};return $.each(steps,function(f,e){if(e.id==n)return $.each(e.panels,function(n,f){if(f.id==t)return $.each(f.blocks,function(n,t){if(t.type=="blockinfo"&&t.id==i)return $.each(t.chapters,function(n,t){if(t.id==r)return $.each(t.sections,function(n,t){var i=t.label?t.label:Translator.trans("Section %id% (nolabel)",{id:t.id});u[t.id]=i}),!1}),!1}),!1}),!1}),u};Simulators.makeTargetContents=function(n,t,i,r){var u={};return $.each(steps,function(f,e){if(e.id==n)return $.each(e.panels,function(n,f){if(f.id==t)return $.each(f.blocks,function(n,t){if(t.type=="blockinfo"&&t.id==i)return $.each(t.chapters,function(n,t){if(t.id==r)return $.each(t.sections,function(n,t){if(t.content&&t.content.content!=""){var i=t.label?t.label:Translator.trans("Section %id% (nolabel)",{id:t.id});u[t.id]=i}}),!1}),!1}),!1}),!1}),u};Simulators.makeTargetAnnotations=function(n,t,i,r){var u={};return $.each(steps,function(f,e){if(e.id==n)return $.each(e.panels,function(n,f){if(f.id==t)return $.each(f.blocks,function(n,t){if(t.type=="blockinfo"&&t.id==i)return $.each(t.chapters,function(n,t){if(t.id==r)return $.each(t.sections,function(n,t){if(t.annotations&&t.annotations.content!=""){var i=t.label?t.label:Translator.trans("Section %id% (nolabel)",{id:t.id});u[t.id]=i}}),!1}),!1}),!1}),!1}),u};Simulators.drawActionButtonForInput=function(n){var i="step-"+n.stepId+"-action-button-"+n.name,p=Simulators.openCollapsiblePanel(i,Translator.trans("Action Button")+" : "+n.label,"light","in","sortable",[{"class":"delete-action-button",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-action-button",label:Translator.trans("Edit"),icon:"fa-plus-circle"}]),st=p.find(".card-body"),h=$('<div class="card bg-light action-button-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-id="'+n.name+'"><\/div>'),w=$('<div class="card-body"><\/div>'),c=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>"),b,t,u,l,a,k,d,g,nt,tt,it,rt,ut,ft,et,f,o,v,s,ot,y,e;r.append(Simulators.simpleAttributeForInput(i+"-name","text","name",Translator.trans("Name"),n.name,!0,Translator.trans("Action button name without spaces or special characters")));r.append(Simulators.simpleAttributeForInput(i+"-label","text","label",Translator.trans("Label"),n.label,!0,Translator.trans("Action button label")));r.append(Simulators.simpleAttributeForInput(i+"-shape","select","shape",Translator.trans("Action shape"),n.shape,!0,Translator.trans("Select an action shape"),JSON.stringify({button:Translator.trans("Button"),link:Translator.trans("Text link or icon")})));r.append(Simulators.simpleAttributeForInput(i+"-location","select","location",Translator.trans("Location"),n.location,!0,Translator.trans("Select a location"),JSON.stringify({top:Translator.trans("At the top of the simulation form"),right:Translator.trans("On the right of the simulation form"),bottom:Translator.trans("At the bottom of the simulation form"),left:Translator.trans("On the left of the simulation form")})));r.append(Simulators.simpleAttributeForInput(i+"-what","select","what",Translator.trans("What"),n.what,!0,Translator.trans("Select an action"),JSON.stringify({submit:Translator.trans("Submit"),reset:Translator.trans("Reset"),execute:Translator.trans("Execute")})));switch(n.what){case"submit":r.append(Simulators.simpleAttributeForInput(i+"-for","select","for",Translator.trans("For"),n.for,!0,Translator.trans("Select a target step"),JSON.stringify({priorStep:Translator.trans("Prior step"),currentStep:Translator.trans("Current step"),nextStep:Translator.trans("Next step"),jumpToStep:Translator.trans("Jump to step"),newSimulation:Translator.trans("New simulation"),externalPage:Translator.trans("External page")})));n.for=="jumpToStep"?(b=Simulators.makeTargetSteps(n.stepId),r.append(Simulators.simpleAttributeForInput(i+"-uri","select","uri",Translator.trans("Target step"),n.uri,!0,Translator.trans("Select a target step"),JSON.stringify(b)))):n.for=="externalPage"&&r.append(Simulators.simpleAttributeForInput(i+"-uri","text","uri",Translator.trans("External page URL"),n.uri,!0,Translator.trans("External page URL")));break;case"execute":r.append(Simulators.simpleAttributeForInput(i+"-for","select","for",Translator.trans("What?"),n.for,!0,Translator.trans("Select a target step"),JSON.stringify({"function":Translator.trans("Function")})));n.for=="function"&&(t=JSON.parse(n.uri.replace(/'/g,'"')),r.append(Simulators.simpleAttributeForInput(i+"-function","select","function",Translator.trans("Function"),t.function,!0,Translator.trans("Select a function"),JSON.stringify(functions.labels))),u={page:Translator.trans("Full page"),article:Translator.trans("Simulation block"),data:Translator.trans("Data"),datagroup:Translator.trans("Datagroup"),panel:Translator.trans("Panel"),blockgroup:Translator.trans("Grouping of information block/group of fields"),fieldset:Translator.trans("FieldSet"),fieldrow:Translator.trans("Fieldrow"),field:Translator.trans("Field"),prenote:Translator.trans("PreNote"),postnote:Translator.trans("PostNote"),blockinfo:Translator.trans("BlockInfo"),chapter:Translator.trans("Chapter"),section:Translator.trans("Section"),content:Translator.trans("Section content"),annotations:Translator.trans("Section annotations"),footnote:Translator.trans("FootNote")},$.each(u,function(n){$.inArray(n,functions.targets[t.function])<0&&delete u[n]}),Object.keys(Simulators.dataset).length==0&&delete u.data,Object.keys(Simulators.datagroups).length==0&&delete u.datagroup,r.append(Simulators.simpleAttributeForInput(i+"-appliedto","select","appliedto",Translator.trans("Applied to"),t.appliedto,!0,Translator.trans("Select a target"),JSON.stringify(u))),t.arguments.data?(l={},$.each(Simulators.dataset,function(n,t){l[t.id]=t.label}),r.append(Simulators.simpleAttributeForInput(i+"-argument-data","select","data",Translator.trans("Data"),t.arguments.data,!0,Translator.trans("Select a data"),JSON.stringify(l)))):t.arguments.datagroup?(a={},$.each(Simulators.datagroups,function(n,t){a[t.id]=t.label}),r.append(Simulators.simpleAttributeForInput(i+"-argument-datagroup","select","datagroup",Translator.trans("Datagroup"),t.arguments.datagroup,!0,Translator.trans("Select a datagroup"),JSON.stringify(a)))):t.arguments.step&&(t.arguments.footnote?(k=Simulators.makeTargetFootnotes(t.arguments.step),r.append(Simulators.simpleAttributeForInput(i+"-argument-footnote","select","footnote",Translator.trans("Footnote"),t.arguments.footnote,!0,Translator.trans("Select a footnote"),JSON.stringify(k)))):t.arguments.panel&&(d=Simulators.makeTargetPanels(t.arguments.step),r.append(Simulators.simpleAttributeForInput(i+"-argument-panel","select","panel",Translator.trans("Panel"),t.arguments.panel,!0,Translator.trans("Select a panel"),JSON.stringify(d))),t.arguments.blockgroup?(g=Simulators.makeTargetBlockGroups(t.arguments.step,t.arguments.panel),r.append(Simulators.simpleAttributeForInput(i+"-argument-blockgroup","select","blockgroup",Translator.trans("Block belonging to the grouping"),t.arguments.blockgroup,!0,Translator.trans("Select a block belonging to the group"),JSON.stringify(g)))):t.arguments.fieldset?(nt=Simulators.makeTargetFieldsets(t.arguments.step,t.arguments.panel),r.append(Simulators.simpleAttributeForInput(i+"-argument-fieldset","select","fieldset",Translator.trans("FieldSet"),t.arguments.fieldset,!0,Translator.trans("Select a fieldset"),JSON.stringify(nt))),t.arguments.fieldrow&&(tt=Simulators.makeTargetFieldrows(t.arguments.step,t.arguments.panel,t.arguments.fieldset),r.append(Simulators.simpleAttributeForInput(i+"-argument-fieldrow","select","fieldrow",Translator.trans("Fieldrow"),t.arguments.fieldrow,!0,Translator.trans("Select a fieldrow"),JSON.stringify(tt)))),t.arguments.field?(it=Simulators.makeTargetFields(t.arguments.step,t.arguments.panel,t.arguments.fieldset,t.arguments.fieldrow),r.append(Simulators.simpleAttributeForInput(i+"-argument-field","select","field",Translator.trans("Field"),t.arguments.field,!0,Translator.trans("Select a field"),JSON.stringify(it)))):t.arguments.prenote?(rt=Simulators.makeTargetPrenotes(t.arguments.step,t.arguments.panel,t.arguments.fieldset,t.arguments.fieldrow),r.append(Simulators.simpleAttributeForInput(i+"-argument-field","select","field",Translator.trans("Field"),t.arguments.prenote,!0,Translator.trans("Select a field"),JSON.stringify(rt)))):t.arguments.postnote&&(ut=Simulators.makeTargetPostnotes(t.arguments.step,t.arguments.panel,t.arguments.fieldset,t.arguments.fieldrow),r.append(Simulators.simpleAttributeForInput(i+"-argument-field","select","field",Translator.trans("Field"),t.arguments.postnote,!0,Translator.trans("Select a field"),JSON.stringify(ut))))):t.arguments.blockinfo&&(ft=Simulators.makeTargetBlockinfos(t.arguments.step,t.arguments.panel),r.append(Simulators.simpleAttributeForInput(i+"-argument-blockinfo","select","blockinfo",Translator.trans("BlockInfo"),t.arguments.blockinfo,!0,Translator.trans("Select a blockinfo"),JSON.stringify(ft))),t.arguments.chapter&&(et=Simulators.makeTargetChapters(t.arguments.step,t.arguments.panel,t.arguments.blockinfo),r.append(Simulators.simpleAttributeForInput(i+"-argument-chapter","select","chapter",Translator.trans("Chapter"),t.arguments.chapter,!0,Translator.trans("Select a chapter"),JSON.stringify(et))),t.arguments.section?(f=Simulators.makeTargetSections(t.arguments.step,t.arguments.panel,t.arguments.blockinfo,t.arguments.chapter),r.append(Simulators.simpleAttributeForInput(i+"-argument-section","select","section",Translator.trans("Section"),t.arguments.section,!0,Translator.trans("Select a section"),JSON.stringify(f)))):t.arguments.content?(f=Simulators.makeTargetSections(t.arguments.step,t.arguments.panel,t.arguments.blockinfo,t.arguments.chapter),r.append(Simulators.simpleAttributeForInput(i+"-argument-section","select","section",Translator.trans("Section"),t.arguments.content,!0,Translator.trans("Select a section"),JSON.stringify(f)))):t.arguments.annotations&&(f=Simulators.makeTargetSections(t.arguments.step,t.arguments.panel,t.arguments.blockinfo,t.arguments.chapter),r.append(Simulators.simpleAttributeForInput(i+"-argument-section","select","section",Translator.trans("Section"),t.arguments.annotations,!0,Translator.trans("Select a section"),JSON.stringify(f)))))))))}return c.append(r),o=$('<div class="optional-attributes card bg-light"><\/div>'),o.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),v=$('<ul class="list-group"><\/ul>'),s=$('<li class="list-group-item" tabindex="0" data-element="'+i+'" data-type="text" data-name="uri" data-placeholder="'+Translator.trans("Button uri")+'">'+Translator.trans("URI / Step")+"<\/li>"),s=$('<li class="list-group-item" tabindex="0" data-element="'+i+'" data-type="select" data-name="class" data-placeholder="'+Translator.trans("Button class")+'" data-options="'+encodeURI(JSON.stringify({"btn-primary":Translator.trans("Primary"),"btn-secondary":Translator.trans("Secondary")}))+'">'+Translator.trans("Class")+"<\/li>"),v.append(s),n.class&&(ot=Simulators.simpleAttributeForInput(i+"-class","select","class",Translator.trans("Class"),n.class,!1,Translator.trans("Button class"),JSON.stringify({"btn-primary":Translator.trans("Primary"),"btn-secondary":Translator.trans("Secondary")})),r.append(ot),s.hide()),o.append(v),c.append(o),w.append(c),h.append(w),st.append(h),y=$('<div class="card bg-light buttons-panel" id="'+i+'-buttons-panel"><\/div>'),e=$('<div class="card-body action-buttons"><\/div>'),e.append('<button class="btn btn-success float-right validate-edit-action">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),e.append('<button class="btn btn-secondary float-right cancel-edit-action">'+Translator.trans("Cancel")+"<\/span><\/button>"),e.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),y.append(e),h.append(y),p};Simulators.bindActionButtonButtons=function(n){n||(n=$("#steps"));n.find("button.edit-action-button").on("click",function(n){n.preventDefault();Simulators.editActionButton($($(this).attr("data-parent")))});n.find("button.delete-action-button").on("click",function(n){n.preventDefault();Simulators.deleteActionButton($($(this).attr("data-parent")))})};Simulators.bindActionButtonWhat=function(n){var t=n.attr("id");n.find("select[data-attribute=what]").on("change",function(){Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what"])<0&&$(this).closest(".form-group").remove()});var i=$(this).closest(".form-group").parent();switch($(this).val()){case"submit":i.append(Simulators.simpleAttributeForInput(t+"-for","select","for",Translator.trans("For"),"",!0,Translator.trans("Select a step"),JSON.stringify({priorStep:Translator.trans("Prior step"),currentStep:Translator.trans("Current step"),nextStep:Translator.trans("Next step"),jumpToStep:Translator.trans("Jump to step"),newSimulation:Translator.trans("New simulation"),externalPage:Translator.trans("External page")})));Simulators.bindActionButtonFor(n);case"reset":n.find("select[data-attribute=shape]").val("button");break;case"execute":i.append(Simulators.simpleAttributeForInput(t+"-for","select","for",Translator.trans("What?"),"",!0,Translator.trans("Select a function"),JSON.stringify({"function":Translator.trans("Function")})));Simulators.bindActionButtonFor(n);n.find("select[data-attribute=for]").trigger("change")}})};Simulators.bindActionButtonFor=function(n){var t=n.attr("id");n.find("select[data-attribute=for]").on("change",function(){var i,r,u;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for"])<0&&$(this).closest(".form-group").remove()});i=$(this).closest(".form-group").parent();switch($(this).val()){case"jumpToStep":r=t.match(/^step\-(\d+)\-/)[1];u=Simulators.makeTargetSteps(r);i.append(Simulators.simpleAttributeForInput(t+"-uri","select","uri",Translator.trans("Target step"),"",!0,Translator.trans("Select a target step"),JSON.stringify(u)));break;case"externalPage":i.append(Simulators.simpleAttributeForInput(t+"-uri","text","uri",Translator.trans("External page URL"),"",!0,Translator.trans("External page URL")));break;case"function":i.append(Simulators.simpleAttributeForInput(t+"-function","select","function",Translator.trans("Function"),"",!0,Translator.trans("Select a function"),JSON.stringify(functions.labels)));Simulators.bindActionButtonFunction(n);n.find("select[data-attribute=function]").trigger("change")}})};Simulators.bindActionButtonFunction=function(n){var t=n.attr("id");n.find("select[data-attribute=function]").on("change",function(){Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function"])<0&&$(this).closest(".form-group").remove()});var r=$(this).val(),u=$(this).closest(".form-group").parent(),i={page:Translator.trans("Full page"),article:Translator.trans("Simulation block"),data:Translator.trans("Data"),datagroup:Translator.trans("Datagroup"),panel:Translator.trans("Panel"),blockgroup:Translator.trans("Grouping of information block/group of fields"),fieldset:Translator.trans("FieldSet"),fieldrow:Translator.trans("Fieldrow"),field:Translator.trans("Field"),prenote:Translator.trans("PreNote"),postnote:Translator.trans("PostNote"),blockinfo:Translator.trans("BlockInfo"),chapter:Translator.trans("Chapter"),section:Translator.trans("Section"),content:Translator.trans("Section content"),annotations:Translator.trans("Section annotations"),footnote:Translator.trans("FootNote")};$.each(i,function(n){$.inArray(n,functions.targets[r])<0&&delete i[n]});Object.keys(Simulators.dataset).length==0&&delete i.data;Object.keys(Simulators.datagroups).length==0&&delete i.datagroup;u.append(Simulators.simpleAttributeForInput(t+"-appliedto","select","appliedto",Translator.trans("Applied to"),"",!0,Translator.trans("Select a target"),JSON.stringify(i)));Simulators.bindActionButtonAppliedto(n);n.find("select[data-attribute=appliedto]").trigger("change")})};Simulators.bindActionButtonAppliedto=function(n){var t=n.attr("id");n.find("select[data-attribute=appliedto]").on("change",function(){var i,r,u,e,f,o;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function","appliedto"])<0&&$(this).closest(".form-group").remove()});i=$(this).closest(".form-group").parent();switch($(this).val()){case"page":case"article":break;case"data":r={};$.each(Simulators.dataset,function(n,t){r[t.id]=t.label});Object.keys(r).length==0?Simulators.showActionButtonAppliedToError(n):i.append(Simulators.simpleAttributeForInput(t+"-argument-data","select","data",Translator.trans("Data"),"",!0,Translator.trans("Select a data"),JSON.stringify(r)));break;case"datagroup":u={};$.each(Simulators.datagroups,function(n,t){u[t.id]=t.label});Object.keys(u).length==0?Simulators.showActionButtonAppliedToError(n):i.append(Simulators.simpleAttributeForInput(t+"-argument-datagroup","select","datagroup",Translator.trans("Datagroup"),"",!0,Translator.trans("Select a datagroup"),JSON.stringify(u)));break;case"footnote":f=t.match(/^step\-(\d+)\-/)[1];e=Simulators.makeTargetFootnotes(f);Object.keys(e).length==0?Simulators.showActionButtonAppliedToError(n):i.append(Simulators.simpleAttributeForInput(t+"-argument-footnote","select","footnote",Translator.trans("Footnote"),"",!0,Translator.trans("Select a footnote"),JSON.stringify(e)));break;default:f=t.match(/^step\-(\d+)\-/)[1];o=Simulators.makeTargetPanels(f);Object.keys(o).length==0?Simulators.showActionButtonAppliedToError(n):(i.append(Simulators.simpleAttributeForInput(t+"-argument-panel","select","panel",Translator.trans("Panel"),"",!0,Translator.trans("Select a panel"),JSON.stringify(o))),Simulators.bindActionButtonPanel(n),n.find("select[data-attribute=panel]").trigger("change"))}})};Simulators.bindActionButtonPanel=function(n){var t=n.attr("id");n.find("select[data-attribute=panel]").on("change",function(){var i,f;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function","appliedto","step","panel"])<0&&$(this).closest(".form-group").remove()});i=$(this).closest(".form-group").parent();f=n.find("select[data-attribute=appliedto]").val();switch(f){case"step":case"panel":break;case"blockinfo":case"chapter":case"section":case"content":case"annotations":var r=t.match(/^step\-(\d+)\-/)[1],u=n.find("select[data-attribute=panel]").val(),e=Simulators.makeTargetBlockinfos(r,u);Object.keys(e).length==0?Simulators.showActionButtonAppliedToError(n):(i.append(Simulators.simpleAttributeForInput(t+"-argument-blockinfo","select","blockinfo",Translator.trans("BlockInfo"),"",!0,Translator.trans("Select a blockinfo"),JSON.stringify(e))),Simulators.bindActionButtonBlockinfo(n),n.find("select[data-attribute=blockinfo]").trigger("change"));break;case"blockgroup":var r=t.match(/^step\-(\d+)\-/)[1],u=n.find("select[data-attribute=panel]").val(),o=Simulators.makeTargetBlockGroups(r,u);Object.keys(o).length==0?Simulators.showActionButtonAppliedToError(n):i.append(Simulators.simpleAttributeForInput(t+"-argument-blockgroup","select","blockgroup",Translator.trans("Block belonging to the grouping"),"",!0,Translator.trans("Select a block belonging to the group"),JSON.stringify(o)));break;default:var r=t.match(/^step\-(\d+)\-/)[1],u=n.find("select[data-attribute=panel]").val(),s=Simulators.makeTargetFieldsets(r,u);Object.keys(s).length==0?Simulators.showActionButtonAppliedToError(n):(i.append(Simulators.simpleAttributeForInput(t+"-argument-fieldset","select","fieldset",Translator.trans("FieldSet"),"",!0,Translator.trans("Select a fieldset"),JSON.stringify(s))),Simulators.bindActionButtonFieldset(n),n.find("select[data-attribute=fieldset]").trigger("change"))}})};Simulators.bindActionButtonBlockinfo=function(n){var t=n.attr("id");n.find("select[data-attribute=blockinfo]").on("change",function(){var i,r;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function","appliedto","step","panel","blockinfo"])<0&&$(this).closest(".form-group").remove()});i=$(this).closest(".form-group").parent();r=n.find("select[data-attribute=appliedto]").val();switch(r){case"step":case"panel":case"blockinfo":break;default:var f=t.match(/^step\-(\d+)\-/)[1],e=n.find("select[data-attribute=panel]").val(),o=n.find("select[data-attribute=blockinfo]").val(),u=Simulators.makeTargetChapters(f,e,o);Object.keys(u).length==0?Simulators.showActionButtonAppliedToError(n):(i.append(Simulators.simpleAttributeForInput(t+"-argument-chapter","select","chapter",Translator.trans("Chapter"),"",!0,Translator.trans("Select a chapter"),JSON.stringify(u))),Simulators.bindActionButtonChapter(n),n.find("select[data-attribute=chapter]").trigger("change"))}})};Simulators.bindActionButtonChapter=function(n){var t=n.attr("id");n.find("select[data-attribute=chapter]").on("change",function(){var s,i;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function","appliedto","step","panel","blockinfo","chapter"])<0&&$(this).closest(".form-group").remove()});s=$(this).closest(".form-group").parent();i=n.find("select[data-attribute=appliedto]").val();switch(i){case"step":case"panel":case"blockinfo":case"chapter":break;default:var r=t.match(/^step\-(\d+)\-/)[1],u=n.find("select[data-attribute=panel]").val(),f=n.find("select[data-attribute=blockinfo]").val(),e=n.find("select[data-attribute=chapter]").val(),o;o=i=="content"?Simulators.makeTargetContents(r,u,f,e):i=="annotations"?Simulators.makeTargetAnnotations(r,u,f,e):Simulators.makeTargetSections(r,u,f,e);Object.keys(o).length==0?Simulators.showActionButtonAppliedToError(n):s.append(Simulators.simpleAttributeForInput(t+"-argument-section","select","section",Translator.trans("Section"),"",!0,Translator.trans("Select a section"),JSON.stringify(o)))}})};Simulators.bindActionButtonFieldset=function(n){var t=n.attr("id");n.find("select[data-attribute=fieldset]").on("change",function(){var e,i,o;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function","appliedto","step","panel","fieldset"])<0&&$(this).closest(".form-group").remove()});e=$(this).closest(".form-group").parent();i=n.find("select[data-attribute=appliedto]").val();switch(i){case"step":case"panel":case"fieldset":break;default:var r=t.match(/^step\-(\d+)\-/)[1],u=n.find("select[data-attribute=panel]").val(),f=n.find("select[data-attribute=fieldset]").val(),s=Simulators.makeTargetFieldrows(r,u,f);Object.keys(s).length>0?(e.append(Simulators.simpleAttributeForInput(t+"-argument-fieldrow","select","fieldrow",Translator.trans("Fieldrow"),"",!0,Translator.trans("Select a fieldrow"),JSON.stringify(s))),Simulators.bindActionButtonFieldrow(n),n.find("select[data-attribute=fieldrow]").trigger("change")):i=="fieldrow"?Simulators.showActionButtonAppliedToError(n):(o=i=="prenote"?Simulators.makeTargetPrenotes(r,u,f):i=="postnote"?Simulators.makeTargetPostnotes(r,u,f):Simulators.makeTargetFields(r,u,f),Object.keys(o).length==0?Simulators.showActionButtonAppliedToError(n):e.append(Simulators.simpleAttributeForInput(t+"-argument-field","select","field",Translator.trans("Field"),"",!0,Translator.trans("Select a field"),JSON.stringify(o))))}})};Simulators.bindActionButtonFieldrow=function(n){var t=n.attr("id");n.find("select[data-attribute=fieldrow]").on("change",function(){var s,i;Simulators.hideActionButtonError(n);n.find(":input[data-attribute]").each(function(){var n=$(this).attr("data-attribute");$.inArray(n,["name","label","shape","location","class","what","for","function","appliedto","step","panel","fieldset","fieldrow"])<0&&$(this).closest(".form-group").remove()});s=$(this).closest(".form-group").parent();i=n.find("select[data-attribute=appliedto]").val();switch(i){case"step":case"panel":case"fieldset":case"fieldrow":break;default:var r=t.match(/^step\-(\d+)\-/)[1],u=n.find("select[data-attribute=panel]").val(),f=n.find("select[data-attribute=fieldset]").val(),e=n.find("select[data-attribute=fieldrow]").val(),o;o=i=="prenote"?Simulators.makeTargetPrenotes(r,u,f,e):i=="postnote"?Simulators.makeTargetPostnotes(r,u,f,e):Simulators.makeTargetFields(r,u,f,e);Object.keys(o).length==0?Simulators.showActionButtonAppliedToError(n):s.append(Simulators.simpleAttributeForInput(t+"-argument-field","select","field",Translator.trans("Field"),"",!0,Translator.trans("Select a field"),JSON.stringify(o)))}})};Simulators.bindActionButton=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});Simulators.bindActionButtonWhat(n);Simulators.bindActionButtonFor(n);Simulators.bindActionButtonFunction(n);Simulators.bindActionButtonAppliedto(n);Simulators.bindActionButtonPanel(n);Simulators.bindActionButtonBlockinfo(n);Simulators.bindActionButtonChapter(n);Simulators.bindActionButtonFieldset(n);Simulators.bindActionButtonFieldrow(n);n.find(".cancel-edit-action").on("click",function(){n.find(".action-button-container").replaceWith(Simulators.actionButtonBackup);Simulators.actionButtonBackup.find("button.edit-action-button").on("click",function(n){n.preventDefault();Simulators.editActionButton($($(this).attr("data-parent")))});Simulators.actionButtonBackup.find("button.delete-action-button").on("click",function(n){n.preventDefault();Simulators.deleteActionButton($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-action").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-action, .validate-add-action").on("click",function(){var f=n.find(".action-button-container"),i,r,o,s;if(!Simulators.checkActionButton(n))return!1;var u=f.attr("data-step"),e=f.attr("data-id"),h=f.find(".attributes-container"),t={stepId:u,uri:"","class":""};h.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.name&&(t.name=$.trim(t.name));switch(t.what){case"reset":t.for="currentStep";break;case"execute":i={"function":t.function,appliedto:t.appliedto,arguments:{}};delete t["function"];switch(t.appliedto){case"data":i.arguments.data=t.data;delete t.data;break;case"datagroup":i.arguments.datagroup=t.datagroup;delete t.datagroup;break;case"field":case"prenote":case"postnote":t.field&&(i.arguments[t.appliedto]=t.field,delete t.field);case"fieldrow":t.fieldrow&&(i.arguments.fieldrow=t.fieldrow,delete t.fieldrow);case"fieldset":t.fieldset&&(i.arguments.fieldset=t.fieldset,delete t.fieldset);case"section":case"content":case"annotations":t.section&&(i.arguments[t.appliedto]=t.section,delete t.section);case"chapter":t.chapter&&(i.arguments.chapter=t.chapter,delete t.chapter);case"blockinfo":t.blockinfo&&(i.arguments.blockinfo=t.blockinfo,delete t.blockinfo);case"blockgroup":t.blockgroup&&(i.arguments.blockgroup=t.blockgroup,delete t.blockgroup);case"panel":t.panel&&(i.arguments.panel=t.panel,delete t.panel);case"footnote":t.footnote&&(i.arguments.footnote=t.footnote,delete t.footnote);default:i.arguments.step=u}delete t.appliedto;t.uri=JSON.stringify(i).replace(/"/g,"'")}r=Simulators.drawActionButtonForDisplay(t);$(this).hasClass("validate-edit-action")?(delete t.stepId,Simulators.updateInArray(steps,[{key:"id",val:u,list:"actions"},{key:"name",val:e}],t),o=Simulators.actionButtonBackup.find("p[data-attribute='label']").attr("data-value"),e!=t.name?(Simulators.changeActionButtonNameInRules(u,e,t.name),t.label!=o&&Simulators.changeActionButtonLabelInRules(u,t.name,t.label),n.replaceWith(r),Simulators.bindActionButtonButtons(r)):(f.replaceWith(r.find(".action-button-container")),t.label!=o&&(s=n.find("> .card > .card-header").find("> h4 > a"),s.text(""+Translator.trans("Action Button")+" : "+t.label),Simulators.changeActionButtonLabelInRules(u,t.name,t.label)),r=n)):(n.replaceWith(r),Simulators.bindActionButtonButtons(r),Simulators.addActionButtonInActions(t),delete t.stepId,Simulators.addInArray(steps,[{key:"id",val:u,list:"actions"}],t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;r.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:r.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkActionButton=function(n){var i=n.attr("id"),r=$.trim($("#"+i+"-name").val()),e,o,u,s,h,c,t,l;if(r==="")return n.find(".error-message").text(Translator.trans("The action button name is required")),n.find(".alert").show(),!1;if(!/^[\w\-]+$/.test(r))return n.find(".error-message").text(Translator.trans("Incorrect action button name")),n.find(".alert").show(),!1;var a=n.find(".action-button-container").attr("data-step"),v=n.find(".action-button-container").attr("id"),f=!1;if($("#collapsestep-"+a+"-action-buttons").find(".action-button-container").each(function(){if($(this).attr("id")!=v&&$(this).attr("data-id")==r)return f=!0,!1}),f)return n.find(".error-message").text(Translator.trans("The action button name already exists")),n.find(".alert").show(),!1;if(e=$.trim($("#"+i+"-label").val()),e==="")return n.find(".error-message").text(Translator.trans("The action button label is required")),n.find(".alert").show(),!1;o=$("#"+i+"-what").val();switch(o){case"submit":if(u=$("#"+i+"-for").val(),(u==="jumpToStep"||u==="externalPage")&&(s=$.trim($("#"+i+"-uri").val()),s===""))return n.find(".error-message").text(Translator.trans("The action button uri is required in this context")),n.find(".alert").show(),!1;case"reset":if(h=$("#"+i+"-shape").val(),h=="link")return n.find(".error-message").text(Translator.trans("The action shape 'link' is not allowed in this context")),n.find(".alert").show(),!1;break;case"execute":if(c=$("#"+i+"-appliedto"),t=c.val(),t!="page"&&t!="article"&&(t=="prenote"||t=="postnote"?t="field":(t=="content"||t=="annotations")&&(t="section"),t=$("#"+i+"-argument-"+t),l=t.val(),!l))return Simulators.showActionButtonAppliedToError(n),!1}return!0};Simulators.showActionButtonAppliedToError=function(n){var i=n.attr("id"),t=$("#"+i+"-appliedto");Simulators.showActionButtonError(n,Translator.trans("The searched element « %element% » that applies to this function does not exist.",{element:t.find("option:selected").text()}),t)};Simulators.showActionButtonError=function(n,t,i){i.addClass("is-invalid").addClass("form-control-danger");n.find(".error-message").text(t);n.find(".alert").show()};Simulators.hideActionButtonError=function(n){n.find(".is-invalid").removeClass("is-invalid");n.find(".error-message").text();n.find(".alert").hide()};Simulators.addActionButton=function(n){var t,r;try{var u=n.parent().parent().find(".step-container"),i=u.attr("data-id"),f=Simulators.findInArray(steps,[{key:"id",val:i}]),e={stepId:i,name:"",label:"",shape:"button",location:"bottom",what:"submit","for":"nextStep",uri:"","class":""};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawActionButtonForInput(e);t.find("button.cancel-edit-action").addClass("cancel-add-action").removeClass("cancel-edit-action");t.find("button.validate-edit-action").addClass("validate-add-action").removeClass("validate-edit-action");r=$("#collapsestep-"+f.id+"-action-buttons").find("> div.sortable");r.append(t);Simulators.bindActionButton(t);$("#collapse"+n.attr("id")).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(o){console&&console.log(o.message)}};Simulators.editActionButton=function(n){var u;try{var t=n.find(".action-button-container"),i=t.attr("data-step"),f=t.attr("data-id"),r=Simulators.findInArray(steps,[{key:"id",val:i,list:"actions"},{key:"name",val:f}]);r.stepId=i;$(".update-button").hide();$(".toggle-collapse-all").hide();u=Simulators.drawActionButtonForInput(r);Simulators.actionButtonBackup=t.replaceWith(u.find(".action-button-container"));Simulators.bindActionButton(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(e){console&&console.log(e.message)}};Simulators.deleteActionButton=function(n){try{var r=n.find(".action-button-container"),t=r.attr("data-step"),i=r.attr("data-id"),f=Simulators.findInArray(steps,[{key:"id",val:t,list:"actions"},{key:"name",val:i}]),u;if((u=Simulators.isActionButtonInRules(t,i))!==!1){bootbox.alert({title:Translator.trans("Deleting action button"),message:Translator.trans("This action button is used in rule #%id%. You must modify this rule before you can delete this action button",{id:u})});return}bootbox.confirm({title:Translator.trans("Deleting action button"),message:Translator.trans("Are you sure you want to delete the action button : %label%",{label:f.label}),callback:function(r){r&&(Simulators.deleteInArray(steps,[{key:"id",val:t,list:"actions"},{key:"name",val:i}]),n.remove(),$(".save-simulator").show(),Admin.updated=!0)}})}catch(e){console&&console.log(e.message)}}}(this),function(){"use strict";Simulators.drawBlockInfoForDisplay=function(n,t){var i="step-"+n.stepId+"-panel-"+n.panelId+"-blockinfo-"+n.id,u=Simulators.openCollapsiblePanel(i,Translator.trans("Blockinfo #%id% : %label%",{id:n.id,label:n.label}),"info",t,"",[{"class":"delete-blockinfo",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"add-chapter",label:Translator.trans("Add chapter"),icon:"fa-plus-circle"},{"class":"edit-blockinfo",label:Translator.trans("Edit"),icon:"fa-pencil"}]),f=u.find(".card-body"),e=$('<div class="card bg-light block-container blockinfo" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-id="'+n.id+'"><\/div>'),o=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Blockinfo name"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Blockinfo label"))),r.append(Simulators.simpleAttributeForDisplay(i,"select","display",Translator.trans("Display"),n.display,n.display,!1,Translator.trans("Select a Display"),JSON.stringify({inline:Translator.trans("Inline"),grouped:Translator.trans("Grouped"),accordion:Translator.trans("Accordion"),"pop-in":Translator.trans("Pop-in")}))),r.append(Simulators.simpleAttributeForDisplay(i,"text","popinLink",Translator.trans("Pop-in Link"),n.popinLink,n.popinLink,!1,Translator.trans("Pop-in Link"))),s.append(r),o.append(s),e.append(o),f.append(e),f.append('<div class="card bg-light chapters-panel" id="'+i+'-chapters-panel"><div class="card-body sortable"><\/div><\/div>'),u};Simulators.drawBlockInfoForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.panelId+"-blockinfo-"+n.id,l=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),o=$("<div>",{"class":"card bg-info"}),e,u,i,c,f;o.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" : "+n.label+"<\/a><\/h4><\/div>");var a=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),v=$('<div class="card-body"><\/div>'),y=$('<div class="card bg-light block-container blockinfo" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),s=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForInput(t+"-name","text","name",Translator.trans("Name"),n.name,!1,Translator.trans("BlockInfo name"))),h.append(r),e=$('<div class="optional-attributes card bg-light"><\/div>'),e.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),u=$('<ul class="list-group"><\/ul>'),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="label" data-placeholder="'+Translator.trans("BlockInfo label")+'">'+Translator.trans("Label")+"<\/li>"),u.append(i),n.label&&(r.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!1,Translator.trans("BlockInfo label"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="select" data-name="display" data-placeholder="'+Translator.trans("Blockinfo display")+'" data-options="'+encodeURI(JSON.stringify({inline:Translator.trans("Inline"),grouped:Translator.trans("Grouped"),accordion:Translator.trans("Accordion"),"pop-in":Translator.trans("Pop-in")}))+'">'+Translator.trans("Display")+"<\/li>"),u.append(i),n.display&&(r.append(Simulators.simpleAttributeForInput(t+"-display","select","display",Translator.trans("Display"),n.display,!1,Translator.trans("Blockinfo display"),JSON.stringify({inline:Translator.trans("Inline"),grouped:Translator.trans("Grouped"),accordion:Translator.trans("Accordion"),"pop-in":Translator.trans("Pop-in")}))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="popinLink" data-placeholder="'+Translator.trans("Pop-in Link")+'">'+Translator.trans("Pop-in Link")+"<\/li>"),u.append(i),n.popinLink&&(r.append(Simulators.simpleAttributeForInput(t+"-popinLink","text","popinLink",Translator.trans("Pop-in Link"),n.popinLink,!1,Translator.trans("Pop-in Link"))),i.hide()),e.append(u),h.append(e),s.append(h),y.append(s),v.append(y),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),f=$('<div class="card-body blockinfo-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-blockinfo">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-blockinfo">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(f),s.append(c),a.append(v),o.append(a),l.append(o),l};Simulators.bindBlockInfoButtons=function(n){n||(n=$("#steps .blocks-panel"));n.find("button.edit-blockinfo").on("click",function(n){n.preventDefault();Simulators.editBlockInfo($($(this).attr("data-parent")))});n.find("button.delete-blockinfo").on("click",function(n){n.preventDefault();Simulators.deleteBlockInfo($($(this).attr("data-parent")))});n.find("button.add-chapter").on("click",function(n){n.preventDefault();Simulators.addChapter($($(this).attr("data-parent")))})};Simulators.bindBlockInfo=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-blockinfo").on("click",function(){n.find(".block-container.blockinfo").replaceWith(Simulators.blockinfoBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-blockinfo").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-blockinfo, .validate-add-blockinfo").on("click",function(){var c=n.parent(),f=n.find(".block-container.blockinfo"),o,s,i;if(!Simulators.checkBlockInfo(n))return!1;var r=f.attr("data-step"),u=f.attr("data-panel"),e=f.attr("data-id"),t={type:"blockinfo",id:e,stepId:r,panelId:u,label:""},h=f.find(".attributes-container");h.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.name&&(t.name=$.trim(t.name));t.popinLink||(t.popinLink="");o="";$(this).hasClass("validate-edit-blockinfo")?(s=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:e}]),o=s.label,t.chapters=s.chapters):t.chapters=[];i=Simulators.drawBlockInfoForDisplay(t,"in");$(this).hasClass("validate-edit-blockinfo")?(f.replaceWith(i.find(".block-container.blockinfo")),t.label!=o&&(Simulators.changeBlockinfoLabelInActionButtons(r,u,t.id,t.label),Simulators.changeBlockInfoLabelInRules(r,u,t.id,t.label)),delete t.stepId,delete t.panelId,Simulators.updateInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:e}],t),i=n):(n.replaceWith(i),Simulators.bindBlockInfoButtons(i),Simulators.bindSortableChapters(i.find(".chapters-panel")),Simulators.addBlockInfoInActions(t),delete t.stepId,delete t.panelId,Simulators.addInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"}],t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkBlockInfo=function(n){var t=n.attr("id"),i=$.trim($("#"+t+"-name").val()),r,f,e;if(i==="")return n.find(".error-message").text(Translator.trans("The blockinfo name is required")),n.find(".alert").show(),!1;if(!/^\w+$/.test(i))return n.find(".error-message").text(Translator.trans("Incorrect blockinfo name")),n.find(".alert").show(),!1;var o=n.find(".block-container.blockinfo").attr("data-step"),s=n.find(".block-container.blockinfo").attr("data-panel"),h=n.find(".block-container.blockinfo").attr("data-id"),c=Simulators.findInArray(steps,[{key:"id",val:o,list:"panels"},{key:"id",val:s}]),u=!1;if($.each(c.blocks,function(n,t){if(t.type=="blockinfo"&&t.id!=h&&t.name==i)return u=!0,!1}),u)return n.find(".error-message").text(Translator.trans("This blockinfo name already exists")),n.find(".alert").show(),!1;if(r=$.trim($("#"+t+"-display").val()),r=="pop-in"){if(f=$.trim($("#"+t+"-popinLink").val()),f=="")return n.find(".error-message").text(Translator.trans("The pop-in link text is required when display is pop-in")),n.find(".alert").show(),!1}else if(r=="accordion"&&(e=$.trim($("#"+t+"-label").val()),e==""))return n.find(".error-message").text(Translator.trans("The label is required when display is accordion")),n.find(".alert").show(),!1;return!0};Simulators.addBlockInfo=function(n){var s,t,h,r;try{var u=n.find(".panel-container"),f=u.attr("data-step"),e=u.attr("data-id"),o=Simulators.findInArray(steps,[{key:"id",val:f,list:"panels"},{key:"id",val:e}]),i=0;o.blocks&&$.each(o.blocks,function(n,t){t.id>i&&(i=t.id)});s={type:"blockinfo",stepId:f,panelId:e,id:parseInt(i)+1,name:"",label:"",display:"inline",popinLink:"",chapters:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawBlockInfoForInput(s,"in");t.find("button.cancel-edit-blockinfo").addClass("cancel-add-blockinfo").removeClass("cancel-edit-blockinfo");t.find("button.validate-edit-blockinfo").addClass("validate-add-blockinfo").removeClass("validate-edit-blockinfo");r=n.attr("id");h=r==="blocks"?$("#collapseblocks").find("> div.sortable"):n.find(".blocks-panel > div.sortable");h.append(t);Simulators.bindBlockInfo(t);$("#collapse"+r).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(c){console&&console.log(c.message)}};Simulators.editBlockInfo=function(n){var f;try{var t=n.find(".block-container.blockinfo"),r=t.attr("data-step"),u=t.attr("data-panel"),e=t.attr("data-id"),i=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:e}]);i.stepId=r;i.panelId=u;$(".update-button").hide();$(".toggle-collapse-all").hide();f=Simulators.drawBlockInfoForInput(i);Simulators.blockinfoBackup=t.replaceWith(f.find(".block-container.blockinfo"));Simulators.bindBlockInfo(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(o){console&&console.log(o.message)}};Simulators.deleteBlockInfo=function(n){var o;try{var u=n.find(".block-container.blockinfo"),t=u.attr("data-step"),i=u.attr("data-panel"),r=u.attr("data-id"),s=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i}]),f=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]),h=f.label?f.label:f.name,e;if((e=Simulators.isBlockInfoInRules(t,i,r))!==!1){bootbox.alert({title:Translator.trans("Deleting blockinfo"),message:Translator.trans("This blockinfo is used in rule #%id%. You must modify this rule before you can delete this blockinfo",{id:e})});return}if((o=Simulators.isBlockinfoIdInActionButtons(t,i,r))!==!1){bootbox.alert({title:Translator.trans("Deleting blockinfo"),message:Translator.trans("This blockinfo is used in action button « %label% ». You must modify this action button before you can delete this blockinfo",{label:o})});return}bootbox.confirm({title:Translator.trans("Deleting blockinfo"),message:Translator.trans("Are you sure you want to delete the blockinfo : %label%",{label:h}),callback:function(u){if(u){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]);var f=n.parent();n.remove();Simulators.deleteBlockInfoInActions(t,i,r);Simulators.renumberBlocks(s.blocks,t,i,f.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(c){console&&console.log(c.message)}}}(this),function(){"use strict";Simulators.renumberChapters=function(n,t,i,r,u){$.each(n,function(n,f){var s=f.id,e=n+1,l,a,v;if(s!=0&&e!=s){f.id=e;var h=u.eq(n),o=new RegExp("-chapter-"+s,"g"),c=h.attr("id");c=c.replace(o,"-chapter-"+e);h.attr("id",c);l=h.find("> .card > .card-header").find("> h4 > a");l.text(" "+Translator.trans("Chapter")+" #"+e+" : "+f.label+" ");a=h.find(".chapter-container");a.attr("data-id",e);v=h.find("*");v.each(function(){var n;this.hasAttribute("data-chapter")&&$(this).attr("data-chapter",e);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(o,"-chapter-"+e),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(o,"-chapter-"+e),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(o,"-chapter-"+e),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(o,"-chapter-"+e),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(o,"-chapter-"+e),$(this).attr("aria-labelledby",n))});Simulators.changeChapterIdInActionButtons(t,i,r,s,"X"+e);Simulators.changeChapterIdInRules(t,i,r,s,"X"+e)}});$.each(n,function(n,u){Simulators.changeChapterIdInActionButtons(t,i,r,"X"+u.id,u.id);Simulators.changeChapterIdInRules(t,i,r,"X"+u.id,u.id)})};Simulators.bindSortableChapters=function(n){n||(n=$("#steps .chapters-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".chapter-container"),r=i.attr("data-step"),u=i.attr("data-panel"),f=i.attr("data-blockinfo"),e=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f}]),o=i.attr("data-id");Simulators.moveInArray(e.chapters,[{key:"id",val:o}],t.item.index())&&(Simulators.renumberChapters(e.chapters,r,u,f,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawChapterForDisplay=function(n,t){var i="step-"+n.stepId+"-panel-"+n.panelId+"-blockinfo-"+n.blockinfoId+"-chapter-"+n.id,u=Simulators.openCollapsiblePanel(i,Translator.trans("Chapter #%id% : %label%",{id:n.id,label:n.label}),"warning",t,"",[{"class":"delete-chapter",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"add-section",label:Translator.trans("Add section"),icon:"fa-plus-circle"},{"class":"edit-chapter",label:Translator.trans("Edit"),icon:"fa-pencil"}]),f=u.find(".card-body"),e=$('<div class="card bg-light chapter-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-blockinfo="'+n.blockinfoId+'" data-id="'+n.id+'"><\/div>'),o=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Chapter name"),n.name,n.name,!0,Translator.trans("Chapter name"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Chapter label"),n.label,n.label,!0,Translator.trans("Chapter label"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","icon",Translator.trans("Icon"),n.icon,n.icon,!1,Translator.trans("Chapter icon"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","collapsible",Translator.trans("Allow collapse/expand ?"),n.collapsible,n.collapsible,!1,Translator.trans("Allow collapse/expand ?"))),s.append(r),o.append(s),e.append(o),f.append(e),f.append('<div class="card bg-light sections-panel" id="'+i+'-sections-panel"><div class="card-body sortable"><\/div><\/div>'),u};Simulators.drawChapterForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.panelId+"-blockinfo-"+n.blockinfoId+"-chapter-"+n.id,l=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),o=$("<div>",{"class":"card bg-warning"}),e,u,i,c,f;o.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" : "+n.label+"<\/a><\/h4><\/div>");var a=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),v=$('<div class="card-body"><\/div>'),y=$('<div class="card bg-light chapter-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-blockinfo="'+n.blockinfoId+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),s=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForInput(t+"-name","text","name",Translator.trans("Name"),n.name,!1,Translator.trans("Chapter name"))),h.append(r),e=$('<div class="optional-attributes card bg-light"><\/div>'),e.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),u=$('<ul class="list-group"><\/ul>'),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="label" data-placeholder="'+Translator.trans("Chapter label")+'">'+Translator.trans("Label")+"<\/li>"),u.append(i),n.label&&(r.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!1,Translator.trans("Chapter label"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="icon" data-placeholder="'+Translator.trans("Chapter icon")+'">'+Translator.trans("Icon")+"<\/li>"),u.append(i),n.icon&&(r.append(Simulators.simpleAttributeForInput(t+"-icon","text","icon",Translator.trans("Icon"),n.icon,!1,Translator.trans("Chapter icon"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="collapsible" data-placeholder="">'+Translator.trans("Allow collapse/expand ?")+"<\/li>"),u.append(i),n.collapsible=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-collapsible","checkbox","collapsible",Translator.trans("Allow collapse/expand ?"),n.collapsible,!1,"")),i.hide()),e.append(u),h.append(e),s.append(h),y.append(s),v.append(y),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),f=$('<div class="card-body chapter-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-chapter">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-chapter">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(f),s.append(c),a.append(v),o.append(a),l.append(o),l};Simulators.bindChapterButtons=function(n){n||(n=$("#steps .chapters-panel"));n.find("button.edit-chapter").on("click",function(n){n.preventDefault();Simulators.editChapter($($(this).attr("data-parent")))});n.find("button.delete-chapter").on("click",function(n){n.preventDefault();Simulators.deleteChapter($($(this).attr("data-parent")))});n.find("button.add-section").on("click",function(n){n.preventDefault();Simulators.addSection($($(this).attr("data-parent")))})};Simulators.bindChapter=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-chapter").on("click",function(){n.find(".chapter-container").replaceWith(Simulators.chapterBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-chapter").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-chapter, .validate-add-chapter").on("click",function(){var l=n.parent(),r=n.find(".chapter-container"),s,h,i;if(!Simulators.checkChapter(n))return!1;var u=r.attr("data-step"),f=r.attr("data-panel"),e=r.attr("data-blockinfo"),o=r.attr("data-id"),t={id:o,stepId:u,panelId:f,blockinfoId:e,label:"",icon:"",collapsible:"0"},c=r.find(".attributes-container");c.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.name&&(t.name=$.trim(t.name));s="";$(this).hasClass("validate-edit-chapter")?(h=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"chapters"},{key:"id",val:o}]),s=h.label,t.sections=h.sections):t.sections=[];i=Simulators.drawChapterForDisplay(t,"in");$(this).hasClass("validate-edit-chapter")?(r.replaceWith(i.find(".chapter-container")),t.label!=s&&(Simulators.changeChapterLabelInActionButtons(u,f,e,t.id,t.label),Simulators.changeChapterLabelInRules(u,f,e,t.id,t.label)),delete t.stepId,delete t.panelId,delete t.blockinfoId,Simulators.updateInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"chapters"},{key:"id",val:o}],t),i=n):(n.replaceWith(i),Simulators.bindChapterButtons(i),Simulators.bindSortableSections(i.find(".sections-panel")),Simulators.addChapterInActions(t),delete t.stepId,delete t.panelId,delete t.blockinfoId,Simulators.addInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"chapters"}],t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkChapter=function(n){var r=n.attr("id"),t=$.trim($("#"+r+"-name").val());if(t==="")return n.find(".error-message").text(Translator.trans("The chapter name is required")),n.find(".alert").show(),!1;if(!/^\w+$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect chapter name")),n.find(".alert").show(),!1;var u=n.find(".chapter-container").attr("data-step"),f=n.find(".chapter-container").attr("data-panel"),e=n.find(".chapter-container").attr("data-blockinfo"),o=n.find(".chapter-container").attr("data-id"),s=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]),i=!1;return($.each(s.chapters,function(n,r){if(r.id!=o&&r.name==t)return i=!0,!1}),i)?(n.find(".error-message").text(Translator.trans("This chapter name already exists")),n.find(".alert").show(),!1):!0};Simulators.addChapter=function(n){var h,t,c,u;try{var i=n.find(".block-container.blockinfo"),f=i.attr("data-step"),e=i.attr("data-panel"),o=i.attr("data-id"),s=Simulators.findInArray(steps,[{key:"id",val:f,list:"panels"},{key:"id",val:e,list:"blocks"},{key:"id",val:o}]),r=0;s.chapters&&$.each(s.chapters,function(n,t){t.id>r&&(r=t.id)});h={stepId:f,panelId:e,blockinfoId:o,id:parseInt(r)+1,name:"",label:"",sections:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawChapterForInput(h);t.find("button.cancel-edit-chapter").addClass("cancel-add-chapter").removeClass("cancel-edit-chapter");t.find("button.validate-edit-chapter").addClass("validate-add-chapter").removeClass("validate-edit-chapter");u=n.attr("id");c=u==="chapters"?$("#collapsechapters").find("> div.sortable"):n.find(".chapters-panel > div.sortable");c.append(t);Simulators.bindChapter(t);$("#collapse"+u).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(l){console&&console.log(l.message)}};Simulators.editChapter=function(n){var e;try{var t=n.find(".chapter-container"),r=t.attr("data-step"),u=t.attr("data-panel"),f=t.attr("data-blockinfo"),o=t.attr("data-id"),i=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"chapters"},{key:"id",val:o}]);i.stepId=r;i.panelId=u;i.blockinfoId=f;$(".update-button").hide();$(".toggle-collapse-all").hide();e=Simulators.drawChapterForInput(i);Simulators.chapterBackup=t.replaceWith(e.find(".chapter-container"));Simulators.bindChapter(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(s){console&&console.log(s.message)}};Simulators.deleteChapter=function(n){var s;try{var f=n.find(".chapter-container"),t=f.attr("data-step"),i=f.attr("data-panel"),r=f.attr("data-blockinfo"),u=f.attr("data-id"),h=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]),e=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"chapters"},{key:"id",val:u}]),c=e.label?e.label:e.name,o;if((o=Simulators.isChapterInRules(t,i,r,u))!==!1){bootbox.alert({title:Translator.trans("Deleting chapter"),message:Translator.trans("This chapter is used in rule #%id%. You must modify this rule before you can delete this chapter",{id:o})});return}if((s=Simulators.isChapterIdInActionButtons(t,i,r,u))!==!1){bootbox.alert({title:Translator.trans("Deleting chapter"),message:Translator.trans("This chapter is used in action button « %label% ». You must modify this action button before you can delete this chapter",{label:s})});return}bootbox.confirm({title:Translator.trans("Deleting chapter"),message:Translator.trans("Are you sure you want to delete the chapter : %label%",{label:c}),callback:function(f){if(f){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"chapters"},{key:"id",val:u}]);var e=n.parent();n.remove();Simulators.deleteChapterInActions(t,i,r,u);Simulators.renumberChapters(h.chapters,t,i,r,e.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(l){console&&console.log(l.message)}}}(this),function(){"use strict";Simulators.deleteFieldRowsColumn=function(n,t,i,r){var f=$("#step-"+n+"-panel-"+t+"-fieldset-"+i+"-fieldrows-panel").find("> .sortable").find("> div"),u=[];f.each(function(){var n=$(this).find(".panel-group");n.each(function(){var n=$(this),i=n.find(".field-container"),t;i.attr("data-id")==r&&(t=n.attr("id"),$.inArray(t,u)<0&&(Simulators.deleteField(n,!1),u.push(t)))})})};Simulators.renumberFieldRows=function(n,t,i,r,u){$.each(n,function(n,f){var s=f.id,e=n+1,l,a,v;if(s!=0&&e!=s){f.id=e;var h=u.eq(n),o=new RegExp("-fieldrow-"+s,"g"),c=h.attr("id");c=c.replace(o,"-fieldrow-"+e);h.attr("id",c);l=h.find("> .card > .card-header").find("> h4 > a");l.text(" "+Translator.trans("Fieldrow #%id% : %label%",{id:e,label:f.label})+" ");a=h.find(".fieldrow-container");a.attr("data-id",e);v=h.find("*");v.each(function(){var n;this.hasAttribute("data-fieldrow")&&$(this).attr("data-fieldrow",e);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(o,"-fieldrow-"+e),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(o,"-fieldrow-"+e),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(o,"-fieldrow-"+e),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(o,"-fieldrow-"+e),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(o,"-fieldrow-"+e),$(this).attr("aria-labelledby",n))});Simulators.changeFieldrowIdInActionButtons(t,i,r,s,"X"+e);Simulators.changeFieldRowIdInRules(t,i,r,s,"X"+e)}});$.each(n,function(n,u){Simulators.changeFieldrowIdInActionButtons(t,i,r,"X"+u.id,u.id);Simulators.changeFieldRowIdInRules(t,i,r,"X"+u.id,u.id)})};Simulators.bindSortableFieldRows=function(n){n||(n=$("#steps .fieldrows-panel"));n.find("> div.sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".fieldrow-container"),r=i.attr("data-step"),u=i.attr("data-panel"),f=i.attr("data-fieldset"),e=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f}]),o=i.attr("data-id");Simulators.moveInArray(e.fieldrows,[{key:"id",val:o}],t.item.index())&&(Simulators.renumberFieldRows(e.fieldrows,r,u,f,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawFieldRowForDisplay=function(n,t){var h=Simulators.findInArray(steps,[{key:"id",val:n.stepId,list:"panels"},{key:"id",val:n.panelId,list:"blocks"},{key:"id",val:n.fieldsetId}]),i="step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-fieldrow-"+n.id,u=n.fields.length<h.columns.length?Simulators.openCollapsiblePanel(i,Translator.trans("Fieldrow #%id% : %label%",{id:n.id,label:n.label}),"success",t,"",[{"class":"delete-fieldrow",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"add-field",label:Translator.trans("Add field"),icon:"fa-plus-circle"},{"class":"edit-fieldrow",label:Translator.trans("Edit"),icon:"fa-pencil"}]):Simulators.openCollapsiblePanel(i,Translator.trans("Fieldrow #%id% : %label%",{id:n.id,label:n.label}),"success",t,"",[{"class":"delete-fieldrow",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-fieldrow",label:Translator.trans("Edit"),icon:"fa-pencil"}]),f=u.find(".card-body"),e=$('<div class="card bg-light fieldrow-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-fieldset="'+n.fieldsetId+'" data-id="'+n.id+'"><\/div>'),o=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Fieldrow label"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","colon",Translator.trans("Show colon after field label ?"),n.colon,n.colon,!1,Translator.trans("Show colon after field label ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","help",Translator.trans("Show data description as help ?"),n.help,n.help,!1,Translator.trans("Show data description as help ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","emphasize",Translator.trans("Emphasize the text label ?"),n.emphasize,n.emphasize,!1,Translator.trans("Emphasize the text label ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","datagroup",Translator.trans("Datagroup"),Simulators.findDatagroupById(n.datagroup).label,Simulators.findDatagroupById(n.datagroup).label,!0,Translator.trans("Datagroup"))),s.append(r),o.append(s),e.append(o),f.append(e),f.append('<div class="card bg-light fields-panel" id="'+i+'-fields-panel"><div class="card-body sortable"><\/div><\/div>'),u};Simulators.addFieldButtonToFieldRows=function(n){var t=n.find(".delete-fieldrow");t.each(function(){if(!$(this).next().hasClass("add-field")){var n=$('<button class="btn btn-success float-right update-button add-field" title="'+Translator.trans("Add field")+'" data-parent="'+$(this).attr("data-parent")+'"><span class="button-label">'+Translator.trans("Add field")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button>');$(this).after(n);n.on("click",function(n){n.preventDefault();Simulators.addField($($(this).attr("data-parent")))})}})};Simulators.checkAddFieldButton=function(n){var t=n.parents(".fields-panel"),r=t.parents(".fieldset-grid-panel"),u=r.find(".columns-panel"),f=t.find("> div.sortable > div").length,e=u.find("> div.sortable > div").length,i;f>=e&&(i=t.parent().parent().parent().find("button.add-field"),i.remove())};Simulators.drawFieldRowForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-fieldrow-"+n.id,l=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),o=$("<div>",{"class":"card bg-warning"}),e,u,i,c,f;o.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">'+Translator.trans("Fieldrow #%id% : %label%",{id:n.id,label:n.label})+"<\/a><\/h4><\/div>");var a=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),v=$('<div class="card-body"><\/div>'),y=$('<div class="card bg-light fieldrow-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-fieldset="'+n.fieldsetId+'" data-id="'+n.id+'"><\/div>'),s=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>"),p={0:Translator.trans("--- Select a datagroup ---")};return $.each(Simulators.datagroups,function(n,t){p[t.id]=t.label}),r.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!0,Translator.trans("Fieldrow label"))),h.append(r),e=$('<div class="optional-attributes card bg-light"><\/div>'),e.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),u=$('<ul class="list-group"><\/ul>'),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="colon" data-placeholder="'+Translator.trans("Show colon after field label ?")+'">'+Translator.trans("Show colon after field label ?")+"<\/li>"),u.append(i),n.colon&&(r.append(Simulators.simpleAttributeForInput(t+"-colon","checkbox","colon",Translator.trans("Show colon after field label ?"),n.colon,!1,Translator.trans("Show colon after field label ?"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="help" data-placeholder="'+Translator.trans("Show data description as help ?")+'">'+Translator.trans("Show data description as help ?")+"<\/li>"),u.append(i),n.help&&(r.append(Simulators.simpleAttributeForInput(t+"-help","checkbox","help",Translator.trans("Show data description as help ?"),n.help,!1,Translator.trans("Show data description as help ?"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="emphasize" data-placeholder="'+Translator.trans("Emphasize the text label ?")+'">'+Translator.trans("Emphasize the text label ?")+"<\/li>"),u.append(i),n.emphasize&&(r.append(Simulators.simpleAttributeForInput(t+"-emphasize","checkbox","emphasize",Translator.trans("Emphasize the text label ?"),n.emphasize,!1,Translator.trans("Emphasize the text label ?"))),i.hide()),r.append(Simulators.simpleAttributeForInput(t+"-datagroup","select","datagroup",Translator.trans("Datagroup"),n.datagroup,!0,Translator.trans("Select a datagroup"),JSON.stringify(p))),e.append(u),h.append(e),s.append(h),y.append(s),v.append(y),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),f=$('<div class="card-body fieldrow-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-fieldrow">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-fieldrow">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(f),s.append(c),a.append(v),o.append(a),l.append(o),l};Simulators.bindFieldRowButtons=function(n){n||(n=$("#steps .fieldrows-panel"));n.find("button.edit-fieldrow").on("click",function(n){n.preventDefault();Simulators.editFieldRow($($(this).attr("data-parent")))});n.find("button.delete-fieldrow").on("click",function(n){n.preventDefault();Simulators.deleteFieldRow($($(this).attr("data-parent")))});n.find("button.add-field").on("click",function(n){n.preventDefault();Simulators.addField($($(this).attr("data-parent")))})};Simulators.bindFieldRow=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-fieldrow").on("click",function(){n.find(".fieldrow-container").replaceWith(Simulators.fieldrowBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-fieldrow").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-fieldrow, .validate-add-fieldrow").on("click",function(){var l=n.parent(),r=n.find(".fieldrow-container"),s,h,i;if(!Simulators.checkFieldRow(n))return!1;var u=r.attr("data-step"),f=r.attr("data-panel"),e=r.attr("data-fieldset"),o=r.attr("data-id"),t={id:o,stepId:u,panelId:f,fieldsetId:e,label:"",colon:"0",help:"0",emphasize:"0",datagroup:""},c=r.find(".attributes-container");c.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});s="";$(this).hasClass("validate-edit-fieldrow")?(h=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"fieldrows"},{key:"id",val:o}]),s=h.label,t.fields=h.fields):t.fields=[];i=Simulators.drawFieldRowForDisplay(t,"in");$(this).hasClass("validate-edit-fieldrow")?(r.replaceWith(i.find(".fieldrow-container")),t.label!=s&&(n.find("> div > .card-header > h4 a").text(Translator.trans("Fieldrow #%id% : %label%",{id:t.id,label:t.label})),Simulators.changeFieldrowLabelInActionButtons(u,f,e,t.id,t.label),Simulators.changeFieldRowLabelInRules(u,f,e,t.id,t.label)),delete t.stepId,delete t.panelId,delete t.fieldsetId,Simulators.updateInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"fieldrows"},{key:"id",val:o}],t),i=n):(n.replaceWith(i),Simulators.bindFieldRowButtons(i),Simulators.bindSortableFields(i.find(".fields-panel")),Simulators.addFieldRowInActions(t),delete t.stepId,delete t.panelId,delete t.fieldsetId,Simulators.addInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"fieldrows"}],t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkFieldRow=function(n){var t=n.attr("id"),r=$.trim($("#"+t+"-label").val()),i;return r===""?(n.find(".error-message").text(Translator.trans("The fieldrow label is required")),n.find(".alert").show(),!1):(i=$("#"+t+"-datagroup").val(),i==0)?(n.find(".error-message").text(Translator.trans("Please, select a datagroup")),n.find(".alert").show(),!1):!0};Simulators.addFieldRow=function(n){var c,t,l,f;try{var i=n.parent(),r=i.find(".block-container.fieldset"),e=r.attr("data-step"),o=r.attr("data-panel"),s=r.attr("data-id"),h=Simulators.findInArray(steps,[{key:"id",val:e,list:"panels"},{key:"id",val:o,list:"blocks"},{key:"id",val:s}]),u=0;h.fieldrows&&$.each(h.fieldrows,function(n,t){t.id>u&&(u=t.id)});c={stepId:e,panelId:o,fieldsetId:s,id:parseInt(u)+1,label:"",colon:"0",help:"0",emphasize:"0",datagroup:"",fields:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawFieldRowForInput(c);t.find("button.cancel-edit-fieldrow").addClass("cancel-add-fieldrow").removeClass("cancel-edit-fieldrow");t.find("button.validate-edit-fieldrow").addClass("validate-add-fieldrow").removeClass("validate-edit-fieldrow");f=i.attr("id");l=f==="fieldrows"?$("#collapsefieldrows").find("> div.sortable"):i.find(".fieldrows-panel > div.sortable");l.append(t);Simulators.bindFieldRow(t);$("#collapse"+f).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(a){console&&console.log(a.message)}};Simulators.editFieldRow=function(n){var e;try{var t=n.find(".fieldrow-container"),r=t.attr("data-step"),u=t.attr("data-panel"),f=t.attr("data-fieldset"),o=t.attr("data-id"),i=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fieldrows"},{key:"id",val:o}]);i.stepId=r;i.panelId=u;i.fieldsetId=f;$(".update-button").hide();$(".toggle-collapse-all").hide();e=Simulators.drawFieldRowForInput(i);Simulators.fieldrowBackup=t.replaceWith(e.find(".fieldrow-container"));Simulators.bindFieldRow(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(s){console&&console.log(s.message)}};Simulators.deleteFieldRow=function(n){var o;try{var f=n.find(".fieldrow-container"),t=f.attr("data-step"),i=f.attr("data-panel"),r=f.attr("data-fieldset"),u=f.attr("data-id"),s=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]),h=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"fieldrows"},{key:"id",val:u}]),c=h.label,e;if((e=Simulators.isFieldRowInRules(t,i,r,u))!==!1){bootbox.alert({title:Translator.trans("Deleting fieldrow"),message:Translator.trans("This fieldrow is used in rule #%id%. You must modify this rule before you can delete this fieldrow",{id:e})});return}if((o=Simulators.isFieldrowIdInActionButtons(t,i,r,u))!==!1){bootbox.alert({title:Translator.trans("Deleting fieldrow"),message:Translator.trans("This fieldrow is used in action button « %label% ». You must modify this action button before you can delete this fieldrow",{label:o})});return}bootbox.confirm({title:Translator.trans("Deleting fieldrow"),message:Translator.trans("Are you sure you want to delete the fieldrow : %label%",{label:c}),callback:function(f){if(f){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"fieldrows"},{key:"id",val:u}]);var e=n.parent();n.remove();Simulators.deleteFieldRowInActions(t,i,r,u);Simulators.renumberFieldRows(s.fieldrows,t,i,r,e.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(l){console&&console.log(l.message)}}}(this),function(){"use strict";Simulators.renumberFields=function(n,t,i,r,u,f){$.each(n,function(n,e){var s=e.position,o=n+1,a,v,y;if(s!=0&&o!=s){e.position=o;var c=f.eq(n),h=new RegExp("-field-"+s,"g"),l=c.attr("id");l=l.replace(h,"-field-"+o);c.attr("id",l);a=c.find("> .card > .card-header").find("> h4 > a");a.text(" "+Translator.trans("Field")+" #"+o+" : "+e.label+" ");v=c.find(".field-container");v.attr("data-id",o);y=c.find("*");y.each(function(){var n;this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(h,"-field-"+o),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(h,"-field-"+o),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(h,"-field-"+o),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(h,"-field-"+o),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(h,"-field-"+o),$(this).attr("aria-labelledby",n))});u&&u!=""?Simulators.changeFieldrowFieldPositionInActionButtons(t,i,r,u,s,"X"+o):Simulators.changeFieldPositionInActionButtons(t,i,r,s,"X"+o);Simulators.changeFieldIdInRules(t,i,r,u,s,"X"+o)}});$.each(n,function(n,f){u&&u!=""?Simulators.changeFieldrowFieldPositionInActionButtons(t,i,r,u,"X"+f.position,f.position):Simulators.changeFieldPositionInActionButtons(t,i,r,"X"+f.position,f.position);Simulators.changeFieldIdInRules(t,i,r,u,"X"+f.position,f.position)})};Simulators.bindSortableFields=function(n){n||(n=$("#steps .fields-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".field-container"),u=i.attr("data-step"),f=i.attr("data-panel"),e=i.attr("data-fieldset"),o=i.attr("data-fieldrow"),r,s,h,c;o==""?(s=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]),r=s.fields):(h=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"fieldrows"},{key:"id",val:o}]),r=h.fields);c=i.attr("data-id");Simulators.moveInArray(r,[{key:"position",val:c}],t.item.index())&&(Simulators.renumberFields(r,u,f,e,o,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawFieldForDisplay=function(n,t){var i=n.fieldrowId==""?"step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-field-"+n.position:"step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-fieldrow-"+n.fieldrowId+"-field-"+n.position,f=Simulators.openCollapsiblePanel(i,Translator.trans("Field")+" #"+n.position+" : "+n.label,"warning",t,"",[{"class":"delete-field",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-field",label:Translator.trans("Edit"),icon:"fa-pencil"}]),h=f.find(".card-body"),e=$('<div class="card bg-light field-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-fieldset="'+n.fieldsetId+'" data-fieldrow="'+n.fieldrowId+'" data-id="'+n.position+'"><\/div>'),u=$('<div class="card-body"><\/div>'),o=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>"),s;return r.append(Simulators.simpleAttributeForDisplay(i,"text","data",Translator.trans("Data"),Simulators.findDataById(n.data).label,Simulators.findDataById(n.data).label,!0,Translator.trans("Field data"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!1,Translator.trans("Field label"))),r.append(Simulators.simpleAttributeForDisplay(i,"select","usage",Translator.trans("Usage"),n.usage,n.usage,!0,Translator.trans("Select an usage"),JSON.stringify({input:Translator.trans("input"),output:Translator.trans("output")}))),r.append(Simulators.simpleAttributeForDisplay(i,"text","prompt",Translator.trans("Prompt"),n.prompt,n.prompt,!1,Translator.trans("Field prompt"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","required",Translator.trans("Required"),n.required,n.required,!1,Translator.trans("Required"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","visibleRequired",Translator.trans("Required if visible"),n.visibleRequired,n.visibleRequired,!1,Translator.trans("Required if visible"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","newline",Translator.trans("Newline before field ?"),n.newline,n.newline,!1,Translator.trans("Newline before field ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","colon",Translator.trans("Show colon after field label ?"),n.colon,n.colon,!1,Translator.trans("Show colon after field label ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","underlabel",Translator.trans("Place the field under the label ?"),n.underlabel,n.underlabel,!1,Translator.trans("Place the field under the label ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","help",Translator.trans("Show data description as help ?"),n.help,n.help,!1,Translator.trans("Show data description as help ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","emphasize",Translator.trans("Emphasize the text label ?"),n.emphasize,n.emphasize,!1,Translator.trans("Emphasize the text label ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"checkbox","expanded",Translator.trans("Show choices as radio buttons ?"),n.expanded,n.expanded,!1,Translator.trans("Show choices as radio buttons ?"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","explanation",Translator.trans("Explanation"),n.explanation,n.explanation,!1,Translator.trans("Explanation"))),r.append(Simulators.simpleAttributeForDisplay(i,"select","widget",Translator.trans("Widget"),n.widget,n.widget,!1,Translator.trans("Select a widget"),JSON.stringify(Simulators.makeWidgetsList(n)))),o.append(r),u.append(o),e.append(u),h.append(e),n.fieldrowId===""&&n.Note&&(s=n.Note=="beforeField"?Translator.trans("placed before the field"):Translator.trans("placed after the field"),u.append('<div class="card bg-light note-panel elements-container" id="'+i+'-note-panel"><div class="card-header"><span class="note-position float-right">'+Translator.trans("Note position")+" : "+s+"<\/span>"+Translator.trans("Note")+'<\/div><div class="card-body field-note rich-text">'+n.Note.text.content+"<\/div><\/div>")),f};Simulators.getFieldInputType=function(n,t){var i="text";switch(t.type){case"boolean":case"multichoice":i="checkbox";break;case"number":case"integer":i="number";break;case"textarea":i="textarea";break;case"choice":case"department":case"region":case"country":case"year":case"month":case"day":i=n.expanded=="1"?"radio":"select"}return i};Simulators.makeWidgetsList=function(n){var f={},r=Simulators.findDataById(n.data),u,i,t;if(r)for(u=Simulators.getFieldInputType(n,r),i=typewidgets[r.type].filter(function(n){return inputwidgets[u]&&inputwidgets[u].indexOf(n)>-1}),t=0;t<i.length;t++)f[i[t]]=widgets[i[t]];return f};Simulators.checkFieldWidget=function(n){var t=Simulators.findDataById(n.data),i;return typewidgets[t.type]?typewidgets[t.type].indexOf(n.widget)<=-1?!1:(i=Simulators.getFieldInputType(n,t),inputwidgets[i]&&inputwidgets[i].indexOf(n.widget)>-1):!1};Simulators.drawFieldForInput=function(n){var t=n.fieldrowId==""?"step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-field-"+n.position:"step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-fieldrow-"+n.fieldrowId+"-field-"+n.position,v=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),o=$("<div>",{"class":"card bg-warning"}),w,e,u,i,a,f;o.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.position+" : "+n.label+"<\/a><\/h4><\/div>");var y=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),s=$('<div class="card-body"><\/div>'),p=$('<div class="card bg-light field-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-fieldset="'+n.fieldsetId+'" data-fieldrow="'+n.fieldrowId+'" data-id="'+n.position+'"><\/div>'),h=$('<div class="card-body"><\/div>'),c=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>"),l={0:Translator.trans("--- Select a data ---")};if(n.fieldrowId==""?$.each(Simulators.dataset,function(n,t){l[t.id]=t.label}):(w=Simulators.findInArray(steps,[{key:"id",val:n.stepId,list:"panels"},{key:"id",val:n.panelId,list:"blocks"},{key:"id",val:n.fieldsetId,list:"fieldrows"},{key:"id",val:n.fieldrowId}]),$.each(Simulators.dataset,function(n,t){t.datagroup==w.datagroup&&(l[t.id]=t.label)})),r.append(Simulators.simpleAttributeForInput(t+"-data","select","data",Translator.trans("Data"),n.data,!0,Translator.trans("Select a data"),JSON.stringify(l))),r.append(Simulators.simpleAttributeForInput(t+"-type","select","usage","Usage",n.usage,!0,Translator.trans("Select a data type"),JSON.stringify({input:Translator.trans("input"),output:Translator.trans("output")}))),c.append(r),e=$('<div class="optional-attributes card bg-light"><\/div>'),e.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),u=$('<ul class="list-group"><\/ul>'),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="label" data-placeholder="'+Translator.trans("Field label")+'">'+Translator.trans("Label")+"<\/li>"),u.append(i),n.label&&(r.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!1,Translator.trans("Field label"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="prompt" data-placeholder="'+Translator.trans("Field prompt")+'">'+Translator.trans("Prompt")+"<\/li>"),u.append(i),n.prompt&&(r.append(Simulators.simpleAttributeForInput(t+"-prompt","text","prompt",Translator.trans("Prompt"),n.prompt,!1,Translator.trans("Field prompt"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="newline" data-placeholder="">'+Translator.trans("Newline before field ?")+"<\/li>"),u.append(i),n.newline=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-newline","checkbox","newline",Translator.trans("Newline before field ?"),n.newline,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="required" data-placeholder="">'+Translator.trans("Required")+"<\/li>"),u.append(i),n.required=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-required","checkbox","required",Translator.trans("Required"),n.required,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="visibleRequired" data-placeholder="">'+Translator.trans("Required if visible")+"<\/li>"),u.append(i),n.visibleRequired=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-visibleRequired","checkbox","visibleRequired",Translator.trans("Required if visible"),n.visibleRequired,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="colon" data-placeholder="">'+Translator.trans("Show colon after field label ?")+"<\/li>"),u.append(i),n.colon=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-colon","checkbox","colon",Translator.trans("Show colon after field label ?"),n.colon,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="underlabel" data-placeholder="">'+Translator.trans("Place the field under the label ?")+"<\/li>"),u.append(i),n.underlabel=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-underlabel","checkbox","underlabel",Translator.trans("Place the field under the label ?"),n.underlabel,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="help" data-placeholder="">'+Translator.trans("Show data description as help ?")+"<\/li>"),u.append(i),n.help=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-help","checkbox","help",Translator.trans("Show data description as help ?"),n.help,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="emphasize" data-placeholder="">'+Translator.trans("Emphasize the text label ?")+"<\/li>"),u.append(i),n.emphasize=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-emphasize","checkbox","emphasize",Translator.trans("Emphasize the text label ?"),n.emphasize,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="checkbox" data-name="expanded" data-placeholder="">'+Translator.trans("Show choices as radio buttons ?")+"<\/li>"),u.append(i),n.expanded=="1"&&(r.append(Simulators.simpleAttributeForInput(t+"-expanded","checkbox","expanded",Translator.trans("Show choices as radio buttons ?"),n.expanded,!1,"")),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="explanation" data-placeholder="'+Translator.trans("Explanation")+'">'+Translator.trans("Explanation")+"<\/li>"),u.append(i),n.explanation&&(r.append(Simulators.simpleAttributeForInput(t+"-explanation","text","explanation",Translator.trans("Explanation"),n.explanation,!1,Translator.trans("Explanation"))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="select" data-name="widget" data-placeholder="'+Translator.trans("Select a widget")+'" data-options="'+encodeURI(JSON.stringify(Simulators.makeWidgetsList(n)))+'">'+Translator.trans("Widget")+"<\/li>"),u.append(i),n.widget&&n.widget!=""&&(r.append(Simulators.simpleAttributeForInput(t+"-widget","select","widget",Translator.trans("Widget"),n.widget,!1,Translator.trans("Select a widget"),JSON.stringify(Simulators.makeWidgetsList(n)))),i.hide()),e.append(u),c.append(e),h.append(c),p.append(h),s.append(p),n.fieldrowId===""){var b={content:"",edition:""},k="",d="";n.Note&&(b=n.Note.text,n.Note.position=="beforeField"?k=' selected="selected"':d=' selected="selected"');h.append('<div class="card bg-light note-panel elements-container" id="'+t+'-note-panel"><div class="card-header"><span class="note-position float-right"><label for="'+t+'-note-position">'+Translator.trans("Note position")+'<\/label><select id="'+t+'-note-position"><option value="beforeField"'+k+">"+Translator.trans("placed before the field")+'<\/option><option value="afterField"'+d+">"+Translator.trans("placed after the field")+"<\/option><\/select><\/span>"+Translator.trans("Note")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-note" id="'+t+'-note" wrap="hard" class="form-control field-note">'+Simulators.paragraphs(b).content+"<\/textarea><\/div><\/div>")}return a=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),f=$('<div class="card-body field-buttons"><\/div>'),f.append('<button class="btn btn-success float-right validate-edit-field">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),f.append('<button class="btn btn-secondary float-right cancel-edit-field">'+Translator.trans("Cancel")+"<\/span><\/button>"),f.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),a.append(f),s.append(a),y.append(s),o.append(y),v.append(o),v};Simulators.bindFieldButtons=function(n){n||(n=$("#steps .fields-panel"));n.find("button.edit-field").on("click",function(n){n.preventDefault();Simulators.editField($($(this).attr("data-parent")))});n.find("button.delete-field").on("click",function(n){n.preventDefault();Simulators.deleteField($($(this).attr("data-parent")))})};Simulators.bindField=function(n){n.find("textarea").wysihtml(Admin.wysihtml5Options);n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find("select[data-attribute=data]").on("change",function(){Simulators.changeFieldWidgetList(n)});n.find(".cancel-edit-field").on("click",function(){n.replaceWith(Simulators.fieldBackup);Simulators.fieldBackup.find("button.edit-field").on("click",function(n){n.preventDefault();Simulators.editField($($(this).attr("data-parent")))});Simulators.fieldBackup.find("button.delete-field").on("click",function(n){n.preventDefault();Simulators.deleteField($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-field").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-field, .validate-add-field").on("click",function(){var y=n.parent(),e=n.find(".field-container"),c,h,l,o,a,v;if(!Simulators.checkField(n))return!1;var r=e.attr("data-step"),u=e.attr("data-panel"),f=e.attr("data-fieldset"),i=e.attr("data-fieldrow"),s=e.attr("data-id"),t={type:"field",position:s,newline:"0",prompt:"",required:"0",visibleRequired:"0",colon:"0",underlabel:"0",help:"0",emphasize:"0",explanation:"",expanded:"0",widget:""};t.stepId=r;t.panelId=u;t.fieldsetId=f;t.fieldrowId=i;c=e.find(".attributes-container");c.find("input.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).is(":checkbox")?$(this).is(":checked")?"1":"0":$(this).val()});t.label||(t.label="");h=Admin.clearHTML(n.find(".field-note"));i==""&&h!=""?(l=n.find(".note-position select").val(),t.Note={position:l,text:{content:h,edition:"wysihtml"}}):delete t.Note;o=Simulators.drawFieldForDisplay(t);n.replaceWith(o);Simulators.bindFieldButtons(o);$(this).hasClass("validate-edit-field")?(a=i==""?Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fields"},{key:"position",val:s}]):Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fieldrows"},{key:"id",val:i,list:"fields"},{key:"position",val:s}]),v=a.label,t.label!=v&&(i&&i!=""?Simulators.changeFieldrowFieldLabelInActionButtons(r,u,f,i,t.position,t.label):Simulators.changeFieldLabelInActionButtons(r,u,f,t.position,t.label),Simulators.changeFieldLabelInRules(r,u,f,i,t.position,t.label)),delete t.stepId,delete t.panelId,delete t.fieldsetId,delete t.fieldrowId,i==""?Simulators.updateInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fields"},{key:"position",val:s}],t):Simulators.updateInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fieldrows"},{key:"id",val:i,list:"fields"},{key:"position",val:s}],t)):(Simulators.addFieldInActions(t),delete t.stepId,delete t.panelId,delete t.fieldsetId,delete t.fieldrowId,i==""?Simulators.addInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fields"}],t):(Simulators.checkAddFieldButton(o),Simulators.addInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"fieldrows"},{key:"id",val:i,list:"fields"}],t)));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;o.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:o.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n,function(t){if(t.attr("data-name")=="expanded")n.find(".attributes-container input[data-attribute=expanded]").on("change",function(){Simulators.changeFieldWidgetList(n)})},function(t){t=="expanded"&&Simulators.changeFieldWidgetList(n)})};Simulators.changeFieldWidgetList=function(n){var u=n.find(".optional-attributes li[data-name=widget]"),f=n.find(".attributes-container input[data-attribute=expanded]:checked"),e=n.find(".attributes-container select[data-attribute=data] option:selected"),o={data:e.val(),expanded:f.length==0?"0":"1"},i=n.find(".attributes-container select[data-attribute=widget] option:selected"),s=i.length==0?"":i.val(),r=Simulators.makeWidgetsList(o),t;u.attr("data-options",JSON.stringify(r));t=n.find(".attributes-container select[data-attribute=widget]");t.length&&(t.empty(),$.each(r,function(n,i){var r=$("<option>",{value:n,text:i});n==s&&r.attr("selected",!0);t.append(r)}))};Simulators.checkField=function(n){var t=n.attr("id"),i=$("#"+t+"-data").val();return i==0?(n.find(".error-message").text(Translator.trans("Please, select a data")),n.find(".alert").show(),!1):!0};Simulators.addField=function(n){var i,r,u,o,f,e,c,s,a,h,v,t,l,y;try{f=n.find(".block-container.fieldset");f.length>0?(i=f.attr("data-step"),r=f.attr("data-panel"),u=f.attr("data-id"),o=""):(e=n.find(".fieldrow-container"),i=e.attr("data-step"),r=e.attr("data-panel"),u=e.attr("data-fieldset"),o=e.attr("data-id"));c=Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u}]);c.disposition==="grid"?(a=Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u,list:"fieldrows"},{key:"id",val:o}]),s=a.fields):s=c.fields;h=0;s&&$.each(s,function(n,t){t.position>h&&(h=t.position)});v={stepId:i,panelId:r,fieldsetId:u,fieldrowId:o,position:parseInt(h)+1,data:0,label:"",usage:"input"};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawFieldForInput(v);t.find("button.cancel-edit-field").addClass("cancel-add-field").removeClass("cancel-edit-field");t.find("button.validate-edit-field").addClass("validate-add-field").removeClass("validate-edit-field");l=n.attr("id");y=$("#collapse"+l).find("> div > div.fields-panel > div.sortable");y.append(t);Simulators.bindField(t);$("#collapse"+l).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(p){console&&console.log(p.message)}};Simulators.editField=function(n){var r;try{var t=n.find(".field-container"),u=t.attr("data-step"),f=t.attr("data-panel"),e=t.attr("data-fieldset"),o=t.attr("data-fieldrow"),s=t.attr("data-id"),h=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e}]),i=h.disposition==="grid"?Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"fieldrows"},{key:"id",val:o,list:"fields"},{key:"position",val:s}]):Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"fields"},{key:"position",val:s}]);i.stepId=u;i.panelId=f;i.fieldsetId=e;i.fieldrowId=o;$(".update-button").hide();$(".toggle-collapse-all").hide();r=Simulators.drawFieldForInput(i);Simulators.fieldBackup=n.replaceWith(r);Simulators.bindField(r);$("#collapse"+r.attr("id")).collapse("show");$("html, body").animate({scrollTop:r.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(c){console&&console.log(c.message)}};Simulators.deleteField=function(n,t){var c;typeof t=="undefined"&&(t=!0);try{var o=n.find(".field-container"),i=o.attr("data-step"),r=o.attr("data-panel"),u=o.attr("data-fieldset"),f=o.attr("data-fieldrow"),e=o.attr("data-id"),s=Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u}]),h=s.disposition==="grid"?Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u,list:"fieldrows"},{key:"id",val:f,list:"fields"},{key:"position",val:e}]):Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u,list:"fields"},{key:"position",val:e}]),a=h.label?h.label:Translator.trans("Field %id% (nolabel)",{id:"#"+h.position}),l;if((l=Simulators.isFieldInRules(i,r,u,f,e))!==!1){bootbox.alert({title:Translator.trans("Deleting field"),message:Translator.trans("This field is used in rule #%id%. You must modify this rule before you can delete this field",{id:l})});return}if(c=f&&f!=""?Simulators.isFieldrowFieldPositionInActionButtons(i,r,u,f,e):Simulators.isFieldPositionInActionButtons(i,r,u,e),c!==!1){bootbox.alert({title:Translator.trans("Deleting field"),message:Translator.trans("This field is used in action button « %label% ». You must modify this action button before you can delete this field",{label:c})});return}t?bootbox.confirm({title:Translator.trans("Deleting field"),message:Translator.trans("Are you sure you want to delete the field : %label%",{label:a}),callback:function(t){t&&Simulators.doDeleteField(n,s.disposition,i,r,u,f,e)}}):Simulators.doDeleteField(n,s.disposition,i,r,u,f,e)}catch(v){console&&console.log(v.message)}};Simulators.doDeleteField=function(n,t,i,r,u,f,e){var o,s,h;t==="grid"?Simulators.deleteInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u,list:"fieldrows"},{key:"id",val:f,list:"fields"},{key:"position",val:e}]):Simulators.deleteInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u,list:"fields"},{key:"position",val:e}]);o=n.parent();n.remove();Simulators.deleteFieldInActions(i,r,u,f,e);t==="grid"?(s=Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u,list:"fieldrows"},{key:"id",val:f}]),Simulators.renumberFields(s.fields,i,r,u,f,o.find("> div")),Simulators.addFieldButtonToFieldRows(o.parents(".fieldset-grid-panel").eq(0)),Simulators.checkAddFieldButton(o)):(h=Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:r,list:"blocks"},{key:"id",val:u}]),Simulators.renumberFields(h.fields,i,r,u,"",o.find("> div")));$(".save-simulator").show();Admin.updated=!0}}(this),function(){"use strict";Simulators.drawFieldSetForDisplay=function(n,t){var i="step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.id,e=n.disposition=="grid"?Simulators.openCollapsiblePanel(i,Translator.trans("FieldSet")+" #"+n.id+" : "+$("<span>"+n.legend.content+"<\/span>").text(),"info",t,"in",[{"class":"delete-fieldset",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-fieldset",label:Translator.trans("Edit"),icon:"fa-pencil"}]):Simulators.openCollapsiblePanel(i,Translator.trans("FieldSet")+" #"+n.id+" : "+$("<span>"+n.legend.content+"<\/span>").text(),"info",t,"in",[{"class":"delete-fieldset",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"add-field",label:Translator.trans("Add field"),icon:"fa-plus-circle"},{"class":"edit-fieldset",label:Translator.trans("Edit"),icon:"fa-pencil"}]);var r=e.find(".card-body"),o=$('<div class="card bg-light block-container fieldset" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-id="'+n.id+'"><\/div>'),f=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),u=$("<div><\/div>");return u.append(Simulators.simpleAttributeForDisplay(i,"select","disposition",Translator.trans("Disposition"),n.disposition,n.disposition,!1,Translator.trans("Select a Disposition"),JSON.stringify({classic:Translator.trans("Classic"),grid:Translator.trans("Grid"),inline:Translator.trans("Inline")}))),u.append(Simulators.simpleAttributeForDisplay(i,"select","display",Translator.trans("Display"),n.display,n.display,!1,Translator.trans("Select a Display"),JSON.stringify({inline:Translator.trans("Inline"),grouped:Translator.trans("Grouped"),accordion:Translator.trans("Accordion"),"pop-in":Translator.trans("Pop-in")}))),u.append(Simulators.simpleAttributeForDisplay(i,"text","popinLink",Translator.trans("Pop-in Link"),n.popinLink,n.popinLink,!1,Translator.trans("Pop-in Link"))),s.append(u),f.append(s),o.append(f),r.append(o),f.append('<div class="card bg-light legend-panel elements-container" id="'+i+'-legend-panel"><div class="card-header">'+Translator.trans("Legend")+'<\/div><div class="card-body fieldset-legend rich-text" data-edition="'+n.legend.edition+'">'+n.legend.content+"<\/div><\/div>"),n.disposition=="grid"?r.append('<div class="card bg-light fieldset-grid-panel" id="fieldset-'+n.id+'-fieldset-grid-panel"><div class="card-header"><button class="btn btn-secondary float-right update-button add-column" data-parent="#fieldset-'+n.id+'-fieldset-grid-panel" title="'+Translator.trans("Add column")+'"><span class="button-label">'+Translator.trans("Add column")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><button class="btn btn-secondary float-right update-button add-fieldrow" data-parent="#fieldset-'+n.id+'-fieldset-grid-panel" title="'+Translator.trans("Add fieldrow")+'"><span class="button-label">'+Translator.trans("Add fieldrow")+'<\/span> <span class="fas fa-plus-circle"><\/span><\/button><h4 class="card-title">'+Translator.trans("Grid")+'<\/h4><\/div><div class="card-body"><div class="card bg-light columns-panel" id="step-'+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.id+'-columns-panel"><div class="card-body sortable"><\/div><\/div><div class="card bg-light fieldrows-panel" id="step-'+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.id+'-fieldrows-panel"><div class="card-body sortable"><\/div><\/div><\/div><\/div>'):(r.append('<div class="card bg-light columns-panel" id="'+i+'-columns-panel"><div class="card-body sortable"><\/div><\/div>'),r.append('<div class="card bg-light fields-panel" id="'+i+'-fields-panel"><div class="card-body sortable"><\/div><\/div>')),e};Simulators.drawFieldSetForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.id,l=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),s=$("<div>",{"class":"card bg-info"}),o,r,i,c,u;s.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" : "+n.legend.content+"<\/a><\/h4><\/div>");var a=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),v=$('<div class="card-body"><\/div>'),y=$('<div class="card bg-light block-container fieldset" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),f=$('<div class="card-body"><\/div>'),h=$('<div class="attributes-container"><\/div>'),e=$("<div><\/div>");return h.append(e),o=$('<div class="optional-attributes card bg-light"><\/div>'),o.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),r=$('<ul class="list-group"><\/ul>'),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="select" data-name="disposition" data-placeholder="'+Translator.trans("FieldSet disposition")+'" data-options="'+encodeURI(JSON.stringify({classic:Translator.trans("Classic"),grid:Translator.trans("Grid")}))+'">'+Translator.trans("Disposition")+"<\/li>"),r.append(i),n.disposition&&(e.append(Simulators.simpleAttributeForInput(t+"-disposition","select","disposition",Translator.trans("Disposition"),n.disposition,!1,Translator.trans("FieldSet disposition"),JSON.stringify({classic:Translator.trans("Classic"),grid:Translator.trans("Grid"),inline:Translator.trans("Inline")}))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="select" data-name="display" data-placeholder="'+Translator.trans("FieldSet display")+'" data-options="'+encodeURI(JSON.stringify({inline:Translator.trans("Inline"),grouped:Translator.trans("Grouped"),accordion:Translator.trans("Accordion"),"pop-in":Translator.trans("Pop-in")}))+'">'+Translator.trans("Display")+"<\/li>"),r.append(i),n.display&&(e.append(Simulators.simpleAttributeForInput(t+"-display","select","display",Translator.trans("Display"),n.display,!1,Translator.trans("FieldSet display"),JSON.stringify({inline:Translator.trans("Inline"),grouped:Translator.trans("Grouped"),accordion:Translator.trans("Accordion"),"pop-in":Translator.trans("Pop-in")}))),i.hide()),i=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="popinLink" data-placeholder="'+Translator.trans("Pop-in Link")+'">'+Translator.trans("Pop-in Link")+"<\/li>"),r.append(i),n.popinLink&&(e.append(Simulators.simpleAttributeForInput(t+"-popinLink","text","popinLink",Translator.trans("Pop-in Link"),n.popinLink,!1,Translator.trans("Pop-in Link"))),i.hide()),o.append(r),h.append(o),f.append(h),y.append(f),v.append(y),f.append('<div class="card bg-light legend-panel elements-container" id="'+t+'-legend-panel"><div class="card-header">'+Translator.trans("Legend")+'<\/div><div class="card-body"><textarea rows="1" name="'+t+'-legend" id="'+t+'-legend" wrap="hard" class="form-control fieldset-legend">'+Simulators.paragraphs(n.legend).content+"<\/textarea><\/div><\/div>"),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),u=$('<div class="card-body fieldset-buttons"><\/div>'),u.append('<button class="btn btn-success float-right validate-edit-fieldset">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),u.append('<button class="btn btn-secondary float-right cancel-edit-fieldset">'+Translator.trans("Cancel")+"<\/span><\/button>"),u.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(u),f.append(c),a.append(v),s.append(a),l.append(s),l};Simulators.bindFieldSetButtons=function(n){n||(n=$("#steps .blocks-panel"));n.find("button.edit-fieldset").on("click",function(n){n.preventDefault();Simulators.editFieldSet($($(this).attr("data-parent")))});n.find("button.delete-fieldset").on("click",function(n){n.preventDefault();Simulators.deleteFieldSet($($(this).attr("data-parent")))});n.find("button.add-field").on("click",function(n){n.preventDefault();var t=$($(this).attr("data-parent")).find(".fieldrow-container");t.length==0&&Simulators.addField($($(this).attr("data-parent")))});n.find("button.add-fieldrow").on("click",function(n){n.preventDefault();Simulators.addFieldRow($($(this).attr("data-parent")))});n.find("button.add-column").on("click",function(n){n.preventDefault();Simulators.addFieldSetColumn($($(this).attr("data-parent")))})};Simulators.bindFieldSet=function(n){var t=$.extend(!0,{},Admin.wysihtml5InlineOnlyOptions,{toolbar:{insertData:!0,insertFootnoteReference:!0}});n.find("textarea").wysihtml(t);n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-fieldset").on("click",function(){n.find(".block-container.fieldset").replaceWith(Simulators.fieldsetBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-fieldset").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-fieldset, .validate-add-fieldset").on("click",function(){var h=n.parent(),e=n.find(".block-container.fieldset"),s,r,i;if(!Simulators.checkFieldSet(n))return!1;var u=e.attr("data-step"),f=e.attr("data-panel"),o=e.attr("data-id"),t={type:"fieldset",id:o};t.stepId=u;t.panelId=f;s=e.find(".attributes-container");s.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.legend={content:Admin.clearHTML(n.find(".fieldset-legend")),edition:"wysihtml"};t.popinLink||(t.popinLink="");$(this).hasClass("validate-edit-fieldset")?(r=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:o}]),r.disposition=="grid"?t.disposition=="grid"?(t.columns=r.columns,t.fieldrows=r.fieldrows):t.fields=[]:t.disposition=="grid"?(t.columns=[],t.fieldrows=[]):t.fields=r.fields):t.disposition=="grid"?(t.columns=[],t.fieldrows=[]):t.fields=[];i=Simulators.drawFieldSetForDisplay(t,"in");$(this).hasClass("validate-edit-fieldset")?(t.disposition==r.disposition?(e.replaceWith(i.find(".block-container.fieldset")),t.legend.content!=r.legend.content&&(n.find("> div > .card-header > h4 a").text(" "+Translator.trans("FieldSet")+" #"+t.id+" : "+$("<span>"+t.legend.content+"<\/span>").text()+" "),Simulators.changeFieldsetLegendInActionButtons(u,f,t.id,t.legend.content),Simulators.changeFieldSetLegendInRules(u,f,t.id,t.legend.content)),i=n):(n.replaceWith(i),Simulators.bindFieldSetButtons(i),Simulators.bindSortableFields(i.find(".fields-panel")),Simulators.deleteFieldSetInActions(r.stepId,r.panelId,r.id),Simulators.addFieldSetInActions(t)),delete t.stepId,delete t.panelId,Simulators.updateInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:o}],t)):(n.replaceWith(i),Simulators.bindFieldSetButtons(i),Simulators.bindSortableFields(i.find(".fields-panel")),Simulators.addFieldSetInActions(t),delete t.stepId,delete t.panelId,Simulators.addInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"}],t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkFieldSet=function(n){var t=n.attr("id"),i=$.trim($("#"+t+"-display").val()),r,u;if(i=="pop-in"){if(r=$.trim($("#"+t+"-popinLink").val()),r=="")return n.find(".error-message").text(Translator.trans("The pop-in link text is required when display is pop-in")),n.find(".alert").show(),!1}else if(i=="accordion"&&(u=$.trim(Admin.clearHTML(n.find(".fieldset-legend"))),u==""))return n.find(".error-message").text(Translator.trans("The legend is required when display is accordion")),n.find(".alert").show(),!1;return!0};Simulators.addFieldSet=function(n){var s,t,h,r;try{var u=n.find(".panel-container"),f=u.attr("data-step"),e=u.attr("data-id"),o=Simulators.findInArray(steps,[{key:"id",val:f,list:"panels"},{key:"id",val:e}]),i=0;o.blocks&&$.each(o.blocks,function(n,t){t.id>i&&(i=t.id)});s={type:"fieldset",stepId:f,panelId:e,id:parseInt(i)+1,display:"inline",disposition:"classic",popinLink:"",legend:{content:"",edition:""},fields:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawFieldSetForInput(s);t.find("button.cancel-edit-fieldset").addClass("cancel-add-fieldset").removeClass("cancel-edit-fieldset");t.find("button.validate-edit-fieldset").addClass("validate-add-fieldset").removeClass("validate-edit-fieldset");r=n.attr("id");h=r==="blocks"?$("#collapseblocks").find("> div.sortable"):n.find(".blocks-panel > div.sortable");h.append(t);Simulators.bindFieldSet(t);$("#collapse"+r).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(c){console&&console.log(c.message)}};Simulators.editFieldSet=function(n){var f;try{var t=n.find(".block-container.fieldset"),r=t.attr("data-step"),u=t.attr("data-panel"),e=t.attr("data-id"),i=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:e}]);i.stepId=r;i.panelId=u;$(".update-button").hide();$(".toggle-collapse-all").hide();f=Simulators.drawFieldSetForInput(i);Simulators.fieldsetBackup=t.replaceWith(f.find(".block-container.fieldset"));Simulators.bindFieldSet(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(o){console&&console.log(o.message)}};Simulators.deleteFieldSet=function(n){var o;try{var u=n.find(".block-container.fieldset"),t=u.attr("data-step"),i=u.attr("data-panel"),r=u.attr("data-id"),s=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i}]),f=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]),h=f.legend.content!==""?f.legend.content:"fieldset #"+f.id,e;if((e=Simulators.isFieldSetInRules(t,i,r))!==!1){bootbox.alert({title:Translator.trans("Deleting fieldset"),message:Translator.trans("This fieldset is used in rule #%id%. You must modify this rule before you can delete this fieldset",{id:e})});return}if((o=Simulators.isFieldsetIdInActionButtons(t,i,r))!==!1){bootbox.alert({title:Translator.trans("Deleting fieldset"),message:Translator.trans("This fieldset is used in action button « %label% ». You must modify this action button before you can delete this fieldset",{label:o})});return}bootbox.confirm({title:Translator.trans("Deleting fieldset"),message:Translator.trans("Are you sure you want to delete the fieldset : %legend%",{legend:h.content}),callback:function(u){if(u){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]);var f=n.parent();n.remove();Simulators.deleteFieldSetInActions(t,i,r);Simulators.renumberBlocks(s.blocks,t,i,f.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(c){console&&console.log(c.message)}};Simulators.renumberFieldSetColumns=function(n,t,i,r,u){$.each(n,function(n,f){var h=f.id,e=n+1,l,a,v;if(h!=0&&e!=h){f.id=e;var s=u.eq(n),o=new RegExp("-column-"+h,"g"),c=s.attr("id");c=c.replace(o,"-column-"+e);s.attr("id",c);l=s.find("> .card > .card-header").find("> h4 > a");l.text(" "+Translator.trans("Column #%id% : %label%",{id:e,label:f.label})+" ");a=s.find(".column-container");a.attr("data-id",e);v=s.find("*");v.each(function(){var n;this.hasAttribute("data-column")&&$(this).attr("data-column",e);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(o,"-column-"+e),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(o,"-column-"+e),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(o,"-column-"+e),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(o,"-column-"+e),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(o,"-column-"+e),$(this).attr("aria-labelledby",n))});Simulators.changeFieldSetColumnIdInRules(t,i,r,h,"X"+e)}});$.each(n,function(n,u){Simulators.changeFieldSetColumnIdInRules(t,i,r,"X"+u.id,u.id)})};Simulators.bindSortableFieldSetColumns=function(n){n||(n=$("#steps .columns-panel"));n.find("> div.sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".column-container"),r=i.attr("data-step"),u=i.attr("data-panel"),f=i.attr("data-fieldset"),e=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f}]),o=i.attr("data-id");Simulators.moveInArray(e.columns,[{key:"id",val:o}],t.item.index())&&(Simulators.renumberFieldSetColumns(e.columns,r,u,f,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawFieldSetColumnForDisplay=function(n,t){var h=Simulators.findInArray(steps,[{key:"id",val:n.stepId,list:"panels"},{key:"id",val:n.panelId,list:"blocks"},{key:"id",val:n.fieldsetId}]),i="step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-column-"+n.id,u=Simulators.openCollapsiblePanel(i,Translator.trans("Column #%id% : %label%",{id:n.id,label:n.label}),"warning",t,"",[{"class":"delete-column",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-column",label:Translator.trans("Edit"),icon:"fa-pencil"}]),s=u.find(".card-body"),f=$('<div class="card bg-light column-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-fieldset="'+n.fieldsetId+'" data-id="'+n.id+'"><\/div>'),e=$('<div class="card-body"><\/div>'),o=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Column name"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Column label"))),r.append(Simulators.simpleAttributeForDisplay(i,"select","type",Translator.trans("Type"),n.type,n.type,!0,Translator.trans("Select a column type"),JSON.stringify(Admin.types))),o.append(r),e.append(o),f.append(e),s.append(f),u};Simulators.drawFieldSetColumnForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.panelId+"-fieldset-"+n.fieldsetId+"-column-"+n.id,o=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),u=$("<div>",{"class":"card bg-warning"}),e,i;u.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">'+Translator.trans("Column #%id% : %label%",{id:n.id,label:n.label})+"<\/a><\/h4><\/div>");var s=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),h=$('<div class="card-body"><\/div>'),c=$('<div class="card bg-light column-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-fieldset="'+n.fieldsetId+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),f=$('<div class="card-body"><\/div>'),l=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append('<div class="form-group row"><label for="'+t+'-name" class="col-sm-4 col-form-label">'+Translator.trans("Name")+'<\/label><div class="col-sm-8"><input type="text" name="'+t+'-name" id="'+t+'-name" data-attribute="name" class="form-control simple-value" placeholder="'+Translator.trans("Column name without spaces or special characters")+'" value="'+n.name+'" /><\/div><\/div>'),r.append('<div class="form-group row"><label for="'+t+'-label" class="col-sm-4 col-form-label">'+Translator.trans("Label")+'<\/label><div class="col-sm-8"><input type="text" name="'+t+'-label" id="'+t+'-label" data-attribute="label" class="form-control simple-value" placeholder="'+Translator.trans("Column label")+'" value="'+n.label+'" /><\/div><\/div>'),r.append(Simulators.simpleAttributeForInput(t+"-type","select","type","Type",n.type,!0,Translator.trans("Select a column type"),JSON.stringify(Admin.types))),l.append(r),f.append(l),c.append(f),h.append(c),e=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),i=$('<div class="card-body column-buttons"><\/div>'),i.append('<button class="btn btn-success float-right validate-edit-column">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),i.append('<button class="btn btn-secondary float-right cancel-edit-column">'+Translator.trans("Cancel")+"<\/span><\/button>"),i.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),e.append(i),f.append(e),s.append(h),u.append(s),o.append(u),o};Simulators.bindFieldSetColumnButtons=function(n){n||(n=$("#steps .columns-panel"));n.find("button.edit-column").on("click",function(n){n.preventDefault();Simulators.editFieldSetColumn($($(this).attr("data-parent")))});n.find("button.delete-column").on("click",function(n){n.preventDefault();Simulators.deleteFieldSetColumn($($(this).attr("data-parent")))})};Simulators.bindFieldSetColumn=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-column").on("click",function(){n.find(".column-container").replaceWith(Simulators.columnBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-column").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-column, .validate-add-column").on("click",function(){var a=n.parent(),r=n.find(".column-container"),c,s,h,i;if(!Simulators.checkFieldSetColumn(n))return!1;var u=r.attr("data-step"),f=r.attr("data-panel"),e=r.attr("data-fieldset"),o=r.attr("data-id"),t={id:o,stepId:u,panelId:f,fieldsetId:e,name:"",label:"",type:""},l=r.find(".attributes-container");l.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});c="";s="";$(this).hasClass("validate-edit-column")&&(h=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"columns"},{key:"id",val:o}]),c=h.name,s=h.label);i=Simulators.drawFieldSetColumnForDisplay(t,"in");$(this).hasClass("validate-edit-column")?(r.replaceWith(i.find(".column-container")),t.label!=s&&(n.find("> div > .card-header > h4 a").text(Translator.trans("Column #%id% : %label%",{id:t.id,label:t.label})),Simulators.changeFieldSetColumnLabelInRules(u,f,e,t.id,t.label)),delete t.stepId,delete t.panelId,delete t.fieldsetId,Simulators.updateInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"columns"},{key:"id",val:o}],t),i=n):(n.replaceWith(i),Simulators.bindFieldSetColumnButtons(i),Simulators.addFieldSetColumnInActions(t),delete t.stepId,delete t.panelId,delete t.fieldsetId,Simulators.addInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"columns"}],t),Simulators.addFieldButtonToFieldRows(i.parents(".fieldset-grid-panel")));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)})};Simulators.checkFieldSetColumn=function(n){var i=n.attr("id"),t=$.trim($("#"+i+"-name").val()),r;if(t==="")return n.find(".error-message").text(Translator.trans("The column name is required")),n.find(".alert").show(),!1;if(!/^\w+$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect column name")),n.find(".alert").show(),!1;if(r=$.trim($("#"+i+"-label").val()),r==="")return n.find(".error-message").text(Translator.trans("The column label is required")),n.find(".alert").show(),!1;var f=n.find(".column-container").attr("data-step"),e=n.find(".column-container").attr("data-panel"),o=n.find(".column-container").attr("data-fieldset"),s=n.find(".column-container").attr("data-id"),h=Simulators.findInArray(steps,[{key:"id",val:f,list:"panels"},{key:"id",val:e,list:"blocks"},{key:"id",val:o}]),u=!1;return($.each(h.columns,function(n,i){if(i.id!=s&&i.name==t)return u=!0,!1}),u)?(n.find(".error-message").text(Translator.trans("This column name already exists")),n.find(".alert").show(),!1):!0};Simulators.addFieldSetColumn=function(n){var c,t,l,f;try{var i=n.parent(),r=i.find(".block-container.fieldset"),e=r.attr("data-step"),o=r.attr("data-panel"),s=r.attr("data-id"),h=Simulators.findInArray(steps,[{key:"id",val:e,list:"panels"},{key:"id",val:o,list:"blocks"},{key:"id",val:s}]),u=0;h.columns&&$.each(h.columns,function(n,t){t.id>u&&(u=t.id)});c={stepId:e,panelId:o,fieldsetId:s,id:parseInt(u)+1,name:"",label:"",type:""};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawFieldSetColumnForInput(c);t.find("button.cancel-edit-column").addClass("cancel-add-column").removeClass("cancel-edit-column");t.find("button.validate-edit-column").addClass("validate-add-column").removeClass("validate-edit-column");f=i.attr("id");l=f==="columns"?$("#collapsecolumns").find("> div.sortable"):i.find(".columns-panel > div.sortable");l.append(t);Simulators.bindFieldSetColumn(t);$("#collapse"+f).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(a){console&&console.log(a.message)}};Simulators.editFieldSetColumn=function(n){var e;try{var t=n.find(".column-container"),r=t.attr("data-step"),u=t.attr("data-panel"),f=t.attr("data-fieldset"),o=t.attr("data-id"),i=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"columns"},{key:"id",val:o}]);i.stepId=r;i.panelId=u;i.fieldsetId=f;$(".update-button").hide();$(".toggle-collapse-all").hide();e=Simulators.drawFieldSetColumnForInput(i);Simulators.columnBackup=t.replaceWith(e.find(".column-container"));Simulators.bindFieldSetColumn(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(s){console&&console.log(s.message)}};Simulators.deleteFieldSetColumn=function(n){try{var f=n.find(".column-container"),t=f.attr("data-step"),i=f.attr("data-panel"),r=f.attr("data-fieldset"),u=f.attr("data-id"),o=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r}]),s=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"columns"},{key:"id",val:u}]),h=s.label,e;if((e=Simulators.isFieldSetColumnInRules(t,i,r,u))!==!1){bootbox.alert({title:Translator.trans("Deleting column"),message:Translator.trans("This column is used in rule #%id%. You must modify this rule before you can delete this column",{id:e})});return}bootbox.confirm({title:Translator.trans("Deleting column"),message:Translator.trans("Are you sure you want to delete the column : %label%",{label:h}),callback:function(f){if(f){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"columns"},{key:"id",val:u}]);var e=n.parent();n.remove();Simulators.deleteFieldRowsColumn(t,i,r,u);Simulators.deleteFieldSetColumnInActions(t,i,r,u);Simulators.renumberFieldSetColumns(o.columns,t,i,r,e.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(c){console&&console.log(c.message)}}}(this),function(){"use strict";Simulators.renumberFootNotes=function(n,t,i){$.each(n,function(n,r){var o=r.id,u=n+1,h,c;if(u!=o){r.id=u;var e=i.eq(n),f=new RegExp("-footnote-"+o,"g"),s=e.attr("id");s=s.replace(f,"-footnote-"+u);e.attr("id",s);h=e.find("> .card-header").find("> h4");h.text(" "+Translator.trans("FootNote #%id%",{id:u}));e.attr("data-id",u);c=e.find("*");c.each(function(){var n;this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(f,"-footnote-"+u),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(f,"-footnote-"+u),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(f,"-footnote-"+u),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(f,"-footnote-"+u),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(f,"-footnote-"+u),$(this).attr("aria-labelledby",n))});Simulators.changeFootNoteIdInRules(t,o,"X"+u)}});$.each(n,function(n,i){Simulators.changeFootNoteIdInRules(t,"X"+i.id,i.id)})};Simulators.bindSortableFootNotes=function(n){n||(n=$("#steps .footnotes-panel.sortable"));n.sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var e=$(this),i=$(t.item),r=i.attr("data-step"),u=Simulators.findInArray(steps,[{key:"id",val:r}]),f=i.attr("data-id");Simulators.moveInArray(u.footNotes.footNotes,[{key:"id",val:f}],t.item.index())&&(Simulators.renumberFootNotes(u.footNotes.footNotes,r,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawFootNotesForDisplay=function(n){var t="step-"+n.stepId+"-footnotes",r=Simulators.openCollapsiblePanel(t,Translator.trans("FootNotes"),"success","in","",[{"class":"delete-footnotes",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"add-footnote",label:Translator.trans("Add footnote"),icon:"fa-plus-circle"},{"class":"edit-footnotes",label:Translator.trans("Edit"),icon:"fa-pencil"}]),u=r.find(".card-body"),f=$('<div class="card bg-light footnotes-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'"><\/div>'),e=$('<div class="card-body"><\/div>'),o=$('<div class="attributes-container"><\/div>'),s=$("<div><\/div>"),i;return s.append(Simulators.simpleAttributeForDisplay(t,"select","position",Translator.trans("Position"),n.position,n.position,!0,Translator.trans("Select a position"),JSON.stringify({beforeActions:Translator.trans("before action buttons"),afterActions:Translator.trans("after action buttons")}))),o.append(s),e.append(o),f.append(e),u.append(f),i=$('<div class="footnotes-panel sortable"><\/div>'),$.each(n.footNotes,function(t,r){r.stepId=n.stepId;i.append(Simulators.drawFootNoteForDisplay(r))}),u.append(i),r};Simulators.drawFootNotesForInput=function(n){var t="step-"+n.stepId+"-footnotes",e=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),r=$("<div>",{"class":"card bg-success"}),f,i;r.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">'+Translator.trans("FootNotes")+"<\/a><\/h4><\/div>");var o=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),s=$('<div class="card-body"><\/div>'),h=$('<div class="card bg-light footnotes-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'"><\/div>'),u=$('<div class="card-body"><\/div>'),c=$('<div class="attributes-container"><\/div>'),l=$("<div><\/div>");return l.append(Simulators.simpleAttributeForInput(t+"-position","select","position",Translator.trans("Position"),n.position,!0,Translator.trans("Select a position"),JSON.stringify({beforeActions:Translator.trans("before action buttons"),afterActions:Translator.trans("after action buttons")}))),c.append(l),u.append(c),h.append(u),s.append(h),f=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),i=$('<div class="card-body footnotes-buttons"><\/div>'),i.append('<button class="btn btn-success float-right validate-edit-footnotes">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),i.append('<button class="btn btn-secondary float-right cancel-edit-footnotes">'+Translator.trans("Cancel")+"<\/span><\/button>"),i.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),f.append(i),u.append(f),o.append(s),r.append(o),e.append(r),e};Simulators.bindFootNotesButtons=function(n){n||(n=$("#steps"));n.find("button.edit-footnotes").on("click",function(n){n.preventDefault();Simulators.editFootNotes($($(this).attr("data-parent")))});n.find("button.delete-footnotes").on("click",function(n){n.preventDefault();Simulators.deleteFootNotes($($(this).attr("data-parent")))});n.find("button.add-footnote").on("click",function(n){n.preventDefault();Simulators.addFootNote($($(this).attr("data-parent")))})};Simulators.bindFootNotes=function(n){n.find(".cancel-edit-footnotes").on("click",function(){n.find(".footnotes-container").replaceWith(Simulators.footnotesBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-footnotes").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-footnotes, .validate-add-footnotes").on("click",function(){var o=n.parent(),u=n.find(".footnotes-container"),r,t;if(!Simulators.checkFootNotes(n))return!1;var f=u.attr("data-step"),i={stepId:f},e=u.find(".attributes-container");e.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){i[$(this).attr("data-attribute")]=$(this).val()});r=Simulators.findInArray(steps,[{key:"id",val:f}]);i.footNotes=$(this).hasClass("validate-edit-footnotes")?r.footNotes.footNotes:[];t=Simulators.drawFootNotesForDisplay(i);delete i.stepId;$(this).hasClass("validate-edit-footnotes")?(u.replaceWith(t.find(".footnotes-container")),r.footNotes=i,t=n):(n.replaceWith(t),Simulators.bindSortableFootNotes(t.find(".sortable")),Simulators.bindFootNotesButtons(t),r.footNotes=i);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkFootNotes=function(n){var t=n.attr("id"),i=$("#"+t+"-position").val();return!0};Simulators.addFootNotes=function(n){var t,r;try{var u=n.find(".step-container"),i=u.attr("data-id"),o=Simulators.findInArray(steps,[{key:"id",val:i}]),f={stepId:i,position:"beforeActions",footNotes:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawFootNotesForInput(f);t.find("button.cancel-edit-footnotes").addClass("cancel-add-footnotes").removeClass("cancel-edit-footnotes");t.find("button.validate-edit-footnotes").addClass("validate-add-footnotes").removeClass("validate-edit-footnotes");r=n.find(".panels-panel");r.after(t);Simulators.bindFootNotes(t);n.find(".collapse").collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(e){console&&console.log(e.message)}};Simulators.editFootNotes=function(n){var u;try{var t=n.find(".footnotes-container"),i=t.attr("data-step"),f=Simulators.findInArray(steps,[{key:"id",val:i}]),r=f.footNotes;r.stepId=i;$(".update-button").hide();$(".toggle-collapse-all").hide();u=Simulators.drawFootNotesForInput(r);Simulators.footnotesBackup=t.replaceWith(u.find(".footnotes-container"));Simulators.bindFootNotes(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(e){console&&console.log(e.message)}};Simulators.deleteFootNotes=function(n){try{var i=n.find(".footnotes-container"),r=i.attr("data-step"),t=Simulators.findInArray(steps,[{key:"id",val:r}]),u=t.label?t.label:t.name;bootbox.confirm({title:Translator.trans("Deleting footnotes"),message:Translator.trans("Are you sure you want to delete the footnotes of step : %label%",{label:u}),callback:function(i){i&&(delete t.footNotes,n.remove(),$(".save-simulator").show(),Admin.updated=!0)}})}catch(f){console&&console.log(f.message)}};Simulators.drawFootNoteForDisplay=function(n){var i="step-"+n.stepId+"-footnotes-footnote"+n.id,r=$('<div class="card bg-light footnote-container" id="'+i+'-panel" data-step="'+n.stepId+'" data-id="'+n.id+'">'),t=$('<div class="card-header">'),u;return t.append('<button class="btn btn-secondary float-right update-button delete-footnote" title="'+Translator.trans("Delete")+'" data-parent="#'+i+'-panel"><span class="button-label">'+Translator.trans("Delete")+'<\/span> <span class="fas fa-minus-circle"><\/span><\/button>'),t.append('<button class="btn btn-secondary float-right update-button edit-footnote" title="'+Translator.trans("Edit")+'" data-parent="#'+i+'-panel"><span class="button-label">'+Translator.trans("Edit")+'<\/span> <span class="fas fa-pencil-alt"><\/span><\/button>'),t.append('<h4 class="card-title">'+Translator.trans("FootNote #%id%",{id:n.id})+"<\/h4>"),r.append(t),u=$('<div class="card-body step-footnote rich-text"><\/div>'),u.append(n.text.content),r.append(u),r};Simulators.drawFootNoteForInput=function(n){var i="step-"+n.stepId+"-footnotes-footnote"+n.id,u=$('<div class="card bg-light footnote-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-id="'+n.id+'"><\/div>'),e=$('<div class="card-header">'),r,f,t;return e.append('<h4 class="card-title">'+Translator.trans("FootNote #%id%",{id:n.id})+"<\/h4>"),u.append(e),r=$('<div class="card-body step-footnote"><\/div>'),r.append('<textarea rows="5" name="'+i+'-text" id="'+i+'-text" wrap="hard" class="form-control footnote-text">'+Simulators.paragraphs(n.text).content+"<\/textarea>"),f=$('<div class="card bg-light buttons-panel" id="'+i+'-buttons-panel"><\/div>'),t=$('<div class="card-body footnote-buttons"><\/div>'),t.append('<button class="btn btn-success float-right validate-edit-footnote">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),t.append('<button class="btn btn-secondary float-right cancel-edit-footnote">'+Translator.trans("Cancel")+"<\/span><\/button>"),t.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),f.append(t),r.append(f),u.append(r),u};Simulators.bindFootNoteButtons=function(n){n||(n=$("#steps"));n.find("button.edit-footnote").on("click",function(n){n.preventDefault();Simulators.editFootNote($($(this).attr("data-parent")))});n.find("button.delete-footnote").on("click",function(n){n.preventDefault();Simulators.deleteFootNote($($(this).attr("data-parent")))})};Simulators.bindFootNote=function(n){n.find("textarea").wysihtml(Admin.wysihtml5Options);n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-footnote").on("click",function(){n.replaceWith(Simulators.footnoteBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-footnote").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-footnote").on("click",function(){var i=n.parent(),u,f;if(!Simulators.checkFootNote(n))return!1;var r=i.attr("data-step"),e=i.attr("data-id"),t={id:e};t.stepId=r;t.text={content:Admin.clearHTML(n.find(".footnote-text")),edition:"wysihtml"};u=Simulators.findInArray(steps,[{key:"id",val:r}]);f=Simulators.drawFootNoteForDisplay(t);delete t.stepId;n.replaceWith(f.find(".step-footnote"));Simulators.updateInArray(u.footNotes.footNotes,[{key:"id",val:t.id}],t);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});n.find(".validate-add-footnote").on("click",function(){var u,i;if(!Simulators.checkFootNote(n))return!1;var r=n.attr("data-step"),f=n.attr("data-id"),t={id:f};t.stepId=r;t.text={content:n.find(".footnote-text").val(),edition:"wysihtml"};u=Simulators.findInArray(steps,[{key:"id",val:r}]);i=Simulators.drawFootNoteForDisplay(t);n.replaceWith(i);Simulators.bindFootNoteButtons(i);Simulators.addFootNoteInActions(t);delete t.stepId;Simulators.addInArray(u.footNotes.footNotes,[],t);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500);Simulators.updating=!1})};Simulators.checkFootNote=function(n){var t=n.find("textarea"),i=$.trim(t.val());return i===""?(n.find(".error-message").text(Translator.trans("Please enter a note")),n.find(".alert").show(),!1):!0};Simulators.addFootNote=function(n){var f,t,e;try{var o=n.parent().find(".step-container"),i=o.attr("data-id"),r=Simulators.findInArray(steps,[{key:"id",val:i}]),u=0;r.footNotes&&r.footNotes.footNotes&&$.each(r.footNotes.footNotes,function(n,t){t.id>u&&(u=t.id)});f={stepId:i,id:parseInt(u)+1,text:{content:"",edition:""}};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawFootNoteForInput(f);t.find("button.cancel-edit-footnote").addClass("cancel-add-footnote").removeClass("cancel-edit-footnote");t.find("button.validate-edit-footnote").addClass("validate-add-footnote").removeClass("validate-edit-footnote");e=$("#collapsestep-"+i+"-footnotes").find("> .card-body");e.append(t);Simulators.bindFootNote(t);$("#collapsestep-"+i+"-footnotes").collapse("show");$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(s){console&&console.log(s.message)}};Simulators.editFootNote=function(n){var u,t;try{var i=n.attr("data-step"),f=n.attr("data-id"),e=Simulators.findInArray(steps,[{key:"id",val:i}]),r=Simulators.findInArray(e.footNotes.footNotes,[{key:"id",val:f}]);r.stepId=i;$(".update-button").hide();$(".toggle-collapse-all").hide();u=Simulators.drawFootNoteForInput(r);t=u.find(".step-footnote");Simulators.footnoteBackup=n.find(".step-footnote").replaceWith(t);Simulators.bindFootNote(t);$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(o){console&&console.log(o.message)}};Simulators.deleteFootNote=function(n){var f;try{var t=n.attr("data-step"),i=n.attr("data-id"),r=Simulators.findInArray(steps,[{key:"id",val:t}]),u;if((u=Simulators.isFootNoteInRules(t,i))!==!1){bootbox.alert({title:Translator.trans("Deleting footnote"),message:Translator.trans("This footnote is used in rule #%id%. You must modify this rule before you can delete this footnote",{id:u})});return}if((f=Simulators.isFootnoteIdReferenced(t,i))!==!1){bootbox.alert({title:Translator.trans("Deleting footnote"),message:f+". "+Translator.trans("You must remove this reference before you can remove this footnote.")});return}bootbox.confirm({title:Translator.trans("Deleting footnote"),message:Translator.trans("Are you sure you want to delete the footnote : %id%",{id:i}),callback:function(u){if(u){Simulators.deleteInArray(r.footNotes.footNotes,[{key:"id",val:i}]);var f=n.parent();n.remove();Simulators.deleteFootNoteInActions(t,i);Simulators.renumberFootNotes(r.footNotes.footNotes,t,f.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(e){console&&console.log(e.message)}}}(this),function(){"use strict";Simulators.renumberPanels=function(n,t,i){$.each(n,function(n,r){var e=r.id,u=n+1,h,c,l;if(e!=0&&u!=e){r.id=u;var o=i.eq(n),f=new RegExp("-panel-"+e,"g"),s=o.attr("id");s=s.replace(f,"-panel-"+u);o.attr("id",s);h=o.find("> .card > .card-header").find("> h4 > a");h.text(" "+Translator.trans("Panel")+" #"+u+" : "+r.label+" ");c=o.find(".panel-container");c.attr("data-id",u);l=o.find("*");l.each(function(){var n;this.hasAttribute("data-panel")&&$(this).attr("data-panel",u);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(f,"-panel-"+u),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(f,"-panel-"+u),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(f,"-panel-"+u),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(f,"-panel-"+u),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(f,"-panel-"+u),$(this).attr("aria-labelledby",n))});Simulators.changePanelIdInActionButtons(t,e,"X"+u);Simulators.changePanelIdInRules(t,e,"X"+u)}});$.each(n,function(n,i){Simulators.changePanelIdInActionButtons(t,"X"+i.id,i.id);Simulators.changePanelIdInRules(t,"X"+i.id,i.id)})};Simulators.bindSortablePanels=function(n){n||(n=$("#steps .panels-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".panel-container"),r=i.attr("data-step"),u=Simulators.findInArray(steps,[{key:"id",val:r}]),f=i.attr("data-id");Simulators.moveInArray(u.panels,[{key:"id",val:f}],t.item.index())&&(Simulators.renumberPanels(u.panels,r,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawPanelForDisplay=function(n,t){var i="step-"+n.stepId+"-panel-"+n.id,u=Simulators.openCollapsiblePanel(i,Translator.trans("Panel")+" #"+n.id+" : "+n.label,"success",t,"sortable",[{"class":"delete-panel",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"add-fieldset",label:Translator.trans("Add fieldset"),icon:"fa-plus-circle"},{"class":"add-blockinfo",label:Translator.trans("Add blockinfo"),icon:"fa-plus-circle"},{"class":"edit-panel",label:Translator.trans("Edit"),icon:"fa-pencil"}]),f=u.find(".card-body"),e=$('<div class="card bg-light panel-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-id="'+n.id+'"><\/div>'),o=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),r=$("<div><\/div>");return r.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Panel name"))),r.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!0,Translator.trans("Panel label"))),s.append(r),o.append(s),e.append(o),f.append(e),f.append('<div class="card bg-light blocks-panel" id="'+i+'-blocks-panel"><div class="card-body sortable"><\/div><\/div>'),u};Simulators.drawPanelForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.id,l=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),u=$("<div>",{"class":"card bg-success"}),r,s,h,c,i;u.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">'+Translator.trans("Panel")+" #"+n.id+" : "+n.label+"<\/a><\/h4><\/div>");var a=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),v=$('<div class="card-body"><\/div>'),y=$('<div class="card bg-light panel-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),f=$('<div class="card-body"><\/div>'),e=$('<div class="attributes-container"><\/div>'),o=$("<div><\/div>");return o.append(Simulators.simpleAttributeForInput(t+"-name","text","name",Translator.trans("Name"),n.name,!1,Translator.trans("Panel name without spaces or special characters"))),e.append(o),r=$('<div class="optional-attributes card bg-light"><\/div>'),r.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),s=$('<ul class="list-group"><\/ul>'),h=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="label" data-placeholder="'+Translator.trans("Panel label")+'">'+Translator.trans("Label")+"<\/li>"),s.append(h),n.label&&(o.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!1,Translator.trans("Panel label"))),h.hide()),r.append(s),e.append(r),f.append(e),y.append(f),v.append(y),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),i=$('<div class="card-body panel-buttons"><\/div>'),i.append('<button class="btn btn-success float-right validate-edit-panel">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),i.append('<button class="btn btn-secondary float-right cancel-edit-panel">'+Translator.trans("Cancel")+"<\/span><\/button>"),i.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(i),f.append(c),a.append(v),u.append(a),l.append(u),l};Simulators.bindPanelButtons=function(n){n||(n=$("#steps .panels-panel"));n.find("button.edit-panel").on("click",function(n){n.preventDefault();Simulators.editPanel($($(this).attr("data-parent")))});n.find("button.delete-panel").on("click",function(n){n.preventDefault();Simulators.deletePanel($($(this).attr("data-parent")))});n.find("button.add-fieldset, a.add-fieldset").on("click",function(n){n.preventDefault();Simulators.addFieldSet($($(this).attr("data-parent")))});n.find("button.add-blockinfo, a.add-blockinfo").on("click",function(n){n.preventDefault();Simulators.addBlockInfo($($(this).attr("data-parent")))})};Simulators.bindPanel=function(n){n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-panel").on("click",function(){n.find(".panel-container").replaceWith(Simulators.panelBackup);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-panel").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-panel, .validate-add-panel").on("click",function(){var h=n.parent(),u=n.find(".panel-container"),s,e,o,i;if(!Simulators.checkPanel(n))return!1;var r=u.attr("data-step"),f=u.attr("data-id"),t={stepId:r,id:f,label:""};t.stepId=r;s=u.find(".attributes-container");s.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.name&&(t.name=$.trim(t.name));e="";$(this).hasClass("validate-edit-panel")?(o=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:f}]),e=o.label,t.blocks=o.blocks):t.blocks=[];i=Simulators.drawPanelForDisplay(t,"in");$(this).hasClass("validate-edit-panel")?(u.replaceWith(i.find(".panel-container")),t.label!=e&&(n.find("> div > .card-header > h4 a").text(" "+Translator.trans("Panel")+" #"+t.id+" : "+t.label+" "),Simulators.changePanelLabelInActionButtons(r,t.id,t.label),Simulators.changePanelLabelInRules(r,t.id,t.label)),delete t.stepId,Simulators.updateInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:f}],t),i=n):(n.replaceWith(i),Simulators.bindPanelButtons(i),Simulators.bindSortableBlocks(i.find(".blocks-panel")),Simulators.addPanelInActions(t),delete t.stepId,Simulators.addInArray(steps,[{key:"id",val:r,list:"panels"}],t));$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;i.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:i.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkPanel=function(n){var r=n.attr("id"),t=$.trim($("#"+r+"-name").val());if(t==="")return n.find(".error-message").text(Translator.trans("The panel name is required")),n.find(".alert").show(),!1;if(!/^\w+$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect panel name")),n.find(".alert").show(),!1;var u=n.find(".panel-container").attr("data-step"),f=n.find(".panel-container").attr("data-id"),i=!1,e=Simulators.findInArray(steps,[{key:"id",val:u}]);return($.each(e.panels,function(n,r){if(r.id!=f&&r.name==t)return i=!0,!1}),i)?(n.find(".error-message").text(Translator.trans("This panel name already exists")),n.find(".alert").show(),!1):!0};Simulators.addPanel=function(n){var f,t,e,o;try{var s=n.find(".step-container"),r=s.attr("data-id"),u=Simulators.findInArray(steps,[{key:"id",val:r}]),i=0;u.panels&&$.each(u.panels,function(n,t){t.id>i&&(i=t.id)});f={stepId:r,id:parseInt(i)+1,name:"",label:"",blocks:[]};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawPanelForInput(f);t.find("button.cancel-edit-panel").addClass("cancel-add-panel").removeClass("cancel-edit-panel");t.find("button.validate-edit-panel").addClass("validate-add-panel").removeClass("validate-edit-panel");o=n.attr("id");e=o==="panels"?$("#collapsepanels").find("> div.sortable"):n.find(".panels-panel > div.sortable");e.append(t);Simulators.bindPanel(t);$("#collapse"+n.attr("id")).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(h){console&&console.log(h.message)}};Simulators.editPanel=function(n){var u;try{var t=n.find(".panel-container"),i=t.attr("data-step"),f=t.attr("data-id"),r=Simulators.findInArray(steps,[{key:"id",val:i,list:"panels"},{key:"id",val:f}]);r.stepId=i;$(".update-button").hide();$(".toggle-collapse-all").hide();u=Simulators.drawPanelForInput(r);Simulators.panelBackup=t.replaceWith(u.find(".panel-container"));Simulators.bindPanel(n);$("#collapse"+n.attr("id")).collapse("show");$("html, body").animate({scrollTop:n.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(e){console&&console.log(e.message)}};Simulators.deletePanel=function(n){var e;try{var u=n.find(".panel-container"),t=u.attr("data-step"),i=u.attr("data-id"),o=Simulators.findInArray(steps,[{key:"id",val:t}]),r=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i}]),s=r.label?r.label:r.name,f;if((f=Simulators.isPanelInRules(t,i))!==!1){bootbox.alert({title:Translator.trans("Deleting panel"),message:Translator.trans("This panel is used in rule #%id%. You must modify this rule before you can delete this panel",{id:f})});return}if((e=Simulators.isPanelIdInActionButtons(t,i))!==!1){bootbox.alert({title:Translator.trans("Deleting panel"),message:Translator.trans("This panel is used in action button « %label% ». You must modify this action button before you can delete this panel",{label:e})});return}bootbox.confirm({title:Translator.trans("Deleting panel"),message:Translator.trans("Are you sure you want to delete the panel : %label%",{label:s}),callback:function(r){if(r){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i}]);var u=n.parent();n.remove();Simulators.deletePanelInActions(t,i);Simulators.renumberPanels(o.panels,t,u.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(h){console&&console.log(h.message)}};Simulators.renumberBlocks=function(n,t,i,r){$.each(n,function(n,u){var e=u.id,f=n+1,c,l,a;if(e!=0&&f!=e){u.id=f;var s=r.eq(n),o=new RegExp("-"+u.type+"-"+e,"g"),h=s.attr("id");h=h.replace(o,"-"+u.type+"-"+f);s.attr("id",h);c=s.find("> .card > .card-header").find("> h4 > a");u.type=="fieldset"?c.text(" "+Translator.trans("FieldSet")+" #"+f+" : "+u.legend.content+" "):c.text(" "+Translator.trans("BlockInfo")+" #"+f+" : "+u.label+" ");l=s.find(".block-container");l.attr("data-id",f);a=s.find("*");a.each(function(){var n;this.hasAttribute("data-"+u.type)&&$(this).attr("data-"+u.type,f);this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(o,"-"+u.type+"-"+f),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(o,"-"+u.type+"-"+f),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(o,"-"+u.type+"-"+f),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(o,"-"+u.type+"-"+f),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(o,"-"+u.type+"-"+f),$(this).attr("aria-labelledby",n))});u.type=="fieldset"?(Simulators.changeFieldsetIdInActionButtons(t,i,e,"X"+f),Simulators.changeFieldSetIdInRules(t,i,e,"X"+f)):(Simulators.changeBlockinfoIdInActionButtons(t,i,e,"X"+f),Simulators.changeBlockInfoIdInRules(t,i,e,"X"+f))}});$.each(n,function(n,r){r.type=="fieldset"?(Simulators.changeFieldsetIdInActionButtons(t,i,"X"+r.id,r.id),Simulators.changeFieldSetIdInRules(t,i,"X"+r.id,r.id)):(Simulators.changeBlockinfoIdInActionButtons(t,i,"X"+r.id,r.id),Simulators.changeBlockInfoIdInRules(t,i,"X"+r.id,r.id))})};Simulators.bindSortableBlocks=function(n){n||(n=$("#steps .blocks-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".block-container"),r=i.attr("data-step"),u=i.attr("data-panel"),f=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u}]),e=i.attr("data-id");Simulators.moveInArray(f.blocks,[{key:"id",val:e}],t.item.index())&&(Simulators.renumberBlocks(f.blocks,r,u,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})}}(this),function(){"use strict";Simulators.renumberSections=function(n,t,i,r,u,f){$.each(n,function(n,e){var h=e.id,o=n+1,a,v,y;if(h!=0&&o!=h){e.id=o;var c=f.eq(n),s=new RegExp("-section-"+h,"g"),l=c.attr("id");l=l.replace(s,"-section-"+o);c.attr("id",l);a=c.find("> .card > .card-header").find("> h4 > a");a.text(" "+Translator.trans("Section")+" #"+o+" : "+e.label+" ");v=c.find(".section-container");v.attr("data-id",o);y=c.find("*");y.each(function(){var n;this.hasAttribute("id")&&(n=$(this).attr("id"),n=n.replace(s,"-section-"+o),$(this).attr("id",n));this.hasAttribute("data-parent")&&(n=$(this).attr("data-parent"),n=n.replace(s,"-section-"+o),$(this).attr("data-parent",n));this.hasAttribute("href")&&(n=$(this).attr("href"),n=n.replace(s,"-section-"+o),$(this).attr("href",n));this.hasAttribute("aria-controls")&&(n=$(this).attr("aria-controls"),n=n.replace(s,"-section-"+o),$(this).attr("aria-controls",n));this.hasAttribute("aria-labelledby")&&(n=$(this).attr("aria-labelledby"),n=n.replace(s,"-section-"+o),$(this).attr("aria-labelledby",n))});Simulators.changeSectionIdInActionButtons(t,i,r,u,h,"X"+o);Simulators.changeSectionIdInRules(t,i,r,u,h,"X"+o)}});$.each(n,function(n,f){Simulators.changeSectionIdInActionButtons(t,i,r,u,"X"+f.id,f.id);Simulators.changeSectionIdInRules(t,i,r,u,"X"+f.id,f.id)})};Simulators.bindSortableSections=function(n){n||(n=$("#steps .sections-panel"));n.find(".sortable").sortable({cursor:"move",containment:"parent",axis:"y",update:function(n,t){var i=$(t.item).find(".section-container"),r=i.attr("data-step"),u=i.attr("data-panel"),f=i.attr("data-blockinfo"),e=i.attr("data-chapter"),o=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"chapters"},{key:"id",val:e}]),s=i.attr("data-id");Simulators.moveInArray(o.sections,[{key:"id",val:s}],t.item.index())&&(Simulators.renumberSections(o.sections,r,u,f,e,$(t.item).parent().find("> div")),$(".update-button").show(),$(".toggle-collapse-all").show(),Admin.updated=!0)}})};Simulators.drawSectionForDisplay=function(n,t){var i="step-"+n.stepId+"-panel-"+n.panelId+"-blockinfo-"+n.blockinfoId+"-chapter-"+n.chapterId+"-section-"+n.id,f=Simulators.openCollapsiblePanel(i,Translator.trans("Section #%id% : %label%",{id:n.id,label:n.label}),"info",t,"",[{"class":"delete-section",label:Translator.trans("Delete"),icon:"fa-minus-circle"},{"class":"edit-section",label:Translator.trans("Edit"),icon:"fa-pencil"}]),r=f.find(".card-body"),e=$('<div class="card bg-light section-container" id="'+i+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-blockinfo="'+n.blockinfoId+'" data-chapter="'+n.chapterId+'" data-id="'+n.id+'"><\/div>'),o=$('<div class="card-body"><\/div>'),s=$('<div class="attributes-container"><\/div>'),u=$("<div><\/div>");return u.append(Simulators.simpleAttributeForDisplay(i,"text","name",Translator.trans("Name"),n.name,n.name,!0,Translator.trans("Section name"))),u.append(Simulators.simpleAttributeForDisplay(i,"text","label",Translator.trans("Label"),n.label,n.label,!1,Translator.trans("Section label"))),s.append(u),o.append(s),e.append(o),r.append(e),r.append('<div class="card bg-light content-panel" id="'+i+'-content-panel"><div class="card-header">'+Translator.trans("Content")+'<\/div><div class="card-body section-content rich-text" data-edition="'+n.content.edition+'">'+n.content.content+"<\/div><\/div>"),n.annotations&&r.append('<div class="card bg-light annotations-panel" id="'+i+'-annotations-panel"><div class="card-header">'+Translator.trans("Annotations")+'<\/div><div class="card-body section-annotations rich-text" data-edition="'+n.annotations.edition+'">'+n.annotations.content+"<\/div><\/div>"),f};Simulators.drawSectionForInput=function(n){var t="step-"+n.stepId+"-panel-"+n.panelId+"-blockinfo-"+n.blockinfoId+"-chapter-"+n.chapterId+"-section-"+n.id,l=$("<div>",{"class":"panel-group",id:t,role:"tablist","aria-multiselectable":"true"}),f=$("<div>",{"class":"card bg-info"}),u,s,h,c,r;f.append('<div class="card-header" role="tab" id="'+t+'-panel"><h4 class="card-title"><a data-toggle="collapse" data-parent="#'+t+'" href="#collapse'+t+'" aria-expanded="true" aria-controls="collapse'+t+'">#'+n.id+" : "+n.label+"<\/a><\/h4><\/div>");var a=$('<div id="collapse'+t+'" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="'+t+'-panel"><\/div>'),i=$('<div class="card-body"><\/div>'),v=$('<div class="card bg-light section-container" id="'+t+'-attributes-panel" data-step="'+n.stepId+'" data-panel="'+n.panelId+'" data-blockinfo="'+n.blockinfoId+'" data-chapter="'+n.chapterId+'" data-id="'+n.id+'" data-name="'+n.name+'"><\/div>'),y=$('<div class="card-body"><\/div>'),e=$('<div class="attributes-container"><\/div>'),o=$("<div><\/div>");return o.append(Simulators.simpleAttributeForInput(t+"-name","text","name",Translator.trans("Name"),n.name,!1,Translator.trans("Section name"))),e.append(o),u=$('<div class="optional-attributes card bg-light"><\/div>'),u.append('<div class="card-header"><h4 class="card-title">'+Translator.trans("Optional attributes")+"<\/h4><\/div>"),s=$('<ul class="list-group"><\/ul>'),h=$('<li class="list-group-item" tabindex="0" data-element="'+t+'" data-type="text" data-name="label" data-placeholder="'+Translator.trans("Section label")+'">'+Translator.trans("Label")+"<\/li>"),s.append(h),n.label&&(o.append(Simulators.simpleAttributeForInput(t+"-label","text","label",Translator.trans("Label"),n.label,!1,Translator.trans("Section label"))),h.hide()),u.append(s),e.append(u),y.append(e),v.append(y),i.append(v),i.append('<div class="card bg-light content-panel" id="'+t+'-content-panel"><div class="card-header">'+Translator.trans("Content")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-content" id="'+t+'-content" wrap="hard" class="form-control section-content">'+Simulators.paragraphs(n.content).content+"<\/textarea><\/div><\/div>"),i.append('<div class="card bg-light annotations-panel" id="'+t+'-annotations-panel"><div class="card-header">'+Translator.trans("Annotations")+'<\/div><div class="card-body"><textarea rows="5" name="'+t+'-annotations" id="'+t+'-annotations" wrap="hard" class="form-control section-annotations">'+Simulators.paragraphs(n.annotations).content+"<\/textarea><\/div><\/div>"),c=$('<div class="card bg-light buttons-panel" id="'+t+'-buttons-panel"><\/div>'),r=$('<div class="card-body section-buttons"><\/div>'),r.append('<button class="btn btn-success float-right validate-edit-section">'+Translator.trans("Validate")+' <span class="fas fa-check"><\/span><\/button>'),r.append('<button class="btn btn-secondary float-right cancel-edit-section">'+Translator.trans("Cancel")+"<\/span><\/button>"),r.append('<div class="alert alert-danger" role="alert"><span class="fas fa-exclamation-circle" aria-hidden="true"><\/span><span class="sr-only">'+Translator.trans("Error")+':<\/span> <span class="error-message"><\/span><\/div>'),c.append(r),i.append(c),a.append(i),f.append(a),l.append(f),l};Simulators.bindSectionButtons=function(n){n||(n=$("#steps .sections-panel"));n.find("button.edit-section").on("click",function(n){n.preventDefault();Simulators.editSection($($(this).attr("data-parent")))});n.find("button.delete-section").on("click",function(n){n.preventDefault();Simulators.deleteSection($($(this).attr("data-parent")))})};Simulators.bindSection=function(n){n.find("textarea").wysihtml(Admin.wysihtml5Options);n.find(".sortable").sortable({cursor:"move",axis:"y"});n.find(".cancel-edit-section").on("click",function(){n.replaceWith(Simulators.sectionBackup);Simulators.sectionBackup.find("button.edit-section").on("click",function(n){n.preventDefault();Simulators.editSection($($(this).attr("data-parent")))});Simulators.sectionBackup.find("button.delete-section").on("click",function(n){n.preventDefault();Simulators.deleteSection($($(this).attr("data-parent")))});$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".cancel-add-section").on("click",function(){n.remove();$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated||$(".save-simulator").hide();Simulators.updating=!1});n.find(".validate-edit-section, .validate-add-section").on("click",function(){var a=n.parent(),i=n.find(".section-container"),s,o,h;if(!Simulators.checkSection(n))return!1;var r=i.attr("data-step"),u=i.attr("data-panel"),f=i.attr("data-blockinfo"),e=i.attr("data-chapter"),c=i.attr("data-id"),t={id:c,stepId:r,panelId:u,blockinfoId:f,chapterId:e,label:"",content:{content:"",edition:""},annotations:{content:"",edition:""}},l=i.find(".attributes-container");l.find("input:not(:checkbox).simple-value, input:checkbox:checked.simple-value, select.simple-value").each(function(){t[$(this).attr("data-attribute")]=$(this).val()});t.name&&(t.name=$.trim(t.name));t.content={content:Admin.clearHTML(n.find(".section-content")),edition:"wysihtml"};s=Admin.clearHTML(n.find(".section-annotations"));s!=""?t.annotations={content:s,edition:"wysihtml"}:delete t.annotations;o=Simulators.drawSectionForDisplay(t,"in");delete t.stepId;delete t.panelId;delete t.blockinfoId;delete t.chapterId;n.replaceWith(o);Simulators.bindSectionButtons(o);$(this).hasClass("validate-edit-section")?(h=Simulators.findInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"chapters"},{key:"id",val:e,list:"sections"},{key:"id",val:t.id}]),t.label!=h.label&&(Simulators.changeSectionLabelInActionButtons(r,u,f,e,t.id,t.label),Simulators.changeSectionLabelInRules(r,u,f,e,t.id,t.label)),Simulators.updateInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"chapters"},{key:"id",val:e,list:"sections"},{key:"id",val:t.id}],t)):Simulators.addInArray(steps,[{key:"id",val:r,list:"panels"},{key:"id",val:u,list:"blocks"},{key:"id",val:f,list:"chapters"},{key:"id",val:e,list:"sections"}],t);$(".update-button").show();$(".toggle-collapse-all").show();Admin.updated=!0;Simulators.updating=!1;o.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:o.offset().top-$("#navbar").height()},500)});Simulators.bindOptionalAttributes(n)};Simulators.checkSection=function(n){var i=n.attr("id"),t=$.trim($("#"+i+"-name").val()),r;if(t==="")return n.find(".error-message").text(Translator.trans("The section name is required")),n.find(".alert").show(),!1;if(!/^\w+$/.test(t))return n.find(".error-message").text(Translator.trans("Incorrect section name")),n.find(".alert").show(),!1;if(r=$.trim($("#"+i+"-content").val()),r==="")return n.find(".error-message").text(Translator.trans("The section content is required")),n.find(".alert").show(),!1;var f=n.find(".section-container").attr("data-step"),e=n.find(".section-container").attr("data-panel"),o=n.find(".section-container").attr("data-blockinfo"),s=n.find(".section-container").attr("data-chapter"),h=n.find(".section-container").attr("data-id"),c=Simulators.findInArray(steps,[{key:"id",val:f,list:"panels"},{key:"id",val:e,list:"blocks"},{key:"id",val:o,list:"chapters"},{key:"id",val:s}]),u=!1;return($.each(c.sections,function(n,i){if(i.id!=h&&i.name==t)return u=!0,!1}),u)?(n.find(".error-message").text(Translator.trans("This section name already exists")),n.find(".alert").show(),!1):!0};Simulators.addSection=function(n){var c,t,l,u;try{var i=n.find(".chapter-container"),f=i.attr("data-step"),e=i.attr("data-panel"),o=i.attr("data-blockinfo"),s=i.attr("data-id"),h=Simulators.findInArray(steps,[{key:"id",val:f,list:"panels"},{key:"id",val:e,list:"blocks"},{key:"id",val:o,list:"chapters"},{key:"id",val:s}]),r=0;h.sections&&$.each(h.sections,function(n,t){t.id>r&&(r=t.id)});c={stepId:f,panelId:e,blockinfoId:o,chapterId:s,id:parseInt(r)+1,name:"",label:"",content:{content:"",edition:""},annotations:{content:"",edition:""}};$(".toggle-collapse-all").hide();$(".update-button").hide();t=Simulators.drawSectionForInput(c);t.find("button.cancel-edit-section").addClass("cancel-add-section").removeClass("cancel-edit-section");t.find("button.validate-edit-section").addClass("validate-add-section").removeClass("validate-edit-section");u=n.attr("id");l=u==="sections"?$("#collapsesections").find("> div.sortable"):n.find(".sections-panel > div.sortable");l.append(t);Simulators.bindSection(t);$("#collapse"+u).collapse("show");t.find('a[data-toggle="collapse"]').each(function(){var n=$(this).attr("href");$(n).collapse("show")});$("html, body").animate({scrollTop:t.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(a){console&&console.log(a.message)}};Simulators.editSection=function(n){var r;try{var i=n.find(".section-container"),u=i.attr("data-step"),f=i.attr("data-panel"),e=i.attr("data-blockinfo"),o=i.attr("data-chapter"),s=i.attr("data-id"),t=Simulators.findInArray(steps,[{key:"id",val:u,list:"panels"},{key:"id",val:f,list:"blocks"},{key:"id",val:e,list:"chapters"},{key:"id",val:o,list:"sections"},{key:"id",val:s}]);t.stepId=u;t.panelId=f;t.blockinfoId=e;t.chapterId=o;t.annotations||(t.annotations={content:"",edition:""});$(".update-button").hide();$(".toggle-collapse-all").hide();r=Simulators.drawSectionForInput(t);Simulators.sectionBackup=n.replaceWith(r);Simulators.bindSection(r);$("#collapse"+r.attr("id")).collapse("show");$("html, body").animate({scrollTop:r.offset().top-$("#navbar").height()},500);Simulators.updating=!0}catch(h){console&&console.log(h.message)}};Simulators.deleteSection=function(n){var h;try{var f=n.find(".section-container"),t=f.attr("data-step"),i=f.attr("data-panel"),r=f.attr("data-blockinfo"),u=f.attr("data-chapter"),e=f.attr("data-id"),c=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"chapters"},{key:"id",val:u}]),o=Simulators.findInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"chapters"},{key:"id",val:u,list:"sections"},{key:"id",val:e}]),l=o.label!==""?o.label:o.name,s;if((s=Simulators.isSectionInRules(t,i,r,u,e))!==!1){bootbox.alert({title:Translator.trans("Deleting section"),message:Translator.trans("This section is used in rule #%id%. You must modify this rule before you can delete this section",{id:s})});return}if((h=Simulators.isSectionIdInActionButtons(t,i,r,u,e))!==!1){bootbox.alert({title:Translator.trans("Deleting section"),message:Translator.trans("This section is used in action button « %label% ». You must modify this action button before you can delete this section",{label:h})});return}bootbox.confirm({title:Translator.trans("Deleting section"),message:Translator.trans("Are you sure you want to delete the section : %label%",{label:l}),callback:function(f){if(f){Simulators.deleteInArray(steps,[{key:"id",val:t,list:"panels"},{key:"id",val:i,list:"blocks"},{key:"id",val:r,list:"chapters"},{key:"id",val:u,list:"sections"},{key:"id",val:e}]);var o=n.parent();n.remove();Simulators.deleteSectionInActions(t,i,r,u,e);Simulators.renumberSections(c.sections,t,i,r,u,o.find("> div"));$(".save-simulator").show();Admin.updated=!0}}})}catch(a){console&&console.log(a.message)}}}(this)